/*
 * This is a near-direct port of Robert Penner's easing equations. Please shower Robert with
 * praise and all of your admiration. His license is provided below.
 *
 * For information on how to use these functions in your animations, check out: 
 * http://www.kirupa.com/html5/animating_with_easing_functions_in_javascript.htm
 *
 * -Kirupa
 */

/*
 *
 * TERMS OF USE - EASING EQUATIONS
 * 
 * Open source under the BSD License. 
 * 
 * Copyright Â© 2001 Robert Penner
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
 */

function linearEase(e,t,n,r){return n*e/r+t}function easeInQuad(e,t,n,r){return n*(e/=r)*e+t}function easeOutQuad(e,t,n,r){return-n*(e/=r)*(e-2)+t}function easeInOutQuad(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}function easeInCubic(e,t,n,r){return n*Math.pow(e/r,3)+t}function easeOutCubic(e,t,n,r){return n*(Math.pow(e/r-1,3)+1)+t}function easeInOutCubic(e,t,n,r){return(e/=r/2)<1?n/2*Math.pow(e,3)+t:n/2*(Math.pow(e-2,3)+2)+t}function easeInQuart(e,t,n,r){return n*Math.pow(e/r,4)+t}function easeOutQuart(e,t,n,r){return-n*(Math.pow(e/r-1,4)-1)+t}function easeInOutQuart(e,t,n,r){return(e/=r/2)<1?n/2*Math.pow(e,4)+t:-n/2*(Math.pow(e-2,4)-2)+t}function easeInQuint(e,t,n,r){return n*Math.pow(e/r,5)+t}function easeOutQuint(e,t,n,r){return n*(Math.pow(e/r-1,5)+1)+t}function easeInOutQuint(e,t,n,r){return(e/=r/2)<1?n/2*Math.pow(e,5)+t:n/2*(Math.pow(e-2,5)+2)+t}function easeInSine(e,t,n,r){return n*(1-Math.cos(e/r*(Math.PI/2)))+t}function easeOutSine(e,t,n,r){return n*Math.sin(e/r*(Math.PI/2))+t}function easeInOutSine(e,t,n,r){return n/2*(1-Math.cos(Math.PI*e/r))+t}function easeInExpo(e,t,n,r){return n*Math.pow(2,10*(e/r-1))+t}function easeOutExpo(e,t,n,r){return n*(-Math.pow(2,-10*e/r)+1)+t}function easeInOutExpo(e,t,n,r){return(e/=r/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(-Math.pow(2,-10*--e)+2)+t}function easeInCirc(e,t,n,r){return n*(1-Math.sqrt(1-(e/=r)*e))+t}function easeOutCirc(e,t,n,r){return n*Math.sqrt(1-(e=e/r-1)*e)+t}function easeInOutCirc(e,t,n,r){return(e/=r/2)<1?n/2*(1-Math.sqrt(1-e*e))+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t}define("application-constants",[],function(){return StorageMode={},StorageMode.LOCAL="local",StorageMode.SESSION="session",StorageMode.NONE="none",IncomeAtPensionMode={},IncomeAtPensionMode.SIMPLE="simple",IncomeAtPensionMode.FULL="full",IncomeAtPensionAlternativeMode={},IncomeAtPensionAlternativeMode.NONE="none",IncomeAtPensionAlternativeMode.SIMPLE="simple",RiskAlternativeMode={},RiskAlternativeMode.NONE="none",RiskAlternativeMode.SIMPLE="simple",RiskMode={},RiskMode.SIMPLE="simple",RiskMode.FULL="full",HouseAffordabilityScenarioMode={},HouseAffordabilityScenarioMode.SIMPLE="simple",HouseAffordabilityScenarioMode.FULL="full",HouseAffordabilityAlternativeMode={},HouseAffordabilityAlternativeMode.NONE="none",HouseAffordabilityAlternativeMode.SIMPLE="simple",HouseAffordabilityAlternativeMode.FULL="full",HouseAffordabilityAlternativeRiskMode={},HouseAffordabilityAlternativeRiskMode.NONE="none",HouseAffordabilityAlternativeRiskMode.SIMPLE="simple",HouseAffordabilityAlternativeRiskMode.FULL="full",AmortizationComparisonMode={},AmortizationComparisonMode.SIMPLE="simple",AmortizationComparisonMode.FULL="full",TaxableIncomeMode={},TaxableIncomeMode.SIMPLE="simple",TaxableIncomeMode.FULL="full",InheritanceMode={},InheritanceMode.SIMPLE="simple",InheritanceMode.FULL="full",RelevantIncomeMode={},RelevantIncomeMode.GROSS="gross",RelevantIncomeMode.NET="net",{}}),define("base-application-parameters",["application-constants"],function(){"use strict";var e={googleAnalyticsID:void 0,storageMode:StorageMode.NONE,serverCalculation:!1,printServiceURL:"http://localhost:8080/puma/print",informParentWindowOnPrintSuccess:!1,fileServiceURL:"http://localhost:8080/puma/file",calculatorServiceURL:"http://localhost:8080/puma/calculator",productListServiceURL:"",userModulesServiceURL:"http://localhost:8080/puma/userModules",mediaServiceURL:"http://localhost:8080/puma/media",statisticsServiceURL:"http://localhost:8080/puma/statistics",contactServiceURL:"",contactCustomizationUrl:"",screenContactUrlByIframe:!0,toEmail:"",dossierExpirationDays:"",rentalVsCapitalPDFURL:"",printDocName:"online.standard",printCustomization:"standard",storageCustomization:"standard",calculatorCustomization:"rpopulaires",calculatorMainHouseAffordabilityCustomization:null,calculatorMainHouseCostsCustomization:null,calculatorSecondHouseAffordabilityCustomization:null,calculatorSecondHouseCostsCustomization:null,userModulesCustomization:"standard",productListCustomization:"standard",contactCustomization:"standard",mediaCustomization:"standard",statisticsCustomization:"standard",authenticationServiceURL:"",storageServiceURL:"",httpTimeout:8e3,contactTimeout:16e3,incomeAtPensionLongTermAvailable:!0,incomeAtPensionMode:IncomeAtPensionMode.SIMPLE,incomeAtPensionAlternativeMode:IncomeAtPensionAlternativeMode.SIMPLE,incomeAtPensionFirstPillarIncomeOptionAvailable:!0,incomeAtPensionSecondPillarSelectionAvailable:!0,incomeAtPensionBridgingRentAvailable:!0,fortunePensionInterestOptionsAvailable:!1,riskMode:RiskMode.FULL,riskAllowSecondPersonFocusing:!0,houseAffordabilityScenarioMode:HouseAffordabilityScenarioMode.SIMPLE,houseAffordabilityAlternativeMode:HouseAffordabilityAlternativeMode.NONE,houseAffordabilityAlternativeRiskMode:HouseAffordabilityAlternativeRiskMode.NONE,amortizationComparisonMode:AmortizationComparisonMode.FULL,taxableIncomeMode:TaxableIncomeMode.SIMPLE,inheritanceMode:InheritanceMode.FULL,inheritanceSelectMode:!1,relevantIncomeMode:RelevantIncomeMode.GROSS,consultantMode:!1,requirePaths:null,authorizedContainers:[],authorizedCalculators:[]};return e}),define("enums-constants",[],function(){return Sex={},Sex.MALE=1,Sex.FEMALE=2,SexOptions=[Sex.MALE,Sex.FEMALE],CivilStatus={},CivilStatus.SINGLE=1,CivilStatus.MARRIED=2,CivilStatus.SINGLE_IN_CONCUBINAGE=3,CivilStatusOptions=[CivilStatus.SINGLE,CivilStatus.MARRIED,CivilStatus.SINGLE_IN_CONCUBINAGE],ProfessionalStatus={},ProfessionalStatus.EMPLOYEE=1,ProfessionalStatus.SELF_EMPLOYEE_SECOND_PILLAR_INSURED=2,ProfessionalStatus.SELF_EMPLOYEE_NO_SECOND_PILLAR_INSURED=3,ProfessionalStatusOptions=[ProfessionalStatus.EMPLOYEE,ProfessionalStatus.SELF_EMPLOYEE_SECOND_PILLAR_INSURED,ProfessionalStatus.SELF_EMPLOYEE_NO_SECOND_PILLAR_INSURED],Saving3aInvestmentOptions={},Saving3aInvestmentOptions.BANKACCOUNT3A=1,Saving3aInvestmentOptions.OTHERINVESTMENT3A=2,Saving3aInvestmentOptionsOptions=[Saving3aInvestmentOptions.BANKACCOUNT3A,Saving3aInvestmentOptions.OTHERINVESTMENT3A],HouseInterestOptions={},HouseInterestOptions.LIBOR=1,HouseInterestOptions.VARIABLEMORTGAGE=2,HouseInterestOptions.FIXEDRATEMORTGAGE=3,HouseInterestOptions.DISCOUNTRATE=4,HouseInterestOptionsOptions=[HouseInterestOptions.LIBOR,HouseInterestOptions.VARIABLEMORTGAGE,HouseInterestOptions.FIXEDRATEMORTGAGE,HouseInterestOptions.DISCOUNTRATE],HouseInterestOptions2={},HouseInterestOptions2.FESTHYPOTHEK1JAHR=1,HouseInterestOptions2.FESTHYPOTHEK2JAHR=2,HouseInterestOptions2.FESTHYPOTHEK3JAHR=3,HouseInterestOptions2.VARIABLEHYPOTHEK=4,HouseInterestOptions2Options=[HouseInterestOptions2.FESTHYPOTHEK1JAHR,HouseInterestOptions2.FESTHYPOTHEK2JAHR,HouseInterestOptions2.FESTHYPOTHEK3JAHR,HouseInterestOptions2.VARIABLEHYPOTHEK],PasswordStrength={},PasswordStrength.UNDEFINED=0,PasswordStrength.INVALID=1,PasswordStrength.WEAK=2,PasswordStrength.MEDIUM=3,PasswordStrength.STRONG=4,PasswordStrengthOptions=[PasswordStrength.UNDEFINED,PasswordStrength.INVALID,PasswordStrength.WEAK,PasswordStrength.MEDIUM,PasswordStrength.STRONG],StorageServiceResultStatus={},StorageServiceResultStatus.OK=1,StorageServiceResultStatus.SERVERERROR=2,StorageServiceResultStatus.UNAUTHORIZED=3,StorageServiceResultStatus.DOSSIERNOTFOUND=4,StorageServiceResultStatus.DOSSIERNOTAVAILABLE=5,StorageServiceResultStatusOptions=[StorageServiceResultStatus.OK,StorageServiceResultStatus.SERVERERROR,StorageServiceResultStatus.UNAUTHORIZED,StorageServiceResultStatus.DOSSIERNOTFOUND,StorageServiceResultStatus.DOSSIERNOTAVAILABLE],ContactServiceResultStatus={},ContactServiceResultStatus.OK=1,ContactServiceResultStatus.SERVERERROR=2,ContactServiceResultStatus.UNAUTHORIZED=3,ContactServiceResultStatus.DOSSIERNOTFOUND=4,ContactServiceResultStatusOptions=[ContactServiceResultStatus.OK,ContactServiceResultStatus.SERVERERROR,ContactServiceResultStatus.UNAUTHORIZED,ContactServiceResultStatus.DOSSIERNOTFOUND],AuthenticationServiceRegistrationResultStatus={},AuthenticationServiceRegistrationResultStatus.SUCCEEDED=1,AuthenticationServiceRegistrationResultStatus.FAILED=2,AuthenticationServiceRegistrationResultStatus.USERALREADYEXISTS=3,AuthenticationServiceRegistrationResultStatusOptions=[AuthenticationServiceRegistrationResultStatus.SUCCEEDED,AuthenticationServiceRegistrationResultStatus.FAILED,AuthenticationServiceRegistrationResultStatus.USERALREADYEXISTS],AuthenticationServiceLoginResultStatus={},AuthenticationServiceLoginResultStatus.SUCCEEDED=1,AuthenticationServiceLoginResultStatus.FAILED=2,AuthenticationServiceLoginResultStatus.INVALIDUSERORPASSWORD=3,AuthenticationServiceLoginResultStatus.USERINACTIVE=4,AuthenticationServiceLoginResultStatus.USERBLOCKED=5,AuthenticationServiceLoginResultStatusOptions=[AuthenticationServiceLoginResultStatus.SUCCEEDED,AuthenticationServiceLoginResultStatus.FAILED,AuthenticationServiceLoginResultStatus.INVALIDUSERORPASSWORD,AuthenticationServiceLoginResultStatus.USERINACTIVE,AuthenticationServiceLoginResultStatus.USERBLOCKED],AuthenticationServiceLoginRememberedUserResultStatus={},AuthenticationServiceLoginRememberedUserResultStatus.SUCCEEDED=1,AuthenticationServiceLoginRememberedUserResultStatus.FAILED=2,AuthenticationServiceLoginRememberedUserResultStatus.INVALIDUSER=3,AuthenticationServiceLoginRememberedUserResultStatusOptions=[AuthenticationServiceLoginRememberedUserResultStatus.SUCCEEDED,AuthenticationServiceLoginRememberedUserResultStatus.FAILED,AuthenticationServiceLoginRememberedUserResultStatus.INVALIDUSER],AuthenticationServiceUpdateUserAccountResultStatus={},AuthenticationServiceUpdateUserAccountResultStatus.SUCCEEDED=1,AuthenticationServiceUpdateUserAccountResultStatus.FAILED=2,AuthenticationServiceUpdateUserAccountResultStatus.INVALIDUSERORPASSWORD=3,AuthenticationServiceUpdateUserAccountResultStatus.UNAUTHORIZED=4,AuthenticationServiceUpdateUserAccountResultStatusOptions=[AuthenticationServiceUpdateUserAccountResultStatus.SUCCEEDED,AuthenticationServiceUpdateUserAccountResultStatus.FAILED,AuthenticationServiceUpdateUserAccountResultStatus.INVALIDUSERORPASSWORD,AuthenticationServiceUpdateUserAccountResultStatus.UNAUTHORIZED],AuthenticationServiceUpdatePasswordResultStatus={},AuthenticationServiceUpdatePasswordResultStatus.SUCCEEDED=1,AuthenticationServiceUpdatePasswordResultStatus.FAILED=2,AuthenticationServiceUpdatePasswordResultStatus.INVALIDUSERORPASSWORD=3,AuthenticationServiceUpdatePasswordResultStatus.UNAUTHORIZED=4,AuthenticationServiceUpdatePasswordResultStatusOptions=[AuthenticationServiceUpdatePasswordResultStatus.SUCCEEDED,AuthenticationServiceUpdatePasswordResultStatus.FAILED,AuthenticationServiceUpdatePasswordResultStatus.INVALIDUSERORPASSWORD,AuthenticationServiceUpdatePasswordResultStatus.UNAUTHORIZED],AuthenticationServiceResetPasswordResultStatus={},AuthenticationServiceResetPasswordResultStatus.SUCCEEDED=1,AuthenticationServiceResetPasswordResultStatus.FAILED=2,AuthenticationServiceResetPasswordResultStatus.USERNOTFOUND=3,AuthenticationServiceResetPasswordResultStatusOptions=[AuthenticationServiceResetPasswordResultStatus.SUCCEEDED,AuthenticationServiceResetPasswordResultStatus.FAILED,AuthenticationServiceResetPasswordResultStatus.USERNOTFOUND],AuthenticationServiceRegistrationConfirmationResultStatus={},AuthenticationServiceRegistrationConfirmationResultStatus.SUCCEEDED=1,AuthenticationServiceRegistrationConfirmationResultStatus.ALREADYCONFIRMED=2,AuthenticationServiceRegistrationConfirmationResultStatus.SERVERERROR=3,AuthenticationServiceRegistrationConfirmationResultStatus.NOCONFIRMATIONPENDING=4,AuthenticationServiceRegistrationConfirmationResultStatus.EXPIREDORINVALIDDATA=5,AuthenticationServiceRegistrationConfirmationResultStatusOptions=[AuthenticationServiceRegistrationConfirmationResultStatus.SUCCEEDED,AuthenticationServiceRegistrationConfirmationResultStatus.ALREADYCONFIRMED,AuthenticationServiceRegistrationConfirmationResultStatus.SERVERERROR,AuthenticationServiceRegistrationConfirmationResultStatus.NOCONFIRMATIONPENDING,AuthenticationServiceRegistrationConfirmationResultStatus.EXPIREDORINVALIDDATA],AuthenticationServiceCreateCalculatorServiceTokenResultStatus={},AuthenticationServiceCreateCalculatorServiceTokenResultStatus.SUCCEEDED=1,AuthenticationServiceCreateCalculatorServiceTokenResultStatus.FAILED=2,AuthenticationServiceCreateCalculatorServiceTokenResultStatus.USERNOTFOUND=3,AuthenticationServiceCreateCalculatorServiceTokenResultStatusOptions=[AuthenticationServiceCreateCalculatorServiceTokenResultStatus.SUCCEEDED,AuthenticationServiceCreateCalculatorServiceTokenResultStatus.FAILED,AuthenticationServiceCreateCalculatorServiceTokenResultStatus.USERNOTFOUND],PrintServiceResultStatus={},PrintServiceResultStatus.OK=1,PrintServiceResultStatus.SERVERERROR=2,PrintServiceResultStatus.NOCONTENT=3,PrintServiceResultStatus.PREPARATIONERROR=4,PrintServiceResultStatusOptions=[PrintServiceResultStatus.OK,PrintServiceResultStatus.SERVERERROR,PrintServiceResultStatus.NOCONTENT,PrintServiceResultStatus.PREPARATIONERROR],FileServiceResultStatus={},FileServiceResultStatus.OK=1,FileServiceResultStatus.SERVERERROR=2,FileServiceResultStatus.PREPARATIONERROR=3,FileServiceResultStatusOptions=[FileServiceResultStatus.OK,FileServiceResultStatus.SERVERERROR,FileServiceResultStatus.PREPARATIONERROR],CalculatorServiceResultStatus={},CalculatorServiceResultStatus.OK=1,CalculatorServiceResultStatus.SERVERERROR=2,CalculatorServiceResultStatus.UNAUTHORIZED=3,CalculatorServiceResultStatusOptions=[CalculatorServiceResultStatus.OK,CalculatorServiceResultStatus.SERVERERROR,CalculatorServiceResultStatus.UNAUTHORIZED],UserModulesServiceResultStatus={},UserModulesServiceResultStatus.SUCCEEDED=1,UserModulesServiceResultStatus.FAILED=2,UserModulesServiceResultStatusOptions=[UserModulesServiceResultStatus.SUCCEEDED,UserModulesServiceResultStatus.FAILED],MediaServiceGetResultStatus={},MediaServiceGetResultStatus.SUCCEEDED=1,MediaServiceGetResultStatus.FAILED=2,MediaServiceGetResultStatus.MEDIANOTFOUND=3,MediaServiceGetResultStatusOptions=[MediaServiceGetResultStatus.SUCCEEDED,MediaServiceGetResultStatus.FAILED,MediaServiceGetResultStatus.MEDIANOTFOUND],MediaServiceUpdateResultStatus={},MediaServiceUpdateResultStatus.SUCCEEDED=1,MediaServiceUpdateResultStatus.FAILED=2,MediaServiceUpdateResultStatus.USERNOTFOUND=3,MediaServiceUpdateResultStatusOptions=[MediaServiceUpdateResultStatus.SUCCEEDED,MediaServiceUpdateResultStatus.FAILED,MediaServiceUpdateResultStatus.USERNOTFOUND],StatisticsServiceInsertStatisticResultStatus={},StatisticsServiceInsertStatisticResultStatus.SUCCEEDED=1,StatisticsServiceInsertStatisticResultStatus.FAILED=2,StatisticsServiceInsertStatisticResultStatusOptions=[StatisticsServiceInsertStatisticResultStatus.SUCCEEDED,StatisticsServiceInsertStatisticResultStatus.FAILED],{}}),define("model-constants",["enums-constants"],function(){return{}}),define("base-model-parameters",["model-constants"],function(){"use strict";var e=((new Date).getFullYear(),{locationDefault:{ch:"8000 ZÃ¼rich",li:"9490 Vaduz"},civilStatus:CivilStatus.MARRIED,professionalStatus:ProfessionalStatus.EMPLOYEE,numberOfChildren:0,numberOfChildrenOptions:[0,1,2,3,4],mainPersonSex:Sex.FEMALE,secondPersonSex:Sex.MALE,mainPersonBirthYear:1970,secondPersonBirthYear:1975,minimumAge:18,grossIncome:1e5,grossIncomeManualMode:!0,consumptionDuration:10,interestRate:1,monthlySavingCapacity:500,taxableIncome:null,grossFortune:0,taxableFortune:0,isBaseDataExpanded:!0,measureTypeOptions_multicalc:{},responsibleTypeOptions:{"default":"1",products:[{code:"1",descriptions:{de:"Kunde",en:"Kunde",it:"Kunde",fr:"Client"}},{code:"2",descriptions:{de:"Kundenberater/in",en:"Kundenberater/in",it:"Kundenberater/in",fr:"Conseiller/Ã¨re"}}]},mainPersonAge:45,mainPersonGrossIncome:1e5,mainPersonDisabilityRent:0,mainPersonDisabilityChildrenRent:0,mainPersonWidowRent:0,mainPersonOrphanRent:0,mainPersonPensionRent:0,secondPersonDisabilityRent:0,secondPersonDisabilityChildrenRent:0,secondPersonWidowRent:0,secondPersonOrphanRent:0,secondPersonPensionRent:0,fortuneUsablePercentage:100,additionalDisabilityRent:0,additionalDeathCapital:0,disabilityNeedPercentage:80,deathNeedPercentage:80});return e}),define("common-numeric-parameter",[],function(){"use strict";var e=function(e,t,n,r,a){this.min=e,this.max=t,this.slider_min=n,(null===this.slider_min||void 0===this.slider_min)&&(this.slider_min=e),this.slider_max=r,(null===this.slider_max||void 0===this.slider_max)&&(this.slider_max=t),this.slider_step=a,(null===this.slider_step||void 0===this.slider_step)&&(this.slider_step=1)};return e}),define("base-view-parameters",["common-numeric-parameter","model-constants"],function(e){"use strict";var t=((new Date).getFullYear(),{customization:"standard",availableLanguages:["de","fr","it","en"],languageSelectionEnabled:!1,availableCountries:["CH","LI"],countrySelectionEnabled:!1,calculatorSelectionEnabled:!1,newConsultingIconEnabled:!1,mainSecondHouseDistinctionEnabled:!1,contactIconEnabled:!0,navigationBar:!1,iconButtonBar:!0,isIconButtonBarFixed:!1,singleCalculation:!0,showCopyrightDisclaimer:!0,groupDelimiter:"'",amountDecimalDelimiter:".",percentageDecimalDelimiter:",",useMixedGroupingSeparator:!1,animationFocusDuration:300,animationDuration:220,askConsultantDataForPrinting:!1,askCustomerReferenceForPrinting:!1,customerNumberEnabled:!1,eventPlanIconEnabled:!1,maxEventPlansAllowed:10,listEventsEnabled:!1,eventResponsibleEnabled:!1,showGapLongTermChart:!1,eventDateValidation:!1,deleteCustomerInfo:!0,age:new e(18,63),numberOfChildren:new e(0,5),grossIncome:new e(0,25e4,0,25e4,5e3),monthlySavingCapacity:new e(0,5e3,0,5e3,50),interestRate:new e(0,3,0,3,.1),additionalDeathCapital:new e(0,1e8,0,2e6,5e4),need:new e(0,25e4,0,25e4,5e3),investmentColor:"#E73758",interestColor:"#CBA6AD",totalTaxSavingColor:"#940303",saving3aAlternativeCurrentTaxColor:"#999999",saving3aAlternativeAlternativeTaxColor:"#726552",saving3aAlternativeSavingColor:"#009900",saving3aAlternativeIncreaseColor:"#E52C2A",riskDonutTotalRentColor:"rgb(113,147,145)",riskDonutGapColor:"rgb(171,21,48)",riskDisabilityGapColor:"#FCC433",riskDeathGapColor:"#5bc0de",riskDonutFortuneColor:"rgb(153,153,153)",riskIncomeColor:"#E8EAE6",riskFirstPillarColor:"rgb(51,88,103)",riskDisabilityFirstPillarColor:"#8C6910",riskDeathFirstPillarColor:"#006578",riskSecondPillarColor:"rgb(176,196,207)",riskDisabilitySecondPillarColor:"#CE9B19",riskDeathSecondPillarColor:"#008EA9",riskNeedColor:"rgb(0,0,0)",riskFortuneColor:"rgb(153,153,153)",riskAdditionalColor:"rgb(247,240,200)",useGeoLocation:!1,calculatorsSettings:{contactUrl:"contact-to-whatever",facebookUrl:void 0,socialMediaUrls:void 0,multicalc:{isAvailable:!0,contactUrl:"multicalc-contact-to-whatever",socialMediaUrls:void 0}},routeSettings:{overview:{}},languages:[{id:"de",order:1},{id:"fr",order:2},{id:"it",order:3},{id:"en",order:4}],countries:[{id:"CH",order:1},{id:"LI",order:2}],messageTimeout:5e3,loadingFadeInDuration:300,loadingFadeOutDuration:600,fieldAcceptModelTimeout:300,teasersColumnsSm:2});return t}),define("custom-application-parameters",["application-constants"],function(){"use strict";var e={printCustomization:"rpopulaires",storageCustomization:"rpopulaires",authenticationCustomization:"rpopulaires",contactServiceURL:"http://localhost:8080/puma/contact",contactCustomizationUrl:"",screenContactUrlByIframe:!0,toEmail:"",serverCalculation:!0,authenticationServiceURL:"https://uat.logismata.ch/puma/authentication",calculatorServiceURL:"https://uat.logismata.ch/puma/calculator",contactCustomization:"rpopulaires",calculatorCustomization:"rpopulaires",productListCustomization:"rpopulaires",authorizedContainers:["http://localhost:8788"],incomeAtPensionLongTermAvailable:!1,incomeAtPensionAlternativeMode:IncomeAtPensionAlternativeMode.FULL,incomeAtPensionMode:IncomeAtPensionMode.FULL,incomeAtPensionFirstPillarIncomeOptionAvailable:!0,fortunePensionInterestOptionsAvailable:!1,incomeAtPensionSecondPillarSelectionAvailable:!0,houseAffordabilityAlternativeMode:HouseAffordabilityAlternativeMode.FULL,houseAffordabilityAlternativeRiskMode:HouseAffordabilityAlternativeRiskMode.NONE};return e}),define("custom-model-parameters",["model-constants"],function(){"use strict";var e=((new Date).getFullYear(),{locationDefault:{ch:"1006 Lausanne",li:"9490 Vaduz"}});return e}),define("custom-view-parameters",[],function(){"use strict";var e={singleCalculation:!0,navigationBar:!1,iconButtonBar:!0,availableLanguages:["fr"],languageSelectionEnabled:!1,availableCountries:["CH"],countrySelectionEnabled:!1,calculatorSelectionEnabled:!1,newConsultingIconEnabled:!1,mainSecondHouseDistinctionEnabled:!1,contactIconEnabled:!1,useMixedGroupingSeparator:!0,askConsultantDataForPrinting:!1,askCustomerReferenceForPrinting:!1,customerNumberEnabled:!1,eventPlanIconEnabled:!1,useGeoLocation:!1,calculatorsSettings:{contactUrl:"https://www.somewhere.ch"}};return e}),define("deploy-application-parameters",[],function(){"use strict";var e={};return e={incomeAtPensionMode:"simple",riskMode:"simple",houseAffordabilityScenarioMode:"simple",houseAffordabilityAlternativeMode:"full",houseAffordabilityAlternativeRiskMode:"none",amortizationComparisonMode:"simple",inheritanceMode:"simple",inheritanceSelectMode:!1,storageMode:"local",googleAnalyticsID:[{name:"id1",id:"UA-47915081-1",description:"id for retraites populaires"}],toEmail:"",printServiceURL:"",productListServiceURL:"https://services.logismata.ch/puma/productList",serverCalculation:!0,authenticationServiceURL:"https://services.logismata.ch/puma/authentication",calculatorServiceURL:"https://services.logismata.ch/puma/calculator",storageServiceURL:"",contactServiceURL:"",contactCustomizationUrl:"",requirePaths:{},authorizedContainers:["https://www.retraitespopulaires.ch","https://services.logismata.ch"]}}),define("deploy-model-parameters",[],function(){"use strict";var e={};return e={}}),define("deploy-view-parameters",[],function(){"use strict";var e={};return e={}}),define("common-object-utilities",["logger"],function(e){"use strict";var t=(e.get("ObjectUtilities"),function(){this.extendDeep=function(e,t){for(var n in t)try{void 0===t[n]||"object"!=typeof t[n]||null===t[n]||Array.isArray(t[n])?e[n]=t[n]:e[n]&&"object"==typeof e[n]&&null!==e[n]?this.extendDeep(e[n],t[n]):e[n]=t[n]}catch(r){continue}return e},this.equals=function(e,t){if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return e===t;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1}for(var n in e){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]&&!this.equals(e[n],t[n]))return!1}for(n in t)if(!e.hasOwnProperty(n))return!1;return!0},this.getValueThroughString=function(e,t){t=t.split(".");for(var n=0;n<t.length;n++)e=e[t[n]];return e},this.setValueThroughString=function(e,t,n){var r=t.split(/\.(?=[^.]+$)/);1===r.length?e[r[0]]=n:2===r.length&&(this.getValueThroughString(e,r[0])[r[1]]=n)},this.protect=function(e){if(e){var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=e[n],null!==t&&"object"==typeof t&&this.protect(t);else{Object.preventExtensions(e);for(var r in e)t=e[r],null!==t&&"object"==typeof t&&this.protect(t)}}}});return t}),define("parameters-decorator",[],function(){return{onCustomizedApplicationParameters:function(e){return e},onCustomizedModelParameters:function(e){return e},onCustomizedViewParameters:function(e){return e}}}),define("parameters-manager",["base-application-parameters","base-model-parameters","base-view-parameters","custom-application-parameters","custom-model-parameters","custom-view-parameters","deploy-application-parameters","deploy-model-parameters","deploy-view-parameters","common-object-utilities","parameters-decorator"],function(e,t,n,r,a,i,o,s,l,c,u){var d=new c,m=d.extendDeep(e,r);m=u.onCustomizedApplicationParameters(m),m=d.extendDeep(m,o);var g=d.extendDeep(t,a);g=u.onCustomizedModelParameters(g),g=d.extendDeep(g,s);var f=d.extendDeep(n,i);return f=u.onCustomizedViewParameters(f),f=d.extendDeep(f,l),require(["runtime-environment-application-parameters"],function(e){m=d.extendDeep(m,e)},function(){}),require(["runtime-environment-model-parameters"],function(e){g=d.extendDeep(g,e)},function(){}),require(["runtime-environment-view-parameters"],function(e){f=d.extendDeep(f,e)},function(){}),{baseApplicationParameters:m,baseModelParameters:g,baseViewParameters:f}}),define("routes-handler",["parameters-manager"],function(e){"use strict";var t={routeSettings:e.baseViewParameters.routeSettings,calculatorsSettings:e.baseViewParameters.calculatorsSettings,html5:!1,reset:function(){this.routeSettings=e.baseViewParameters.routeSettings,this.calculatorsSettings=e.baseViewParameters.calculatorsSettings},getSourcePath:function(){var e=window.parent.location.href,t=angular.element(document.body).injector().get("locationService").getPath();return-1!==e.toString().indexOf(t)&&(e=e.substr(0,e.indexOf(t)),e=e.concat("/")),e},getPathByLanguage:function(e,t){var n=!0,r=!1,a=!1,i=e.indexOf("#");i>0&&(e=e.slice(i+1,e.length),r=!0),"./"===e.substr(0,2)&&(e=e.substr(1,e.length),a=!0),"/"!==e.substr(0,1)&&(e="/"+e,n=!1);var o="/";if("/"!==e){var s=e.split("/").filter(function(e){return""!==e}),l=s[0],c=s[1];if(void 0!==l)if(void 0!==this.routeSettings.themes[l]){var u=l;if(o="/"+this.routeSettings.themes[u].overview[t],void 0!==c){var d=c;void 0===this.routeSettings.themes[u]?console.error("THEME "+u+" IS MISSING (LANGUAGE "+t+")"):void 0===this.routeSettings.themes[u].calculations[d]&&console.error("THEME "+u+" HAS NO CALCULATION NAMED "+d+"(LANGUAGE "+t+")"),o+="/"+this.routeSettings.themes[u].calculations[d][t]}}else o="/"+this.routeSettings[l][t]}return n||(o=o.substr(1,o.length)),a?((r||!this.html5)&&(o="/#"+o),o="."+o):(r||!this.html5)&&(o="#"+o),o},getCheckedPath:function(e,t){var n=this.getPathByLanguage(e,t);return"#"===n.substr(0,1)&&(n=n.substr(1,n.length)),n},getPathByIdAndLanguage:function(e,t){var n="/";if(""!==e){var r=e.split(".").filter(function(e){return""!==e}),a=r[0],i=r[1];if(void 0!==a)if(void 0!==this.routeSettings.themes[a]){var o=a;if(void 0===this.routeSettings.themes[o].overview[t]?(console.error("THEME "+o+" IS MISSING (LANGUAGE "+t+")"),n="/"+this.routeSettings.themes[o].overview.de):n="/"+this.routeSettings.themes[o].overview[t],void 0!==i){var s=i;void 0===this.routeSettings.themes[o].calculations[s]?console.error("THEME "+o+" HAS NO CALCULATION NAMED "+s+")"):void 0===this.routeSettings.themes[o].calculations[s][t]?(console.error("THEME "+o+" HAS NO CALCULATION NAMED "+s+"(LANGUAGE "+t+")"),n+="/"+this.routeSettings.themes[o].calculations[s].de):n+="/"+this.routeSettings.themes[o].calculations[s][t]}}else void 0===this.routeSettings[a][t]?(console.error("CONTROLLER "+a+" IS MISSING (LANGUAGE "+t+")"),n="/"+this.routeSettings[a].de):n="/"+this.routeSettings[a][t]}return n},prepareRouteBeforeConversion:function(e){"#"===e.substr(0,1)&&(e=e.substr(1,e.length)),"./"===e.substr(0,2)&&(e=e.substr(1,e.length)),"/"!==e.substr(0,1)&&(e="/"+e);var t=e.indexOf("?");return t>=0&&(e=e.substr(0,t)),e},getRouteParts:function(e){e=this.prepareRouteBeforeConversion(e);var t=e.split("/").filter(function(e){return""!==e});return t},getId:function(){var e=angular.element(document.body).injector().get("locationService").getPath();e=this.prepareRouteBeforeConversion(e);var t,n=this.getRouteParts(e),r=n[0],a=n[1],i="";if(void 0!==r)for(var o in this.routeSettings.themes){var s=this.routeSettings.themes[o];if(void 0!==this.calculatorsSettings.themes[o])for(t in s.overview)if(void 0!==a)for(var l in s.calculations){var c=s.calculations[l];if(i="/"+s.overview[t]+"/"+c[t],e===i)return o+"."+l}else if(i="/"+s.overview[t],e===i)return o}for(var u in this.routeSettings){var d=this.routeSettings[u];for(t in d)if(i="/"+d[t],e===i)return u}return e.replace("/","")}};return t}),define("theme-manager",["logger"],function(e){"use strict";var t,n=(e.get("ThemeManager"),null),r=null,a=[],i=function(){this.getVisitedThemes=function(){return a},this.getCurrentThemeId=function(){return n},this.isThemeSelected=function(e){return e===n},this.getCurrentSubThemeId=function(){return r},this.isSubThemeSelected=function(e){var t=e===r;return t},this.isThemeMainSelected=function(e){return!this.isThemeSelected(e)||null!==r&&void 0!==r?!1:!0},this.setTheme=function(e,i){if(void 0!==e&&null!==e){a.push(e),a=a.filter(function(e,t){return a.indexOf(e)===t});var o="Theme"+e.charAt(0).toUpperCase()+e.slice(1);t=o,n=e,r=i}}};return i}),define("common-currency-formatter",[],function(){"use strict";var e=function(e,t,n){var r=e,a=t,i=n;this.formatCurrency=function(e,t,n){var r,o,s=0,l="";return null===n&&(n=2),t||(n=0),"number"==typeof e?r=e:("string"!=typeof e&&(e=String(e)),""===e&&(e="0"),e=this.cleanGroupDelimiters(e),r=this.parseNumberWithDecimals(e)),isNaN(r)&&(r=0),r=Math.round(r*Math.pow(10,n))/Math.pow(10,n),0>r&&(l="-",r=Math.abs(r)),r!==parseInt(r,10)&&(s=r-parseInt(r,10),s=Math.round(s*Math.pow(10,n))/Math.pow(10,n),r=Math.round(r-s),s=Math.round(s*Math.pow(10,n))),o=i?l+this.addGroupMixedSeparator(String(r)):l+this.addGroupUnitarySeparator(String(r)),t&&n>0&&(o=o+a+this.fillZeroLeft(String(s),n)),o},this.addGroupMixedSeparator=function(e){var t="";try{var n=parseInt(e,10);if(t=String(n),t>=1e4)for(var a=0;a<Math.floor((t.length-(1+a))/3);a++)t=t.substring(0,t.length-(4*a+3))+r+t.substring(t.length-(4*a+3))}catch(i){}return t.toString()},this.addGroupUnitarySeparator=function(e){var t="";try{var n=parseInt(e,10);t=String(n);for(var a=0;a<Math.floor((t.length-(1+a))/3);a++)t=t.substring(0,t.length-(4*a+3))+r+t.substring(t.length-(4*a+3))}catch(i){}return t.toString()},this.fillZeroLeft=function(e,t){for(;e.length<t;)e="0"+e;return e},this.parseNumberWithDecimals=function(e){var t,n,r,i,o,s,l;l=e.indexOf("-")>-1,e=e.replace("-",""),s=e.indexOf(a),-1===s?(t=e,r="0"):0===s?(t=0,r=e.substring(s+1)):(t=e.substring(0,s),r=e.substring(s+1)),n=parseInt(t,10),i=r.length,o=parseInt(r,10)/Math.pow(10,i);var c=n+o;return l&&(c=-1*c),c=Math.round(c*Math.pow(10,i))/Math.pow(10,i)},this.cleanGroupDelimiters=function(e){for(;-1!==e.indexOf(r);)e=e.replace(r,"");return e}};return e}),define("common-localization",["logger","common-currency-formatter"],function(e,t){"use strict";var n=e.get("localization"),r=e.get("localizationDetail"),a={},i=function(i,o,s,l,c){var u=i,d=!1;r&&!r.enabledFor(e.DEBUG)&&(r=void 0),this.replaceFixedPercentage=function(e){var t,n="fixedPercentage";void 0===a[n]?(t=new RegExp("<([0-9.]*?).fixedPercentage(.*?)>",""),a[n]=t):t=a[n];for(var r=t.exec(e);null!==r&&r.length>=3;){var i=r[1];i=parseFloat(i);var o=2;if(r[2].indexOf(":")>=0){var s=r[2].split(":")[1],l=parseInt(s);isNaN(l)||(o=l)}e=e.replace(r[0],this.getLocalizedString("GenericFormats","Percentage",{VALUE:i,DECIMALS:o})),r=t.exec(e)}return e},this.replaceFixedCurrencyWithSymbol=function(e){var t,n="fixedCurrencyWithSymbol";void 0===a[n]?(t=new RegExp("<([0-9.]*?).fixedCurrencyWithSymbol(.*?)>",""),a[n]=t):t=a[n];for(var r=t.exec(e);null!==r&&r.length>=3;){var i=r[1];i=parseFloat(i);var o=0;if(r[2].indexOf(":")>=0){var s=r[2].split(":")[1],l=parseInt(s);isNaN(l)||(o=l)}e=e.replace(r[0],this.getLocalizedString("GenericFormats","CurrencyWithSymbol",{VALUE:i,DECIMALS:o})),r=t.exec(e)}return e},this.replaceFixedPlaceholders=function(e){return e=this.replaceFixedPercentage(e),e=this.replaceFixedCurrencyWithSymbol(e)},this.applyFormatting=function(e,n){var r,a,i;return 0===n.indexOf("percentage")?(r=2,n.indexOf(":")>=0&&(a=n.split(":")[1],i=parseInt(a),isNaN(i)||(r=i)),e=this.getLocalizedString("GenericFormats","XRate",{VALUE:new t(o,l,c).formatCurrency(e,!0,r)})):0===n.indexOf("currencyWithSymbol")?(r=0,n.indexOf(":")>=0&&(a=n.split(":")[1],i=parseInt(a),isNaN(i)||(r=i)),e=this.getLocalizedString("GenericFormats","XAmountWithSymbol",{VALUE:new t(o,s,c).formatCurrency(e,!0,r)})):0===n.indexOf("currency")&&(r=0,n.indexOf(":")>=0&&(a=n.split(":")[1],i=parseInt(a),isNaN(i)||(r=i)),e=this.getLocalizedString("GenericFormats","XAmount",{VALUE:new t(o,s,c).formatCurrency(e,!0,r)
})),e},this.replacePlaceholder=function(e,t,n){var r;void 0===a[t]?(r=new RegExp(".*<("+t+"[a-zA-Z0-9:|]*?)>.*",""),a[t]=r):r=a[t];var i=r.exec(e);if(null===i||2!==i.length)return e;var o=i[1],s=o.split("|");if(s.length>1)for(var l=1;l<s.length;l++){var c=s[l];n=this.applyFormatting(n,c)}return e=e.replace("<"+o+">",n)},this.replacePlaceholders=function(e,t){if(void 0===t)return e;var n,r,a=[];for(n in t)a.push(n);a.sort(function(e,t){return t.length-e.length});var i;do{i=!1;for(var o=0;o<a.length;o++){n=a[o],r=t[n];var s=this.replacePlaceholder(e,n,r);e!==s&&(i=!0),e=s}}while(i);return e},this.getUntranslatedEnum=function(e,t){return d===!0&&n.error("UNTRANSLATED ENUM:"+e+" KEY: "+t),"@"+t},this.getLocalizedString=function(e,t,n){var r;if(!n){var a=this.getCachedResult(e,t);if(void 0!==a)return a.longValue}var i=this.getLocalizedEnum(e,t,n);if("object"==typeof i){var o=this.replaceFixedPlaceholders(i.longValue);n?o=this.replacePlaceholders(o,n):(i.longValue=o,this.cacheResult(e,t,i)),r=o}else r=i;return r},this.getLocalizedShortString=function(e,t){var n=this.getCachedResult(e,t);if(void 0!==n)return n.shortValue;var r=this.getLocalizedEnum(e,t);return this.cacheResult(e,t,r),r.shortValue},this.cacheResult=function(e,t,n){void 0===this.cache&&(this.cache={}),void 0===this.cache[e]&&(this.cache[e]={}),this.cache[e][t]=n},this.getCachedResult=function(e,t){return void 0!==this.cache&&void 0!==this.cache[e]?this.cache[e][t]:void 0},this.hasKey=function(e,t){if("object"!=typeof u)return!1;var n=u[e];return void 0===n?!1:void 0!==n[t]},this.getLocalizedEnum=function(e,t,a){if(r&&r.debug("SEARCH FOR ENUM: "+e+" KEY: "+t),"object"!=typeof u)return n.error("NO ENUMS DEFINED"),this.getUntranslatedEnum(e,t);var i=u[e];if(void 0===i)return n.error("NO ENUM FOR "+e),this.getUntranslatedEnum(e,t);var o;if(isNaN(t)){if(void 0===i[t])return this.getUntranslatedEnum(e,t);o=i[t]}else o=this.getLocalizedEnumByNumber(e,t);return o},this.getLocalizedEnumByNumber=function(e,t){if(r&&r.debug("SEARCH FOR ENUM: "+e+" Code: "+t),"object"!=typeof u)return n.error("NO ENUMS DEFINED"),this.getUntranslatedEnum(e,t);var a=u[e];if(void 0===a)return n.error("NO ENUM FOR "+e),this.getUntranslatedEnum(e,t);for(var i in a)if(a[i].number===t.toString())return a[i];return this.getUntranslatedEnum(e,t)},this.getLocalizedEnumDescriptionByNumber=function(e,t){var n=this.getLocalizedEnumByNumber(e,t);return"object"==typeof n?n.longValue:n},this.getLocalizedEnumShortDescriptionByNumber=function(e,t){var n=this.getLocalizedEnumByNumber(e,t);return"object"==typeof n?n.shortValue:n}};return i}),define("active-controller",["angular"],function(e){"use strict";var t=e.module("activeControllerModule",[]);return t.factory("activeController",function(){var e={activeController:null,set:function(e){this.activeController=e},clear:function(){this.activeController=null},getActiveController:function(){return this.activeController}};return e}),t}),define("localization",["angular","common-localization","logger","parameters-manager","active-controller"],function(e,t,n,r){"use strict";var a,i,o=n.get("localization"),s=e.module("localization",[]);return a=r.baseViewParameters.availableLanguages&&r.baseViewParameters.availableLanguages.length>0?r.baseViewParameters.availableLanguages[0]:"de",i=r.baseViewParameters.availableCountries&&r.baseViewParameters.availableCountries.length>0?r.baseViewParameters.availableCountries[0]:"CH",s.factory("localize",["$http","$rootScope","$window","$route","activeController",function(e,n,s,l,c){function u(e){var t="Default",n=e.split(".");return 2===n.length?(t=n[0],e=n[1]):void 0!==c.getActiveController()?t=c.getActiveController():l&&l.current&&l.current.$$route&&l.current.$$route.controller&&(t=l.current.$$route.controller.replace("Controller","")),{enumName:t,value:e}}function d(){return m.resourceFileLoaded?!0:(m.initLocalizedResources(),m.resourceFileLoaded=!0,!1)}var m={path:"./resources/enums",language:s.navigator.userLanguage||s.navigator.language,country:i,enums:[],resourceFileLoaded:!1,loading:!1,defaultLanguage:a,defaultCountry:i,activeLanguage:null,activeCountry:null,setLanguage:function(e,t,r){var a=m.language;return o.debug("Setting language "+e+" (previous was "+a+")"),a===e?void o.warn("Language already set, skipping"):(window.sessionStorage.language=e,m.language=e,m.activeLanguage=null,void m.loadResources(function(){t&&t(),n.$broadcast("languageChangeSuccess")},function(){o.debug("Setting language back to "+a),window.sessionStorage.language=a,m.language=a,m.activeLanguage=null,m.successCallback(m.enums),t&&t(),r&&r(),n.$broadcast("languageChangeFailed")}))},setCountry:function(e,t,r){var a=m.country;return o.debug("Setting country "+e+" (previous was "+a+")"),a===e?void o.warn("Country already set, skipping"):(window.sessionStorage.country=e,m.country=e,m.activeCountry=null,m.cachedCountries={CH:m.getLocalizedShortString("Countries.CH"),LI:m.getLocalizedShortString("Countries.LI")},void m.loadResources(function(){t&&t(),n.$broadcast("countryChangeSuccess"),m.cachedCountries=void 0},function(){o.debug("Setting country back to "+a),window.sessionStorage.country=a,m.country=a,m.activeCountry=null,m.successCallback(m.enums),t&&t(),r&&r(),n.$broadcast("countryChangeFailed"),m.cachedCountries=void 0}))},successCallback:function(e){m.enums=e,m.localization=new t(m.enums,r.baseViewParameters.groupDelimiter,r.baseViewParameters.amountDecimalDelimiter,r.baseViewParameters.percentageDecimalDelimiter,r.baseViewParameters.useMixedGroupingSeparator),o.debug("Enums loaded for "+m.language+"_"+m.country),m.loading=!1,m.resourceFileLoaded=!0,n.$emit("localizeResourcesUpdates")},getActiveLanguage:function(){return null===m.activeLanguage&&(m.activeLanguage=m.language.replace(/\-.*/,""),m.activeLanguage=m.activeLanguage.toLowerCase(),-1===r.baseViewParameters.availableLanguages.indexOf(m.activeLanguage)&&(m.activeLanguage=m.defaultLanguage)),m.activeLanguage},getActiveLanguageCode:function(){var e=m.getActiveLanguage();switch(e){case"de":return"1";case"fr":return"2";case"it":return"3";case"en":return"4";default:return"1"}},getActiveCountryCode:function(){return this.isCountryCh()?756:this.isCountryLi()?438:0},getActiveCountry:function(){return null===m.activeCountry&&(m.activeCountry=m.country.replace(/\-.*/,""),m.activeCountry=m.activeCountry.toUpperCase(),-1===r.baseViewParameters.availableCountries.indexOf(m.activeCountry)&&(m.activeCountry=m.defaultCountry)),m.activeCountry},getTranslatedDescription:function(e){return void 0!==e[m.getActiveLanguage().toLowerCase()]?e[m.getActiveLanguage().toLowerCase()]:e[m.defaultLanguage]},getSessionStoredLanguage:function(){return window.sessionStorage.language},getSessionStoredCountry:function(){return window.sessionStorage.country},getURL:function(){var e=m.getActiveLanguage(),t=m.getActiveCountry();o.debug("language "+e);var n=m.path+"/Enums_"+e.toUpperCase()+"_"+t.toUpperCase()+".json";return o.debug("About to load "+n),n},loadResources:function(t,n){o.debug("Loading definitions for language "+m.language),m.loading=!0,e({method:"GET",url:m.getURL(),cache:!0}).success(function(e){m.successCallback(e),t&&t()}).error(function(){o.debug("ERROR loading language "+m.language),m.loading=!1,n&&n()})},initLocalizedResources:function(){m.loadResources(function(){},function(){m.setLanguage(m.defaultLanguage),m.loadResources()})},getLocalizedString:function(e,t){var n=!1;if(m.loading)return n?"!"+e+"!":"";var r=u(e),a=r.enumName;return e=r.value,d()?"object"==typeof m.enums?m.localization.getLocalizedString(a,e,t):"@"+e:n?"!"+e+"!":""},getLocalizedShortString:function(e){var t=!1;if(m.loading)return t?"!"+e+"!":"";var n=u(e),r=n.enumName;return e=n.value,d()?"object"==typeof m.enums?m.localization.getLocalizedShortString(r,e):"@"+e:t?"!"+e+"!":""},hasKey:function(e){if(m.loading)return!1;var t=u(e),n=t.enumName;return e=t.value,d()&&"object"==typeof m.enums?m.localization.hasKey(n,e):!1},replace:function(e,t){var n=m.getLocalizedString(t);null!==n&&void 0!==n&&""!==n&&e.html(n)},getLocalizedEnumDescriptionByNumber:function(e,t){return m.localization.getLocalizedEnumDescriptionByNumber(e,t)},isCountryLi:function(){var e=!1;return e=m.loading&&void 0!==m.cachedCountries?m.getActiveCountry()===m.cachedCountries.LI:m.getActiveCountry()===m.getLocalizedShortString("Countries.LI")},isCountryCh:function(){var e=!1;return e=m.loading&&void 0!==m.cachedCountries?m.getActiveCountry()===m.cachedCountries.CH:m.getActiveCountry()===m.getLocalizedShortString("Countries.CH")}};return m}]),s}),define("version-transformations",["logger"],function(e){"use strict";var t=(e.get("VersionTransformations"),function(e){e=e.replace(/\[(\w+)\]/g,".$1"),e=e.replace(/^\./,"");var t=e.split(".");return t}),n=function(e,n){for(var r=t(n),a=0,i=r.length;i>a;++a){var o=r[a];if(!(o in e))return null;e=e[o]}return e},r=function(e,r){if(""===r)return!1;var i=t(r);if(1===i.length)return!0;i.pop();var o=i.join(".");return a(e,o)?n(e,o)instanceof Object:!1},a=function(e,n){for(var r=t(n),a=0;a<r.length;a++){if(!e||!e.hasOwnProperty(r[a]))return!1;e=e[r[a]]}return!0},i=function(e,n,r){for(var a,i=t(n),o=0,s=i.length;s>o;++o)a=i[o],a in e&&o<i.length-1?e=e[a]:o<i.length-1&&(e[a]={},e=e[a]);void 0!==r?e[a]=r:delete e[a]},o=function(e,t){a(e,t)&&i(e,t,void 0)},s=function(e){this.update=e};s.prototype={transform:function(e){return this.update(e)}};var l=function(e,t,n){this.from=e,this.value=t};l.prototype={transform:function(e){return!a(e,this.from)&&r(e,this.from)&&i(e,this.from,this.value),e}};var c=function(e,t){this.from=e,this.comment=t};c.prototype={transform:function(e){return o(e,this.from),e}};var u=function(e,t,n,r){this.from=e+"."+t,this.to=e+"."+n,this.comment=r};u.prototype={transform:function(e){return a(e,this.from)&&!a(e,this.to)&&r(e,this.to)&&(this.value=n(e,this.from),o(e,this.from),i(e,this.to,this.value)),e}};var d=function(e,t,n){this.from=e,this.to=t,this.comment=n};d.prototype={transform:function(e){if(a(e,this.from)&&!a(e,this.to)&&r(e,this.to)){var t=n(e,this.from);o(e,this.from),i(e,this.to,t)}return e}};var m=function(e,t,n,r){this.from=e,this.to=t,this.valueForAdd=n,this.comment=r};m.prototype={transform:function(e){if(!a(e,this.to)&&r(e,this.to))if(a(e,this.from)){var t=n(e,this.from);o(e,this.from),i(e,this.to,t)}else i(e,this.to,this.valueForAdd);return e}};var g=function(e,t,n){this.from=e,this.to=t,this.comment=n};g.prototype={transform:function(e){return a(e,this.from)&&r(e,this.to)&&(this.value=n(e,this.from),i(e,this.to,this.value)),e}};var f=function(e,t,n){this.from=e,this.transformation=t,this.comment=n};f.prototype={transform:function(e){return a(e,this.from)&&(this.value=n(e,this.from),this.value=this.transformation(this.value),i(e,this.from,this.value)),e}};var h=function(e){if(isNaN(e))throw"versionNumber isNaN";this.versionNumber=e,this.transformations=[]};h.prototype.addTransformation=function(e){this.transformations.push(e)},h.prototype.addTransformations=function(){for(var e=0;e<arguments.length;e++)this.addTransformation(arguments[e])};var p={};return p.Version=h,p.ModelTransformation=s,p.ModelTransformationAdd=l,p.ModelTransformationRemove=c,p.ModelTransformationRename=u,p.ModelTransformationMove=d,p.ModelTransformationMoveOrAdd=m,p.ModelTransformationCopy=g,p.ModelTransformationTransformValue=f,p.getAttributeByPath=n,p.setAttributeByPath=i,p.checkPath=a,p.checkParent=r,p.deleteAttributeByPath=o,p}),define("model-version-1.0",["version-transformations"],function(e){"use strict";var t=new e.Version(1);return t}),define("version-manager",["angular","logger"],function(e,t){"use strict";var n=e.module("versionManagerModule",[]);return n.factory("versionManager",["$q","$rootScope",function(n,r){function a(t){var n=e.element(document.body).injector();n.get("baseState");for(var r in t)t.hasOwnProperty(r)&&"version"!==r&&n.get(r+"State")}var i=(t.get("VersionManager"),function(){this.versions=[]});i.prototype.indexOf=function(e){for(var t=0;t<this.versions.length;t++)if(this.versions[t].versionNumber===e)return t;return-1},i.prototype.addVersion=function(e){if(isNaN(e.versionNumber))throw"versionNumber isNaN";if(-1!==this.indexOf(e.versionNumber))throw new Error("Version "+e.versionNumber+" already exists.");for(var t=0;this.versions[t]&&e.versionNumber>this.versions[t].versionNumber;)t+=1;this.versions.splice(t,0,e)},i.prototype.addVersions=function(){for(var e=0;e<arguments.length;e++)this.addVersion(arguments[e])};var o=function(e){return n.reject(e)};return i.prototype.getCurrentVersion=function(){return this.versions.length>0?this.versions[this.versions.length-1].versionNumber:null},i.prototype.needsToUpdate=function(e){var t=this.versions.length;return t>0&&(!e.version||this.versions[t-1].versionNumber>e.version)?!0:!1},i.prototype.update=function(e,t){a(e),r.$broadcast("storageReset");var i=n.defer(),s=i.promise;if(this.needsToUpdate(e)){var l=this.indexOf(e.version),c=l+1;t||(t=this.getCurrentVersion());for(var u=this.indexOf(t),d=c;u>=d;d++)for(var m=this.versions[d],g=0;g<m.transformations.length;g++){var f=m.transformations[g];s=s.then(f.transform.bind(f))["catch"](o)}s.then(function(){return e.version=t,e})["catch"](o)}return i.resolve(e),s},i}]),n}),define("model-updater",["angular","version-transformations","model-version-1.0","version-manager"],function(e,t){"use strict";for(var n=e.module("modelUpdaterModule",["versionManagerModule"]),r=[],a=0;a<arguments.length;a++){var i=arguments[a];i instanceof t.Version&&r.push(i)}return n.factory("modelUpdater",["versionManager",function(e){var t=new e;try{for(var n=0;n<r.length;n++){var a=r[n];t.addVersion(a)}return t}catch(i){throw i}}]),n}),define("storage-manager",["angular","parameters-manager","common-object-utilities","ng-storage","application-constants","model-updater"],function(e,t,n){"use strict";var r,a=e.module("storageManagerModule",["ngStorage"]);return a.factory("storageManager",["$localStorage","$sessionStorage","modelUpdater",function(e,a,i){var o={initStorage:function(){var o=t.baseApplicationParameters.storageMode;o===StorageMode.NONE?r={}:o===StorageMode.LOCAL?r=e:o===StorageMode.SESSION&&(e.$reset(),r=a),r&&!r.onlineCalc&&(r.onlineCalc={version:i.getCurrentVersion()});var s=new n;for(var l in r.onlineCalc){var c=r.onlineCalc[l];c instanceof Object&&s.protect(c)}},getStoredObject:function(e){return this.getFullStoredObject()[e]},getFullStoredObject:function(){return i.needsToUpdate(r.onlineCalc)&&(r.onlineCalc={version:i.getCurrentVersion()}),r.onlineCalc},updateStoredObjectWith:function(e){var t=this.getFullStoredObject(),r=new n;r.extendDeep(t,e);for(var a in t){var i=t[a];r.protect(i)}},storeObject:function(e,t){r.onlineCalc[e]=t},reset:function(){e.$reset(),a.$reset(),r=void 0,this.initStorage()},storeOnBrowserSessionStorage:function(e,t){window.sessionStorage.setItem(e,JSON.stringify(t))},getFromBrowserSessionStorage:function(e){var t=window.sessionStorage.getItem(e);if(t)try{return t=JSON.parse(t)}catch(n){return t}},removeFromBrowserSessionStorage:function(e){window.sessionStorage.removeItem(e)},clearBrowserSessionStorage:function(){window.sessionStorage.clear()},storeOnBrowserLocalStorage:function(e,t){"string"==typeof t?window.localStorage.setItem(e,t):window.localStorage.setItem(e,JSON.stringify(t))},getFromBrowserLocalStorage:function(e){var t=window.localStorage.getItem(e);if("undefined"===t)return"";try{return JSON.parse(t)}catch(n){return t}},removeFromBrowserLocalStorage:function(e){window.localStorage.removeItem(e)}};return o.initStorage(),o}]),a}),define("calculators-manager",["angular","parameters-manager","localization","storage-manager"],function(e,t){"use strict";var n=e.module("calculatorsManagerModule",[]),r=null,a=null,i=null,o=null,s=t.baseViewParameters.calculatorsSettings,l=(t.baseViewParameters,t.baseApplicationParameters.authorizedCalculators);return n.factory("calculatorsManager",["localize","$rootScope","$route","storageManager",function(e,n,c,u){var d=function(){var e=require.toUrl("wolf-calc"),t=window.location.protocol+"//"+window.location.hostname;return!window.isIE9||window.isIE9&&e.slice(0,t)===t},m=d(),g={crossDomainSupported:function(){return m},isApplicationOverviewAvailable:function(){return void 0!==s.overview.isAvailable?s.overview.isAvailable:void 0!==s.isAvailable?s.isAvailable:!0},isCalculatorAvailable:function(e){if(!m)return!1;var t=this.getCalculatorNameObject(e);if(!t||!t.calculator)return!1;var n=s.themes[t.theme];return void 0===n?!1:this.searchCalculatorAvailability(t.theme,t.calculator)},getCalculatorNameObject:function(e){var t=null,n=null,r=e.split(/[.#]/).filter(function(e){return""!==e});return r.length<1||r.length>2?null:(t=r[0],2===r.length&&(n=r[1]),{theme:t,calculator:n})},getThemeNameFromString:function(e){e=e.replace("/","");var t=e.split(/[.#]/).filter(function(e){return""!==e});return 0===t.length?null:t[0]},getCalculatorNameFromString:function(e){var t=e.split(/[.#]/).filter(function(e){return""!==e});return 2!==t.length?null:t[1]},isCalculatorAvailableForCurrentCountry:function(t,n){var r=e.getActiveCountry();return c.current.params.country&&(r=c.current.params.country.toUpperCase()),void 0===s.themes[t].calculations[n].availableCountries||s.themes[t].calculations[n].availableCountries.indexOf(r)>-1},availabilityConditions:function(e,t){return void 0!==s.themes[e].calculations[t].isAvailable?s.themes[e].calculations[t].isAvailable&&this.isCalculatorAvailableForCurrentCountry(e,t):void 0!==s.themes[e].isAvailable?s.themes[e].isAvailable&&this.isCalculatorAvailableForCurrentCountry(e,t):void 0!==s.isAvailable?s.isAvailable&&this.isCalculatorAvailableForCurrentCountry(e,t):!0},searchCalculatorAvailability:function(e,t){return void 0===l||null===l||0===l.length?this.availabilityConditions(e,t):-1!==l.indexOf(t)&&this.availabilityConditions(e,t)},searchThemeAvailability:function(e){return void 0!==s.themes[e].overview.isAvailable?s.themes[e].overview.isAvailable:void 0!==s.themes[e].isAvailable?s.themes[e].isAvailable:void 0!==s.isAvailable?s.isAvailable:!0},availableThemesCalculators:function(){if(null!==r&&0!==r.length)return r;if(r=[],m){for(var e in s.themes)if(void 0!==s.themes[e]&&s.themes.hasOwnProperty(e)){var t=s.themes[e];for(var n in t.calculations)t.calculations.hasOwnProperty(n)&&this.searchCalculatorAvailability(e,n)&&r.push({theme:e,calculator:n})}return r}},availableCalculatorsByTheme:function(e){return this.availableThemesCalculators().filter(function(t){return t.theme===e})},availableCalculators:function(){if(null!==a)return a;if(a=[],!m)return a;var e=[],t=this.availableThemesCalculators();for(var n in t)e.push(t[n].calculator);return a=e.filter(function(t,n){return e.indexOf(t)===n})},availableThemes:function(){if(!i){if(i=[],m){var e=s.themes;for(var t in e)if(void 0!==s.themes[t]&&this.searchThemeAvailability(t)){var n=e[t];n.id=t,i.push(n)}}i.sort(function(e,t){return e.order-t.order})}return i},isThemeAvailable:function(e){return $.grep(this.availableThemes(),function(t){return t.id===e}).length>0},getCalculatorsByName:function(e){var t=this.availableThemesCalculators(),n=t.filter(function(t){return t.calculator===e});return n},isAnyCalculatorAvailableByName:function(e){var t=this.getCalculatorsByName(e);return t.length>0},getAnyPathForCalculatorByName:function(e){var t=this.getCalculatorsByName(e);return 0===t.length?null:t[0].theme+"/"+t[0].calculator},getCalculatorPath:function(e,t){return e+"/"+t},isValidNonEmptyString:function(e){return void 0!==e&&null!==e&&""!==e},getContactUrl:function(t){var n=null,r=null;if("multicalc"!==t){var a=this.getCalculatorNameObject(t);if(null===a)return null;n=a.theme,r=a.calculator}var i=e.getActiveLanguage(),o=null;if(this.isValidNonEmptyString(r)&&void 0!==s.themes[n]&&void 0!==s.themes[n].calculations[r]){if(o=s.themes[n].calculations[r].contactUrl,"string"==typeof o)return o;if("undefined"!=typeof o&&null!==o)return o[i]}if(this.isValidNonEmptyString(n)&&void 0!==s.themes[n]){if(o=s.themes[n].contactUrl,"string"==typeof o)return o;if("undefined"!=typeof o&&null!==o)return o[i]}return"string"==typeof s.contactUrl?s.contactUrl:"undefined"!=typeof s.contactUrl?s.contactUrl[i]:null},addSocialMedia:function(e,t,n){for(var r in t)(void 0===e[r]||null===e[r])&&("string"==typeof t[r]?e[r]=t[r]:"undefined"!=typeof t[r]&&(e[r]=t[r][n]))},getSocialMediaUrl:function(e,t){var n=this.getSocialMediaUrls()[e][t];return n},getSocialMediaUrls:function(){if(void 0!==o&&null!==o)return o;o={};var n=e.getActiveLanguage(),r=t.baseViewParameters.calculatorsSettings;for(var a in r.themes)if(void 0!==r.themes[a]){var i=r.themes[a];for(var s in i.calculations){var l=i.calculations[s],c={};this.addSocialMedia(c,l.socialMediaUrls,n),this.addSocialMedia(c,i.socialMediaUrls,n),this.addSocialMedia(c,r.socialMediaUrls,n);var u=a+"."+s;o[u]=c}var d={};this.addSocialMedia(d,i.overview.socialMediaUrls,n),this.addSocialMedia(d,i.socialMediaUrls,n),this.addSocialMedia(d,r.socialMediaUrls,n),o[a]=d}var m={};return this.addSocialMedia(m,r.overview.socialMediaUrls,n),this.addSocialMedia(m,r.socialMediaUrls,n),o.overview=m,o},getAvailableSocialMedia:function(e){var t=this.getSocialMediaUrls()[e],n=[];if(void 0!==t)for(var r in t)this.isValidNonEmptyString(t[r])&&n.push(r);return n},resetSocialMediaUrl:function(){o=null},reset:function(){s=t.baseViewParameters.calculatorsSettings,l=t.baseApplicationParameters.authorizedCalculators,r=null,a=null,i=null,this.resetSocialMediaUrl()}};return n.$on("countryChangeSuccess",function(){g.reset()}),g}]),n}),define("route-resolver",["angular","parameters-manager","routes-handler","calculators-manager"],function(e,t){"use strict";var n=function(){this.$get=function(){return this},this.route=function(){var e=function(e,t,n){var r=e.defer();return require(n,function(){r.resolve(),t.$apply()}),r.promise},n=function(n,r,a,i,o){void 0===i&&(i=!0);var s={};return s.templateUrl=n,s.controller=r,s.reloadOnSearch=i,s.resolve={load:["$q","$rootScope","locationService","calculatorsManager",function(n,i,s,l){var c=[a];return s.getSearch().consultantMode&&(t.baseApplicationParameters.consultantMode="true"===s.getSearch().consultantMode),t.baseApplicationParameters.consultantMode?"function"!=typeof o||o(l)?void 0===window.sessionStorage.userLogged&&"registerController"!==r&&"confirmationController"!==r&&"loginController"!==r&&"userAccountController"!==r&&"consultantUserAccountController"!==r&&"resetPasswordController"!==r?s.setPath("/login"):"overviewController"===r&&void 0===window.sessionStorage.userLogged&&s.setPath("/login"):s.setPath("/login"):"function"!=typeof o||o(l)||s.setPath("/"),e(n,i,c)}]},s};return{resolve:n}}()},r=e.module("routeResolverServices",[]);r.provider("routeResolver",n)}),define("custom-route-registrator",[],function(){"use strict";var e={registerRoute:function(e,t,n){}};return e}),define("route-registrator",["angular","routes-handler","parameters-manager","custom-route-registrator"],function(e,t,n,r){"use strict";var a={reset:function(){t.reset()},registerCalculatorRoute:function(e,n,r,a){e.when(t.getCheckedPath(n,r),a)},registerRoute:function(e,n,a){e.when(t.getCheckedPath("/",a),n.resolve("src/controllers/multicalc/multicalc.html","multicalcController","multicalc-controller",!0)),r.registerRoute(e,n,a),e.otherwise({redirectTo:"/"})}},i=function(){this.$get=function(){return this},this.routeRegistrator=a},o=e.module("routeRegistratorServices",[]);o.provider("routeRegistrator",i)}),define("state",["angular","common-object-utilities","storage-manager","model-constants"],function(e,t){"use strict";var n=e.module("stateModule",["storageManagerModule"]);return n.factory("state",["storageManager","$rootScope",function(e,n){var r,a=new t;return r={},r.create=function(t,r,i){var o;o=e.getStoredObject(t),o||(o=r(),a.protect(o),i(o),e.storeObject(t,o)),n.$on("storageReset",function(){i(o),e.storeObject(t,o)});var s={};return s.getModel=function(){return o},s.get=function(){return e.getStoredObject(t)},s.createModel=function(e){return a.protect(e),e},s},r.createModel=function(e){return a.protect(e),e},r}]),n}),define("base-model",[],function(){"use strict";var e=function(){this.class1MortgagesInitialized=null,this.class1Mortgages=null,this.class2Mortgage=null,this.specialConditions=null,this.class1MortgageAmount=null,this.class2MortgageAmount=null,this.totalAmortizationAmount=null,this.yearlyAmortizationAmount=null,this.hasClass2Mortgage=null,Object.preventExtensions(this)},t=function(){this.ownCapital=null,this.houseValue=null,this.effectiveCostMortgageInterestRate=null,this.selectedInterest=null,this.financing=new e,Object.preventExtensions(this)},n={HouseFinancing:e,House:t};return n}),define("base-state",["angular","parameters-manager","base-model","state","storage-manager","model-constants"],function(e,t,n){"use strict";var r=e.module("baseStateModule",["storageManagerModule"]);return r.factory("baseState",["storageManager","$rootScope","state",function(e,n,r){var a=function(n){if(n.relationship=null,n.relationshipSinceYear=null,n.mainPerson.defaultCivilStatus=null,n.mainPerson.civilStatus=null,n.mainPerson.confession=null,n.mainPerson.sex=null,n.mainPerson.birthYear=null,n.mainPerson.grossIncome=null,n.mainPerson.taxableIncome=null,n.mainPerson.yearlyNetIncome=null,n.mainPerson.monthlyNetIncome=null,n.mainPerson.grossFortune=null,n.mainPerson.taxableFortune=null,n.mainPerson.entryType=null,n.mainPerson.firstPillarBase=null,n.mainPerson.missingYears=null,n.mainPerson.secondPillarBase=null,n.mainPerson.secondPillarRent=null,n.mainPerson.secondPillarCapital=null,n.mainPerson.numberOfOwnChildren=null,n.mainPerson.averageIncome=null,n.mainPerson.disabilityRent=null,n.mainPerson.disabilityChildrenRent=null,n.mainPerson.widowRent=null,n.mainPerson.orphanRent=null,n.mainPerson.pensionRent=null,n.mainPerson.manualDisabilityChildrenRent=!1,n.mainPerson.manualDisabilityRent=!1,n.mainPerson.manualWidowRent=!1,n.mainPerson.manualOrphanRent=!1,n.mainPerson.manualPensionRent=!1,n.secondPerson.defaultCivilStatus=null,n.secondPerson.civilStatus=null,n.secondPerson.confession=null,n.secondPerson.sex=null,n.secondPerson.birthYear=null,n.secondPerson.grossIncome=null,n.secondPerson.taxableIncome=null,n.secondPerson.yearlyNetIncome=null,n.secondPerson.monthlyNetIncome=null,n.secondPerson.grossFortune=null,n.secondPerson.taxableFortune=null,n.secondPerson.entryType=null,n.secondPerson.firstPillarBase=null,n.secondPerson.missingYears=null,n.secondPerson.secondPillarBase=null,n.secondPerson.secondPillarRent=null,n.secondPerson.secondPillarCapital=null,n.secondPerson.numberOfOwnChildren=null,n.secondPerson.disabilityChildrenRent=null,n.secondPerson.disabilityRent=null,n.secondPerson.widowRent=null,n.secondPerson.orphanRent=null,n.secondPerson.pensionRent=null,n.secondPerson.manualDisabilityChildrenRent=!1,n.secondPerson.manualDisabilityRent=!1,n.secondPerson.manualWidowRent=!1,n.secondPerson.manualOrphanRent=!1,n.secondPerson.manualPensionRent=!1,n.hasDetailedNumberOfChildren=null,n.numberOfChildren=null,n.numberOfCoupleChildren=null,n.zipAndLocation=null,n.country=null,n.isBaseDataExpanded=null,n.tax.grossIncome=null,n.tax.taxableIncome=null,n.tax.taxableIncomeDetailed=!1,n.tax.grossFortune=null,n.tax.taxableFortune=null,n.tax.yearlyNetIncome=null,n.tax.monthlyNetIncome=null,n.tax.entryType=null,n.tax.taxableIncomeDetail.countryTaxableIncome=null,n.tax.taxableIncomeDetail.cantonalRateDecisiveIncome=null,n.tax.taxableIncomeDetail.countryRateDecisiveIncome=null,n.house.ownCapital=null,n.house.houseValue=null,n.house.effectiveCostMortgageInterestRate=null,n.house.selectedInterest=null,n.house.financing.class1MortgagesInitialized=!1,n.house.financing.class1Mortgages=[],n.house.financing.class2Mortgage=null,n.house.financing.class1MortgageAmount=null,n.house.financing.class2MortgageAmount=null,n.house.financing.totalAmortizationAmount=null,n.house.financing.yearlyAmortizationAmount=null,n.house.financing.hasClass2Mortgage=null,n.house.financing.specialConditions.assigned=null,n.saving.endCapital=null,n.saving.initialInvestment=null,n.saving.modality=null,n.saving.monthlyPeriodicInvestment=null,n.saving.yearlyPeriodicInvestment=null,n.saving.duration=null,n.saving.selectedInterest=null,n.saving.interestRate=null,n.saving.specialConditions=null,n.defaultGrossIncome=null,n.defaultNetIncome=null,n.currentFortune=null,n.pensionInterest=null,n.selectedFortunePension=null,n.showPensionNeedAsPercentage=null,n.pensionNeedPercentage=null,n.pensionNeedAmount=null,n.yearlySavings=null,n.thirdPillarRent=null,t.baseViewParameters.askConsultantDataForPrinting){t.baseViewParameters.deleteCustomerInfo&&(n.additionalPrintingData.customerInfo="",n.additionalPrintingData.customerNumber="");var a=e.getFromBrowserLocalStorage("consultantInfo");a?n.additionalPrintingData.consultantInfo=a:e.storeOnBrowserLocalStorage("consultantInfo",n.additionalPrintingData.consultantInfo);var i=e.getFromBrowserLocalStorage("additionalData");i?n.additionalPrintingData.additionalData=r.createModel(i):e.storeOnBrowserLocalStorage("additionalData",n.additionalPrintingData.additionalData)}else e.removeFromBrowserLocalStorage("consultantInfo"),e.removeFromBrowserLocalStorage("additionalData")},i=function(){var e;return e={},e.relationship=null,e.relationshipSinceYear=null,e.hasDetailedNumberOfChildren=null,e.numberOfChildren=null,e.numberOfCoupleChildren=null,e.zipAndLocation=null,e.country=null,e.isBaseDataExpanded=null,e.defaultGrossIncome=null,e.defaultNetIncome=null,e.currentFortune=null,e.pensionInterest=null,e.selectedFortunePension=null,e.showPensionNeedAsPercentage=null,e.pensionNeedPercentage=null,e.pensionNeedAmount=null,e.yearlySavings=null,e.thirdPillarRent=null,e.additionalPrintingData={customerInfo:null,customerNumber:null,consultantInfo:"",additionalData:null},e.house={ownCapital:null,houseValue:null,effectiveCostMortgageInterestRate:null,selectedInterest:null,financing:{class1MortgagesInitialized:null,class1Mortgages:null,class2Mortgage:null,specialConditions:{assigned:null},class1MortgageAmount:null,class2MortgageAmount:null,totalAmortizationAmount:null,yearlyAmortizationAmount:null,hasClass2Mortgage:null}},e.mainPerson={defaultCivilStatus:null,civilStatus:null,confession:null,sex:null,birthYear:null,grossIncome:null,taxableIncome:null,monthlyNetIncome:null,yearlyNetIncome:null,grossFortune:null,taxableFortune:null,entryType:null,firstPillarBase:null,missingYears:null,secondPillarBase:null,secondPillarRent:null,secondPillarCapital:null,numberOfOwnChildren:null,averageIncome:null,disabilityRent:null,disabilityChildrenRent:null,widowRent:null,orphanRent:null,pensionRent:null,manualDisabilityChildrenRent:null,manualDisabilityRent:null,manualWidowRent:null,manualOrphanRent:null,manualPensionRent:null},e.secondPerson={defaultCivilStatus:null,civilStatus:null,confession:null,sex:null,birthYear:null,grossIncome:null,taxableIncome:null,grossFortune:null,taxableFortune:null,monthlyNetIncome:null,yearlyNetIncome:null,entryType:null,firstPillarBase:null,missingYears:null,secondPillarBase:null,secondPillarRent:null,secondPillarCapital:null,numberOfOwnChildren:null,averageIncome:null,disabilityRent:null,disabilityChildrenRent:null,widowRent:null,orphanRent:null,pensionRent:null,manualDisabilityChildrenRent:null,manualDisabilityRent:null,manualWidowRent:null,manualOrphanRent:null,manualPensionRent:null},e.tax={grossIncome:null,taxableIncome:null,taxableIncomeDetailed:!1,grossFortune:null,taxableFortune:null,yearlyNetIncome:null,monthlyNetIncome:null,entryType:null,taxableIncomeDetail:{countryTaxableIncome:null,cantonalRateDecisiveIncome:null,countryRateDecisiveIncome:null}},e.saving={endCapital:null,initialInvestment:null,modality:null,monthlyPeriodicInvestment:null,yearlyPeriodicInvestment:null,duration:null,selectedInterest:null,interestRate:null,specialConditions:null},e};return r.create("base",i,a).getModel()}]),r}),define("calculator-service",["angular","logger","parameters-manager"],function(e,t,n){"use strict";var r=t.get("calculatorService"),a=t.get("AsynchronousModeProfile"),i=t.get("AsynchronousModeDetailedProfile"),o=e.module("calculatorServiceModule",[]);
return o.factory("calculatorService",["$http","$q","authenticationService",function(e,o,s){i&&!i.enabledFor(t.DEBUG)&&(i=void 0);var l={requestsArray:[],deferredArray:[],calculatorInitializationDeferred:{},getServiceURL:function(){return n.baseApplicationParameters.calculatorServiceURL+"/"+n.baseApplicationParameters.calculatorCustomization},getServerCalculatorName:function(e){return"ch.logismata.online.calc"===e?"online.tax":"ch.logismata.rpopulaires.calc"===e?"rpopulaires":void 0},getLocalCalculatorByName:function(e){return"ch.logismata.online.calc"===e?ch.logismata.online.calc:"ch.logismata.rpopulaires.calc"===e?ch.logismata.rpopulaires.modulo:void 0},getLocalCalculatorRequireName:function(e){return"ch.logismata.online.calc"===e?"wolf-calc":"ch.logismata.rpopulaires.calc"===e?"wolf-rpopulaires":void 0},initializeCalculator:function(e){if(this.calculatorInitializationDeferred[e])return this.calculatorInitializationDeferred[e].promise;var t=o.defer();this.calculatorInitializationDeferred[e]=t,a.debug("initializing calculator "+e);var n=this.getLocalCalculatorRequireName(e),r=this;return require([n],function(){var a=require.toUrl(n),i=a.substring(0,a.lastIndexOf("/")),o=r.getLocalCalculatorByName(e);o.loadFrom(i),t.resolve()}),t.promise},initializeRequestedCalculators:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push(this.initializeCalculator(r))}return o.all(t)},doLocalCalculations:function(e){var t,n,s,l=o.defer(),c=[],u={},d=[];for(s=0;s<e.length;s++){var m=e[s].calculatorName;-1===d.indexOf(m)&&d.push(m)}var g=this;return this.initializeRequestedCalculators(d).then(function(){for(s=0;s<e.length;s++){try{t=g.getLocalCalculatorByName(e[s].calculatorName),n=t[e[s].calculationName]}catch(o){throw r.error("Error finding calculation. calculator="+e[s].calculatorName+" calculation="+e[s].calculationName+" parameters="+JSON.stringify(e[s].calculationParameters)),o}a.debug("CALC "+e[s].calculationName),i&&i.debug("CALC "+e[s].calculationName+" INDEX "+s+" parameters: "+e[s].calculationParameters.length);try{u.response=n.apply(t,e[s].calculationParameters),u.errorCode=0,c.push(u)}catch(o){throw r.error("Error calling calculator. calculator="+e[s].calculatorName+" calculation="+e[s].calculationName+" parameters="+JSON.stringify(e[s].calculationParameters)),o}u={}}for(s=0;s<e.length;s++)i&&i.debug("Result "+s+" : "+e[s].calculatorName+" - "+e[s].calculationName+" : "+JSON.stringify(c[s]));l.resolve(c)}),l.promise},doServerCalculations:function(t){var r,a=o.defer(),i=this.getServiceURL()+"/calculate",l=[];for(r=0;r<t.length;r++)l[r]={},l[r].calculatorName=this.getServerCalculatorName(t[r].calculatorName),l[r].method=t[r].calculationName,l[r].params=t[r].calculationParameters;var c=this;return s.getCalculatorServiceToken().then(function(r){e({timeout:n.baseApplicationParameters.httpTimeout,method:"PUT",url:i,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:{authToken:r.authToken,requests:l}}).success(function(e,t,n,r){var i,o=[];if(e.responses)for(i=0;i<e.responses.length;i++)o.push(e.responses[i]);e.response&&void 0!==e.errorCode&&o.push(e),a.resolve(o)}).error(function(e,n,r,i){var o;return 401===n?(s.clearCalculatorServiceToken(),c.doServerCalculations(t)):(o=CalculatorServiceResultStatus.SERVERERROR,void a.reject({status:o}))})}),a.promise},doCalculations:function(e){return n.baseApplicationParameters.serverCalculation?this.doServerCalculations(e):this.doLocalCalculations(e)},addRequest:function(e){var t=o.defer(),n={calculatorName:e.calculatorName,calculationName:e.calculationName,calculationParameters:e.calculationParameters};return a.debug("addRequest - request"+e.calculationName),i&&i.debug("addRequest - request"+JSON.stringify(e)),this.requestsArray.push(n),this.deferredArray.push(t),t.promise},sendRequest:function(e){var t={calculatorName:e.calculatorName,calculationName:e.calculationName,calculationParameters:e.calculationParameters};return a.debug("sendRequest - request"+e.calculationName),i&&i.debug("sendRequest - request"+JSON.stringify(e)),this.doCalculations([t])},sendRequests:function(){var e=o.defer();a.debug("SEND REQUESTS");var t,n=this.requestsArray.slice(),r=this.deferredArray.slice();if(this.requestsArray=[],this.deferredArray=[],n.length>0){for(t=0;t<n.length;t++)i&&i.debug("Request "+t+" : "+n[t].calculatorName+" - "+n[t].calculationName);return this.doCalculations(n).then(function(n){for(t=0;t<r.length;t++)0===n[t].errorCode?r[t].resolve(n[t].response):r[t].reject(n[t]);e.resolve(n)},function(){e.reject()})}return e.resolve(),e.promise}};return l}]),o}),define("tax-calculator",["angular","logger","parameters-manager","calculator-service"],function(e,t,n){"use strict";var r=(t.get("TaxCalculator"),t.get("AsynchronousModeProfile"),e.module("taxCalculatorModule",[]));return r.factory("taxCalculator",["calculatorService","localize","$q",function(e,t,r){var a={activateCH:function(){var t={calculatorName:"ch.logismata.online.law",calculationName:"activateCH",calculationParameters:[]};return e.addRequest(t)},setActiveCountry:function(){var n;n=t.isCountryCh()?"activateCH":t.isCountryLi()?"activateLI":"activateCH";var r={calculatorName:"ch.logismata.online.law",calculationName:n,calculationParameters:[]};return e.addRequest(r)},calculateTaxableIncomeStatePromise:function(t,n,r,a,i,o,s){var l={calculatorName:"ch.logismata.online.calc",calculationName:"calcTaxableIncomeState",calculationParameters:[t,n,r,a,i,o,s]};return e.addRequest(l)},calculateTaxableIncomeCountryPromise:function(t,n,r,a,i,o,s){var l={calculatorName:"ch.logismata.online.calc",calculationName:"calcTaxableIncomeCountry",calculationParameters:[t,n,r,a,i,o,s]};return e.addRequest(l)},calculateGrossIncomeStatePromise:function(t,n,r,a,i,o,s){var l={calculatorName:"ch.logismata.online.calc",calculationName:"calcGrossIncomeState",calculationParameters:[t,n,r,a,i,o,s]};return e.addRequest(l)},calculateGrossIncomeCountry:function(t,n,r,a,i,o,s){var l={calculatorName:"ch.logismata.online.calc",calculationName:"calcGrossIncomeCountry",calculationParameters:[t,n,r,a,i,o,s]};return e.addRequest(l)},calculateTaxableFortunePromise:function(t,n,r,a,i){var o={calculatorName:"ch.logismata.online.calc",calculationName:"calcTaxableFortune",calculationParameters:[t,n,r,a,i]};return e.addRequest(o)},calculateGrossFortunePromise:function(t,n,r,a,i){var o={calculatorName:"ch.logismata.online.calc",calculationName:"calcGrossFortune",calculationParameters:[t,n,r,a,i]};return e.addRequest(o)},calculateIncomeTax:function(t,n,r,a,i,o,s,l,c,u,d){var m={calculatorName:"ch.logismata.online.calc",calculationName:"calcIncomeTax",calculationParameters:[t,n,r,a,i,o,s,l,c,u,d]};return e.addRequest(m)},calculateCapitalizationTax:function(t,n,r,a,i,o,s,l,c){var u={calculatorName:"ch.logismata.online.calc",calculationName:"calcCapitalTax",calculationParameters:[t,n,r,a,i,o,s,l,c]};return e.addRequest(u)},calculateSimpleSaving:function(t,r,a,i,o,s,l,c){var u=n.baseApplicationParameters.calculatorCustomization,d=1,m={invest:t,periodical:r,monthlybase:a,duration:i,interest:o,neg_interest:c,interestranges:l,inflationrate:null,endcapital:null,specialconditions:s},g={calculatorName:"ch.logismata.online.calc",calculationName:"calcSaving",calculationParameters:[u,d,m]};return e.addRequest(g)},calculateSimpleSavingInvest:function(t,r,a,i,o,s,l,c){var u=n.baseApplicationParameters.calculatorCustomization,d=2,m={invest:t,periodical:null,monthlybase:r,duration:a,interest:i,neg_interest:c,interestranges:l,inflationrate:null,endcapital:o,specialconditions:s},g={calculatorName:"ch.logismata.online.calc",calculationName:"calcSaving",calculationParameters:[u,d,m]};return e.addRequest(g)},calculateSimpleSavingDuration:function(t,r,a,i,o,s,l,c){var u=n.baseApplicationParameters.calculatorCustomization,d=3,m={invest:t,periodical:r,monthlybase:a,duration:null,interest:i,neg_interest:c,interestranges:l,inflationrate:null,endcapital:o,specialconditions:s},g={calculatorName:"ch.logismata.online.calc",calculationName:"calcSaving",calculationParameters:[u,d,m]};return e.addRequest(g)},calcExpression:function(t,n,r,a){var i={calculatorName:"ch.logismata.online.calc",calculationName:"calcExpression",calculationParameters:[t,n,r,a]};return e.addRequest(i)},roundValue:function(t){var n={calculatorName:"ch.logismata.online.calc",calculationName:"roundValue",calculationParameters:[t]};return e.addRequest(n)},calculate3aSaving:function(t,n,r,a,i,o,s,l,c,u,d,m,g,f){var h={calculatorName:"ch.logismata.online.calc",calculationName:"calcS3aSaving",calculationParameters:[t,n,r,a,i,o,s,l,c,u,d,m,g,f]};return e.addRequest(h)},getMax3aInvestmentValues:function(){return r.all([this.activateCH(),this.getMax3aInvestmentWithSecondPillarPromise(),this.getMax3aInvestmentWithoutSecondPillarPromise(),this.getMax3aInvestmentWithoutSecondPillarTwoPersonPromise(),this.setActiveCountry()]).then(function(e){var t=e[1],n=e[2],r=e[3];return{max3aInvestmentWithSecondPillar:t,max3aInvestmentWithoutSecondPillar:n,max3aInvestmentWithoutSecondPillarTwoPerson:r}})},getMax3aInvestmentWithSecondPillarPromise:function(){var t={calculatorName:"ch.logismata.online.law",calculationName:"getMax3aPremiumWithBVG",calculationParameters:[]};return e.addRequest(t)},getMax3aInvestmentWithoutSecondPillarPromise:function(){var t={calculatorName:"ch.logismata.online.law",calculationName:"getMax3aPremiumWithoutBVG",calculationParameters:[]};return e.addRequest(t)},getMax3aInvestmentWithoutSecondPillarTwoPersonPromise:function(){var t={calculatorName:"ch.logismata.online.law",calculationName:"getMax3aPremiumWithoutBVG",calculationParameters:[]};return e.addRequest(t).then(function(e){return 2*e})},calcInheritanceEstate:function(t,n,r,a){var i={calculatorName:"ch.logismata.online.calc",calculationName:"calcInheritanceEstate",calculationParameters:[t,n,r,a]};return e.addRequest(i)},calculateConsumptionEndCapital:function(t,r,a,i,o,s,l,c){var u=n.baseApplicationParameters.calculatorCustomization,d=1,m={startcapital:t,withdrawal:r,monthlybase:a,duration:i,interest:o,neg_interest:c,interestranges:l,inflationrate:null,endcapital:null,specialconditions:s},g={calculatorName:"ch.logismata.online.calc",calculationName:"calcWithdrawal",calculationParameters:[u,d,m]};return e.addRequest(g)},calculateConsumptionWithdrawal:function(t,r,a,i,o,s,l,c){var u=n.baseApplicationParameters.calculatorCustomization,d=2,m={startcapital:t,withdrawal:null,monthlybase:r,duration:a,interest:i,neg_interest:c,interestranges:l,inflationrate:null,endcapital:o,specialconditions:s},g={calculatorName:"ch.logismata.online.calc",calculationName:"calcWithdrawal",calculationParameters:[u,d,m]};return e.addRequest(g)},calculateConsumptionDuration:function(t,r,a,i,o,s,l,c){var u=n.baseApplicationParameters.calculatorCustomization,d=3,m={startcapital:t,withdrawal:r,monthlybase:a,duration:null,interest:i,neg_interest:c,interestranges:l,inflationrate:null,endcapital:o,specialconditions:s},g={calculatorName:"ch.logismata.online.calc",calculationName:"calcWithdrawal",calculationParameters:[u,d,m]};return e.addRequest(g)},calculateFreeAvailableFortune:function(t,r,a,i,o,s,l,c,u){var d=n.baseApplicationParameters.calculatorCustomization,m={startyear:t,duration:r,liqreserve:a,fortune:i,interest:o,neg_interest:s,saving:l,changes:c},g={calculatorName:"ch.logismata.online.calc",calculationName:"calcFreeAvailableFortune",calculationParameters:[d,m,u]};return e.addRequest(g)},calculateNetIncomeFromGrossIncome:function(t,n,r){var a={calculatorName:"ch.logismata.online.calc",calculationName:"calcNetIncome",calculationParameters:[t,n,r]};return e.addRequest(a)},calculateGrossIncomeFromNetIncome:function(t,n,r){var a={calculatorName:"ch.logismata.online.calc",calculationName:"calcGrossIncomeFromNetIncome",calculationParameters:[t,n,r]};return e.addRequest(a)},calcNetIncomeFromTaxableIncome:function(t,n,r,a,i,o,s,l){var c={calculatorName:"ch.logismata.online.calc",calculationName:"calcNetIncomeFromTaxableIncome",calculationParameters:[t,n,r,a,i,o,s,l]};return e.addRequest(c)},sendRequests:function(){return e.sendRequests()}};return a}]),r}),define("rpopulaires-calculator",["angular","logger","calculator-service"],function(e,t,n){"use strict";var r=e.module("rpopulairesCalculatorModule",[]),a=t.get("RPopulairesCalculator");t.get("AsynchronousModeProfile");return r.factory("rpopulairesCalculator",["calculatorService","localize",function(e,t){var n={calculatorName:"ch.logismata.rpopulaires.calc",SCENARIO_PENSION_BOTH:1,SCENARIO_PENSION_MAIN:2,SCENARIO_DISABILITY_SICKNESS_MAIN:3,SCENARIO_DISABILITY_ACCIDENT_MAIN:4,SCENARIO_DEATH_SICKNESS_MAIN:5,SCENARIO_DEATH_ACCIDENT_MAIN:6,SCENARIO_PENSION_SECOND:7,SCENARIO_DISABILITY_SICKNESS_SECOND:8,SCENARIO_DISABILITY_ACCIDENT_SECOND:9,SCENARIO_DEATH_SICKNESS_SECOND:10,SCENARIO_DEATH_ACCIDENT_SECOND:11,_call:function(t,n){a.debug(t+": "+JSON.stringify(n));var r={calculatorName:this.calculatorName,calculationName:t,calculationParameters:n};return e.addRequest(r)},getTaxBaseInfo:function(){return this._call("getTaxBaseInfo",[])},getMax3aPremiumWithBVG:function(){return this._call("getMax3aPremiumWithBVG",[])},getMax3aPremiumWithoutBVG:function(){return this._call("getMax3aPremiumWithoutBVG",[])},checkScenarioSingle:function(e){return this._call("checkScenarioSingle",[(new Date).getFullYear(),e.scenario,{sex:e.focusedPersonSex,birthyear:e.focusedPersonBirthYear},e.numberOfChildren])},checkScenarioCouple:function(e){return this._call("checkScenarioCouple",[(new Date).getFullYear(),e.scenario,e.married,e.marriedSince,{sex:e.focusedPersonSex,birthyear:e.focusedPersonBirthYear},{sex:e.unfocusedPersonSex,birthyear:e.unfocusedPersonBirthYear}])},calcBasisSingle:function(e){return this._call("calcBasisSingle",[(new Date).getFullYear(),{sex:e.focusedPersonSex,birthyear:e.focusedPersonBirthYear,job:e.focusedPersonJob,income:e.focusedPersonGrossIncome,ahv_mode:e.focusedPersonFirstPillarBase,ahv_average:e.focusedPersonAverageIncome,ahv_missing:e.focusedPersonMissingYears,bvg_mode:e.focusedPersonSecondPillarBase},e.numberOfChildren])},calcBasisCouple:function(e){return this._call("calcBasisCouple",[(new Date).getFullYear(),e.married,e.marriedSince,{sex:e.focusedPersonSex,birthyear:e.focusedPersonBirthYear,job:e.focusedPersonJob,income:e.focusedPersonGrossIncome,ahv_mode:e.focusedPersonFirstPillarBase,ahv_average:e.focusedPersonAverageIncome,ahv_missing:e.focusedPersonMissingYears,bvg_mode:e.focusedPersonSecondPillarBase},{sex:e.unfocusedPersonSex,birthyear:e.unfocusedPersonBirthYear,job:e.unfocusedPersonJob,income:e.unfocusedPersonGrossIncome,ahv_mode:e.unfocusedPersonFirstPillarBase,ahv_average:e.unfocusedPersonAverageIncome,ahv_missing:e.unfocusedPersonMissingYears,bvg_mode:e.unfocusedPersonSecondPillarBase},e.numberOfChildren,e.focusedPersonNumberOfOwnChildren,e.unfocusedPersonNumberOfOwnChildren])},calcScenarioSingle:function(e,t){return this._call("calcScenarioSingle",[(new Date).getFullYear(),e,{sex:t.focusedPersonSex,birthyear:t.focusedPersonBirthYear,job:t.focusedPersonJob,income:t.focusedPersonGrossIncome,ahv_mode:t.focusedPersonFirstPillarBase,ahv_average:t.focusedPersonAverageIncome,ahv_missing:t.focusedPersonMissingYears,bvg_mode:t.focusedPersonSecondPillarBase,bvg_iv_rente:t.focusedPersonDisabilityRent,bvg_iv_child:t.focusedPersonDisabilityChildrenRent,bvg_widow:t.focusedPersonWidowRent,bvg_orphan:t.focusedPersonOrphanRent,bvg_pension:t.focusedPersonPensionRent},t.numberOfChildren,{fortune:t.currentFortune,interest:t.pensionInterest,show_children:t.showChildrenRent,dis_need:t.disabilityNeedPercentage,dis_extra_rente:t.disabilityAdditionalRent,death_need:t.deathNeedPercentage,death_extra_capital:t.deathAdditionalRent,pension_need:t.pensionNeedPercentage,pension_extra_saving:t.pensionAdditionalSaving,pension_extra_rente:t.pensionAdditionalRent}])},calcScenarioCouple:function(e,t){return this._call("calcScenarioCouple",[(new Date).getFullYear(),e,t.married,t.marriedSince,{sex:t.focusedPersonSex,birthyear:t.focusedPersonBirthYear,job:t.focusedPersonJob,income:t.focusedPersonGrossIncome,ahv_mode:t.focusedPersonFirstPillarBase,ahv_average:t.focusedPersonAverageIncome,ahv_missing:t.focusedPersonMissingYears,bvg_mode:t.focusedPersonSecondPillarBase,bvg_iv_rente:t.focusedPersonDisabilityRent,bvg_iv_child:t.focusedPersonDisabilityChildrenRent,bvg_widow:t.focusedPersonWidowRent,bvg_orphan:t.focusedPersonOrphanRent,bvg_pension:t.focusedPersonPensionRent},{sex:t.unfocusedPersonSex,birthyear:t.unfocusedPersonBirthYear,job:t.unfocusedPersonJob,income:t.unfocusedPersonGrossIncome,ahv_mode:t.unfocusedPersonFirstPillarBase,ahv_average:t.unfocusedPersonAverageIncome,ahv_missing:t.unfocusedPersonMissingYears,bvg_mode:t.unfocusedPersonSecondPillarBase,bvg_iv_rente:t.unfocusedPersonDisabilityRent,bvg_iv_child:t.unfocusedPersonDisabilityChildrenRent,bvg_widow:t.unfocusedPersonWidowRent,bvg_orphan:t.unfocusedPersonOrphanRent,bvg_pension:t.unfocusedPersonPensionRent},t.numberOfChildren,t.focusedPersonNumberOfOwnChildren,t.unfocusedPersonNumberOfOwnChildren,{fortune:t.currentFortune,interest:t.pensionInterest,show_children:t.showChildrenRent,dis_need:t.disabilityNeedPercentage,dis_extra_rente:t.disabilityAdditionalRent,death_need:t.deathNeedPercentage,death_extra_capital:t.deathAdditionalRent,pension_need:t.pensionNeedPercentage,pension_extra_saving:t.pensionAdditionalSaving,pension_extra_rente:t.pensionAdditionalRent}])},calcSparenJSON:function(e){return this._call("calcSparenJSON",[JSON.stringify({year:e.year,union:e.union,gender:e.gender,age:e.age,children:e.children,income:e.income,is_empl:e.is_empl,has_bvg:e.has_bvg,locality:e.locality,premium:e.premium,interest:e.interest})])},calcRisikoJSON:function(e){return this._call("calcRisikoJSON",[JSON.stringify({year:e.year,union:e.union,gender:e.gender,age:e.age,children:e.children,income:e.income,is_empl:e.is_empl,has_bvg:e.has_bvg,need_disab:e.need_disab,need_death:e.need_death})])}};return n}]),r}),define("multicalc-model",[],function(){"use strict";var e=function(){this.professionalStatus=null,this.age=null,this.monthlySavingCapacity=null,this.interestRate=null,this.disabilityNeed=null,this.deathNeed=null},t=function(){this.benefits=0,this.gap=0,this.secondPillarRent=0,this.firstPillarRent=0},n=function(){this.taxSavings=0,this.interest=0,this.savings=0,this.capitalizationTax=0,this.netCapital=0,this.netYield=0,this.duration=0,this.taxSavingsSet=[],this.interestSet=[],this.savingsSet=[]},r=function(){this.saving3a=new n,this.disability=new t,this.death=new t},a={MulticalcScenario:e,MulticalcResult:r};return a}),define("multicalc-state",["angular","multicalc-model","state","storage-manager"],function(e,t){"use strict";var n=e.module("multicalcStateModule",["storageManagerModule"]);return n.factory("multicalcState",["state",function(e){var n=function(e){e.professionalStatus=null,e.age=null,e.monthlySavingCapacity=null,e.interestRate=null,e.disabilityNeed=null,e.deathNeed=null},r=function(){return new t.MulticalcScenario};return e.create("multicalc",r,n)}]),n}),define("formatter",["angular","logger","common-currency-formatter","parameters-manager","wolf-tools"],function(e,t,n,r){"use strict";var a=t.get("Formatter"),i=e.module("formatterModule",[]),o=r.baseViewParameters;return i.factory("formatter",function(){var e={_amountCurrencyFormatter:new n(o.groupDelimiter,o.amountDecimalDelimiter,o.useMixedGroupingSeparator),_percentageCurrencyFormatter:new n(o.groupDelimiter,o.percentageDecimalDelimiter,o.useMixedGroupingSeparator),formatCurrency:function(e,t){a.debug("about to format: "+e);var n={};return n=t?this._percentageCurrencyFormatter.formatCurrency(e,!1,0):this._amountCurrencyFormatter.formatCurrency(e,!1,0),a.debug("formatted: "+n),n},formatCurrencyWithDecimals:function(e,t,n){a.debug("about to format: "+e);var r={};return r=n?this._percentageCurrencyFormatter.formatCurrency(e,!0,t):this._amountCurrencyFormatter.formatCurrency(e,!0,t),a.debug("formatted: "+r),r},unformat:function(e,t){var n=String(e);a.debug("about to unformat string: "+n);var r={};return t?(n=n.replace(".",o.percentageDecimalDelimiter),r=ch.logismata.wolftools.calcExpression(n,!1,o.percentageDecimalDelimiter,o.groupDelimiter)):r=ch.logismata.wolftools.calcExpression(n,!1,o.amountDecimalDelimiter,o.groupDelimiter),a.debug("unformatted: "+r),r},check:function(e,t){var n=String(e);a.debug("about to check format of string: "+n);try{var r={};return t?(n=n.replace(".",o.percentageDecimalDelimiter),r=ch.logismata.wolftools.calcExpression(n,!0,o.percentageDecimalDelimiter,o.groupDelimiter)):r=ch.logismata.wolftools.calcExpression(n,!0,o.amountDecimalDelimiter,o.groupDelimiter),a.debug("unformatted after check: "+r),!0}catch(i){return!1}},roundValue:function(e){a.debug("about to round: "+e);var t;return t=ch.logismata.wolftools.roundValue(e),a.debug("rounded value: "+t),t},reset:function(){this._amountCurrencyFormatter=new n(o.groupDelimiter,o.amountDecimalDelimiter,o.useMixedGroupingSeparator),this._percentageCurrencyFormatter=new n(o.groupDelimiter,o.percentageDecimalDelimiter,o.useMixedGroupingSeparator)}};return e}),i}),define("route-translator",["angular","logger","routes-handler","localization"],function(e,t,n){"use strict";var r=t.get("routeTranslator"),a=e.module("route-translator",[]);return a.factory("translateRoute",["localize",function(e){var t={perform:function(t){"#"===t.substr(0,1)&&r.error("route came with # at the beginning"),"."===t.substr(0,1)&&r.error("route came with . at the beginning"),t.length>1&&"/"===t.substr(0,1)&&r.error("route came with / at the beginning");var a=n.getPathByLanguage(t,e.getActiveLanguage());return a},getPath:function(e){var t=this.perform(e);return"#"===t.substr(0,1)&&(t=t.substr(1,t.length)),t}};return t}]),a}),define("localization-filter",["angular","logger","localization"],function(e,t){"use strict";var n=t.get("LocalizationFilter"),r=e.module("localizationFilter",[]);return r.filter("i18n",["localize",function(e){var r=function(){return n&&(n.enabledFor(t.DEBUG)?n.debug("i18n filter with key "+arguments[0]):n=void 0),e.getLocalizedString.apply(null,arguments)};return r.$stateful=!0,r}]),r.filter("amount",["localize",function(e){var r=function(r,a){return n&&(n.enabledFor(t.DEBUG)?n.debug("amount filter with value "+r):n=void 0),(null===a||void 0===a)&&(a=0),e.getLocalizedString("GenericFormats.Amount",{VALUE:r,DECIMALS:a})};return r.$stateful=!0,r}]),r.filter("percentage",["localize",function(e){var r=function(r,a){return n&&(n.enabledFor(t.DEBUG)?n.debug("percentage filter with value "+r):n=void 0),(null===a||void 0===a)&&(a=2),e.getLocalizedString("GenericFormats.Percentage",{VALUE:r,DECIMALS:a})};return r.$stateful=!0,r}]),r}),define("localization-directive",["angular","localization"],function(e){"use strict";var t=e.module("localizationDirective",[]);return t.directive("i18n",["localize",function(e){return{restrict:"EAC",link:function(t,n,r){var a=r.i18n?r.i18n:n.html();if(e.resourceFileLoaded)e.replace(n,a);else var i=t.$on("localizeResourcesUpdates",function(){i(),e.replace(n,a)})}}}]),t}),define("loading-controller",["angular","logger","parameters-manager","jquery-easing"],function(e,t,n){"use strict";var r=e.module("loadingModule",[]),a=t.get("LoadingService");return r.factory("loadingService",["$rootScope","$timeout",function(e,t){var r={loading:!1,stopped:!1,timeOutPromise:0,showLoader:function(){r.loading=!0,e.$emit("loadingChanged"),e.loaded=!1;var t={duration:n.baseViewParameters.loadingFadeInDuration,easing:jQuery.easing.easeInExpo};$("#loader").fadeIn(t)},startLoadingForAsync:function(){a.debug("startLoading"),0===r.timeOutPromise&&(a.debug("setting timeout"),r.timeOutPromise=t(r.showLoader,100))},startLoading:function(){var e=arguments[1],n=arguments[2];e.split("?")[0]!==n.split("?")[0]&&(a.debug("startLoading"),0===r.timeOutPromise&&(a.debug("setting timeout"),r.timeOutPromise=t(r.showLoader,100)))},finishLoading:function(){0!==r.timeOutPromise&&t.cancel(r.timeOutPromise),r.loading=!1,r.stopped=!0,r.timeOutPromise=0,e.$emit("loadingChanged"),$("#loader").fadeOut(n.baseViewParameters.loadingFadeOutDuration,function(){e.$broadcast("refreshStatus")}),a.debug("finishLoading")}};return e.$on("$locationChangeStart",r.startLoading),r}]),r}),define("custom-filters",["angular"],function(e){"use strict";var t=e.module("customFilters",[]);return t}),define("language-controller",["app","parameters-manager","routes-handler","logger","calculators-manager"],function(e,t,n,r){"use strict";var a=r.get("localization");return function(e){var r=e.controller("languageController",["$scope","localize","$timeout","calculatorsManager","locationService",function(e,r,i,o,s){e.localize=r,e.languageSelectionAvailable=function(){return t.baseViewParameters.languageSelectionEnabled&&t.baseViewParameters.availableLanguages.length>1},e.availableLanguages=function(){var e=t.baseViewParameters.languages,n=e.filter(function(e){return t.baseViewParameters.availableLanguages.indexOf(e.id)>=0});return n},e.setLanguageId=function(e){a.debug("TRY TO SET LANGUAGE TO "+e),$(document).width()<=750&&setTimeout(function(){$(".navbar-toggle").click()}),r.setLanguage(e,function(){a.debug("LANGUAGE SET TO "+r.language),o.resetSocialMediaUrl(),i(function(){$("#languagesMenu").click()});var e=r.getActiveLanguage(),t=s.getPath(),l=n.getId();t=n.getPathByIdAndLanguage(l,e),s.setPath(t)})},e.getActiveLanguage=function(){return r.getActiveLanguage()},e.getActiveLanguageClass=function(){return"language-icon-"+e.getActiveLanguage()},e.isGerman=function(){return"DE"===r.getActiveLanguage()},e.isEnglish=function(){return"EN"===r.getActiveLanguage()},e.isFrench=function(){return"FR"===r.getActiveLanguage()},e.isItalian=function(){return"IT"===r.getActiveLanguage()}}]);return r}}),define("calculator-item-link",["loading-controller","localization","calculators-manager","route-translator"],function(){"use strict";return function(e){var t=e.directive("calculatorItemLink",[function(){return{restrict:"E",replace:!0,scope:{calculator:"@",onClick:"&"},templateUrl:"src/directives/calculator-item-link/calculator-item-link.html",controller:["$scope","calculatorsManager","translateRoute","localize",function(e,t,n,r){e.isCalculatorAvailable=function(){return t.isAnyCalculatorAvailableByName(e.calculator)},e.getPath=function(){var n=t.getAnyPathForCalculatorByName(e.calculator);return void 0===n||null===n?"":n},e.getTranslatedPath=function(){var r=t.getAnyPathForCalculatorByName(e.calculator);return void 0===r||null===r?"":n.perform(r)},e.getText=function(){var t=e.calculator.charAt(0).toUpperCase()+e.calculator.slice(1);return r.getLocalizedString("Application."+t)},e.getId=function(){return"all_calculators_"+e.calculator}}]}}]);return t}}),define("storage-service",["angular","logger","parameters-manager","localization"],function(e,t,n){"use strict";var r=(t.get("storageService"),e.module("storageServiceModule",[]));return r.factory("storageService",["$http","$q","authenticationService","localize",function(e,t,r,a){var i={getServiceURL:function(){return n.baseApplicationParameters.storageServiceURL+"/"+n.baseApplicationParameters.storageCustomization},storeAnonymousDossier:function(r){var a=t.defer(),i=this.getServiceURL()+"/storeDossier",o={userId:"AnonymousContactDossier",name:"",onlineCalc:r,expirationDate:new Date((new Date).getTime()+864e5*n.baseApplicationParameters.dossierExpirationDays).toISOString().slice(0,10)};return e({timeout:n.baseApplicationParameters.httpTimeout,method:"PUT",url:i,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:{authToken:null,dossierDataObject:o,isAnonymousDossier:!0}}).success(function(e,t,n,r){a.resolve(e.id)}).error(function(e,t,n,r){var i;401===t&&(i=StorageServiceResultStatus.UNAUTHORIZED),i=403===t?StorageServiceResultStatus.DOSSIERNOTAVAILABLE:StorageServiceResultStatus.SERVERERROR,a.reject({status:i})}),a.promise},storeDossier:function(a,i,o,s,l){var c=t.defer(),u=this.getServiceURL()+"/storeDossier",d={userId:a,id:i,name:o,onlineCalc:s,modificationDate:new Date};return e({timeout:n.baseApplicationParameters.httpTimeout,method:"PUT",url:u,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:{authToken:l,dossierDataObject:d,isAnonymousDossier:!1}}).success(function(e,t,n,a){d.id=e.id,window.sessionStorage.setItem("currentDossierId",d.id),window.sessionStorage.setItem("currentDossierName",d.name),r.setAuthToken(e.authToken),c.resolve({status:StorageServiceResultStatus.OK})}).error(function(e,t,n,a){var i;401===t?(i=StorageServiceResultStatus.UNAUTHORIZED,r.logOut()):i=StorageServiceResultStatus.SERVERERROR,c.reject({status:i})}),c.promise},getDossier:function(i,o,s){var l=t.defer(),c=this.getServiceURL()+"/getDossier";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"GET",url:c,params:{userId:i,id:o,authToken:s}}).success(function(e,t,n,i){e.dossier.onlineCalc.base.country&&a.getActiveCountry()!==e.dossier.onlineCalc.base.country&&a.setCountry(e.dossier.onlineCalc.base.country,function(){},function(){a.setCountry(a.defaultCountry)}),window.sessionStorage.setItem("currentDossierId",e.dossier.id),window.sessionStorage.setItem("currentDossierName",e.dossier.name),r.setAuthToken(e.authToken),l.resolve({status:StorageServiceResultStatus.OK,dossier:e.dossier})}).error(function(e,t,n,a){var i;401===t?(i=StorageServiceResultStatus.UNAUTHORIZED,r.logOut()):i=404===t?StorageServiceResultStatus.DOSSIERNOTFOUND:StorageServiceResultStatus.SERVERERROR,l.reject({status:i})}),l.promise},getDossierList:function(a,i){var o=t.defer(),s=this.getServiceURL()+"/getDossierList";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"GET",url:s,params:{userId:a,authToken:i}}).success(function(e,t,n,a){r.setAuthToken(e.authToken),o.resolve({status:StorageServiceResultStatus.OK,dossiers:e.dossiers})}).error(function(e,t,n,a){var i;401===t?(i=StorageServiceResultStatus.UNAUTHORIZED,r.logOut()):i=StorageServiceResultStatus.SERVERERROR,o.reject({status:i})}),o.promise},removeDossier:function(a,i,o){var s=t.defer(),l=this.getServiceURL()+"/removeDossier",c={userId:a,ids:i};return e({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:l,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:{authToken:o,dossierDataObject:c}}).success(function(e,t,n,a){for(var o=0;o<i.length;o++){var l=i[o];window.sessionStorage.currentDossierId===l&&(window.sessionStorage.setItem("currentDossierId",null),window.sessionStorage.setItem("currentDossierName",""))}r.setAuthToken(e.authToken),s.resolve({status:StorageServiceResultStatus.OK})}).error(function(e,t,n,a){var i;401===t?(i=StorageServiceResultStatus.UNAUTHORIZED,r.logOut()):i=StorageServiceResultStatus.SERVERERROR,s.reject({status:i})}),s.promise},forgetDossier:function(){window.sessionStorage.setItem("currentDossierId",null),window.sessionStorage.setItem("currentDossierName","")},getCurrentDossierId:function(){return window.sessionStorage.currentDossierId},getCurrentDossierName:function(){return window.sessionStorage.currentDossierName}};return i}]),r}),define("store-method-link",["parameters-manager","loading-controller","localization","route-translator","storage-service"],function(e){"use strict";return function(e){var t=e.directive("storeMethodLink",["storageService",function(e){return{restrict:"E",replace:!0,scope:{storeMethod:"@",onClick:"&"},templateUrl:"src/directives/store-method-link/store-method-link.html",controller:["$scope","translateRoute","localize",function(t,n,r){t.getPath=function(){var e=t.storeMethod;return void 0===e||null===e?"":e},t.getTranslatedPath=function(){if("save"!==t.storeMethod){var e=n.getPath(t.storeMethod);if(void 0===e||null===e)return""}return""},t.getText=function(){var e=t.storeMethod.charAt(0).toUpperCase()+t.storeMethod.slice(1);return"Save"===e?r.getLocalizedString("Application."+e)+" ("+t.getDossierName()+")":r.getLocalizedString("Application."+e)},t.getId=function(){
return"store_method_"+t.storeMethod},t.getDossierName=function(){return e.getCurrentDossierName()}}]}}]);return t}}),define("text-field",["app"],function(e){"use strict";return function(e){var t=e.directive("textfield",[function(){return{restrict:"E",require:"?ngModel",scope:{label:"@",showLabel:"@",ngModel:"=",maxlength:"@",placeholder:"@",id:"@",isRequired:"@",enabled:"=?",isEditable:"=?",onEdit:"&",onChange:"&"},templateUrl:"src/directives/fields/text-field/text-field.html",compile:function(e,t){return{pre:function(e,t,n,r){void 0!==e.id&&e.id.length>0?e.fieldId=e.id.replace(/\./g,"_"):e.fieldId=n.ngModel.replace(/\./g,"_"),e.$watch("ngModel",function(t,n){e.onChange()}),e.isDisabled=function(){return void 0!==e.enabled?!e.enabled:!1}}}}}}]);return t}}),define("authentication-service",["angular","logger","parameters-manager","storage-manager"],function(e,t,n){"use strict";var r=(t.get("authenticationService"),e.module("authenticationServiceModule",[]));return r.factory("authenticationService",["$http","$q","storageManager",function(e,t,r){var a={getServiceURL:function(){return n.baseApplicationParameters.authenticationServiceURL+"/"+n.baseApplicationParameters.authenticationCustomization},isAlreadyRegistered:function(r){var a=t.defer(),i=this.getServiceURL()+"/isAlreadyRegistered";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:i,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:{userDataObject:r}}).success(function(e,t,n,r){a.resolve({status:AuthenticationServiceRegistrationResultStatus.SUCCEEDED})}).error(function(e,t,n,r){var i;i=409===t?AuthenticationServiceRegistrationResultStatus.USERALREADYEXISTS:AuthenticationServiceRegistrationResultStatus.FAILED,a.reject({status:i})}),a.promise},register:function(r,a){var i=t.defer(),o=this.getServiceURL()+"/register";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"PUT",url:o,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:{userDataObject:r,emailObject:a}}).success(function(e,t,n,r){i.resolve({status:AuthenticationServiceRegistrationResultStatus.SUCCEEDED})}).error(function(e,t,n,r){var a;a=409===t?AuthenticationServiceRegistrationResultStatus.USERALREADYEXISTS:AuthenticationServiceRegistrationResultStatus.FAILED,i.reject({status:a})}),i.promise},confirmRegistration:function(r,a){var i=t.defer(),o=this.getServiceURL()+"/confirmRegistration";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:o,responseType:"json",cache:!1,data:{confirmationToken:a,userDataObject:{userId:r}},headers:{"Content-Type":"application/json; charset=utf-8"}}).success(function(e,t,n,r){e.alreadyConfirmed?i.resolve({status:AuthenticationServiceRegistrationConfirmationResultStatus.ALREADYCONFIRMED}):i.resolve({status:AuthenticationServiceRegistrationConfirmationResultStatus.SUCCEEDED})}).error(function(e,t,n,r){var a;400===t&&(a=AuthenticationServiceRegistrationConfirmationResultStatus.SERVERERROR),401===t&&(a=AuthenticationServiceRegistrationConfirmationResultStatus.EXPIREDORINVALIDDATA),404===t&&(a=AuthenticationServiceRegistrationConfirmationResultStatus.NOCONFIRMATIONPENDING),i.reject({status:a})}),i.promise},login:function(a){var i=t.defer(),o=this.getServiceURL()+"/login";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:o,responseType:"json",cache:!1,data:{userDataObject:a}}).success(function(e,t,o,s){void 0===window.localStorage.pcId&&(window.localStorage.pcId=e.pcId),window.sessionStorage.authToken=e.result.authToken,window.sessionStorage.userLogged=a.userId,window.sessionStorage.userData=JSON.stringify(e.result.userData?e.result.userData:{}),a.userId===n.baseApplicationParameters.demoAccountUser?window.sessionStorage.modulesAuthorized="multicalc":window.sessionStorage.modulesAuthorized=e.result.modulesAuthorized,e.result.userData&&n.baseApplicationParameters.consultantMode&&(r.storeOnBrowserLocalStorage("customerNumber",e.result.userData.customerNumber),r.storeOnBrowserLocalStorage("customerInfo",e.result.userData.customerInfo),r.storeOnBrowserLocalStorage("consultantInfo",e.result.userData.consultantInfo)),i.resolve({status:AuthenticationServiceLoginResultStatus.SUCCEEDED,userLogged:a.userId,modulesAuthorized:e.result.modulesAuthorized,authToken:e.result.authToken})}).error(function(e,t,n,r){var a;a=404===t?AuthenticationServiceLoginResultStatus.INVALIDUSERORPASSWORD:401===t?AuthenticationServiceLoginResultStatus.USERINACTIVE:403===t?AuthenticationServiceLoginResultStatus.USERBLOCKED:AuthenticationServiceLoginResultStatus.FAILED,i.reject({status:a})}),i.promise},loginRememberedUser:function(a){var i=t.defer(),o=this.getServiceURL()+"/loginRememberedUser";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:o,responseType:"json",cache:!1,data:{userDataObject:a}}).success(function(e,t,o,s){window.sessionStorage.authToken=e.authToken,window.sessionStorage.userLogged=a.userId,window.sessionStorage.modulesAuthorized=e.modulesAuthorized,window.sessionStorage.userData=e.userData?JSON.stringify(e.userData):{},e.userData&&n.baseApplicationParameters.consultantMode&&(r.storeOnBrowserLocalStorage("customerNumber",e.userData.customerNumber),r.storeOnBrowserLocalStorage("customerInfo",e.userData.customerInfo),r.storeOnBrowserLocalStorage("consultantInfo",e.userData.consultantInfo)),i.resolve({status:AuthenticationServiceLoginRememberedUserResultStatus.SUCCEEDED})}).error(function(e,t,n,r){var a;a=401===t?AuthenticationServiceLoginRememberedUserResultStatus.INVALIDUSER:AuthenticationServiceLoginRememberedUserResultStatus.FAILED,i.reject({status:a})}),i.promise},checkUserAvailability:function(r){var a=t.defer(),i=this.getServiceURL()+"/checkUserAvailability";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"GET",url:i,params:{userId:r},headers:{"Content-Type":"application/json; charset=utf-8"}}).success(function(e,t,n,r){a.resolve({status:AuthenticationServiceRegistrationResultStatus.USERAVAILABLE})}).error(function(e,t,n,r){var i;i=409===t?AuthenticationServiceRegistrationResultStatus.USERALREADYEXISTS:AuthenticationServiceRegistrationResultStatus.FAILED,a.reject({status:i})}),a.promise},sendReactivationEmail:function(r,a){var i=t.defer(),o=this.getServiceURL()+"/sendActivationEmail";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:o,responseType:"json",cache:!1,data:{userDataObject:r,emailObject:a}}).success(function(e,t,n,r){i.resolve({status:AuthenticationServiceLoginResultStatus.SUCCEEDED})}).error(function(e,t,n,r){var a=AuthenticationServiceLoginResultStatus.FAILED;i.reject({status:a})}),i.promise},updateUser:function(r,a,i){var o=t.defer(),s=this.getServiceURL()+"/updateUser",l=this.getAuthToken();return l||(l=i),e({timeout:n.baseApplicationParameters.httpTimeout,method:"PUT",url:s,responseType:"json",cache:!1,data:{authToken:l,userDataObject:r,userDataToUpdateObject:a}}).success(function(e,t,n,r){window.sessionStorage.authToken=e.authToken,o.resolve({status:AuthenticationServiceUpdateUserAccountResultStatus.SUCCEEDED})}).error(function(e,t,n,r){var a;a=401===t?AuthenticationServiceUpdateUserAccountResultStatus.UNAUTHORIZED:404===t?AuthenticationServiceUpdateUserAccountResultStatus.INVALIDUSERORPASSWORD:AuthenticationServiceUpdateUserAccountResultStatus.FAILED,o.reject({status:a})}),o.promise},updatePassword:function(r,a,i){var o=t.defer(),s=this.getServiceURL()+"/updatePassword",l=this.getAuthToken();return l||(l=i),e({timeout:n.baseApplicationParameters.httpTimeout,method:"PUT",url:s,responseType:"json",cache:!1,data:{authToken:l,userDataObject:r,userDataToUpdateObject:a}}).success(function(e,t,n,r){window.sessionStorage.authToken=e.authToken,o.resolve({status:AuthenticationServiceUpdatePasswordResultStatus.SUCCEEDED})}).error(function(e,t,n,r){var a;a=401===t?AuthenticationServiceUpdatePasswordResultStatus.UNAUTHORIZED:404===t?AuthenticationServiceUpdatePasswordResultStatus.INVALIDUSERORPASSWORD:AuthenticationServiceUpdatePasswordResultStatus.FAILED,o.reject({status:a})}),o.promise},resetPassword:function(r,a){var i=t.defer(),o=this.getServiceURL()+"/resetPassword";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:o,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:{userDataObject:r,emailObject:a}}).success(function(e,t,n,r){window.sessionStorage.authToken=e.authToken,i.resolve({status:AuthenticationServiceResetPasswordResultStatus.SUCCEEDED})}).error(function(e,t,n,r){var a;a=404===t?AuthenticationServiceResetPasswordResultStatus.USERNOTFOUND:AuthenticationServiceResetPasswordResultStatus.FAILED,i.reject({status:a})}),i.promise},getPcId:function(){return void 0===window.localStorage.pcId?null:window.localStorage.pcId},getUserLogged:function(){return window.sessionStorage.userLogged},getUserData:function(){return JSON.parse(window.sessionStorage.userData?window.sessionStorage.userData:null)},getAuthToken:function(){return window.sessionStorage.authToken},setAuthToken:function(e){window.sessionStorage.authToken=e},isUserLogged:function(){return void 0!==window.sessionStorage.userLogged},isDemoAccount:function(){return window.sessionStorage.userLogged===n.baseApplicationParameters.demoAccountUser},logOut:function(){window.localStorage.setItem("user",""),window.localStorage.setItem("token",""),window.sessionStorage.clear()},clearCalculatorServiceToken:function(){window.calculatorServiceToken=void 0},getCalculatorServiceToken:function(){var e=t.defer(),r=this;if(n.baseApplicationParameters.serverCalculation){if(void 0===window.calculatorServiceToken)return r.createCalculatorServiceToken();e.resolve({authToken:window.calculatorServiceToken})}return e.promise},createCalculatorServiceToken:function(){var r=t.defer(),a=this.getServiceURL()+"/createToken";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"GET",url:a,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"}}).success(function(e,t,n,a){window.calculatorServiceToken=e.authToken,r.resolve({status:AuthenticationServiceCreateCalculatorServiceTokenResultStatus.SUCCEEDED,authToken:e.authToken})}).error(function(e,t,n,a){var i;i=404===t?AuthenticationServiceCreateCalculatorServiceTokenResultStatus.USERNOTFOUND:AuthenticationServiceCreateCalculatorServiceTokenResultStatus.FAILED,r.reject({status:i})}),r.promise}};return a}]),r}),define("location-breadcrumbs",["angular","routes-handler","logger","localization"],function(e,t,n){"use strict";var r=(n.get("locationBreadcrumbs"),e.module("locationBreadcrumbsModule",[]));return r.factory("locationBreadcrumbsService",["locationService","localize",function(e,n){var r={breadcrumbs:[],discardRepeatedBreadcrumbGroups:function(){if(0!==this.breadcrumbs.length){for(var e=this.breadcrumbs.length-1,t=this.breadcrumbs[e],n=-1,r=e-1;r>=0;r--){var a=this.breadcrumbs[r];if(a.id===t.id){n=r;break}}if(this.breadcrumbs.lastIndexOf(t,e-1),-1!==n){var i=e-n;if(!(i>n)){for(r=e;r>n;r--){var o=this.breadcrumbs[r],s=this.breadcrumbs[r-i];if(o.id!==s.id)return}this.breadcrumbs.splice(n+1)}}}},forgetOlderBreadcrumbs:function(){var e=10;this.breadcrumbs.length>e&&this.breadcrumbs.splice(0,this.breadcrumbs.length-e)},push:function(n){var r=t.getId(),a=e.getSearch();if(!(this.breadcrumbs.length>0&&this.breadcrumbs[this.breadcrumbs.length-1].id===r&&this.breadcrumbs[this.breadcrumbs.length-1].search===a)){if(this.breadcrumbs.length>0&&this.breadcrumbs[this.breadcrumbs.length-1].id===r&&this.breadcrumbs[this.breadcrumbs.length-1].search!==a)return this.breadcrumbs[this.breadcrumbs.length-1]={id:r,search:a,canGoBack:n},this.discardRepeatedBreadcrumbGroups(),void this.forgetOlderBreadcrumbs();this.breadcrumbs.push({id:r,search:a,canGoBack:n}),this.discardRepeatedBreadcrumbGroups(),this.forgetOlderBreadcrumbs()}},pop:function(){if(0===this.breadcrumbs.length)e.clearSearch(),e.setPath("/");else{e.setUrl(e.getPath());for(var r=n.getActiveLanguage(),a=t.getId(),i=this.breadcrumbs.pop(),o=i.id,s=t.getPathByIdAndLanguage(o,r),l=o!==a&&i.canGoBack(),c=i.search;this.breadcrumbs.length>0&&!l;)i=this.breadcrumbs.pop(),o=i.id,s=t.getPathByIdAndLanguage(o,r),l=o!==a&&i.canGoBack(),c=i.search;l?e.setPath(s).setSearch(c):e.setPath("/")}}};return r}]),r}),define("profile-common",["angular","logger","parameters-manager","authentication-service","location-breadcrumbs"],function(e,t,n){"use strict";var r=(t.get("profileCommon"),e.module("profileCommonModule",[]));return r.factory("profileCommon",["locationService","localize","translateRoute","authenticationService","$rootScope",function(e,t,r,a,i){var o={getServiceURL:function(){return n.baseApplicationParameters.authenticationServiceURL+"/"+n.baseApplicationParameters.authenticationCustomization},getUserLogged:function(){return this.isDemoAccount()?t.getLocalizedString("DemoAccount"):a.getUserLogged()},isDemoAccount:function(){return a.getUserLogged()===n.baseApplicationParameters.demoAccountUser},logOut:function(){a.logOut(),i.$broadcast("storageReset"),e.setPath("/")},logIn:function(){e.clearSearch(),e.setPath(r.getPath("login"))},register:function(){e.clearSearch(),e.setPath(r.getPath("register"))},showLogin:function(){return"login"!==i.activeController?!0:!1},showRegister:function(){return"login"===i.activeController?!0:!1},onUserLogged:function(){a.isDemoAccount()||(e.clearSearch(),n.baseApplicationParameters.consultantMode?e.setPath(r.getPath("consultantUserAccount")):e.setPath(r.getPath("userAccount")))}};return o}]),r}),define("custom-icon-button-bar",["app"],function(e){"use strict";return function(e){var t=e.controller("customIconButtonBarController",["$scope",function(e){}]);return t}}),define("icon-button-bar",["app","parameters-manager","storage-manager","text-field","profile-common","custom-icon-button-bar"],function(e,t){"use strict";return function(e){var n=e.directive("iconButtonBar",["storageManager","$rootScope","localize","$injector",function(e,n,r,a){return{restrict:"E",scope:{onPrint:"&",showPrint:"&",onContact:"&",showContact:"&",onNew:"&",showNew:"&",showSave:"&",showEventPlan:"&",isAnyEventPlan:"&",showDossier:"&"},templateUrl:"src/directives/icon-button-bar/icon-button-bar.html",link:function(n,i,o){a.invoke(["$controller",function(e){e("customIconButtonBarController",{$scope:n})}]),n.anyButton=function(){var e=t.baseViewParameters.languageSelectionEnabled&&t.baseViewParameters.availableLanguages.length>1,r=t.baseViewParameters.countrySelectionEnabled&&t.baseViewParameters.availableCountries.length>1,a=n.availableMedia().length>0;return n.showSave()||n.showDossier()||n.showNew()||n.showEventPlan()||n.showCalculatorsButton()||n.showPrint()||n.showContact()||n.showCalculatorsButton()||e||r||a},n.onEventPlan=function(){n.$parent.onEventPlan()},n.isAnyEventPlan=function(){return n.$parent.isAnyEvent?n.$parent.isAnyEvent():!1},n.onSocialMediaButton=function(e,t){return t.preventDefault(),n.$parent.onSocialMediaButton(e)},n.getSocialMediaUrl=function(e){return n.$parent.getSocialMediaUrl(e)},n.availableMedia=function(){return n.$parent.getAvailableSocialMedia()},n.showCalculatorsButton=function(){return n.$parent.showCalculatorsButton()},n.isIconButtonBarFixed=function(){return t.baseViewParameters.isIconButtonBarFixed},n.showIconButtonBar=function(){return t.baseViewParameters.iconButtonBar},n.getDossierDropdownClass=function(){return n.$parent.showSeparator()?"icon-button-bar__dossier-dropdown--with-separator":"icon-button-bar__dossier-dropdown--without-separator"},n.openAdditionalPrintingData=function(){if(n.askConsultantDataForPrinting()&&!n.additionalPrintingData){var t=e.getStoredObject("base");t&&(n.additionalPrintingData=t.additionalPrintingData),n.additionalPrintingData||(n.additionalPrintingData={customerNumber:0,customerInfo:"",consultantInfo:"",additionalData:""});var r=e.getFromBrowserSessionStorage("customerNumber");r&&(n.additionalPrintingData.customerNumber=r);var a=e.getFromBrowserSessionStorage("customerInfo");a&&(n.additionalPrintingData.customerInfo=a);var i=e.getFromBrowserLocalStorage("consultantInfo");i&&(n.additionalPrintingData.consultantInfo=i);var o=e.getFromBrowserLocalStorage("additionalData");o&&(n.additionalPrintingData.additionalData=o,n.additionalPrintingData.additionalData.description=o.bankCode+" "+o.bankName)}$("#additionalPrintingDataModal").on("show.bs.modal",function(){n.customerNumberEnabled=n.additionalPrintingData&&(!n.additionalPrintingData.customerNumber||n.additionalPrintingData.customerNumber&&0===n.additionalPrintingData.customerNumber.length),n.additionalPrintingDataAux=$.extend(!0,{},n.additionalPrintingData),window.matchMedia("only screen and (min-width: 516px)").matches&&setTimeout(function(){$("#additionalPrintingDataModal").find(".modal-dialog").off("bsTransitionEnd")},350);var t=e.getFromBrowserLocalStorage("additionalData");t&&n.getBankData&&n.getBankData(t).then(function(e){e?(n.additionalPrintingData.additionalData=$.extend(!0,{},e),n.additionalPrintingData.additionalData.description=e.bankCode+" "+e.bankName):n.additionalPrintingData.additionalData=null})}).modal("show")},n.onCancelConsultantDataEdition=function(){n.additionalPrintingData.customerNumber=n.additionalPrintingDataAux.customerNumber,n.additionalPrintingData.customerInfo=n.additionalPrintingDataAux.customerInfo,n.additionalPrintingData.consultantInfo=n.additionalPrintingDataAux.consultantInfo},n.goToEventPlan=function(){n.onCancelConsultantDataEdition(),$("#additionalPrintingDataModal").modal("hide"),n.onEventPlan()},n.getEventPlanLabel=function(){return n.isAnyEventPlan()?r.getLocalizedString("additionalPrintingData.HasEventText"):r.getLocalizedString("additionalPrintingData.NoEventText")},n.getEventPlanLabelLink=function(){return n.isAnyEventPlan()?r.getLocalizedString("additionalPrintingData.HasEventTextLink"):r.getLocalizedString("additionalPrintingData.NoEventTextLink")},n.askConsultantDataForPrinting=function(){return t.baseViewParameters.askConsultantDataForPrinting},n.askCustomerReferenceForPrinting=function(){return t.baseViewParameters.askCustomerReferenceForPrinting},n.testData=function(){return n.customTestData?n.customTestData():!0},n.onSendPrint=function(){n.testData()&&(n.onPrint({additionalPrintingData:n.additionalPrintingData}),$("#additionalPrintingDataModal").modal("hide"))}},controller:["$scope","$window","$timeout","profileCommon",function(e,n,r,a){function i(){var e=0;return $(".icon-button-bar__tool-bar li a").each(function(){$(this).height()>0&&(e+=$(this).height(),e+=parseFloat($(this).css("padding-top")),e+=parseFloat($(this).css("padding-bottom")),e+=parseFloat($(this).css("margin-top")),e+=parseFloat($(this).css("margin-bottom")),e+=parseFloat($(this).css("border-top")),e+=parseFloat($(this).css("border-bottom")))}),e}function o(){setTimeout(function(){var e=$("#IconToolbar"),t=i();t>n.outerHeight?e.css("height",n.outerHeight-50):(t+=parseFloat(e.css("padding-top")),t+=parseFloat(e.css("padding-bottom")),t+=parseFloat(e.css("margin-top")),t+=parseFloat(e.css("margin-bottom")),t+=parseFloat(e.css("border-top")),t+=parseFloat(e.css("border-bottom")),e.css("height",t))},50)}var s=t.baseViewParameters.iconButtonBar;s&&$(".icon-button-bar__tool-bar-visibility").css("display","block");var l=function(){o()};window.addEventListener("resize",l,!1),$(".navbar-toggle").click(function(){o()}),$(".dropdown").click(function(){o()}),e.getUserLogged=function(){return a.getUserLogged()},e.logOut=function(){return a.logOut()},e.logIn=function(){return a.logIn()},e.signUp=function(){return a.signUp()},e.onUserLogged=function(){return a.onUserLogged()},e.isCustomerNumberEnabled=function(){return t.baseViewParameters.customerNumberEnabled||e.customerNumberEnabled}}]}}]);return n}}),define("navigation-bar",["app","theme-manager","logger"],function(e,t,n){"use strict";var r,a=new t,i=n.get("NavigationBar");return function(e){var t=e.directive("navigationBar",["$rootScope",function(e){return{restrict:"E",replace:!1,scope:{onPrint:"&"},templateUrl:"src/directives/navigation-bar/navigation-bar.html",link:function(t,n,r){t.showPrint=function(){return void 0!==r.onPrint},t.showNavigationBar=function(){return!e.singleCalculation&&e.navigationBar}},controller:["$scope","locationService","localize","translateRoute","calculatorsManager",function(t,n,o,s,l){t.notEmpty=function(e){return""!==o.getLocalizedString(e)},t.cleanPath=function(e){return"#/"===e.slice(0,2)&&(e=e.slice(2)),"/"===e.slice(0,1)&&(e=e.slice(1)),"#"===e.slice(0,1)&&(e=e.slice(1)),"/"===e.slice(e.length-1,e.length)&&(e=e.slice(0,e.length-1)),e},t.navigateToRoot=function(e,r){n.clearSearch(),n.setPath(s.getPath("/")),t.initLoadingBar(e,r),r.preventDefault()},t.initLoadingBar=function(e,r){if(t.viewControllerInitializationInProgress)return void i.debug("navigation prevented while view controller initialization is in progress");var a=n.getPath(),o=s.perform(e);a=t.cleanPath(a),e=t.cleanPath(e),o=t.cleanPath(o)},t.translateRoute=s,t.isCalculatorAvailable=function(e){return l.isCalculatorAvailable(e)},t.isThemeAvailable=function(e){return l.isThemeAvailable(e)};var c=function(e){return"Theme"+e.charAt(0).toUpperCase()+e.slice(1)},u=function(e){return"Application."+e.charAt(0).toUpperCase()+e.slice(1)};t.getLocalizedString=function(e){return o.getLocalizedString(e)},t.availableThemes=function(){if(void 0===r){r=[];var e=l.availableThemes();for(var t in e){var n=e[t].id,a=c(n),i=c(n)+"SubThemes",o=c(n)+"SubThemeMain",s=u(n);r.push({name:n,id:a,subThemesId:i,subThemeMainId:o,themeEnumKey:s})}}return r},t.$watch(function(){return l.availableThemes()},function(){r=void 0}),t.availableCalculatorsByTheme=function(e){if(void 0===e)return[];var t=l.availableCalculatorsByTheme(e);for(var n in t){var r=t[n].calculator,a=e.charAt(0).toLowerCase()+e.slice(1)+".";t[n].calculatorEnumKey=a+r.charAt(0).toUpperCase()+r.slice(1)}return t},t.availableCalculators=function(){return l.availableCalculators()},t.isThemeSelected=function(e){return a.isThemeSelected(e)},t.isSubThemeSelected=function(e){return a.isSubThemeSelected(e)},t.isThemeMainSelected=function(e){return a.isThemeMainSelected(e)},t.getRouteForOverview=function(){return t.viewControllerInitializationInProgress?"":s.perform("")},t.getRouteForTheme=function(e){return t.viewControllerInitializationInProgress?"":s.perform(e.name)},t.getRouteForCalculator=function(e,n){return t.viewControllerInitializationInProgress?"":s.perform(e.name+"/"+n.calculator)},e.$on("viewControllerInitializationStarted",function(){t.viewControllerInitializationInProgress=!0}),e.$on("viewControllerInitializationFinished",function(){t.viewControllerInitializationInProgress=!1})}]}}]);return t}}),define("title-link",["app"],function(e){"use strict";return function(e){var t=e.directive("titleLink",[function(){return{restrict:"E",replace:!1,scope:{onPrint:"&"},templateUrl:"src/directives/title-link/title-link.html",link:function(e,t,n){},controller:["$scope","locationService","translateRoute",function(e,t,n){e.cleanPath=function(e){return"#/"===e.slice(0,2)&&(e=e.slice(2)),"/"===e.slice(0,1)&&(e=e.slice(1)),"#"===e.slice(0,1)&&(e=e.slice(1)),"/"===e.slice(e.length-1,e.length)&&(e=e.slice(0,e.length-1)),e},e.navigateToRoot=function(r,a){t.clearSearch(),t.setPath(n.getPath("/")),e.initLoadingBar(r,a),a.preventDefault()},e.initLoadingBar=function(r,a){var i=t.getPath(),o=n.perform(r);i=e.cleanPath(i),r=e.cleanPath(r),o=e.cleanPath(o)},e.translateRoute=n}]}}]);return t}}),define("debugging-view",["app"],function(e){"use strict";return function(e){var t=e.directive("debuggingView",["$rootScope",function(e){return{restrict:"E",replace:!1,scope:{},templateUrl:"src/directives/debugging-view/debugging-view.html",controller:["$scope",function(t){t.lastTimestamp=void 0,e.$on("debug",function(e,n,r){var a=Date.now(),i=document.getElementById("debuggingView"),o=r?" ["+r+"]":"",s=t.lastTimestamp?" - "+(a-t.lastTimestamp)+"ms":"",l=a+" - "+n+o+s;i.innerHTML=i.innerHTML+"<br>"+l,t.lastTimestamp=a})}]}}]);return t}}),define("theme-box",["route-translator"],function(){"use strict";return function(e){return e.component("themeBox",{bindings:{target:"@",themeBoxTitle:"@",text:"@",linkText:"@"},templateUrl:"src/directives/theme-box/theme-box.html",controller:["$timeout","locationService","translateRoute",function(e,t,n){function r(){return $("#"+i.target+"ThemeBox")}function a(){t.clearSearch(),t.setPath(n.getPath(i.target))}var i=this;this.onLinkClick=function(){r().addClass("theme-selected"),e(a,100)}}]})}}),define("base-data-summary",[],function(){"use strict";return function(e){return e.component("baseDataSummary",{bindings:{civilStatus:"=?",numberOfChildren:"=?",zipAndLocation:"=?",extraRow1:"@",extraRow2:"@"},templateUrl:"src/directives/base-data-summary/base-data-summary.html",controller:["localize",function(e){this.getNumberOfChildren=function(){return null===this.numberOfChildren?"":e.getLocalizedString(1===this.numberOfChildren?"Application.Child":"Application.Children",{NUMBEROFCHILDREN:this.numberOfChildren})},this.getCivilStatus=function(){return null===this.civilStatus?"":e.getLocalizedEnumDescriptionByNumber("CivilStatus",this.civilStatus)},this.getCivilStatusClass=function(){return null===this.civilStatus?"":this.civilStatus===CivilStatus.SINGLE?"single":this.civilStatus===CivilStatus.SINGLE_IN_CONCUBINAGE?"single-in-concubinage":this.civilStatus===CivilStatus.MARRIED?"married":this.civilStatus===CivilStatus.REGISTERED_PARTNERSHIP?"partnership":"single"}}]})}}),define("easing",function(e){return function(){var t;return t||e.easing}}(this)),define("common-chart-animator",["logger","easing"],function(e){var t=e.get("ChartAnimator"),n=e.get("ChartAnimatorFlow"),r=e.get("ChartAnimatorDetail"),a=e.get("ChartAnimatorTiming"),i=e.get("ChartAnimatorAnimationDetail"),o=function(){function e(e,t){return Math.round(1e3*t/e)}var o=function(){this.create=function(t,n,r,i,o,s){var l={};return l.name=t,l.ticket=n,l.startTime=new Date,l.duration=r,l.steps=i,l.expectedStepDuration=o,l.callback=s,l.idleTime=.1,l.stepStart=null,l.averageStepDuration=null,l.averageTimeoutOverhead=null,l.step=0,l.cancelled=!1,l.expectedStepDuration<=50?l.idleTime=Math.max(Math.round(l.duration/l.steps)-l.expectedStepDuration,1):l.idleTime=.1,a.debug(l.name+" animation ("+l.duration+" / "+l.steps+"). Idle time: "+l.idleTime),l.showCancelMessage=function(){var e=new Date-l.startTime;a.debug("animation cancelled, total time: "+e+" (executed "+l.step+" of "+l.steps+" steps)")},l.endStep=function(){if(null!==l.stepStart){var e=new Date-l.stepStart;null===l.averageStepDuration?l.averageStepDuration=e:l.averageStepDuration=(l.averageStepDuration+e)/2,l.step++}},l.wait=function(){return l.endStep(),l.cancelled?void l.showCancelMessage():(l.stepStart=new Date,void setTimeout(function(){var e=new Date-l.stepStart;return null===l.averageTimeoutOverhead?l.averageTimeoutOverhead=e:l.averageTimeoutOverhead=(l.averageTimeoutOverhead+e)/2,l.cancelled?void l.showCancelMessage():void s(l)},l.idleTime))},l.start=function(){l.startTime=new Date,l.step=0,l.wait()},l.resume=function(){l.wait()},l.stop=function(){l.endStep(),l.averageStepDuration=Math.round(l.averageStepDuration),l.averageTimeoutOverhead=Math.round(l.averageTimeoutOverhead);var t=new Date-l.startTime;a.debug("animation finished, total time: "+t+" (expected: "+l.steps*l.expectedStepDuration+")"),a.debug("                    avg. step time: "+l.averageStepDuration+" (expected: "+l.expectedStepDuration+")"),a.debug("                    avg. timeout: "+l.averageTimeoutOverhead+" (expected: "+l.idleTime+")"),a.debug("                    FPS: "+e(t,l.steps)+")")},l.cancel=function(){l.cancelled=!0},l}};this.create=function(e,s){function l(){var e=$(c.id),n=e.width(),r=e.height();return 0===n||void 0===n||0===r||void 0===r?(t.debug("SKIP DRAWING OF CHART "+this.id+" (width="+n+" height="+r+")"),!1):!0}var c={};if(c.delegate=s,c.id=e,c.plot=null,c.drawing=!1,c.smoothTransitions=!0,c.previousSets=[],c.previousMax=0,c.previousColumns=0,c.differenceSets=[],c.smoothDuration=400,c.smoothSteps=50,c.smoothCurrentStep=-1,c.drawingStep=!1,c.currentDraw=null,c.pendingDraw=!1,c.pendingReset=!1,c.rescaleYDuration=200,c.rescaleYSteps=25,c.rescaleYStep=-1,c.targetScale=-1,c.previousScale=-1,c.newScale=-1,c.onScaleCallback=null,c.diffColumnsPerStep=0,c.drawingStepColumns=0,c.rescaleXDuration=400,c.rescaleXSteps=15,c.rescaleXStep=-1,c.rescaleXDelta=0,c.rescaleXSets=null,c.onRebuiltCallback=null,c.animateRescaleX=!1,c.sortSets=!1,c.sortAtEachStep=!1,c.stepDuration=0,c.minimumSteps=5,c.maximumExtraDurationPercentage=.3,c.maximumFPS=60,c.configured=!1,c.nextAvailableTicket=0,c.currentTicket=-1,c.pendingTicket=-1,c.isCanvasReady=function(){var e=$(this.id),t=e.width(),n=e.height();return 0===t||void 0===t||0===n||void 0===n?!1:!0},c.draw=function(){return c.drawing?(c.pendingTicket=c.createTicket(),n.debug("Already drawing "+this.id+", ticket "+c.currentTicket+" ==> marking as pending (ticket "+c.pendingTicket+")"),void(c.pendingDraw=!0)):void c._draw()},c.createTicket=function(){return c.nextAvailableTicket++},c.processTicket=function(e){return-1!==c.currentTicket?(n.error("ERROR: trying to process ticket "+e+" while still processing ticket "+c.currentTicket),!1):(c.currentTicket=e,n.debug("STARTING TO PROCESS TICKET "+c.currentTicket+" ON "+c.id),!0)},c.finishTicket=function(e){return e!==c.currentTicket?void n.error("TRYING TO FINISH TICKET "+e+" but current ticket is "+c.currentTicket):(n.debug("FINISHED TICKET "+c.currentTicket),void(c.currentTicket=-1))},c._draw=function(){if(c.drawing=!0,!l())return void(c.drawing=!1);var e=c.createTicket();if(!c.processTicket(e))return void console.error("NEW TICKET "+e+" CANNOT BE PROCESSED");var n=c.smoothTransitions;if(c.delegate.beforeDrawing){var a=c.delegate.beforeDrawing();n&&void 0!==a&&(n=a)}var i=c.delegate.getSetsForDrawing();if(!n||null===c.plot||c.pendingReset)t.debug("Normal draw for "+c.id),r.debug("Sets to draw: "+JSON.stringify(i)),c.drawFromScratch(i),r.debug("drawFromScratch finished"),c.finishTicket(c.currentTicket),c.drawing=!1,c.pendingReset=!1;else if(c.smoothTransitions)c.drawSmooth(c.delegate.createDrawObjectForCurrentState());else{var o=$.extend(!0,[],i);c.redraw(o),c.finishTicket(c.currentTicket),c.drawing=!1}},c.measureStepDuration=function(e){for(var t,n,r=c.plot,a=c.delegate.getSetsForMeasurement?c.delegate.getSetsForMeasurement(e):e.previousSets,i=null,o=0;10>o;o++){t=$.extend(!0,[],a),n=new Date,c.redraw(t,!0);var s=new Date-n;i=null===i?s:(i+s)/2}return i=Math.round(6*i),t=$.extend(!0,[],a),r.draw(),i},c.configureAnimation=function(e){c.stepDuration=c.measureStepDuration(e),a.debug("Average step duration for "+this.id+"="+c.stepDuration);var t;t=c.checkAnimationDuration(c.smoothDuration,c.smoothSteps,c.stepDuration),null===t?c.smoothTransitions=!1:(c.smoothDuration=t.duration,c.smoothSteps=t.steps),t=c.checkAnimationDuration(c.rescaleYDuration,c.rescaleYSteps,c.stepDuration),null===t?c.smoothTransitions=!1:(c.rescaleYDuration=t.duration,c.rescaleYSteps=t.steps),t=c.checkAnimationDuration(c.rescaleXDuration,c.rescaleXSteps,c.stepDuration),null===t?c.smoothTransitions=!1:(c.rescaleXDuration=t.duration,c.rescaleXSteps=t.steps),c.configured=!0,c.showAnimationConfiguration()},c.showParameter=function(e,t,n){var r=Math.round(n*c.stepDuration);a.debug("--> "+e+" parameters: "+r+" (max. "+t+") / "+n+" FPS: "+c.calculateFPS(r,n))},c.showAnimationConfiguration=function(){a.debug("-------------------------------------------------------"),c.smoothTransitions?(a.debug("Animation configuration for "+this.id),c.showParameter("animation",c.smoothDuration,c.smoothSteps),c.showParameter("rescaleY",c.rescaleYDuration,c.rescaleYSteps),c.showParameter("rescaleX",c.rescaleXDuration,c.rescaleXSteps)):a.debug("No animation support for "+this.id),a.debug("-------------------------------------------------------")},c.calculateFPS=function(e,t){return Math.round(1e3*t/e)},c.calculateDuration=function(e,t){
return Math.round(1e3*t/e)},c.calculateSteps=function(e,t){return Math.round(t*e/1e3)},c.checkAnimationDuration=function(e,t,n){var r=c.calculateFPS(e,t);a.debug("Checking animation duration: "+e+" / "+t+" (FPS="+r+")"),r>c.maximumFPS&&(e=c.calculateDuration(c.maximumFPS,t),specifiedStepDuration=e/t,r=c.calculateFPS(e,t),a.debug("FPS was too high. New parameters: "+e+" / "+t+" (FPS="+r+")"));var i=t*n;if(i>e){var o;if(o=Math.floor(e/n),i=o*n,e>=i&&o>=c.minimumSteps)return a.debug("...fixed, new steps="+o),{duration:e,steps:o};var s=e*(1+c.maximumExtraDurationPercentage);return o=Math.floor(s/n),i=o*n,s>=i&&o>=c.minimumSteps?(a.debug("...fixed, new steps="+o+" new duration="+s),{duration:s,steps:o}):(a.debug("...animation not possible!!!"),a.debug("...(adjusted steps: "+o+")"),null)}return{duration:e,steps:t}},c.drawFromScratch=function(e,n){try{c.delegate.onDrawFromScratch&&c.delegate.onDrawFromScratch(e,n),c.plot=null,c.plot=c.delegate.createPlot(e)}catch(r){t.error("drawFromScratch for chart "+c.id+" failed! "+r)}},c.createEmptySet=function(e){var t={};return t.color=e.color,t.label=e.label,t.order=e.order,t.stack=e.stack,t.lines=e.lines,t.wrapper=e.wrapper,Array.isArray(e.data)?t.data=[]:t.data=0,t},c.fillDifferenceSetForXYCharts=function(e,t,n,r,a){var i,o=Math.max(a.previousColumns,a.columns),s=Math.min(t.data.length,n.data.length);e._hasChanges=!1,e._needsAnimation=!1;for(var l=0;o>l;l++){if(l>=t.data.length)i=l<n.data.length?null!==n.data[l][1]?n.data[l][1]/r:n.data[l][1]:0,e._hasChanges=!0;else if(l>=n.data.length)i=-t.data[l][1]/r,e._hasChanges=!0;else{var c=t.data[l][1],u=n.data[l][1];if(null===u&&null===c)i=null;else{var d=n.data[l][1]-t.data[l][1];i=d/r}}e.data.push([l,i]),0!==i&&null!==i&&(e._hasChanges=!0),s>l&&0!==i&&null!==i&&(e._needsAnimation=!0)}},c.fillDifferenceSetForNonXYCharts=function(e,t,n,r,a){var i;e._hasChanges=!1,e._needsAnimation=!1;var o=n.data-t.data;return i=o/r,e.data=i,0!==i&&(e._hasChanges=!0,e._needsAnimation=!0),e},c.createDifferenceSet=function(e,t){var n=c.createEmptySet(t);return c.delegate.fillDifferenceSet?c.delegate.fillDifferenceSet(n,e,t,c.smoothSteps,c.currentDraw):c.currentDraw.xychart?c.fillDifferenceSetForXYCharts(n,e,t,c.smoothSteps,c.currentDraw):c.fillDifferenceSetForNonXYCharts(n,e,t,c.smoothSteps,c.currentDraw),n},c.needsSetAnimation=function(){for(var e=c.differenceSets.length,t=0;e>t;t++){var n=c.differenceSets[t];if(n._needsAnimation)return!0}return!1},c.calculateAnimationStepValue=function(e,t,n){var r;if(null!==t&&"object"==typeof t){var a=t;e=a.previousValue,t=a.difference,i.debug("Fixed specification previous value: "+e+" diff: "+t)}if(null===t)r=null;else if(0>t){var o=n(0,-t);r=e-o}else r=n(e,t);return null!==r&&(r=Math.round(r)),r},c.fillAnimationStepSetForXYChart=function(e,t,n,r,a){for(var o,s=Math.min(a.previousColumns,a.columns),l=0;s>l;l++){var c=n.data[l][1];if(l>=t.data.length)o=null!==c?r(0,c):c,null!==o&&(o=Math.round(o));else{var u=t.data[l][1];i.debug("Index "+l+" previous value: "+u+" diff: "+c),o=this.calculateAnimationStepValue(u,c,r)}e.data.push([l,o])}return e},c.fillAnimationStepSetForNonXYChart=function(e,t,n,r,a){return e.data=r(t.data,n.data),e},c.createAnimationStepSet=function(e,t,n){var r=c.createEmptySet(t),a=function(e,t){return easeInOutQuint(n,e,t*n,c.smoothSteps)};return c.delegate.fillAnimationStepSet?c.delegate.fillAnimationStepSet(r,e,t,a,c.currentDraw):c.currentDraw.xychart?c.fillAnimationStepSetForXYChart(r,e,t,a,c.currentDraw):c.fillAnimationStepSetForNonXYChart(r,e,t,a,c.currentDraw),c.delegate.onAnimationStepSetDefined&&c.delegate.onAnimationStepSetDefined(r,c.currentDraw),r},c.fillRescaleXStepSetForXYChart=function(e,t,n,r){for(var a,i=0;r>i;i++)a=i<t.data.length?t.data[i][1]:n.data[i][1],e.data.push([i,a])},c.createRescaleXStepSet=function(e,t,n){var r=c.createEmptySet(e);return c.delegate.fillRescaleXStepSet?c.delegate.fillRescaleXStepSet(r,e,t,n):c.currentDraw.xychart&&c.fillRescaleXStepSetForXYChart(r,e,t,n),r},c.drawSmooth=function(e){t.debug("*** START DRAW SMOOTH FOR "+c.id+" ***"),c.initialTime=new Date,c.currentDraw=e,e.maintainScale?(c.previousScale=0,c.newScale=0):(c.previousScale=c.getScaleForSets(e.previousSets,e.previousTicks),c.newScale=c.getScaleForSets(e.newSets,e.newTicks));var n=e.previousSets,a=e.newSets;for(r.debug("previous sets ("+n.length+"): "+JSON.stringify(n)),r.debug("new sets ("+a.length+"): "+JSON.stringify(a)),r.debug("columns: "+e.previousColumns+" --> "+e.columns),r.debug("scale: "+c.previousScale+" --> "+c.newScale),r.debug("new sets details:"),u=0;u<a.length;u++){var i=a[u];r.debug("   "+i.label+": number of items = "+i.data.length)}c.newSets=a,c.differenceSets=[];var o,s,l,u,d=e.columns!==e.previousColumns,m=[];for(c.addSetsUnique(n,m),c.addSetsUnique(a,m),c.sortSets&&c.sort(m),u=0;u<m.length;u++){var g=c.indexOfSet(m[u].label,n),f=c.indexOfSet(m[u].label,a);-1===g&&f>-1?(l=a[f],s=c.createEmptySet(l),o=c.createDifferenceSet(s,l),o._needsAnimation=!0,o._isNew=!0,d=!0):g>-1&&-1===f?(s=n[g],l=c.createEmptySet(s),o=c.createDifferenceSet(s,l),o._needsAnimation=!0,o._isRemoved=!0,d=!0):o=c.createDifferenceSet(n[g],a[f]),c.differenceSets.push(o),o._hasChanges&&(d=!0)}if(!d&&c.delegate.hasExtraChanges&&(d=c.delegate.hasExtraChanges(e)),!d)return c.finishTicket(c.currentTicket),c.drawing=!1,t.debug("There are no changes to draw"),c.cleanupSmoothDraw(),void c.checkPendingSmoothDraw();r.debug("difference sets: "+JSON.stringify(c.differenceSets));var h=e.columns-e.previousColumns;c.diffColumnsPerStep=h/c.smoothSteps,r.debug("difference columns per step: "+c.diffColumnsPerStep),h>=0?c.startAnimationOnRebuiltChart():c.rescaleX(e.previousSets,function(){c.startAnimationOnRebuiltChart()})},c.startAnimationOnRebuiltChart=function(){c.previousScale===c.newScale?(c.setScale(c.getScaleForPreviousState()),c.startSetAnimation()):c.previousScale<c.newScale?c.rescaleY(function(){c.startSetAnimation()}):(c.setScale(c.getScaleForPreviousState()),c.startSetAnimation())},c.rescaleX=function(e,r){if(n.debug("*** RESCALING X FOR TICKET "+c.currentTicket+" ***"),t.debug("*** RESCALING X ON "+c.id+" FROM "+c.currentDraw.previousColumns+" TO "+c.currentDraw.columns+" ***"),c.rescaleXSets=e,c.onRebuiltCallback=r,c.setScale(c.getCurrentScale()),!c.animateRescaleX)return c.setColumns(c.currentDraw.columns),void c.onRebuiltCallback();c.rescaleXStartTime=new Date;var a=c.currentDraw.columns-c.currentDraw.previousColumns;c.rescaleXSteps=Math.abs(a),c.rescaleXDelta=a/c.rescaleXSteps,c.rescaleXStep=0,c.rescaleXAnimation=(new o).create("RescaleX",c.currentTicket,c.rescaleXDuration,c.rescaleXSteps,c.stepDuration,c.drawRescaleXStep),c.rescaleXAnimation.start()},c.drawRescaleXStep=function(e){if(e.ticket!==c.currentTicket)return void console.error("SCALEX ANIMATION STEP FOR TICKET "+e.ticket+", CURRENT TICKET IS "+c.currentTicket);if(-1===c.rescaleXStep)return void i.error("Invalid rescaleX step");i.debug("Drawing rescaleX step "+c.rescaleXStep);var t=c.currentDraw.previousColumns+c.rescaleXStep*c.rescaleXDelta;if(c.setColumns(t),c.rescaleXStep===c.rescaleXSteps){c.rescaleXStep=-1,c.rescaleXAnimation.stop(),c.rescaleXAnimation=null;var n=new Date-c.rescaleXStartTime;return a.debug("REBUILD ELAPSED TIME: "+n+" ms"),void c.onRebuiltCallback()}c.rescaleXStep++,c.rescaleXAnimation.resume()},c.setColumns=function(e){i.debug("rescaleX to "+e+" columns");for(var t=[],n=0;n<c.rescaleXSets.length;n++){var r=c.createRescaleXStepSet(c.rescaleXSets[n],c.differenceSets[n],e);t.push(r)}c.redraw(t)},c.setScale=function(e){var t=c.plot.getAxes();i.debug("setting scale to "+e+" (was "+t.yaxis.max+")"),t.yaxis.options.max=e,c.delegate.onRescaleY&&c.delegate.onRescaleY(e,c.plot),c.plot.setupGrid(),c.plot.draw()},c.rescaleY=function(e){n.debug("*** RESCALING Y FOR TICKET "+c.currentTicket+" ***"),t.debug("*** RESCALING Y ON "+c.id),c.rescaleYStartTime=new Date,c.targetScale=c.getScaleForFinalState(),r.debug("Rescaling to "+c.targetScale),c.onScaleCallback=e,c.rescaleYStep=0,c.rescaleYAnimation=(new o).create("RescaleY",c.currentTicket,c.rescaleYDuration,c.rescaleYSteps,c.stepDuration,c.drawRescaleYStep),c.rescaleYAnimation.start()},c.drawRescaleYStep=function(e){if(e.ticket!==c.currentTicket)return void console.error("SCALEY ANIMATION STEP FOR TICKET "+e.ticket+", CURRENT TICKET IS "+c.currentTicket);if(-1===c.rescaleYStep)return void i.error("Invalid rescaleY step");if(i.debug("Drawing rescaleY step "+c.rescaleYStep),c.rescaleYStep===c.rescaleYSteps){c.rescaleYStep=-1,c.setScale(c.targetScale),c.rescaleYAnimation.stop(),c.rescaleYAnimation=null;var t=new Date-c.rescaleYStartTime;return a.debug("RESCALEY ELAPSED TIME: "+t+" ms"),void c.onScaleCallback()}var n=c.targetScale-c.previousScale,r=n/c.rescaleYSteps;c.setScale(c.previousScale+r*c.rescaleYStep),c.rescaleYStep++,c.rescaleYAnimation.resume()},c.startSetAnimation=function(){return n.debug("*** ANIMATING SETS FOR TICKET "+c.currentTicket+" ***"),t.debug("*** ANIMATING SETS ***"),c.needsSetAnimation()?(c.animationStartTime=new Date,c.smoothCurrentStep=0,c.drawingStepColumns=c.currentDraw.previousColumns,c.delegate.onSetAnimationStarting&&c.delegate.onSetAnimationStarting(c.currentDraw),c.setAnimation=(new o).create("Set",c.currentTicket,c.smoothDuration,c.smoothSteps,c.stepDuration,c.drawAnimationStep),void c.setAnimation.start()):(t.debug("No animation needed for the sets, skip"),void c.finishSetAnimation())},c.finishSetAnimation=function(){c.smoothCurrentStep=-1,c.currentDraw.previousColumns<c.currentDraw.columns?c.rescaleX(c.currentDraw.newSets,function(){c.finishWholeAnimation()}):c.finishWholeAnimation()},c.finishWholeAnimation=function(){c.previousScale>c.newScale&&c.currentDraw.max>0?c.rescaleY(function(){c.drawFinalState()}):c.drawFinalState()},c.drawAnimationStep=function(e){if(e.ticket!==c.currentTicket)return void console.error("SET ANIMATION STEP FOR TICKET "+e.ticket+", CURRENT TICKET IS "+c.currentTicket);if(c.drawingStep)return void i.error("Already drawing step!");if(-1===c.smoothCurrentStep)return void i.error("Invalid draw step");if(c.drawingStep=!0,t.debug("Set animation step "+c.smoothCurrentStep+" ("+c.id+")"),c.smoothCurrentStep===c.smoothSteps){c.setAnimation.stop(),c.setAnimation=null;var n=new Date-c.animationStartTime;return a.debug("ANIMATION ELAPSED TIME: "+n+" ms"),void c.finishSetAnimation()}for(var r,o=[],s=c.currentDraw.previousSets,l=0;l<c.differenceSets.length;l++){var u=c.differenceSets[l],d=c.indexOfSet(u.label,s);r=-1===d?c.createAnimationStepSet(c.createEmptySet(u),u,c.smoothCurrentStep):c.createAnimationStepSet(s[d],u,c.smoothCurrentStep),o.push(r),u._isNew&&i.debug("New set in step: "+r),u._isRemoved&&i.debug("Removed set in step: "+r)}i.debug("Sets for step "+c.smoothCurrentStep+": "+JSON.stringify(o)),c.redraw(o),c.smoothCurrentStep++,c.drawingStepColumns+=c.diffColumnsPerStep,c.drawingStep=!1,c.setAnimation.resume()},c.drawFinalState=function(){n.debug("ANIMATIONS FINISHED - DRAW FINAL STATE"),t.debug("DRAW FINAL STATE"),c.drawFromScratch(c.currentDraw.newSets,c.currentDraw),c.cleanupSmoothDraw();var e=new Date;a.debug("Total animation draw time: "+(e-c.initialTime)),c.checkPendingSmoothDraw()},c.getScaleForSets=function(e,t){var n=e;c.delegate.getSetsForScaleMesurement&&(n=c.delegate.getSetsForScaleMesurement(e));var r=c.plot.getAxes(),a=r.yaxis.options.max,i=r.yaxis.options.ticks,o=c.plot.getData();r.yaxis.options.max=null,t&&(r.yaxis.options.ticks=t),c.plot.setData(n),c.plot.setupGrid();var s=r.yaxis.max;return r.yaxis.options.max=a,t&&(r.yaxis.options.ticks=i),c.plot.setData(o),c.plot.setupGrid(),s},c.getScaleForFinalState=function(){return c.getScaleForSets(c.currentDraw.newSets,c.currentDraw.newTicks)},c.getScaleForPreviousState=function(){return c.getScaleForSets(c.currentDraw.previousSets,c.currentDraw.previousTicks)},c.getCurrentScale=function(){var e=c.plot.getAxes(),t=e.yaxis.max;return t},c.checkPendingSmoothDraw=function(){if(c.pendingDraw){c.drawing=!0;var e=c.pendingTicket;if(c.pendingTicket=-1,t.debug("DRAWING PENDING SETS FOR "+c.id),n.debug("DRAWING PENDING TICKET "+e+" FOR "+c.id),!c.processTicket(e))return;var r=!0;if(c.delegate.beforeDrawing){var a=c.delegate.beforeDrawing();void 0!==a&&(r=a)}if(r){var i=c.delegate.createDrawObjectForCurrentState();c.pendingDraw=!1,c.drawSmooth(i)}else{var o=c.delegate.getSetsForDrawing();c.drawFromScratch(o),c.cleanupSmoothDraw()}}},c.cleanupSmoothDraw=function(){c._cleanupCurrentDrawing(),c.finishTicket(c.currentTicket),c.drawing=!1},c._cleanupCurrentDrawing=function(){c.smoothCurrentStep=-1,c.differenceSets=[],c.currentDraw=null,c.drawingStep=!1,c.rescaleYStep=-1,c.targetScale=-1,c.onScaleCallback=null,c.diffColumnsPerStep=0,c.drawingStepColumns=0},c.resetDrawing=function(){if(n.debug("RESET DRAWING "+c.id),t.debug("RESET DRAWING "+c.id),!c.isCanvasReady())return t.debug("Canvas is not ready for drawing."),t.debug("Reset drawing will be performed next time draw is called."),void(c.pendingReset=!0);c.drawing&&(n.debug("WARNING! trying to reset drawing while a previous drawing process is in progress"),c._cancelAnimations()),c.drawing=!0,c.pendingDraw&&(n.debug("WARNING! There was a pending draw!"),c.pendingDraw=!1);var e=c.smoothTransitions;c.smoothTransitions=!1,c._draw(),c.smoothTransitions=e,c.drawing=!1,n.debug("FINISHED RESET DRAWING"),c.pendingDraw&&n.error("PENDING DRAW WHILE RESET DRAWING WAS EXECUTING!!!")},c.redraw=function(e,t){c.sortAtEachStep&&c.sort(e);var n=t?t:!1;if(!n&&c.delegate.getTicks){var r=c.delegate.getTicks(e,c.currentDraw);c.plot.getAxes().yaxis.options.ticks=r}var a=e;if(c.delegate.onRedraw){var i=c.delegate.onRedraw(e,c.plot,c.currentDraw,n);void 0!==i&&(a=i)}c.plot.setData(a),c.plot.setupGrid(),c.plot.draw()},c.setSortSets=function(e){c.sortSets=e},c.findSet=function(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(r.label===e.label)return!0}return!1},c.indexOfSet=function(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(r.label===e)return n}return-1},c.addSetsUnique=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];-1===c.indexOfSet(r.label,t)&&t.push(r)}},c.sort=function(e){e.sort(function(e,t){return e.order-t.order})},c.cancelAnimations=function(){c.drawing=!1,c._cancelAnimations()},c._cancelAnimations=function(){c.currentTicket>-1&&n.debug("CANCELLING ANIMATIONS FOR TICKET "+c.currentTicket),c.currentTicket=-1;try{null!==c.rescaleXAnimation&&c.rescaleXAnimation.cancel()}catch(e){}try{null!==c.rescaleYAnimation&&c.rescaleYAnimation.cancel()}catch(e){}try{null!==c.setAnimation&&c.setAnimation.cancel()}catch(e){}c._cleanupCurrentDrawing()},c.dismiss=function(){c.cancelAnimations()},window.chrome){t.debug("You are in CHROME!");var u=function(){t.debug("WORKAROUND FOR "+c.id);var e=$(c.id);if(t.debug("   length="+e.length),0===e.length)return!1;if(t.debug("   width="+e.width()),t.debug("   css width="+e.css("width")),t.debug("   visible="+e.is(":visible")),e.is(":visible")){var n=parseInt(e.width());e.width(n+1),c.resetDrawing(),e.css("width","100%"),c.resetDrawing()}else t.debug("   Skipping (not visible)");return!0},d=function(){document.hidden||u()||(t.debug("Removing workaround for "+c.id),document.removeEventListener("webkitvisibilitychange",d))};t.debug("Installing workaround for "+c.id),document.addEventListener("webkitvisibilitychange",d)}return c}};return o}),define("common-chart-interactivity",["logger"],function(e){var t=e.get("ChartInteractivity"),n=function(){this.create=function(e){t.debug("Creating chart interactivity support for "+e);var n={};return n.id=e,n.tooltip=null,n.hoverline=null,n.onHoverHandler=null,n.isEnabledHandler=null,n.hoverTimeoutDuration=3e3,n.hoverTimeout=null,n.hoverFadeInDuration=200,n.hoverFadeOutDuration=200,n.minimumX=1,n.maximumX=0,n.minimumY=0,n.maxValue=0,n.messages=[],n.preloadMessages=!0,n.debuggingEnabled=!1,n.debugPopup=null,n.dragging=!1,n.draggingStopTime=null,n.waitTimeAfterDragging=500,n.considerLastColumn=!1,n.useRoundingForColumnConversion=!0,n.onDocumentMouseMove=function(e){if(n.eventHolder){var t=n.eventHolder.offset(),r=e.pageX>=t.left&&e.pageX<=t.left+n.eventHolder.width()&&e.pageY>=t.top&&e.pageY<=t.top+n.eventHolder.height();r||n.hide()}},document.addEventListener("mousemove",n.onDocumentMouseMove,!1),n.setOnHover=function(e){n.onHoverHandler=e},n.setIsEnabledHandler=function(e){n.isEnabledHandler=e},n.setMinimumX=function(e){n.minimumX=e},n.setMaximumX=function(e){t.debug("Setting max x: "+e),n.maximumX=e},n.setMinimumY=function(e){n.minimumY=e},n.setPreloadMessages=function(e){n.preloadMessages=e},n.setConsiderLastColumn=function(e){n.considerLastColumn=e},n.hide=function(){null!==n.tooltip&&n.tooltip.fadeOut(n.hoverFadeOutDuration),null!==n.hoverline&&n.hoverline.fadeOut(n.hoverFadeOutDuration)},n.onBind=function(e,r){n.eventHolder=r,r.unbind(),r.bind("click",function(t){var a=$(n.id),i=r.offset();n.onTouch(t.originalEvent,e,a,i,"click",!1)}),r.bind("mousemove",function(t){if(!(null!==n.draggingStopTime&&new Date-n.draggingStopTime<n.waitTimeAfterDragging)){n.draggingStopTime=null;var a=$(n.id),i=r.offset();n.onTouch(t.originalEvent,e,a,i,"mousemove",!1)}}),r.bind("mousedown",function(e){n.startDragging()}),r.bind("touchstart",function(t){t.preventDefault(),n.dragging=!0,t=t.originalEvent.targetTouches?t.originalEvent.targetTouches[0]:t.originalEvent;var a=$(n.id),i=r.offset();n.onTouch(t,e,a,i,"touchstart",!0)}),r.bind("touchmove",function(t){t.preventDefault(),t=t.originalEvent.targetTouches?t.originalEvent.targetTouches[0]:t.originalEvent;var a=$(n.id),i=r.offset();n.onTouch(t,e,a,i,"touchmove",!0)}),r.bind("touchend",function(e){e.preventDefault(),n.dragging=!1,t.debug("touchend"),n.hide()})},n.fetchMessage=function(e,r){t.debug("| fetching "+e),n.onHoverHandler(e).then(function(a){t.debug("| caching "+e),n.messages[e]=a,r&&r(a)})},n.justFetchMessages=function(){t.debug("Fetching messages for "+n.columns+" columns"),n.onHoverHandler(n.columns).then(function(e){n.messages=e})},n.activate=function(e){if(n.onHoverHandler){var t=e.getAxes(),r=t.yaxis.max;if(n.maxValue=r,n.messages=[],n.columns=t.xaxis.max,n.columns+=n.considerLastColumn?1:0,n.debuggingEnabled){var a="debugPopup"+n.id.replace("#","");n.debugPopup=$("#"+a),null!==n.debugPopup&&(n.debugPopup.remove(),n.debugPopup=[]),$("<div id='"+a+"' class='chart-popup-debugger'></div>").appendTo("body"),n.debugPopup=$("#"+a),n.debugPopup.on("click",function(){$(this).empty(),$(this).hide()})}n.justFetchMessages();var i=$(this.id),o="tooltip"+n.id.replace("#","");n.tooltip=$("#"+o),null!==n.tooltip&&(n.tooltip.remove(),n.tooltip=[]),$("<div id='"+o+"' class='chart-popup'></div>").appendTo("body"),n.tooltip=$("#"+o),n.tooltip.bind("mouseleave",function(e){var t=e.originalEvent.toElement===n.eventHolder[0];t||n.hide()}),n.tooltip.bind("mouseover",function(t){var r=$(n.id),a=n.eventHolder.offset();n.onTouch(t.originalEvent,e,r,a,"mousemove",!1)}),null!==n.hoverline&&n.hoverline.remove();var s="hoverline"+n.id.replace("#","");n.hoverline=$("#"+s),null!==n.hoverline&&(n.hoverline.remove(),n.hoverline=[]),i.append("<div id='"+s+"' class='chart-hover-line'></div>"),n.hoverline=$("#"+s),n.hoverline.bind("mousedown",function(t){n.startDragging();var r=$(n.id),a=n.eventHolder.offset();return n.onTouch(t.originalEvent,e,r,a,"mousemove",!1),!1})}},n.onTouch=function(e,r,a,i,o,s){var l=r.getPlotOffset(),c=e.pageX-i.left-l.left,u=e.pageY-i.top-l.top,d=r.width(),m=r.height();if(t.debug("============================================================================="),t.debug(o+" at "+c+", "+u+" (size "+d+"x"+m+")"),t.debug(" absolute: "+e.pageX+", "+e.pageY+" (offset left: "+i.left+" top:"+i.top+")"),n.debuggingEnabled&&n.addDebuggingLine("<b>touch "+c+", "+u+"</b>"),0>c||c>=d||0>u||u>=m)return t.debug("OUT OF BOUNDS "+c+", "+u+" (size "+d+"x"+m+")"),n.addDebuggingLine("<b>OUT OF BOUNDS "+c+", "+u+" (size "+d+"x"+m+")</b>"),void n.hide();var g=r.c2p({left:c,top:u});g.pageX=e.pageX,g.pageY=e.pageY,t.debug(n.id+" "+JSON.stringify(g)),n.onInteractivity(g,a,i,s)},n.onInteractivity=function(e,r,a,i){if(null===n.isEnabledHandler||n.isEnabledHandler())if(e.x<n.minimumX||e.x>n.maximumX)t.debug("hide for "+JSON.stringify(e)),n.hide();else{var o=n.useRoundingForColumnConversion?Math.round(e.x):Math.floor(e.x);t.debug("==> COLUMN: "+o);var s=n.messages[o];s&&n.show(s,e,r,a,i)}},n.show=function(e,t,r,a,i){if(null===e)return void n.hide();null!==n.hoverTimeout&&window.clearTimeout(n.hoverTimeout),n.dragging||(n.hoverTimeout=window.setTimeout(function(){n.hide()},n.hoverTimeoutDuration)),n.tooltip.empty(),n.tooltip.append(e);var o,s,l=n.tooltip.width(),c=n.tooltip.height();i?(s=t.pageY-40-c,o=t.pageX-10-l):(s=t.pageY+10,o=t.pageX+10);var u=s+c,d=o+l,m=$(window).scrollLeft(),g=$(window).scrollTop(),f=m+$(window).width()-10,h=g+$(window).height()-10;d>f&&(o-=d-f),m>o&&(o+=m-o),u>h&&(s-=u-h),g>s&&(s+=g-s),n.tooltip.stop(!0),n.tooltip.css({top:s,left:o}),n.tooltip.fadeIn(n.hoverFadeInDuration),n.hoverline.stop(!0),n.hoverline.css({top:0,left:t.pageX-a.left,height:r.height()}).fadeIn(n.hoverFadeInDuration),n.debuggingEnabled&&(n.debugPopup.css({top:g,left:m}),n.debugPopup.show(),n.debugPopup.html().length>5e3&&n.debugPopup.empty())},n.startDragging=function(){n.dragging=!0,$(document).disableSelection(),$(document).one("mouseup",n.stopDragging)},n.stopDragging=function(e){n.dragging=!1,$(document).enableSelection(),n.hide(),n.draggingStopTime=new Date},n.configureOptions=function(e){e.hooks||(e.hooks={}),e.hooks.bindEvents||(e.hooks.bindEvents=[]),-1===e.hooks.bindEvents.indexOf(n.onBind)&&e.hooks.bindEvents.push(n.onBind),e.grid||(e.grid={}),e.grid.hoverable=!0,e.grid.clickable=!0},n.addDebuggingLine=function(e){n.debuggingEnabled&&(n.debugPopup.html(n.debugPopup.html()+e+"<br>"),n.debugPopup.scrollTop(n.debugPopup[0].scrollHeight))},n.dismiss=function(){n.hide()},n}};return n}),define("base-chart",["logger","common-chart-animator","common-chart-interactivity","jquery-flot","jquery-flot-stack","jquery-flot-axislabels","jquery-flot-pie","jquery-flot-resize"],function(e,t,n){var r=e.get("BaseChart"),a=function(){this.createChart=function(e,a){var i={};return i.id="#"+e,i.sets=[],i.previousSets=[],i.animator=(new t).create(i.id,i),i.interactivity=a?(new n).create(i.id):void 0,i.height=0,i.defaultHeight=0,i.clearSets=function(){this.previousSets=this.sets,this.sets=[]},i.draw=function(){return r.debug("Draw of "+i.id),i.animator.draw(),a&&i.interactivity.hide(),!0},i.resetDrawing=function(){r.debug("Reset drawing of "+i.id),i.animator.resetDrawing(),a&&i.interactivity.hide()},i.dismiss=function(){r.debug("Dismissal of "+i.id),i.animator.dismiss(),a&&i.interactivity.dismiss()},i.getSetsForDrawing=function(){return i.sets},i.setDefaultHeight=function(e){i.defaultHeight=e},i.ensureHeightIsValid=function(){var e=$(i.id);i.height=e.height(),0===i.height&&(i.height=i.defaultHeight)},i}};return a}),define("common-chart-utilities",["logger"],function(e){var t=(e.get("ChartCommon"),function(e,t){this.formatTickValue=function(n){if(e.useThousandsForTicks){if(0===e.decimalsForTicks)return t.formatCurrency(Math.round(n/1e3));var r=Math.pow(10,e.decimalsForTicks);return t.formatCurrency(Math.round(n/1e3*r)/r,!0,e.decimalsForTicks)}return"CHF "+t.formatCurrency(n)},this.getRawTicks=function(t){e.topValueFactor>1&&t.pop();for(var n=[],r=0;r<t.length;r++){var a=t[r],i={label:e.utils.formatTickValue(a),v:a};n.push(i)}return n},this.overlaps=function(e,t,n){for(var r=0;r<t.length;r++){var a=t[r];if(this.getPixels(a,e,n)<=15)return!0}return!1},this.getPixels=function(t,n,r){var a=Math.abs(t-n),i=a*e.height/(e.max-e.min);return i},this.isBlankSet=function(e){for(var t=0;t<e.data.length;t++){var n=e.data[t];if(0!==n[1])return!1}return!0},this.removeBlankItemsFromSets=function(e){for(var t=[],n=0;n<e.length;n++)this.isBlankSet(e[n])&&t.push(n);for(var r=0,a=0;a<t.length;a++){var i=t[a]-r;e.splice(i,1),r++}},this.determineTickAppearance=function(t){e.useThousandsForTicks=!1},this.hasSetNullValues=function(e){for(var t=!1,n=0;n<e.data.length;n++)if(null===e.data[n].begin||null===e.data[n].end){t=!0;break}return t},this.isSetALine=function(e){return void 0!==e.lines},this.findSetFromOrder=function(t){var n=null;return e.series.forEach(function(r){e.sets.forEach(function(e){r.order===t&&r.name===e.label&&(n=e)})}),n}});return t}),define("base-bar-chart",["logger","base-chart","common-chart-utilities"],function(e,t,n){var r=(e.get("BaseBarChart"),function(){this.createChart=function(e,r,a){var i=(new t).createChart(e,r);return i.utils=new n(i,a),i.options=null,i.max=0,i.min=0,i.series=[],i.previousMax=0,i.previousOptions=null,i.animator.setSortSets(!0),i.labelThounsandsForTicks="",i.labelCurrency="",i.labelYearString="",i.setChartLabels=function(e,t,n){i.labelThounsandsForTicks=void 0!==e?e:i.labelThounsandsForTicks,i.labelCurrency=void 0!==t?t:i.labelCurrency,i.labelYearString=void 0!==n?n:i.labelYearString},i}});return r}),define("common-column-chart",["base-bar-chart","common-currency-formatter","logger"],function(e,t,n){var r=n.get("ColumnChart"),a=function(){this.createColumnChart=function(t,n){function a(e){for(var t,n=0;n<o.columns.length;n++)if(t=o.columns[n],t.id===e)return t;return null}function i(e,t){for(var n=[],r=0;r<t.length;r++){var a=t[r];a.column===e.index&&n.push(a)}return n}var o=(new e).createChart(t,!0,n);return o.columns=[],o.visibleColumns=[],o.previousVisibleColumns=0,o.shouldShowColumnNames=!0,o.shouldShowEmptyColumns=!1,o.interactivity.setMinimumX(0),o.interactivity.setMaximumX(10),o.interactivity.setIsEnabledHandler(function(){return!o.animator.drawing}),o.setOnHover=function(e){o.interactivity.setOnHover(e)},o.addSerie=function(e,t,n,r,a){var i={};i.name=e,i.color=t,i.isLine=n,i.column=r,i.order=o.series.length,i.lineThickness=a?a:2,o.series.push(i)},o.addColumn=function(e,t){var n={};n.index=o.columns.length,n.id=e,n.name=t,n.visible=!0,o.columns.push(n)},o.setColumnVisibility=function(e,t){var n=a(e);n&&(n.visible=t)},o.setData=function(e){o.pendingDraw={values:e,id:Date.now()}},o.createSets=function(e){o.previousSets=o.sets,o.previousMax=o.max,o.previousOptions=o.options;for(var t,n,a,s,l,c=$.extend(!0,[],e),u=$.extend(!0,[],o.columns),d=o.pendingDraw.values,m=[],g=0;g<d.length;g++)t=d[g],l=c[g],l.show=!0,l.value=t,$.isNumeric(t)||(l.show=!1,l.value=void 0);if(!o.shouldShowEmptyColumns)for(a=0;a<u.length;a++){n=u[a];var f=i(n,c),h=!1;for(s=0;s<f.length;s++)l=f[s],l.show&&(h=!0);h||(n.visible=!1)}for(o.visibleColumns=[],a=0;a<u.length;a++)n=u[a],n.visible&&o.visibleColumns.push(n);for(s=0;s<c.length;s++)if(l=c[s],l.show){var p=[],v=0;for(a=0;a<u.length;a++)n=u[a],n.visible&&(t=void 0,n.index===l.column&&(t=l.value),p.push([v++,t]));var S={label:l.name,data:p,color:l.color,order:l.order};l.isLine&&(dataSet=[],dataSet.push([-1,l.value]),dataSet.push([o.visibleColumns.length,l.value]),S.data=dataSet,S.stack=!1,S.lines={show:!0,fill:!1,steps:!1,lineWidth:l.lineThickness}),m.push(S)}return r.debug("Columns: "),o.columns.forEach(function(e){r.debug(JSON.stringify(e))}),r.debug("Series:  "),o.series.forEach(function(e){r.debug(JSON.stringify(e))}),r.debug("Sets:    "),m.forEach(function(e,t){r.debug(JSON.stringify(m[t]))}),m},o.beforeDrawing=function(){return o.prepare(),this.previousVisibleColumns===this.visibleColumns.length},o.draw=function(){r.debug("Drawing comparative chart "+o.id),o.animator.draw()},o.resetDrawing=function(){o.animator.resetDrawing()},o.prepare=function(){o.sets=o.createSets(o.series),o.max=o.getMaxValue(),o.utils.determineTickAppearance(o.max),o.ensureHeightIsValid();var e=[];o.visibleColumns.forEach(function(t,n){e.push([n,t.name])}),o.options={series:{stack:!0,shadowSize:0,bars:{show:!0,fill:1,barWidth:.75,align:"center"}},legend:{show:!1},xaxis:{show:o.shouldShowColumnNames,ticks:e,color:"rgba(0,0,0,0)",min:-.6,max:o.visibleColumns.length-.4},yaxis:{ticks:o.getTicks(o.sets),color:"rgba(0,0,0,0)",min:0,tickFormatter:o.utils.formatTickValue},grid:{aboveData:!0,borderWidth:{top:0,left:1,bottom:1,right:0},margin:{top:20,left:5,bottom:0,right:0}}}},o.getMaxValue=function(){for(var e=0,t=0;t<o.visibleColumns.length;t++)for(var n=0,r=0,a=0,i=0;i<o.sets.length;i++){var s=o.sets[i].data;if(!o.sets[i].lines)for(var l=0;l<s.length;l++)if(r=s[l][0],r===t){r===a?n+=isNaN(s[l][1])?0:s[l][1]:n=isNaN(s[l][1])?0:s[l][1],a=r,n>e&&(e=n);break}}return e},o.drawLabels=function(){var e;e=o.useThousandsForTicks?o.labelThounsandsForTicks:o.labelCurrency},o.dismiss=function(){r.debug("Dismissal of "+o.id),o.animator.dismiss()},o.showColumnNames=function(e){o.shouldShowColumnNames=e},o.showEmptyColumns=function(e){o.shouldShowEmptyColumns=e},o.createDrawObjectForCurrentState=function(){var e=[];return this.previousOptions&&(e=this.previousOptions.yaxis.ticks),{xychart:!0,previousSets:$.extend(!0,[],this.previousSets),newSets:$.extend(!0,[],this.sets),previousMax:this.previousMax,max:this.max,previousColumns:this.previousVisibleColumns,columns:this.visibleColumns.length,previousTicks:e,newTicks:this.options.yaxis.ticks}},o.onDrawFromScratch=function(e,t){t?this.previousVisibleColumns=t.columns:this.previousVisibleColumns=this.visibleColumns.length},o.createPlot=function(e){o.interactivity.configureOptions(this.options);var t=$.plot($(o.id),e,this.options);return o.drawLabels(),o.interactivity.setPreloadMessages(!1),o.interactivity.activate(t),o.interactivity.setMinimumX(this.options.xaxis.min),t},o.onAnimationStepSetDefined=function(e,t){e.stack===!1&&(dataSet=[],dataSet.push([-1,e.data[0][1]]),dataSet.push([t.columns,e.data[0][1]]),e.data=dataSet)},o.onRedraw=function(e,t){o.utils.removeBlankItemsFromSets(e)},o.getTicks=function(e){for(var t,n=[0],r=$(o.id),a=0;a<o.columns.length;a++)for(var i=0,s=0,l=0,c=0;c<e.length;c++)for(var u=e[c].data,d=0;d<u.length;d++)if(s=u[d][0],s===a||-1===s){if(s!==l||e[c].lines?i=isNaN(u[d][1])?0:u[d][1]:i+=isNaN(u[d][1])?0:u[d][1],l=s,t=i,d-1>0){var m=u[d-1][1];void 0!==m&&(t=Math.max(i,m))}o.utils.overlaps(i,n,r)||n.push(i);break}return n},o}};return a}),define("column-graph",["parameters-manager","logger","common-column-chart","common-currency-formatter"],function(e,t,n,r){"use strict";var a=t.get("ColumnGraph");return function(t){return t.component("columnGraph",{bindings:{id:"@",bridge:"="},templateUrl:"src/directives/graphs/column-graph/column-graph.html",controller:["$timeout",function(t){a.debug("START COLUMN GRAPH");var i=this;void 0!==i.id&&i.id.length>0?i.fieldId=i.id.replace(/\./g,"_"):i.fieldId="",i.canvasId=i.fieldId+"ColumnCanvas",i.bridge.update=function(){a.debug("UPDATE: "+i.canvasId),i.refreshHandler.update()},i.bridge.forceDraw=function(){a.debug("FORCE DRAW: "+i.canvasId),i.refreshHandler.forceDraw()},i.bridge.getVisibleRefreshHandlers=function(){return[i.refreshHandler]},i.bridge.getChart=function(){return i.getColumnChart()},i.getColumnChart=function(){return i.columnChart||(i.columnChart=(new n).createColumnChart(i.canvasId,new r(e.baseViewParameters.groupDelimiter,e.baseViewParameters.amountDecimalDelimiter,e.baseViewParameters.useMixedGroupingSeparator)),i.bridge.configureChart(i.columnChart)),i.columnChart};var o=i.bridge.createChartUpdater(i.getColumnChart(),function(e){i.bridge.updateChart(e)});i.refreshHandler=i.bridge.createRefreshHandler(i.canvasId,o)}]})}}),define("multicalc-risk",["parameters-manager","logger","column-graph","base-state"],function(e,t){"use strict";var n=t.get("MulticalcRisk");return function(t){return t.component("multicalcRisk",{bindings:{id:"@",result:"=",bridge:"=",data:"=",calculate:"&",contact:"&",need:"="},templateUrl:"src/controllers/multicalc/multicalc-risk/multicalc-risk.html",controller:["baseState","localize","$timeout",function(t,r,a){var i=this;i.baseViewParameters=e.baseViewParameters,i.collapsed=!0,void 0!==i.id&&i.id.length>0?i.fieldId=i.id.replace(/\./g,"_"):i.fieldId="",i.mainId=i.fieldId+"Result",i.chartId=i.mainId+"Chart",i.riskType=-1!==i.fieldId.indexOf("Death")?"Death":"Disability",i.bridge.update=function(){i.chartBridge.update()},i.bridge.forceDraw=function(){
n.debug("RISK ON ACTIVE CHART DRAW!"),n.debug("result="+JSON.stringify(i.result)),i.chartBridge.forceDraw()},i.bridge.getVisibleRefreshHandlers=function(){return i.chartBridge.getVisibleRefreshHandlers()},i.chartBridge=i.bridge.newBridge(),i.chartBridge.configureChart=function(t){t.addColumn("today",r.getLocalizedString("MulticalcRisk.ColumnToday")),t.addColumn("risk",r.getLocalizedString("MulticalcRisk.Column"+i.riskType)),t.showEmptyColumns(!1);var n="risk"+i.riskType+"GapColor",a="risk"+i.riskType+"FirstPillarColor",o="risk"+i.riskType+"SecondPillarColor";t.addSerie("income",e.baseViewParameters.riskIncomeColor,!1,0),t.addSerie("ahv",e.baseViewParameters[a],!1,1),t.addSerie("bvg",e.baseViewParameters[o],!1,1),t.addSerie("gap",e.baseViewParameters[n],!1,1),t.addSerie("need",e.baseViewParameters.riskNeedColor,!0,void 0,e.baseViewParameters.needLineThickness),t.setChartLabels(r.getLocalizedString("Charts.ThousandCurrency"),r.getLocalizedString("Charts.Currency")),t.setOnHover(function(e){return i.bridge.loadTemplateArray(i.chartId+"ColumnCanvasContainer","src/controllers/multicalc/multicalc-risk/multicalc-risk-chart-popup.html",e,function(e,t){e.column=t,e.that=i;var n,r=i.chartBridge.getChart().utils.findSetFromOrder;n=r(0),e.grossIncome=null===n?0:n.data[t][1],n=r(1===t?2:6),e.secondPillarRent=null===n?0:n.data[t][1],n=r(1===t?1:5),e.firstPillarRent=null===n?0:n.data[t][1]})})},i.chartBridge.updateChart=function(e){var n=function(e){return e>0?e:null},r=[];r.push(n(t.mainPerson.grossIncome)),r.push(i.result.firstPillarRent),r.push(i.result.secondPillarRent),r.push(i.result.gap),r.push(n(i.need)),e.setData(r)},a(function(){$("#"+i.riskType).collapse("hide"),$("#"+i.riskType).on("shown.bs.collapse",function(){i.bridge.forceDraw()})}),i.toggleCollapse=function(){$("#"+i.riskType).collapse("toggle"),i.collapsed=!i.collapsed}}]})}}),define("common-area-chart",["base-bar-chart","logger"],function(e,t){var n=t.get("AreaChart"),r=function(){this.create=function(t,r){n.debug("Creating area chart for "+t);var a=(new e).createChart(t,!0,r);return a.columns=0,a.previousSets=[],a.previousColumns=0,a.addCurrencyLabel=!1,a.XAxisLeftLabel="",a.XAxisRightLabel="",a.interactivity.setIsEnabledHandler(function(){return!a.animator.drawing}),a.setUpAsAreaChart=function(){this.addCurrencyLabel=!0,this.options={series:{stack:!0,shadowSize:0,lines:{show:!0,fill:1,steps:!1,lineWidth:1},bars:{show:!1,barWidth:.6}},legend:{show:!1},xaxis:{show:!0,color:"white",min:0,ticks:0},yaxis:{tickFormatter:a.formatTickValue,min:0,ticks:3},grid:{show:!0,aboveData:!1,margin:{top:25,left:0,bottom:0,right:0},markings:[{xaxis:{from:0,to:0},color:"#000"},{yaxis:{from:0,to:0},color:"#000"}],borderWidth:0},xaxes:[{axisLabelUseHtml:!0}]}},a.setOnHover=function(e){a.interactivity.setOnHover(e)},a.setXAxisLeftLabel=function(e){a.XAxisLeftLabel=e},a.setXAxisRightLabel=function(e){a.XAxisRightLabel=e},a.setXAxisFormatter=function(e){this.options.xaxis.tickDecimals=e,this.options.xaxis.tickFormatter=function(e,t){return e.toFixed(t.tickDecimals)}},a.setXAxisOffset=function(e){this.options.xaxis.offset=e,this.options.xaxis.tickFormatter=function(e,t){return(t.options.offset+e).toFixed(t.tickDecimals)}},a.buildDataSet=function(e){for(var t=[],n=e.length,r=0;n>r;r++){var i=e[r];t.push([r,i]),this.max=Math.max(this.max,i)}return n>a.columns&&(a.columns=n),t},a.addSet=function(e,t,n){var r,a=this.buildDataSet(n);r={label:e,data:a,color:t},this.sets.push(r)},a.addLineSet=function(e,t,n){var r,a=this.buildDataSet(n);r={label:e,data:a,color:t,stack:!1,lines:{show:!0,fill:!1,steps:!1,lineWidth:2}},this.sets.push(r)},a.clearSets=function(){this.sets=[],this.max=0,this.columns=0},a.drawLabels=function(){if(this.addCurrencyLabel){var e;e=a.useThousandsForTicks?a.labelThounsandsForTicks:a.labelCurrency;var t=$(this.id);t.append("<div class='area-chart-left-label'>"+a.XAxisLeftLabel+"</div>"),t.append("<div class='area-chart-right-label'>"+a.XAxisRightLabel+"</div>");var n=this.id.replace("#","")+"CurrencyLabel";a.currencyLabel=$("#"+n)}},a.updateCurrencyLabel=function(){var e;e=a.useThousandsForTicks?a.labelThounsandsForTicks:a.labelCurrency,null!==a.currencyLabel&&a.currencyLabel.html(e)},a.formatTickValue=function(e){return 0===a.max?"":a.utils.formatTickValue(e)},a.getYTicks=function(){var e=a.animator.plot,t=e.getAxes();return t.yaxis.ticks},a.getXTicks=function(){var e=a.animator.plot,t=e.getAxes();return t.xaxis.ticks},a.createDrawObjectForCurrentState=function(){return{xychart:!0,previousSets:$.extend(!0,[],this.previousSets),newSets:$.extend(!0,[],this.sets),previousMax:this.previousMax,max:this.max,previousColumns:this.previousColumns,columns:this.columns}},a.beforeDrawing=function(){a.utils.determineTickAppearance(this.max)},a.onDrawFromScratch=function(e,t){t?(this.previousSets=t.newSets,this.previousMax=t.max,this.previousColumns=t.columns):(this.previousSets=this.sets,this.previousMax=this.max,this.previousColumns=this.columns)},a.createPlot=function(e){a.utils.determineTickAppearance(this.max),a.interactivity.configureOptions(this.options);var t=$.plot(this.id,e,this.options);return a.drawLabels(),a.interactivity.setConsiderLastColumn(!0),a.interactivity.setMaximumX(a.columns-1),a.interactivity.activate(t),t},a.onRedraw=function(e,t){var n=t.getAxes().yaxis.options.max;a.utils.determineTickAppearance(n),a.updateCurrencyLabel()},a.onRescaleY=function(e,t){a.utils.determineTickAppearance(e),a.updateCurrencyLabel()},a.setUpAsAreaChart(),a}};return r}),define("multicalc-saving3a",["parameters-manager","logger","common-area-chart","column-graph","base-state"],function(e,t,n){"use strict";t.get("MulticalcSaving3a");return function(t){return t.component("multicalcSaving3a",{bindings:{id:"@",scenario:"=",result:"=",bridge:"=",data:"=",calculate:"&",contact:"&"},templateUrl:"src/controllers/multicalc/multicalc-saving3a/multicalc-saving3a.html",controller:["$timeout","baseState","localize",function(t,r,a){var i=this;i.baseViewParameters=e.baseViewParameters,i.collapsed=!0,i.bridge.update=function(){i.refreshHandler.update()},i.bridge.forceDraw=function(){i.refreshHandler.forceDraw()},i.bridge.getVisibleRefreshHandlers=function(){return[i.refreshHandler]},i.updateChart=function(e){e.clearSets(),e.addSet("savings",i.baseViewParameters.investmentColor,i.result.savingsSet),e.addSet("interest",i.baseViewParameters.interestColor,i.result.interestSet),e.addSet("taxSavings",i.baseViewParameters.totalTaxSavingColor,i.result.taxSavingsSet),e.setXAxisOffset(i.scenario.age),e.setXAxisLeftLabel(a.getLocalizedString("MulticalcSaving3a.Today")),e.setXAxisRightLabel(a.getLocalizedString("MulticalcSaving3a.RetirementAge"))},i.getAreaChart=function(){return i.standardChart||(i.standardChart=(new n).create("saving3aStandardChartCanvas",i.bridge.getDefaultCurrencyFormatter()),i.standardChart.setXAxisFormatter(0),i.standardChart.setChartLabels(a.getLocalizedString("Charts.ThousandCurrency"),a.getLocalizedString("Charts.Currency"),a.getLocalizedString("Charts.Age")),i.standardChart.setOnHover(function(e){return i.bridge.loadTemplateArray("standardChart","src/controllers/multicalc/multicalc-saving3a/multicalc-saving3a-chart-popup.html",e,function(e,t){e.column=t+i.scenario.age,e.taxSaving=i.result.taxSavingsSet[t],e.interest=i.result.interestSet[t],e.investment=i.result.savingsSet[t]})})),i.standardChart};var o=i.bridge.createChartUpdater(i.getAreaChart(),function(e){i.updateChart(e)});i.refreshHandler=i.bridge.createRefreshHandler("saving3aStandardChartCanvas",o),$("#saving3a").collapse("hide"),$("#saving3a").on("shown.bs.collapse",function(){i.bridge.forceDraw()}),i.toggleCollapse=function(){$("#saving3a").collapse("toggle"),i.collapsed=!i.collapsed}}]})}}),define("profile-bar",["app","logger","profile-common"],function(e){"use strict";return function(e){var t=e.directive("profileBar",["$rootScope",function(e){return{restrict:"E",scope:{onPrint:"&"},templateUrl:"src/directives/profile-bar/profile-bar.html",link:function(t,n,r){t.showProfileBar=function(){return!e.singleCalculation&&e.hasAuthenticationURL}},controller:["$scope","profileCommon",function(e,t){e.getUserLogged=function(){return t.getUserLogged()},e.isDemoAccount=function(){return t.isDemoAccount()},e.logOut=function(){return t.logOut()},e.logIn=function(){return t.logIn()},e.register=function(){return t.register()},e.showLogin=function(){return t.showLogin()},e.showRegister=function(){return t.showRegister()},e.signUp=function(){return t.signUp()},e.onUserLogged=function(){return t.onUserLogged()}}]}}]);return t}}),define("src/iframe-helper.js",["parameters-manager","jquery"],function(e){"use strict";function t(t,n){var r=window.parent;if(r){t={message:t,parameters:n};var a=o;0===a.length&&(a=e.baseApplicationParameters.authorizedContainers);for(var i=0;i<a.length;i++)r.postMessage(t,a[i])}}function n(){var e,r=$("body");if(void 0!==r.injector&&void 0!==r.injector()){var a=r.injector().get("$rootScope");void 0!==a&&(a.$on("$routeChangeSuccess",function(){var n=require("routes-handler"),r=n.getId();e!==r&&(e=r,t("onRouteChanged",r))}),a.$on("documentTitleChanged",function(e,n){t("onDocumentTitleChanged",n)}),a.$on("viewTitleChanged",function(e,n){t("onViewTitleChanged",n)}),a.$on("openContactUrl",function(e,n){t("openContactUrl",n)}),a.$on("printSuccessful",function(e,n){var r=new FileReader;r.addEventListener("loadend",function(){for(var e=new Uint8Array(r.result),n=e.byteLength,a="",i=0,o=0,s=0;n>i;)if(a+=String.fromCharCode(e[i]),i++,o++,o>=1e5||i===n){var l=btoa(a,"");t("onPrintSuccessfulChunk",{chunkIndex:s,content:l}),s++,o=0,a=""}t("onPrintSuccessfulEnd",{chunkCount:s,length:n})}),r.readAsArrayBuffer(n)}))}else window.setTimeout(n,100)}function r(){var e;setInterval(function(){var n=$("#main-content"),r=n.height();r!==e&&(e=r,t("onInnerFrameChanged",r))},50)}function a(t){for(var n=!1,r=e.baseApplicationParameters.authorizedContainers,a=0;a<r.length;a++)(t===r[a]||"*"===r[a])&&(n=!0);return n&&0===o.indexOf(t)&&(console.log("origin "+t+" added to list authorizedOrigins"),o.push(t)),n}function i(e){a(e.origin)&&window.processMessage(e.data.message,e.data.parameters)}var o=[];window.processMessage=function(e,n){if("onNavigation"===e){var r=n,a=$("body"),i=a.injector().get("$rootScope"),o=a.injector().get("locationService"),s=a.injector().get("translateRoute");i.$apply(function(){$(".modal.in").removeClass("in").modal("hide"),$(".modal-backdrop").hide(),o.setPath(s.getPath(r))})}if("onIFrameScroll"===e){var l=n;10>l&&(l=10);var c=$(".modal");c.is(":visible")&&c.css("top",l)}if("getDataFromQuickWin"===e){var u=$("body");if(void 0!==u.injector&&void 0!==u.injector()){var d=u.injector().get("storageManager"),m=d.getFullStoredObject();t("onGetDataFromQuickWin",m)}}},window.addEventListener("message",i,!1),n(),r()}),define("custom-scripts",["src/iframe-helper.js"]),define("message-service",["angular","logger","toastr"],function(e,t,n){"use strict";var r=(t.get("messageService"),e.module("messageServiceModule",[]));return r.factory("messageService",["localize",function(e){var t={MESSAGE_INFO:"info",MESSAGE_SUCCESS:"success",MESSAGE_WARNING:"warning",MESSAGE_DANGER:"danger",alertMessages:[],prepareLocalizedText:function(e,t,n){return{id:e+"."+t,params:n}},indexOfAlertMessage:function(e){for(var t=0;t<this.alertMessages.length;t++)if(this.alertMessages[t].type===e.type&&this.alertMessages[t].localizedText.id===e.localizedText.id)return t;return-1},addAlertMessage:function(t){var r=this.indexOfAlertMessage(t);if(0>r){this.alertMessages.push(t);var a=e.getLocalizedString(t.localizedText.id,t.localizedText.params);if(t.actions.length>0){a+="<br><br>";for(var i=0;i<t.actions.length;i++){var o=t.actions[i],s=e.getLocalizedString(o.localizedLabel.id,o.localizedLabel.params);a+='<button type="button" class="btn-default" id="'+o.id+'">'+s+"</button>"}}var l=this,c={preventDuplicates:!0,closeButton:!0,timeOut:0===t.actions.length&&t.timeout?t.timeout:0,extendedTimeOut:0,tapToDismiss:0===t.actions.length,hideDuration:0,positionClass:0===t.actions.length?"toast-top-right":"toast-top-center",onclick:function(e){var r=!1;if(t.actions.length>0)for(var a=0;a<t.actions.length;a++){var i=t.actions[a];i.id===e.target.id&&(i.fn(),r=!0,n.remove(t.htmlElement))}else r=!0;if(!r)throw"prevent closing of message";l.removeMessage(t)}};t.type===this.MESSAGE_INFO?t.htmlElement=n.info(a,"",c):t.type===this.MESSAGE_SUCCESS?t.htmlElement=n.success(a,"",c):t.type===this.MESSAGE_WARNING?t.htmlElement=n.warning(a,"",c):t.type===this.MESSAGE_DANGER&&(t.htmlElement=n.error(a,"",c))}},addMessage:function(e){void 0===e.actions&&(e.actions=[]),!e.localizedText&&e.enumName&&e.enumKey&&e.enumName.length>0&&e.enumKey.length>0&&(e.localizedText=this.prepareLocalizedText(e.enumName,e.enumKey,e.enumParams)),e.removeOtherGroupMessages&&e.group&&e.group.length>0&&this.removeAllMessagesWithGroup(e.group),this.addAlertMessage(e)},removeMessage:function(e){for(var t=this.indexOfAlertMessage(e);t>=0;)this.alertMessages.splice(t,1),t=this.indexOfAlertMessage(e)},removeAllMessagesWithGroup:function(e){for(var t=this.alertMessages.length-1;t>=0;t--){var r=this.alertMessages[t];if(r.group===e){var a=n.options.hideDuration;n.options.hideDuration=0,n.clear(r.htmlElement,{force:!0}),n.options.hideDuration=a,this.alertMessages.splice(t,1)}}},removeMessagesOnNavigation:function(){for(var e=this.alertMessages.length-1;e>=0;e--){var t=this.alertMessages[e];if(t.dismissOnNavigation){var r=n.options.hideDuration;n.options.hideDuration=0,n.clear(t.htmlElement,{force:!0}),n.options.hideDuration=r,this.alertMessages.splice(e,1)}}},removeAllMessages:function(){for(var e=this.alertMessages.length-1;e>=0;e--){var t=this.alertMessages[e];n.clear(t.htmlElement)}this.alertMessages=[]},getMessagesWithType:function(e){return this.alertMessages.filter(function(t){return t.type===e})}};return t}]),r}),define("google-analytics-service",["angular","logger","parameters-manager","routes-handler"],function(e,t,n,r){"use strict";var a=t.get("googleAnalyticsService"),i=e.module("googleAnalyticsServiceModule",[]);return i.factory("googleAnalyticsService",["$window","locationService","$rootScope",function(e,t,i){var o=[];i.$on("newConsulting",function(){o=[]});var s={resetEventsSentForConsulting:function(){o=[]},getTrackers:function(){var e=n.baseApplicationParameters.googleAnalyticsID;return e instanceof Array||(e=[]),e},getPage:function(){var e=location.pathname,n=t.getPath(),a=e;"/"!==n&&(a=a.replace(n,""));var i=r.getPathByIdAndLanguage(r.getId(),"en"),o=a+i;return o=o.replace("//","/")},sendPageView:function(){var t=this.getPage();this.getTrackers().forEach(function(n){a.debug("sending pageview event for tracker with name="+n.name+", page="+t),e.ga(n.name+".set","page",t),e.ga(n.name+".send","pageview",{page:t})})},sendEvent:function(t){var n=this.getPage();this.getTrackers().forEach(function(r){a.debug("sending event for tracker with name="+r.name+", category="+n+", action="+t),e.ga(r.name+".send","event",n,t)})},sendEventOnceByConsulting:function(e){for(var t=this.getPage(),n={eventCategory:t,eventAction:e},r=0;r<o.length;r++){var a=o[r];if(a.eventCategory===n.eventCategory&&a.eventAction===n.eventAction)return}o.push(n),this.sendEvent(e)}};return s}]),i}),define("common-color-tool-set",[],function(){"use strict";var e={};return e.colorComponentFromStr=function(e,t){var n=Math.max(0,parseInt(e,10));return t?Math.floor(255*Math.min(100,n)/100):Math.min(255,n)},e.rgbToHex=function(t){var n=/^rgb\(\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*\)$/,r="",a=n.exec(t);if(a){var i=e.colorComponentFromStr(a[1],a[2]),o=e.colorComponentFromStr(a[3],a[4]),s=e.colorComponentFromStr(a[5],a[6]);r="#"+(16777216+(i<<16)+(o<<8)+s).toString(16)}return r},e.hexToRgb=function(e){var t=e.substring(0,3).toUpperCase();if("RGB"===t)return e;e=0===e.indexOf("#")?e.substr(1,e.length):e;var n=parseInt(e,16),r=n>>16&255,a=n>>8&255,i=255&n;return"RGB("+r+","+a+","+i+")"},e.shadeColor=function(t,n){var r=0,a=0,i=0,o=t.substring(0,3).toUpperCase();if("RGB"===o){var s=/^rgb\(\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*\)$/,l=s.exec(t);l&&(r=e.colorComponentFromStr(l[1],l[2]),a=e.colorComponentFromStr(l[3],l[4]),i=e.colorComponentFromStr(l[5],l[6]))}else{var c=parseInt(t.slice(1),16);r=c>>16,a=c>>8&255,i=255&c}var u=0>n?0:255,d=0>n?-1*n:n;d/=100;var m=65536*(Math.round((u-r)*d)+r),g=256*(Math.round((u-a)*d)+a),f=Math.round((u-i)*d)+i;return"#"+(16777216+m+g+f).toString(16).slice(1)},e}),define("print-service",["angular","logger","parameters-manager","handlebars","common-color-tool-set","swag"],function(e,t,n,r,a){"use strict";var i=t.get("printService"),o=e.module("printServiceModule",[]);return o.factory("printService",["localize","$http","$q","$templateCache","authenticationService",function(e,t,o,s,l){var c=function(){Swag.registerHelpers(r),r.registerHelper("log",function(e){i.debug(e)}),r.registerHelper("resolvedEnumDescription",function(t,n,r){return e.getLocalizedEnumDescriptionByNumber(t,r)}),r.registerHelper("resolvedEnum",function(t,n,a){var i=!1;if("string"==typeof n&&(i=n.indexOf(".")>-1),void 0!==a&&"string"==typeof a){var o=r.compile(a,{noEscape:!0}),s=o(t);try{a=JSON.parse(s)}catch(l){throw new r.Exception("Error parsing placeholder: "+s)}}if(void 0===t.printTemplateEnum&&e.hasKey("Print."+n))return e.getLocalizedString("Print."+n,a);if(i&&e.hasKey(n))return e.getLocalizedString(n,a);if(e.hasKey(t.printTemplateEnum+"."+n))return e.getLocalizedString(t.printTemplateEnum+"."+n,a);if(e.hasKey("Print."+n))return e.getLocalizedString("Print."+n,a);throw new r.Exception("Key "+n+" not found.")}),r.registerHelper("isNotNull",function(e){return null!==e}),r.registerHelper("isNull",function(e){return null===e}),r.registerHelper("isDefined",function(e){return void 0!==e}),r.registerHelper("length",function(e){return void 0!==e?e.length:0}),r.registerHelper("getActiveLanguageCode",function(t){var n=e.getActiveLanguageCode();return n}),r.registerHelper("getActiveLanguageDescriptionFromArray",function(t){var n=e.getActiveLanguage();return void 0!==t?t[n]:""}),r.registerHelper("formatAmount",function(t){var n=Math.round(t);return e.getLocalizedString("GenericFormats.Amount",{VALUE:n,DECIMALS:0})}),r.registerHelper("formatCurrencyWithSymbol",function(t){var n=Math.round(t);return e.getLocalizedString("GenericFormats.CurrencyWithSymbol",{VALUE:n,DECIMALS:0})}),r.registerHelper("formatCurrencyWithSymbolWithConcatenatedPercentage",function(t,n){var r=Math.round(t);return e.getLocalizedString("GenericFormats.CurrencyWithSymbolWithConcatenatedPercentage",{VALUE:r,DECIMALS:0,VALUE_PERCENTAGE:n,DECIMALS_PERCENTAGE:2})}),r.registerHelper("labelWithConcatenatedPercentage",function(t,n){return e.getLocalizedString("GenericFormats.LabelWithConcatenatedPercentage",{LABEL:t,VALUE_PERCENTAGE:n,DECIMALS_PERCENTAGE:2})}),r.registerHelper("absValue",function(e){return Math.abs(e)}),r.registerHelper("negativeValue",function(e){return-e}),r.registerHelper("hexToRgb",function(e){return a.hexToRgb(e)}),r.registerHelper("getTipTypeIcon",function(e){return e===FinanceCoachInfoType.INFORMATION?"info":e===FinanceCoachInfoType.ADVANTAGE?"advantage":e===FinanceCoachInfoType.DISADVANTAGE?"disadvantage":e===FinanceCoachInfoType.EQUALITY?"equality":e===FinanceCoachInfoType.CONTACT?"contact":e===FinanceCoachPrintInfoType.LAW?"law":e===FinanceCoachPrintInfoType.CONSULTANT?"askconsultant":e===FinanceCoachPrintInfoType.DATASAFETY?"datasafety":void 0}),r.registerHelper("hideItemIfEmpty",function(e,t,n,a){var i=!1,o=r.compile(t);t=o(n).split(",");for(var s=0,l=t.length;l>s;++s){var c=t[s].trim();if(c===!0||Number(c)>0||isNaN(Number(c))&&c.length>0){i=!0;break}}return e===(!0).toString()&&i||e===(!1).toString()||void 0===e?a.fn(this):a.inverse(this)}),r.registerHelper("formatTicLabel",function(t){var n=Math.pow(10,1),r=Math.round(t/1e3*n)/n;return e.getLocalizedString("GenericFormats.Amount",{VALUE:r,DECIMALS:1})}),r.registerHelper("percentage",function(t,n){if(void 0===t||null===t||0===t.toString().length)return"";var r=Math.round(100*t)/100,a="number"==typeof n?n:2;return e.getLocalizedString("GenericFormats.Percentage",{VALUE:r,DECIMALS:a})}),r.registerHelper("integerPercentage",function(t){if(void 0===t||null===t||0===t.toString().length)return"";var n=Math.round(100*t)/100;return e.getLocalizedString("GenericFormats.Percentage",{VALUE:n,DECIMALS:0})}),r.registerHelper("nextArrayValue",function(e,t){return e[t+1]}),r.registerHelper("arrayValue",function(e,t){return e[t]}),r.registerHelper("multiLineText",function(e){return null===e||void 0===e||"string"!=typeof e?e:e=e.replace(/\n/g,"<br>")}),r.registerHelper("block-params",function(){for(var e=[],t=arguments[arguments.length-1],n=0;n<arguments.length-1;n++)e.push(arguments[n]);return t.fn(this,{data:t.data,blockParams:e})}),r.registerHelper("callPrototypeFunction",function(e,t){return e[t]()})},u=function(e){return t.get(e,{cache:s})},d=function(){return o.all([u("src/template/print/title-print-template.xml").then(function(e){r.registerPartial("TitleLocalized",e.data)}),u("src/template/print/header-title-print-template.xml").then(function(e){r.registerPartial("HeaderTitle",e.data)}),u("src/template/print/finance-coach-print-template.xml").then(function(e){r.registerPartial("FinanceCoach",e.data)}),u("src/template/print/item-print-template.xml").then(function(e){r.registerPartial("Item",e.data)}),u("src/template/print/tips-print-template.xml").then(function(e){r.registerPartial("Tips",e.data)}),u("src/template/print/serie-items-print-template.xml").then(function(e){r.registerPartial("SerieItems",e.data)}),u("src/template/print/y-axis-print-template.xml").then(function(e){r.registerPartial("YAxis",e.data)}),u("src/template/print/x-axis-print-template.xml").then(function(e){r.registerPartial("XAxis",e.data)}),u("src/template/print/event-list-print-template.xml").then(function(e){r.registerPartial("EventList",e.data)}),u("src/template/print/additional-printing-data.xml").then(function(e){r.registerPartial("AdditionalPrintingData",e.data)})])},m=function(){return c(),d()},g=!1,f={registerTemplate:function(e,t){u(t).then(function(t){r.registerPartial(e,t.data)})},print:function(e,a,s,c,u){var d;return d=g?o.when():m().then(function(){g=!0}),d.then(function(){var d,m=o.defer();try{var g=r.compile(e);d=g(s)}catch(f){return i.error("Handlbars error: "+f),m.reject({status:PrintServiceResultStatus.PREPARATIONERROR}),m.promise}return t({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:n.baseApplicationParameters.printServiceURL+"/getPrint",params:{printTemplateName:a,printDocName:n.baseApplicationParameters.printDocName,customization:n.baseApplicationParameters.printCustomization,userId:l.getUserLogged(),fileOutputName:c,keyPrefixOutputDir:u},responseType:"arraybuffer",cache:!1,headers:{"Content-Type":"text/xml; charset=utf-8"},data:d}).success(function(e,t,n,r){if(204===t)return void m.reject({status:PrintServiceResultStatus.NOCONTENT});if(0===e.byteLength)return void m.reject({status:PrintServiceResultStatus.NOCONTENT});var a=new Blob([e],{type:"application/pdf"});m.resolve({status:PrintServiceResultStatus.OK,content:a})}).error(function(e,t,n,r){m.reject({status:PrintServiceResultStatus.SERVERERROR})}),m.promise})}};return f}]),o}),define("file-service",["angular","logger","parameters-manager","handlebars","common-color-tool-set","swag"],function(e,t,n,r,a){"use strict";var i=t.get("fileService"),o=e.module("fileServiceModule",[]);return o.factory("fileService",["localize","$http","$q","$templateCache",function(e,t,a,o){var s=function(){Swag.registerHelpers(r),r.registerHelper("fs-multiLineText",function(e){return null===e||void 0===e||"string"!=typeof e?e:e=e.replace(/\n/g,"<br>")})},l=function(e){return t.get(e,{cache:o})},c=function(){s()},u=!1,d={registerTemplate:function(e,t){l(t).then(function(t){r.registerPartial(e,t.data)})},saveCSV:function(e,r,i,o){u||(c(),u=!0);var s=a.defer();return t({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:n.baseApplicationParameters.fileServiceURL+"/save",params:{fileOutputName:r,fileOutputEncoding:i,keyPrefixOutputDir:o},responseType:"arraybuffer",cache:!1,headers:{"Content-Type":"text/xml; charset=utf-8"},data:e}).success(function(e,t,n,r){s.resolve({status:FileServiceResultStatus.OK})}).error(function(e,t,n,r){s.reject({status:FileServiceResultStatus.SERVERERROR})}),s.promise},save:function(e,o,s,l,d){u||(c(),u=!0);var m,g=a.defer();try{var f=r.compile(e);m=f(o)}catch(h){return i.error("Handlbars error: "+h),g.reject({status:FileServiceResultStatus.PREPARATIONERROR}),g.promise}return t({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:n.baseApplicationParameters.fileServiceURL+"/save",params:{fileOutputName:s,fileOutputEncoding:l,keyPrefixOutputDir:d},responseType:"arraybuffer",cache:!1,headers:{"Content-Type":"text/xml; charset=utf-8"},data:m}).success(function(e,t,n,r){g.resolve({status:FileServiceResultStatus.OK})}).error(function(e,t,n,r){g.reject({status:FileServiceResultStatus.SERVERERROR})}),g.promise},packageFileList:function(e,r,i){u||(c(),u=!0);var o=a.defer();return t({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:n.baseApplicationParameters.fileServiceURL+"/packageFileList",params:{fileOutputName:r,keyPrefixOutputDir:i},responseType:"arraybuffer",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(e)}).success(function(e,t,n,r){o.resolve({status:FileServiceResultStatus.OK})}).error(function(e,t,n,r){o.reject({status:FileServiceResultStatus.SERVERERROR})}),o.promise}};return d}]),o}),define("product-list-service",["angular","logger","parameters-manager","common-object-utilities"],function(e,t,n,r){"use strict";function a(e){var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=e[n],t.$$hashKey="",null!==t&&"object"==typeof t&&a(t);else{Object.preventExtensions(e);for(var r in e)t=e[r],null!==t&&"object"==typeof t&&a(t)}}var i=t.get("productListService"),o=(new r,e.module("productListServiceModule",[]));return o.factory("productListService",["$http","$q",function(e,t){var r={requestsArray:[],deferredArray:[],getServiceURL:function(){return n.baseApplicationParameters.productListServiceURL+"/"+n.baseApplicationParameters.productListCustomization},getProductList:function(e){return i.debug("getProductList called"),n.baseApplicationParameters.productListServiceURL?this.getServerProductList(e):this.getLocalProductList(e)},getLocalProductList:function(e){var r=t.defer(),i=JSON.parse(JSON.stringify(n.baseModelParameters[e]));return a(i),r.resolve({status:0,list:i}),r.promise},getServerProductList:function(r){var i=t.defer(),o=this.getServiceURL()+"/getProductList?id="+r,s=this;return e({timeout:n.baseApplicationParameters.httpTimeout,method:"GET",url:o,responseType:"json",cache:!0,headers:{"Content-Type":"application/json; charset=utf-8"}}).success(function(e,t,n,r){var o=e.response;a(o),i.resolve({status:0,list:o})}).error(function(e,t,n,a){return 404===t||-1===t?s.getLocalProductList(r).then(function(e){i.resolve({status:t,list:e.list})}):void i.reject({status:t})}),i.promise},getSelectedOptionFromCode:function(e,t){var n=e.filter(function(e){return e.code===t});return n.length>0?n[0]:null},getInitializeOptionsAndSelected:function(e,t,n,r){if(e.length>0){if(null!==n&&void 0!==n&&(n=this.getSelectedOptionFromCode(e,n.code)),null===n||void 0===n){var a=e.filter(function(e){return e.code===t});n=a.length>0?a[0]:e[0]}}else e=[r],n=r;return{options:e,selected:n}}};return r}]),o}),define("zip-and-location-service",["angular","logger","common-object-utilities","parameters-manager","calculator-service"],function(e,t,n,r){"use strict";var a=(t.get("ZipAndLocationService"),t.get("AsynchronousModeProfile")),i=new n,o=e.module("zipAndLocationServiceModule",[]);return o.factory("zipAndLocationService",["calculatorService","$q","localize",function(e,t,n){var o=function(){var e=n.getActiveLanguage().toUpperCase();return"DE"===e?1:"FR"===e?2:"IT"===e?3:0},s=function(){return n.isCountryCh()?756:n.isCountryLi()?438:0},l=function(n){if(void 0===n){var r=t.defer();return r.resolve([]),r.promise}return e.sendRequest(n).then(function(e){return c(e[0].response)})},c=function(e){var t;for(t=0;t<e.length;t++)e[t].zipAndLocation=e[t].zip+" "+e[t].city,i.protect(e[t]);return e},u=function(e){void 0===e&&(e=!0);var t;return t=e?s():void 0},d=function(e){var t=c(e);return t.length>0?t[0]:null},m=function(e){var t;for(t=0;t<e.length;t++)a.debug("ZipAndLocationService - searchMoreImportantLocationPromise - locations "+t+" : "+JSON.stringify(e[t]));var n=c(e);for(t=0;t<n.length;t++)a.debug("ZipAndLocationService - searchMoreImportantLocationPromise - taxLocations "+t+" : "+JSON.stringify(n[t]));if(n.length>0){var r=999999999,i=null;for(t=0;t<n.length;t++){var o=n[t];o.id<r&&(r=o.id,i=o)}return i}return null},g={searchLocations:function(e,t){if(""!==e){var n={calculatorName:"ch.logismata.rpopulaires.calc",calculationName:"searchLocations",calculationParameters:[e,o(),u(t)]};return l(n)}},searchLocationsAround:function(e,t,n,r){var a={calculatorName:"ch.logismata.rpopulaires.calc",calculationName:"searchLocationsAround",calculationParameters:[e,t,n,o(),u(r)]};return l(a)},getActiveCountryLocationDefault:function(){return r.baseModelParameters.locationDefault[n.getActiveCountry().toLowerCase()]},getActiveCountryLocationChangeDefault:function(){return r.baseModelParameters.locationChangeDefault[n.getActiveCountry().toLowerCase()]},searchMoreImportantLocationPromise:function(n,r){if(""===n)return t.when(null);var a={calculatorName:"ch.logismata.rpopulaires.calc",calculationName:"searchLocations",calculationParameters:[n,o(),u(r)]};return e.addRequest(a).then(function(e){return d(e)})},searchMoreImportantLocation:function(e,t){if(""!==e){var n={calculatorName:"ch.logismata.rpopulaires.calc",calculationName:"searchLocations",calculationParameters:[e,o(),u(t)]};return l(n).then(function(e){return m(e)})}}};return g}]),o}),define("basket-service",["angular","logger"],function(e,t){"use strict";var n=(t.get("basketService"),e.module("basketServiceModule",[]));return n.factory("basketService",[function(){var e={},t={containsItem:function(t){return e.hasOwnProperty(t)},addItem:function(t,n){e[t]=n},getItem:function(t){var n=null;return this.containsItem(t)&&(n=e[t]),n},consumeItem:function(t){var n=null;return this.containsItem(t)&&(n=e[t],delete e[t]),n},clear:function(){e={}}};return t}]),n}),define("media-service",["angular","logger","parameters-manager"],function(e,t,n){"use strict";var r=(t.get("mediaService"),e.module("mediaServiceModule",[]));return r.factory("mediaService",["$http","$q",function(e,t){var r={getServiceURL:function(){return n.baseApplicationParameters.mediaServiceURL+"/"+n.baseApplicationParameters.mediaCustomization},getMedia:function(r){var a=t.defer(),i=this.getServiceURL()+"/getMedia";return e({timeout:n.baseApplicationParameters.httpTimeout,method:"POST",url:i,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:{userId:r}}).success(function(e,t,n,r){a.resolve({status:MediaServiceGetResultStatus.SUCCEEDED,data:e.media})}).error(function(e,t,n,r){var i;404===t?i=MediaServiceGetResultStatus.MEDIANOTFOUND:400===t&&(i=MediaServiceGetResultStatus.FAILED),a.reject({status:i})}),a.promise},updateMedia:function(r,a,i){var o=t.defer(),s=this.getServiceURL()+"/updateMedia",l={userId:r,fileName:a,image:i};return e({timeout:n.baseApplicationParameters.httpTimeout,method:"PUT",url:s,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:{media:l}}).success(function(e,t,n,r){o.resolve({status:MediaServiceUpdateResultStatus.SUCCEEDED})}).error(function(e,t,n,r){var a;a=404===t?MediaServiceUpdateResultStatus.USERNOTFOUND:MediaServiceUpdateResultStatus.FAILED,o.reject({status:a})}),o.promise}};return r}]),r}),define("statistics-service",["angular","logger","parameters-manager","authentication-service"],function(e,t,n){
"use strict";var r=(t.get("statisticsService"),e.module("statisticsServiceModule",[]));return r.factory("statisticsService",["$http","$q","authenticationService",function(e,t,r){var a={getServiceURL:function(){return n.baseApplicationParameters.statisticsServiceURL+"/"+n.baseApplicationParameters.statisticsCustomization},logStatistic:function(r,a){var i=t.defer(),o=this.getServiceURL()+"/insertStatistic";return a.event=r,e({timeout:n.baseApplicationParameters.httpTimeout,method:"PUT",url:o,responseType:"json",cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"},data:{statistics:a}}).success(function(e,t,n,r){i.resolve({status:StatisticsServiceInsertStatisticResultStatus.SUCCEEDED})}).error(function(e,t,n,r){var a;400===t&&(a=StatisticsServiceInsertStatisticResultStatus.FAILED),i.reject({status:a})}),i.promise}};return a}]),r}),define("log-statistics-service",["angular","logger","parameters-manager","google-analytics-service","statistics-service"],function(e,t,n){"use strict";var r=(t.get("logStatisticsService"),e.module("logStatisticsServiceModule",[]));return r.factory("logStatisticsService",["statisticsService","googleAnalyticsService",function(e,t){var r={sendEvent:function(r,a){t.sendEvent(r),n.baseApplicationParameters.consultantMode&&e.logStatistic(r,a)},sendEventOnceByConsulting:function(r,a){t.sendEventOnceByConsulting(r),n.baseApplicationParameters.consultantMode&&e.logStatistic(r,a)}};return r}]),r}),define("location-service",["angular","logger"],function(e,t){"use strict";var n=(t.get("locationService"),e.module("locationServiceModule",[]));return n.factory("locationService",["$location",function(e){var t=e,n={absUrl:function(){return t.absUrl()},getUrl:function(){return t.url()},setUrl:function(e){return t.url(e),window.parent!==window&&t.replace(),this},protocol:function(){return t.protocol()},host:function(){return t.host()},port:function(){return t.port()},getPath:function(){return t.path()},setPath:function(e){return t.path(e),window.parent!==window&&t.replace(),this},getSearch:function(){return t.search()},setSearch:function(e,n){return n?t.search(e,n):t.search(e),window.parent!==window&&t.replace(),this},getHash:function(){return t.hash()},setHash:function(e){return t.hash(e),this},replace:function(){return t.replace(),this},getState:function(){return t.state()},setState:function(e){return t.state(e),this},clearSearch:function(){this.setSearch({})}};return n}]),n}),define("tab-selector",[],function(){"use strict";return function(e){return e.component("tabSelector",{transclude:!0,bindings:{},templateUrl:"src/directives/tab-selector/tab-selector.html",controller:["$timeout",function(e){}]})}}),define("tab-selector-link",[],function(){"use strict";return function(e){return e.component("tabSelectorLink",{bindings:{id:"@",title:"@",isSelected:"&",onSelected:"&"},templateUrl:"src/directives/tab-selector-link/tab-selector-link.html",controller:["$timeout",function(e){var t=this;void 0!==t.id&&t.id.length>0?t.fieldId=t.id.replace(/\./g,"_"):t.fieldId="",t.fieldId+="TabSelectorLink"}]})}}),define("topic-chooser",[],function(){"use strict";return function(e){return e.component("topicChooser",{transclude:!0,bindings:{collapsedLabel:"@",showTopicContent:"=",chooserId:"@"},templateUrl:"src/directives/topic-chooser/topic-chooser.html",controller:["$timeout",function(e){this.has4VisibleLinks=function(){var e=document.getElementById(this.chooserId+"TopicChooser");if(null!==e){for(var t=e.getElementsByTagName("topic-link"),n=[],r=0;r<t.length;r++)null!==t[r].firstElementChild&&n.push(t[r]);return 4===n.length}return!1}}]})}}),define("topic-link",[],function(){"use strict";return function(e){return e.component("topicLink",{bindings:{topicId:"@",collapsedLabel:"@",expandedLabel:"@",titleLabel:"@",descriptionLabel:"@",selectedClass:"@",unselectedClass:"@",available:"=?",showTopicContent:"=?",isSelected:"&",onSelected:"&"},templateUrl:"src/directives/topic-link/topic-link.html",controller:["$timeout",function(e){var t=this;void 0===t.showTopicContent&&(t.showTopicContent=!0),void 0===t.available&&(t.available=!0),void 0!==t.topicId&&t.topicId.length>0?t.fieldId=t.topicId.replace(/\./g,"_"):t.fieldId="TopicLink",t.collapsedId="home"+t.fieldId.charAt(0).toUpperCase()+t.fieldId.slice(1),t.linkId=t.fieldId,t.onClicked=function(){t.showTopicContent=!0,t.onSelected()}}]})}}),define("topic-panel",[],function(){"use strict";return function(e){return e.component("topicPanel",{transclude:!0,bindings:{title:"@",footer:"@",showBallonSeparator:"="},templateUrl:"src/directives/topic-panel/topic-panel.html",controller:["$timeout",function(e){}]})}}),define("common-donut-chart",["base-chart","logger"],function(e,t){var n=t.get("DonutChart"),r=function(){this.create=function(t,r){n.debug("Creating donut chart for "+t);var a=(new e).createChart(t,r);return a.options={series:{pie:{radius:.99,innerRadius:.74,label:{show:!1},show:!0,offset:{left:0}}},legend:{show:!1}},a.addSet=function(e,t,n,r){var a={label:e,data:n,color:t,order:r};r&&(this.animator.setSortSets(!0),this.animator.sortAtEachStep=!0),this.sets.push(a)},a.createDrawObjectForCurrentState=function(){return{xychart:!1,previousSets:$.extend(!0,[],this.previousSets),newSets:$.extend(!0,[],this.sets),previousColumns:0,columns:0,maintainScale:!0}},a.createPlot=function(e){return $.plot(this.id,e,this.options)},a}};return r}),define("donut-graph",["parameters-manager","logger","common-donut-chart","common-currency-formatter"],function(e,t,n,r){"use strict";var a=t.get("DonutGraph");return function(t){return t.component("donutGraph",{bindings:{id:"@",bridge:"=",size:"@",innerText:"@",secondaryText:"@"},templateUrl:"src/directives/graphs/donut-graph/donut-graph.html",controller:[function(){a.debug("START DONUT GRAPH");var t=this;void 0!==t.id&&t.id.length>0?t.fieldId=t.id.replace(/\./g,"_"):t.fieldId="",t.canvasId=t.fieldId+"DonutCanvas",t.bridge.update=function(){a.debug("UPDATE: "+t.canvasId),t.refreshHandler.update()},t.bridge.forceDraw=function(){a.debug("FORCE DRAW: "+t.canvasId),t.refreshHandler.forceDraw()},t.bridge.getVisibleRefreshHandlers=function(){return[t.refreshHandler]},t.getDonutChart=function(){return t.donutChart||(t.donutChart=(new n).create(t.canvasId,new r(e.baseViewParameters.groupDelimiter,e.baseViewParameters.amountDecimalDelimiter,e.baseViewParameters.useMixedGroupingSeparator))),t.donutChart},t.getSizeClass=function(){return void 0===t.size||""===t.size?"":"donut-graph__canvas--"+t.size},t.getInnerTextClass=function(){var e=t.size;return(void 0===t.size||""===t.size)&&(e="medium"),"donut-graph__text--"+e},t.getInnerSecondaryTextClass=function(){var e=t.size;return(void 0===t.size||""===t.size)&&(e="medium"),"donut-graph__secondary-text--"+e};var i=t.bridge.createChartUpdater(t.getDonutChart(),function(e){e.clearSets(),t.bridge.updateChart(e)});t.refreshHandler=t.bridge.createRefreshHandler(t.canvasId,i)}]})}}),define("common-series-utilities",["logger","common-object-utilities"],function(e,t){"use strict";function n(e,t){r(e,t);for(var n=[],a=0,i=0;i<e.length;i++){var o,s=e[i];o=[a,s.begin],n.push(o),a++,o=[a,s.end],n.push(o)}return n}function r(e,t){for(var n=!1,r=0;r<e.length;r++){var a=e[r];if(n&&null===a.begin){h.debug("INVALID NULL ARRANGEMENT AT INDEX "+r);var i=e[r-1];i.end=t?null:0;break}n=null!==a.begin&&null===a.end}}function a(e,t){h.debug("Creating set for "+e.name);var r;return r=e.isLine?{label:e.name,order:e.order,data:n(e.values,t),color:e.color,stack:!1,lines:{show:!0,fill:!1,steps:!1,lineWidth:e.lineThickness}}:{label:e.name,order:e.order,data:n(e.values,t),color:e.color}}function i(e,t){h.debug("Creating set for wrapper set "+e.label);var r;return r={label:e.label,order:e.order,data:n(e.data,t),color:e.color,stack:e.stack,lines:e.lines}}function o(e){var t;t={label:"zeroes",order:1234,data:[],color:"whatever"};for(var n=0,r=0;e>r;r++){var a;a=[n,0],t.data.push(a),n++,a=[n,0],t.data.push(a)}return t.stack=!0,t.lines={show:!1},t.bars={show:!1},t}function s(e){var t;t={label:"zeroes",order:1234,data:[],color:"whatever"};for(var n=0;n<e.data.length;n++){var r,a=e.data[n];r=[a[0],0],t.data.push(r)}return t.stack=!0,t.lines={show:!1},t.bars={show:!1},t}function l(e,t){h.debug("Creating wrapper set for "+e.name),void 0===e.name&&h.error("serie has no name!");var n;n=e.isLine?{label:e.name,order:e.order,data:[],color:e.color,stack:!1,lines:{show:!0,fill:!1,steps:!1,lineWidth:e.lineThickness}}:{label:e.name,order:e.order,data:[],color:e.color},n.wrapper=!0;for(var r=0;r<e.values.length;r++){var a,i=e.values[r];a={begin:i.begin,end:i.end},n.data.push(a)}return h.debug("   Wrapper set: "+JSON.stringify(n)),n}function c(e){h.debug("------------------------------------------------------");var t=[];if(e.representationList)t=e.representationList;else for(var n=0,r=0,a=0;a<e.length;a++){for(var i=e[a],o=i.widthPercentage/i.duration,s=0;s<i.duration;s++){var l={};l.fromPercentage=n+s*o,l.toPercentage=n+(s+1)*o,l.itemIndex=r,t.push(l),h.debug(r+": "+s+" from: "+l.fromPercentage+" to: "+l.toPercentage),r++}n+=i.widthPercentage,e.representationList=t}return t}function u(e,t,n,r){var a,i=e,o=m(i,t,r);if(o){var s=n.values[o.itemIndex].begin,l=n.values[o.itemIndex].end,c=i-o.fromPercentage,u=o.toPercentage-i;null===s&&null===l?a=null:null!==s&&null===l||null===s&&null!==l?(p.debug("DOUBT on "+n.label+"["+o.itemIndex+"] between "+s+" and "+l),a=u>=c?s:l):a=i===o.fromPercentage?s:i===o.toPercentage?l:(i-o.fromPercentage)/(o.toPercentage-o.fromPercentage)*(l-s)+s,p.debug("---> translating serie "+n.name+": [index= "+o.itemIndex+" begin="+s+" end="+l+"] ==> [ value="+a+"]")}else p.error("ERROR: no representation found for percentage "+i),a=-1;return a}function d(e,t,n){var r={};return p.debug("---> translating serie "+n.name+" index "+e.itemIndex),r.begin=u(e.fromPercentage,t,n,!1),r.end=u(e.toPercentage,t,n,!0),p.debug("     result: begin="+r.begin+" end="+r.end),r}function m(e,t,n){for(var r,a=0;a<t.length;a++){var i=t[a];if(n&&e===i.fromPercentage)return r;if(e>=i.fromPercentage&&e<i.toPercentage)return i;r=i}return r&&e<=r.toPercentage?r:void 0}function g(e,n){var r=[],a=new t;if(a.equals(e,n))p.debug("mergeRepresentations: firstRepresentationList and secondRepresentationList are equals"),r=e;else{p.debug("mergeRepresentations: ");for(var i=0,o=0,s=0,l=0,c=!1;!c;){var u=e[i],d=n[o],m={fromPercentage:l,toPercentage:0,itemIndex:s};u.toPercentage===d.toPercentage?(m.toPercentage=u.toPercentage,i++,o++):u.toPercentage>d.fromPercentage&&u.toPercentage<d.toPercentage?(m.toPercentage=u.toPercentage,i++):(m.toPercentage=d.toPercentage,o++),l=m.toPercentage,r.push(m),s++,p.debug(m.itemIndex+":  from: "+m.fromPercentage+" to: "+m.toPercentage),c=100===m.toPercentage}}return r}function f(e,t){for(var n=0,r=0;r<t.length;r++){for(var a=t[r],i=0,o=0;o<e.length;o++){var s=e[o],l=a.widthPercentage+n;(s.toPercentage===l||s.toPercentage>n&&s.toPercentage<l)&&i++}a.duration=i,n+=a.widthPercentage}return t}var h=e.get("SeriesUtilities"),p=e.get("SeriesUtilitiesDetail"),v=function(e){this.asSteps=e};return v.prototype.getSetsFromSeries=function(e,t){var n,r,i=[];t=void 0===t?!0:t;for(var s=0;s<e.length;s++)r=e[s],n=a(r,this.asSteps),i.push(n),t&&i.push(o(r.values.length));return i},v.prototype.normalizeSets=function(e){for(var t,n=[],r=0;r<e.length;r++)t=e[r],n.push(t),n.push(s(t));return n},v.prototype.getWrapperSetsFromSeries=function(e){for(var t,n,r=[],a=0;a<e.length;a++)n=e[a],t=l(n,this.asSteps),r.push(t);return r},v.prototype.getSetsFromWrapperSets=function(e){for(var t,n,r=[],a=0;a<e.length;a++)n=e[a],t=i(n,this.asSteps),r.push(t),r.push(o(n.data.length));return r},v.prototype.translateSeries=function(e,t,n){p.debug("--------------------------------------------------------------------------------------"),p.debug("TRANSLATING PREVIOUS SERIES"),p.debug("");for(var r,a=c(t),i=c(n),o=[],s=0;s<e.length;s++){var l=e[s],u={name:l.name,order:l.order,color:l.color,isLine:l.isLine,lineThickness:l.lineThickness,values:[]};p.debug("TRANSLATING SERIE"+l.order);for(var m=0;m<l.values.length;m++){var g=l.values[m];p.debug("        "+m+": "+JSON.stringify(g))}for(var f=0;f<i.length;f++){r=i[f];var h=d(r,a,l);u.values.push(h)}o.push(u),p.debug("Original: "+JSON.stringify(l)),p.debug("Translated: "+JSON.stringify(u)),p.debug("")}return o},v.prototype.hasSerieNullValues=function(e){for(var t=!1,n=0;n<e.values.length;n++)if(null===e.values[n].begin||null===e.values[n].end){t=!0;break}return t},v.prototype.getMaxSerieValue=function(e){for(var t=0,n=0;n<e[0].values.length;n++){var r,a,i=0,o=0;for(r=0;r<e.length;r++)a=e[r],a.isLine||(i+=a.values[n].begin,o+=a.values[n].end);for(i>t&&(t=i),o>t&&(t=o),r=0;r<e.length;r++)a=e[r],a.isLine&&(a.values[n].begin>t&&(t=a.values[n].begin),a.values[n].end>t&&(t=a.values[n].end))}return t},v.prototype.getMinSerieValue=function(e){for(var t=0,n=0;n<e[0].values.length;n++){var r,a,i=0,o=0;for(r=0;r<e.length;r++)a=e[r],a.isLine||(i+=a.values[n].begin,o+=a.values[n].end);for(t>i&&(t=i),t>o&&(t=o),r=0;r<e.length;r++)a=e[r],a.isLine&&(a.values[n].begin<t&&(t=a.values[n].begin),a.values[n].end<t&&(t=a.values[n].end))}return t},v.prototype.mergeTimePeriods=function(e,t){var n=c(e),r=c(t),a=g(n,r),i=f(a,$.extend(!0,[],t));return i.representationList=a,i},v}),define("common-bar-chart-delegate",["common-series-utilities","logger"],function(e,t){function n(e,t){a.debug("------------------------------------------------------"),a.debug(t);for(var n=0,r=0;r<e.length;r++){var i=e[r],o=n+i.duration;a.debug(i.id+": ("+n+" - "+(o-1)+") duration="+i.duration+" label="+i.label+" width %="+i.widthPercentage),n=o}}var r=t.get("BarChartDelegate"),a=t.get("BarChartDelegateDetail"),i=function(e){this.chart=e};return i.prototype.createSets=function(t){var n=new e(!this.chart.smoothing),r=n.getWrapperSetsFromSeries(t);return r},i.prototype.createDrawObjectForCurrentState=function(){n(this.chart.previousTimePeriods,"Previous time periods"),n(this.chart.timePeriods,"New time periods");var t=[];this.chart.previousOptions&&(t=this.chart.previousOptions.yaxis.ticks);var a,i,o,s,l=this.chart.previousSets,c=this.chart.previousColumns,u=new e(!this.chart.smoothing);a=u.mergeTimePeriods(this.chart.previousTimePeriods,this.chart.timePeriods),i=u.translateSeries(this.chart.previousSeriesValues,this.chart.previousTimePeriods,a),o=u.translateSeries(this.chart.series,this.chart.timePeriods,a);for(var d=0,m=0;m<a.length;m++)d+=a[m].duration;c=d,l=u.getWrapperSetsFromSeries(i),s=u.getWrapperSetsFromSeries(o),this.chart.animator.animateRescaleX=!1,l[0].data.length!==c&&console.error("MISMATCH IN COLUMNS. INFORMED: "+c+" REAL: "+l[0].data.length),r.debug("Generating translated previous sets...");var g=u.getSetsFromSeries(i);return r.debug("TRANSLATED PREVIOUS SETS: "+JSON.stringify(g)),{xychart:!0,previousSets:$.extend(!0,[],l),measurementSets:$.extend(!0,[],this.chart.previousSets),newSets:$.extend(!0,[],s),previousMax:this.chart.previousMax,max:this.chart.max,previousColumns:c+1,columns:d+1,previousTicks:t,newTicks:this.chart.options.yaxis.ticks,previousTimePeriods:$.extend(!0,[],this.chart.previousTimePeriods),timePeriods:$.extend(!0,[],a),series:$.extend(!0,[],o),translatedPreviousSeries:i}},i.prototype.createPlot=function(t){var n,a=new e(!this.chart.smoothing),i=a.getSetsFromSeries(this.chart.series,!0);return this.chart.interactivity.configureOptions(this.chart.options),r.debug("createPlot: sets for drawing: "+JSON.stringify(i)),n=$.plot($(this.chart.id),i,this.chart.options),this.chart.drawLabels(n),this.chart.interactivity.setMaximumX(this.chart.columnMode?this.chart.columns:this.chart.columns-1),this.chart.interactivity.activate(n),n},i.prototype.getSetsForDrawing=function(){return this.chart.sets},i.prototype.getSetsForMeasurement=function(e){return e.measurementSets},i.prototype.getTicks=function(e){return this.chart.calculateVerticalTicks(this.chart.columns,e,this.chart.max,this.chart.timePeriods)},i.prototype.beforeDrawing=function(){this.chart.pendingDraw&&(r.debug("Dispatching pending draw "+this.chart.pendingDraw.id),this.chart._setTimePeriods(this.chart.pendingDraw.timePeriods),this.chart._setValues(this.chart.pendingDraw.values),this.chart._setEndingLabel(this.chart.pendingDraw.endingLabel),this.chart.prepare(),this.chart.pendingDraw=null),this.chart.xAxisTransformationHash!==this.chart.calculateHash(this.chart.previousTimePeriods)&&(a.debug("use PREVIOUS time periods"),this.chart.calculateXAxisTransformation(this.chart.previousTimePeriods),this.chart.options.xaxis.max=this.chart.previousColumns,this.chart.calculateHorizontalTicks(this.chart.previousTimePeriods),this.chart.calculateMarkings(this.chart.previousTimePeriods))},i.prototype.onDrawFromScratch=function(e,t){var n=this.chart.timePeriods,r=this.chart.columns;this.chart.xAxisTransformationHash!==this.chart.calculateHash(n)&&(a.debug("use NEW time periods (drawing from scratch)"),this.chart.calculateXAxisTransformation(n),this.chart.options.xaxis.max=r,this.chart.calculateHorizontalTicks(n),this.chart.calculateMarkings(n)),this.chart.autoCalculateTicks&&this.chart.autocalculateHorizontalTicks()},i.prototype.onSetAnimationStarting=function(e){a.debug("STARTING SET ANIMATION!")},i.prototype.onRedraw=function(t,n,i,o){if(!o){var s=i?i.timePeriods:this.chart.timePeriods,l=i?i.columns-1:this.chart.columns;this.chart.xAxisTransformationHash!==this.chart.calculateHash(s)&&(a.debug("use NEW time periods"),this.chart.calculateXAxisTransformation(s),n.getOptions().xaxis.max=l,n.getAxes().xaxis.max=l,n.getAxes().xaxis.options.max=l,this.chart.autoCalculateTicks&&i?this.chart.removeHorizontalTicks():this.chart.calculateHorizontalTicks(s),this.chart.calculateMarkings(s)),n.getOptions().grid.markings=this.chart.options.grid.markings,void 0!==this.chart.options.xaxis.ticks&&n.getOptions().xaxis.ticks&&n.getOptions().xaxis.ticks.length!==this.chart.options.xaxis.ticks.length&&a.debug("xaxis changed from "+n.getOptions().xaxis.ticks.length+" to "+this.chart.options.xaxis.ticks.length),n.getOptions().xaxis.ticks=this.chart.options.xaxis.ticks,n.getOptions().xaxes[0].ticks=this.chart.options.xaxis.ticks,this.chart.drawLabels(n),r.debug("onRedraw - animation step "+this.chart.animator.smoothCurrentStep);for(var c=0;c<t.length;c++){var u=t[c];u.wrapper||console.error("This is not a wrapper set! "+u.label)}var d=new e(!this.chart.smoothing),m=d.getSetsFromWrapperSets(t);return r.debug("onRedraw: sets for drawing: "+JSON.stringify(m)),m}},i.prototype.hasExtraChanges=function(e){if(e.previousTimePeriods.length!==e.timePeriods.length)return r.debug("HAS EXTRA CHANGES: number of time periods"),!0;for(var t,n,a=0;a<e.previousTimePeriods.length;a++)if(t=e.previousTimePeriods[a],n=e.timePeriods[a],t.duration!==n.duration||t.widthPercentage!==n.widthPercentage||t.label!==n.label)return r.debug("HAS EXTRA CHANGES: time period content"),!0;return!1},i.prototype.fillDifferenceSet=function(e,t,n,r,i){function o(e,t){if(null===t&&null===e)return null;var n=t-e;return n/r}e._hasChanges=!1,e._needsAnimation=!1;for(var s=0;s<t.data.length;s++){var l=t.data[s],c=n.data[s];l&&c||console.error("One of the items are undefined!");var u=o(l.begin,c.begin),d=o(l.end,c.end);e.data.push({begin:u,end:d}),(0!==u&&null!==u||0!==d&&null!==d)&&(e._hasChanges=!0,e._needsAnimation=!0)}a.debug("===> DIFFERENCE SET: "+JSON.stringify(e))},i.prototype.fillAnimationStepSet=function(e,t,n,r,a){for(var i=0;i<t.data.length;i++){var o=t.data[i],s=n.data[i],l=this.chart.animator.calculateAnimationStepValue(o.begin,s.begin,r),c=this.chart.animator.calculateAnimationStepValue(o.end,s.end,r);e.data.push({begin:l,end:c})}return e},i.prototype.fillRescaleXStepSet=function(e,t,n,r){for(var a=0;r>a;a++){var i=n.data[a];e.data.push({begin:i.begin,end:i.end})}},i.prototype.getSetsForScaleMesurement=function(t){var n=t,r=t[0];if(void 0!==r&&r.wrapper){var a=new e(!this.chart.smoothing);n=a.getSetsFromWrapperSets(t)}return n},i}),define("common-bar-chart",["base-bar-chart","common-bar-chart-delegate","common-series-utilities","logger"],function(e,t,n,r){var a=r.get("BarChart"),i=r.get("BarChartDetail"),o=function(){this.createBarChart=function(r,o){function s(e){for(var t=0;t<e.length;t++)i.debug(JSON.stringify(e[t])),i.debug("-------------------------------------------------------")}function l(e){i.debug("TESTING CHART"),i.debug("");var t=new n(!d.smoothing);void 0===e&&(e=d.series),i.debug("Series:"),s(e),i.debug("Columns: "+d.columns);var r=t.getSetsFromSeries(e,!0);return i.debug("Sets:"),s(r),$.plot($(d.id),r,d.options),"done."}function c(e){var t=$.plot($(d.id),e,d.options);return d.drawLabels(t),"done ("+e.length+" sets)"}function u(){return i.debug("TESTING CHART (RESET)"),i.debug(""),i.debug("Sets:"),s(d.sets),d.resetDrawing(),"done."}var d=(new e).createChart(r,!0,o);return d.previousSeriesValues=[],d.timePeriods=[],d.previousTimePeriods=[],d.topMargin=20,d.topValueFactor=1,d.endingLabel=null,d.smoothing=!1,d.pendingDraw=null,d.autoCalculateTicks=!1,d.showXAxis=!0,d.columnMode=!1,d.xAxisTransformationHash=0,d.xAxisTransformation=[],d.xAxisInverseTransformation=[],d.columns=0,d.previousColumns=0,d.titles=[],d.previousTitles=[],d.labelElements=[],d.delegate=new t(d),d.animator.delegate=d.delegate,d.localize=null,i.debug("INITIALIZING CHART "+r),void 0===document.testSeries&&"alternativeIncomeDevelopmentCanvas"===r&&(document.testSeries=l,document.testSets=c,document.testReset=u),d.interactivity.setMinimumX(0),d.interactivity.setMaximumX(10),d.interactivity.setIsEnabledHandler(function(){return!d.animator.drawing}),d.setOnHover=function(e){d.interactivity.setOnHover(e)},d.addSerie=function(e,t,n,r,a){var i={};i.name=e,i.color=t,i.isLine=n,i.order=r,i.lineThickness=a?a:2,d.series.push(i)},d.setData=function(e,t,n){d.pendingDraw={timePeriods:e,values:t,endingLabel:n,id:Date.now()},a.debug("Storing pending draw "+d.pendingDraw.id)},d.prepare=function(){d.max=d.getMaxValue(),d.min=d.getMinValue();var e;0===d.max&&0===d.min&&(e=0),d.utils.determineTickAppearance(d.max),d.ensureHeightIsValid(),d.sets=d.delegate.createSets(d.series),d.columns=d.getColumnCount();var t=d.calculateVerticalTicks(d.columns,d.sets,d.max,d.timePeriods),n=d.calculateHorizontalTicks(d.timePeriods),r=d.calculateMarkings(d.timePeriods);d.options={series:{stack:!0,shadowSize:0,lines:{show:!0,fill:1,steps:!1,lineWidth:0},bars:{show:!1,barWidth:.6}},legend:{show:!1},xaxis:{show:d.showXAxis,ticks:n,tickDecimals:0,color:d.getXaxisColor(),min:0,max:d.columns,transform:d.xaxisTransform,inverseTransform:d.xaxisInverseTransform},yaxis:{ticks:t,color:d.autoCalculateTicks?void 0:d.getYaxisColor(),tickFormatter:this.tickFormatter,min:e},grid:{aboveData:d.autoCalculateTicks?!1:!0,borderWidth:{top:0,left:0,bottom:0,right:0},margin:{top:d.topMargin,left:5,bottom:0,right:0},markings:r,hoverable:!0,clickable:!0}}},d.xaxisTransform=function(e){return d.columnMode?e:d.xAxisTransformation[e]},d.xaxisInverseTransform=function(e){if(d.columnMode)return e;for(var t=0;t<d.xAxisInverseTransformation.length;t++){var n=d.xAxisInverseTransformation[t];if(n.from<=e&&e<n.to)return n.index}return e},d.calculatePossibleVerticalTicks=function(e,t,n,r){var a,i=[];i.push(0);for(var o=0;e>o;o++){a=0;for(var s=o===e-1?d.isColumnIndexOnTimePeriod(o+1,r):d.isColumnIndexOnTimePeriod(o,r),l=0;l<t.length;l++){var c=t[l].data;d.smoothing&&o===e-1?a+=c[o].end:d.smoothing&&l>0&&o>0&&d.utils.hasSetNullValues(t[l-1])||d.utils.isSetALine(t[l])?a=c[o].begin:a+=c[o].begin,i.indexOf(a)<0&&(d.smoothing&&(s||0===o)||!d.smoothing)&&i.push(a),d.utils.isSetALine(t[l])&&(a=0)}}return i},d.calculateVerticalTicks=function(e,t,n,r){if(!d.autoCalculateTicks){var a=[],i=d.calculatePossibleVerticalTicks(e,t,n,r),o=$(d.id);return i.forEach(function(e){var t=n>e?e:n;null===t||d.utils.overlaps(t,a,o)||a.push(t)}),d.topValueFactor>1&&a.push(n*d.topValueFactor),a}},d.calculateVerticalTicksOLD=function(e,t,r,a){if(!d.autoCalculateTicks){var i,o,s,l,c=$(d.id),u=[0],m=new n(!d.smoothing);for(o=0;e>o;o++){i=0;var g=o===e-1?d.isColumnIndexOnTimePeriod(o+1,a):d.isColumnIndexOnTimePeriod(o,a);for(s=0;s<t.length;s++){l=t[s].values;var f=l[o].begin,h=l[o].end;if(null===h&&!t[s].isLine){if(!(d.smoothing&&o>0))continue;f=l[o-1].end}t[s].isLine?null!==f&&u.indexOf(f)<0&&!d.utils.overlaps(f,u,c)&&(d.smoothing&&(g||0===o)||!d.smoothing)&&u.push(f):(d.smoothing&&o===e-1?i+=h:d.smoothing&&s>0&&o>0&&m.hasSerieNullValues(t[s-1])?i=f:i+=f,u.indexOf(i)<0&&!d.utils.overlaps(i,u,c)&&(d.smoothing&&(g||0===o)||!d.smoothing)&&u.push(i))}}return d.topValueFactor>1&&u.push(r*d.topValueFactor),u}},d.calculateHorizontalTicks=function(e){if(!d.autoCalculateTicks){for(var t=[],n=0,r=0;r<e.length;r++){var i=e[r];t.push([n,i.label]),n+=i.duration}return null!==d.endingLabel&&t.push([n,String(d.endingLabel)]),a.debug("xticks: "+JSON.stringify(t)),null!==d.options&&(d.options.xaxis.ticks=t),t}},d.removeHorizontalTicks=function(){null!==d.options&&(d.options.xaxis.ticks=[""])},d.autocalculateHorizontalTicks=function(){null!==d.options&&(d.options.xaxis.ticks=void 0)},d.calculateMarkings=function(e){var t=[],n=0,r=[];t.push({yaxis:{from:0,to:0},color:"#000000",lineWidth:1.5});for(var a=0;a<e.length;a++){var i=e[a];t.push({xaxis:{from:n,to:n},color:"#000000",lineWidth:1.5}),i.title&&r.push({label:i.title,column:n}),n+=i.duration}return d.titles=r,null!==d.options&&(d.options.grid.markings=t),t},d.getColumnCount=function(){return d.series[0].values.length},d.getMeasurements=function(){var e={};if(this.pendingDraw){for(var t=[],r=0;r<d.series.length;r++){var a=$.extend(!0,{},d.series[r]);a.values=d.pendingDraw.values[r],t.push(a)}this.ensureHeightIsValid();var i=new n(!d.smoothing).getMaxSerieValue(t),o=t[0].values.length;e.maxValue=i,e.yticks=d.utils.getRawTicks(d.calculateVerticalTicksOLD(o,t,i,d.pendingDraw.timePeriods))}else e.maxValue=this.max,e.yticks=d.utils.getRawTicks(d.options.yaxis.ticks);return e},d.getMaxValue=function(){var e=new n(!d.smoothing);return e.getMaxSerieValue(this.series)},d.getMinValue=function(){var e=new n(!d.smoothing);return e.getMinSerieValue(this.series)},d.getXaxisColor=function(){return"rgba(0,0,0,0)"},d.getYaxisColor=function(){return"rgba(0,0,0,0)"},d.calculateHash=function(e){for(var t=0,n=1,r=0;r<e.length;r++){var a=e[r];t+=a.duration*n,n*=100}return t},d.calculateXAxisTransformation=function(e){a.debug("Calculating x-axis transformation for "+e.length+" time periods."),d.xAxisTransformation=[],d.xAxisInverseTransformation=[];var t=0,n=0;if(e.representationList)for(var r=0;r<e.representationList.length;r++){var o=e.representationList[r];d.xAxisTransformation[t]=o.fromPercentage,d.xAxisInverseTransformation.push({from:o.fromPercentage,to:o.toPercentage,index:t}),i.debug("   index: "+r+" transformed: "+o.fromPercentage+" idx: "+t),n=o.toPercentage,t++}else for(var s=0;s<e.length;s++){var l=e[s],c=l.widthPercentage/l.duration;i.debug("Time period "+s);for(var u=0;u<l.duration;u++){var m=n,g=n+c;d.xAxisTransformation[t]=m,d.xAxisInverseTransformation.push({from:m,to:g,index:t}),i.debug("   index: "+u+" transformed: "+m+" idx: "+t),n+=c,t++}}d.xAxisTransformation[t]=100,d.xAxisInverseTransformation.push({from:n,to:100,index:t}),d.xAxisTransformationHash=d.calculateHash(e)},d.setTopMargin=function(e){d.topMargin=e?e:10},d.setTopValueFactor=function(e){d.topValueFactor=e},d.setSmoothing=function(e){d.smoothing=e},d.setAutoCalculateTicks=function(e){d.autoCalculateTicks=e},d.drawLabels=function(e){for(var t,n=0;n<d.labelElements.length;n++)t=d.labelElements[n],t.remove();d.labelElements=[];var r,a=$(d.id);r=d.useThousandsForTicks?d.labelThounsandsForTicks:d.labelCurrency;var i=d.labelYearString;t=$("<div class='chart-bottomright-label'>"+i+"</div>").appendTo(a),d.labelElements.push(t);var o=d.topMargin-20;0>o&&(o=0),t=$("<div class='chart-topleft-label' style='top: "+o+"px;'>"+r+"</div>").appendTo(a),d.labelElements.push(t);for(var s=0;s<d.titles.length;s++){var l=d.titles[s],c=e.pointOffset({x:l.column,y:d.max*d.topValueFactor}),u=o,m=c.left+5;t=$("<div class='chart-topleft-label' style='left: "+m+"px; top: "+u+"px'>"+l.label+"</div>").appendTo(a),d.labelElements.push(t)}},d.tickFormatter=function(e,t){if(d.topValueFactor>1&&"y"===t.direction){if(d.animator.plot){var n=d.animator.plot.getAxes(),r=n.yaxis.options;if(void 0!==r.ticks&&r.ticks.length>0&&e>=r.ticks[r.ticks.length-1])return""}if(e===d.max*d.topValueFactor)return""}return d.utils.formatTickValue(e)},d.getXTicks=function(){var e=d.animator.plot;if(null===e)return[];var t=e.getAxes();return t.xaxis.ticks},d.isSetForDrawing=function(e){for(var t=0;t<d.sets.length;t++)if(d.sets[t].order===e)return!0;return!1},d.findPreviousSeriesValues=function(e){for(var t=0;t<d.previousSeriesValues.length;t++){var n=d.previousSeriesValues[t];if(n.order===e)return n.values}},d.hideXAxis=function(){d.showXAxis=!1},d.setColumnMode=function(){d.columnMode=!0,d.interactivity.useRoundingForColumnConversion=!1},d._setTimePeriods=function(e){a.debug("Setting time periods ("+e.length+")"),d.previousTimePeriods=d.timePeriods,d.timePeriods=e},d._setValues=function(e){i.debug("SET VALUES:"),d.previousSets=d.sets,d.previousMax=d.max,d.previousOptions=d.options,d.previousTitles=d.titles,d.previousColumns=d.columns,d.previousSeriesValues=[];for(var t=0;t<d.series.length;t++){var n=d.series[t];d.previousSeriesValues.push({order:n.order,name:n.name,color:n.color,isLine:n.isLine,lineThickness:n.lineThickness,values:n.values}),n.values=e[t],i.debug("---> Serie "+n.order+" ("+n.name+") values="+JSON.stringify(n.values))}},d._setEndingLabel=function(e){d.endingLabel=e},d.isColumnIndexOnTimePeriod=function(e,t){for(var n=0,r=0;r<t.length;r++)if(n+=t[r].duration,e===n)return!0;return!1},d}};return o}),define("bar-graph",["parameters-manager","logger","common-bar-chart","common-currency-formatter"],function(e,t,n,r){"use strict";var a=t.get("BarGraph");return function(t){return t.component("barGraph",{bindings:{id:"@",bridge:"="},templateUrl:"src/directives/graphs/bar-graph/bar-graph.html",controller:[function(){a.debug("START BAR GRAPH");var t=this;void 0!==t.id&&t.id.length>0?t.fieldId=t.id.replace(/\./g,"_"):t.fieldId="",t.canvasId=t.fieldId+"BarCanvas",t.bridge.update=function(){a.debug("UPDATE: "+t.canvasId),t.refreshHandler.update()},t.bridge.forceDraw=function(){a.debug("FORCE DRAW: #"+t.canvasId),t.refreshHandler.forceDraw()},t.bridge.getVisibleRefreshHandlers=function(){return[t.refreshHandler]},t.bridge.getChart=function(){return t.getBarChart()},t.getBarChart=function(){return t.barChart||(t.barChart=(new n).createBarChart(t.canvasId,new r(e.baseViewParameters.groupDelimiter,e.baseViewParameters.amountDecimalDelimiter,e.baseViewParameters.useMixedGroupingSeparator)),t.bridge.setupChart(t.barChart)),t.barChart};var i=t.bridge.createChartUpdater(t.getBarChart(),function(e){t.bridge.updateChart(e)});t.refreshHandler=t.bridge.createRefreshHandler(t.canvasId,i)}]})}}),define("expandable-panel-list",[],function(){"use strict";return function(e){return e.component("expandablePanelList",{restrict:"E",transclude:!0,templateUrl:"src/directives/expandable-panel-list/expandable-panel-list.html",bindings:{bridge:"=?"},controller:function(){var e=this;e.expandedPanelId=null,e.bridge.expandedPanelId=function(){return e.expandedPanelId},e.bridge.collapse=function(){e.expandedPanelId=null},e.bridge.isExpanded=function(t){return t===e.expandedPanelId},e.bridge.expand=function(t){e.expandedPanelId===t?e.expandedPanelId=null:e.expandedPanelId=t}}})}}),define("expandable-panel",[],function(){"use strict";return function(e){return e.component("expandablePanel",{restrict:"E",transclude:!0,bindings:{},templateUrl:"src/directives/expandable-panel/expandable-panel.html",controller:function(){}})}}),define("expandable-panel-item",[],function(){"use strict";return function(e){return e.component("expandablePanelItem",{restrict:"E",transclude:!0,bindings:{isExpanded:"=?"},templateUrl:"src/directives/expandable-panel-item/expandable-panel-item.html",controller:function(){}
})}}),define("app",["require","angular","logger","routes-handler","parameters-manager","theme-manager","route-resolver","route-registrator","angular-route","angular-animate","angular-sanitize","bootstrap","ui-bootstrap","state","base-state","tax-calculator","rpopulaires-calculator","multicalc-state","formatter","localization","route-translator","localization-filter","localization-directive","loading-controller","active-controller","custom-filters","language-controller","calculators-manager","storage-manager","version-manager","calculator-item-link","store-method-link","text-field","icon-button-bar","navigation-bar","title-link","debugging-view","theme-box","base-data-summary","multicalc-risk","multicalc-saving3a","profile-bar","profile-common","custom-scripts","message-service","google-analytics-service","print-service","file-service","authentication-service","storage-service","product-list-service","calculator-service","zip-and-location-service","basket-service","media-service","statistics-service","log-statistics-service","location-service","location-breadcrumbs","model-updater","tab-selector","tab-selector-link","topic-chooser","topic-link","topic-panel","donut-graph","column-graph","bar-graph","expandable-panel-list","expandable-panel","expandable-panel-item"],function(e,t,n,r,a){"use strict";function i(){n.get("AsynchronousModeProfile").setLevel(n.ERROR),n.get("AsynchronousModeDetailedProfile").setLevel(n.ERROR),n.get("NumericField").setLevel(n.ERROR),n.get("SliderField").setLevel(n.ERROR),n.get("DonutGraph").setLevel(n.ERROR),n.get("ColumnGraph").setLevel(n.ERROR),n.get("BarGraph").setLevel(n.ERROR),n.get("LocalizationFilter").setLevel(n.ERROR),n.get("localization").setLevel(n.ERROR),n.get("localizationDetail").setLevel(n.ERROR),n.get("savingCalculator").setLevel(n.ERROR),n.get("RPopulairesCalculator").setLevel(n.ERROR),n.get("Formatter").setLevel(n.ERROR),n.get("LoadingService").setLevel(n.ERROR),n.get("LoadingController").setLevel(n.ERROR),n.get("TaxCalculator").setLevel(n.ERROR),n.get("messageService").setLevel(n.ERROR),n.get("googleAnalyticsService").setLevel(n.ERROR),n.get("printService").setLevel(n.ERROR),n.get("fileService").setLevel(n.ERROR),n.get("authenticationService").setLevel(n.ERROR),n.get("storageService").setLevel(n.ERROR),n.get("calculatorService").setLevel(n.ERROR),n.get("zipAndLocationService").setLevel(n.ERROR),n.get("productListService").setLevel(n.ERROR),n.get("routeTranslator").setLevel(n.ERROR),n.get("versionManager").setLevel(n.ERROR),n.get("mediaService").setLevel(n.ERROR),n.get("statisticsService").setLevel(n.ERROR),n.get("logStatisticsService").setLevel(n.ERROR),n.get("locationService").setLevel(n.ERROR),n.get("RefreshHandler").setLevel(n.ERROR),n.get("ScopeHelper").setLevel(n.ERROR),n.get("ThemeManager").setLevel(n.ERROR),n.get("BaseChart").setLevel(n.ERROR),n.get("ComparativeChart").setLevel(n.ERROR),n.get("BarChart").setLevel(n.ERROR),n.get("BarChartDetail").setLevel(n.ERROR),n.get("BarChartDelegate").setLevel(n.ERROR),n.get("BarChartDelegateDetail").setLevel(n.ERROR),n.get("SingleBarChart").setLevel(n.ERROR),n.get("AreaChart").setLevel(n.ERROR),n.get("DonutChart").setLevel(n.ERROR),n.get("ColumnChart").setLevel(n.ERROR),n.get("ChartAnimator").setLevel(n.ERROR),n.get("ChartAnimatorFlow").setLevel(n.ERROR),n.get("ChartAnimatorDetail").setLevel(n.ERROR),n.get("ChartAnimatorTiming").setLevel(n.ERROR),n.get("ChartAnimatorAnimationDetail").setLevel(n.ERROR),n.get("ChartInteractivity").setLevel(n.ERROR),n.get("HouseObject").setLevel(n.ERROR),n.get("PercentageIndicator").setLevel(n.ERROR),n.get("ObjectUtilities").setLevel(n.ERROR),n.get("SeriesUtilities").setLevel(n.ERROR),n.get("SeriesUtilitiesDetail").setLevel(n.ERROR),n.get("ChartUtilities").setLevel(n.ERROR),n.get("Base").setLevel(n.ERROR),n.get("BaseStatus").setLevel(n.ERROR),n.get("BaseUrlParameters").setLevel(n.ERROR),n.get("BaseSaving").setLevel(n.ERROR),n.get("CustomBaseController").setLevel(n.ERROR),n.get("Multicalc").setLevel(n.ERROR),n.get("MulticalcDisability").setLevel(n.ERROR),n.get("MulticalcSaving3a").setLevel(n.ERROR),n.get("MulticalcScenario").setLevel(n.ERROR),n.get("MulticalcRisk").setLevel(n.ERROR)}n.useDefaults(),n.setHandler(function(e,t){var r=window.console,a=r.log;r.debug&&(a=r.debug),t.level===n.WARN?e[0]="WARNING: "+e[0]:t.level===n.ERROR&&(e[0]="ERROR: "+e[0],a=r.error),t.name&&(e[0]="["+t.name+"] "+e[0]);var i=(new Date).getTime();e[0]=String(i)+" "+e[0],a.apply(r,e)}),i();var o=t.module("app",["ngRoute","ngAnimate","ngSanitize","routeResolverServices","routeRegistratorServices","ui.bootstrap","storageManagerModule","versionManagerModule","stateModule","baseStateModule","rpopulairesCalculatorModule","formatterModule","taxCalculatorModule","activeControllerModule","multicalcStateModule","localization","route-translator","localizationFilter","localizationDirective","customFilters","loadingModule","calculatorsManagerModule","messageServiceModule","googleAnalyticsServiceModule","printServiceModule","fileServiceModule","authenticationServiceModule","storageServiceModule","calculatorServiceModule","zipAndLocationServiceModule","productListServiceModule","locationBreadcrumbsModule","modelUpdaterModule","basketServiceModule","profileCommonModule","mediaServiceModule","statisticsServiceModule","logStatisticsServiceModule","locationServiceModule"]);return e("language-controller")(o),e("calculator-item-link")(o),e("store-method-link")(o),e("text-field")(o),e("custom-icon-button-bar")(o),e("icon-button-bar")(o),e("navigation-bar")(o),e("title-link")(o),e("profile-bar")(o),e("debugging-view")(o),e("theme-box")(o),e("base-data-summary")(o),e("multicalc-risk")(o),e("multicalc-saving3a")(o),e("tab-selector")(o),e("tab-selector-link")(o),e("donut-graph")(o),e("column-graph")(o),e("topic-chooser")(o),e("topic-link")(o),e("topic-panel")(o),e("bar-graph")(o),e("expandable-panel-list")(o),e("expandable-panel")(o),e("expandable-panel-item")(o),o.config(["$routeProvider","routeResolverProvider","routeRegistratorProvider","$controllerProvider","$compileProvider","$filterProvider","$locationProvider","$provide",function(e,t,n,i,s,l,c,u){u.factory("$routeProvider",function(){return e}),o.register={controller:i.register,directive:s.directive,component:o.component,filter:l.register,factory:u.factory,service:u.service},window.isIE9||(c.html5Mode(!0).hashPrefix("!"),r.html5=!0);for(var d=t.route,m=n.routeRegistrator,g=0;g<a.baseViewParameters.availableLanguages.length;g++){var f=a.baseViewParameters.availableLanguages[g];m.registerRoute(e,d,f)}}]),o.run(["$rootScope",function(e){e.singleCalculation=a.baseViewParameters.singleCalculation,e.navigationBar=a.baseViewParameters.navigationBar,e.consultantMode=a.baseApplicationParameters.consultantMode,e.showCopyrightDisclaimer=a.baseViewParameters.showCopyrightDisclaimer,e.hasAuthenticationURL=void 0!==a.baseApplicationParameters.authenticationServiceURL&&null!==a.baseApplicationParameters.authenticationServiceURL&&""!==a.baseApplicationParameters.authenticationServiceURL,e.appVersion=window.appVersion,e.hasVersion="raven_version"!==window.appVersion,window.onhashchange=function(){$(".modal.in").removeClass("in").modal("hide"),$(".modal-backdrop").hide()},navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&null!==window.frameElement&&e.$on("$locationChangeSuccess",function(e,t){location.href!==t&&(location.href=t)})}]),o}),define("app-startup",["require","angular","parameters-manager","domReady","app"],function(e,t,n){"use strict";e(["domReady!"],function(e){"object"==typeof n.baseApplicationParameters.requirePaths&&require.config({paths:n.baseApplicationParameters.requirePaths}),t.bootstrap(e,["app"])})}),require.config({paths:{domReady:["../lib/requirejs-2.3.5/domReady-2.0.1"],angular:["../lib/angular-1.5.11/angular.min"],"angular-route":["../lib/angular-1.5.11/angular-route.min"],"angular-animate":["../lib/angular-1.5.11/angular-animate.min"],"angular-sanitize":["../lib/angular-1.5.11/angular-sanitize.min"],"ui-bootstrap":["../lib/ui-bootstrap-0.13.2/ui-bootstrap-tpls-0.13.2.min"],bootstrap:["../lib/bootstrap-sass-3.3.7/assets/javascripts/bootstrap.min"],kineticjs:["../lib/kineticjs-5.2.0/kinetic-v5.2.0.min"],jquery:["../lib/jquery-3.2.1/jquery-3.2.1.min"],"jquery-flot":["../framework/app/lib/flot-0.8.2/jquery.flot.min"],"jquery-flot-stack":["../framework/app/lib/flot-0.8.2/jquery.flot.stack.min"],"jquery-flot-axislabels":["../framework/app/lib/flot-0.8.2/jquery.flot.axislabels"],"jquery-flot-pie":["../framework/app/lib/flot-0.8.2/jquery.flot.pie.min"],"jquery-flot-resize":["../framework/app/lib/flot-0.8.2/jquery.flot.resize.min"],"jquery-visible":["../lib/jquery-visible-1.2.0/jquery.visible.min"],"jquery-easing":["../lib/jquery-easing-compatibility-1/jquery.easing.compatibility"],"jquery-ui":["../lib/jquery-ui-1.10.4/js/jquery-ui-1.10.4.min"],"jquery-ui-touch-punch":["../lib/jquery-ui-touch-punch-master-0.2.3/jquery.ui.touch-punch.min"],logger:["../lib/logger-1.2.0/logger.min"],filesaver:["../lib/filesaver-2014.11.29/FileSaver.min"],"ng-storage":["../lib/ngStorage-0.3.10/ngStorage.min"],handlebars:["../lib/handlebars-3.0.3/handlebars.min"],swag:["../lib/swag-0.6.1/swag.min"],easing:"../framework/app/lib/easing/easing",toastr:["../lib/toastr/toastr.min"],"wolf-calc":["https://services.logismata.ch/components/wolf/ch.logismata.online.calc-min"],"wolf-tools":["../lib/wolf/ch.logismata.wolftools-min"],"wolf-rpopulaires":["https://services.logismata.ch/components/wolf/ch.logismata.rpopulaires.calc-min"],"common-currency-formatter":"../framework/app/src/common/currency-formatter","common-localization":"../framework/app/src/common/localization","common-percentage-indicator":"../framework/app/src/common/percentage-indicator","base-chart":"../framework/app/src/common/chart/base-chart","base-bar-chart":"../framework/app/src/common/chart/base-bar-chart","common-chart-utilities":"../framework/app/src/common/chart/chart-utilities","common-comparative-chart":"../framework/app/src/common/chart/comparative-chart","common-column-chart":"../framework/app/src/common/chart/column-chart","common-bar-chart":"../framework/app/src/common/chart/bar-chart","common-bar-chart-delegate":"../framework/app/src/common/chart/bar-chart-delegate","common-single-bar-chart":"../framework/app/src/common/chart/single-bar-chart","common-area-chart":"../framework/app/src/common/chart/area-chart","common-donut-chart":"../framework/app/src/common/chart/donut-chart","common-chart-animator":"../framework/app/src/common/chart/chart-animator","common-chart-interactivity":"../framework/app/src/common/chart/chart-interactivity","common-series-utilities":"../framework/app/src/common/chart/series-utilities","common-house":"../framework/app/src/common/house","common-refresh-handler":"../framework/app/src/common/refresh-handler","common-numeric-parameter":"../framework/app/src/common/numeric-parameter","common-simple-pass-evaluator":"../framework/app/src/common/simple-pass-evaluator","theme-manager":"../framework/app/src/common/theme-manager","common-object-utilities":"../framework/app/src/common/object-utilities","version-transformations":"../framework/app/src/common/version-transformations","common-extend-deep":"../framework/app/src/common/extend-deep","common-number-utilities":"../framework/app/src/common/number-utilities","common-color-tool-set":"../framework/app/src/common/color-tool-set","float":"directives/float","int":"directives/int","theme-box":"directives/theme-box/theme-box","result-summary-box":"directives/result-summary-box/result-summary-box","calculation-header":"directives/calculation-header/calculation-header","link-to-view":"directives/link-to-view/link-to-view","theme-header":"directives/theme-header/theme-header","fancy-box":"directives/fancy-box/fancy-box","tab-selector":"directives/tab-selector/tab-selector","tab-selector-link":"directives/tab-selector-link/tab-selector-link","topic-chooser":"directives/topic-chooser/topic-chooser","topic-link":"directives/topic-link/topic-link","topic-panel":"directives/topic-panel/topic-panel","donut-graph":"directives/graphs/donut-graph/donut-graph","column-graph":"directives/graphs/column-graph/column-graph","bar-graph":"directives/graphs/bar-graph/bar-graph","calculator-item-link":"directives/calculator-item-link/calculator-item-link","store-method-link":"directives/store-method-link/store-method-link","numeric-field":"directives/fields/numeric-field/numeric-field","slider-field":"directives/fields/slider-field/slider-field","label-field":"directives/fields/label-field/label-field","email-field":"directives/fields/email-field/email-field",captcha:"directives/fields/captcha/captcha","text-field":"directives/fields/text-field/text-field","password-field":"directives/fields/password-field/password-field","selection-field":"directives/fields/selection-field/selection-field","list-selection-field":"directives/fields/list-selection-field/list-selection-field","list-group-field":"directives/fields/list-group-field/list-group-field","radio-field":"directives/fields/radio-field/radio-field","checkbox-field":"directives/fields/checkbox-field/checkbox-field","zip-and-location-field":"directives/fields/zip-and-location-field/zip-and-location-field","search-field":"directives/fields/search-field/search-field","two-tab-field":"directives/fields/two-tab-field/two-tab-field","localization-directive":"directives/localization-directive","enter-press":"directives/enter-press",visibility:"directives/visibility/visibility","typeahead-watch-changes":"directives/typeahead-watch-changes","base-data-summary":"directives/base-data-summary/base-data-summary","table-row":"directives/table-row/table-row","table-row-list":"directives/table-row-list/table-row-list","icon-button-bar":"directives/icon-button-bar/icon-button-bar","custom-icon-button-bar":"directives/icon-button-bar/custom-icon-button-bar","navigation-bar":"directives/navigation-bar/navigation-bar","title-link":"directives/title-link/title-link","debugging-view":"directives/debugging-view/debugging-view","profile-bar":"directives/profile-bar/profile-bar","profile-common":"services/profile-common","expandable-panel-list":"directives/expandable-panel-list/expandable-panel-list","expandable-panel":"directives/expandable-panel/expandable-panel","expandable-panel-item":"directives/expandable-panel-item/expandable-panel-item","application-constants":"model/application-constants","model-constants":"model/model-constants","enums-constants":"model/enums-constants","base-model":"model/base-model","base-state":"model/base-state",state:"model/state","model-updater":"model/versions/model-updater","model-version-1.0":"model/versions/model-version-1.0","base-controller":"controllers/base/base","basic-base-controller":"controllers/base/basic-base","base-incomes-calculator-controller":"controllers/base/base-incomes-calculator","base-url-parameters-controller":"controllers/base/base-url-parameters","custom-base-controller":"controllers/base/custom-base","common-scope-helper":"controllers/common/scope-helper","language-controller":"controllers/language/language-controller","custom-overview-controller":"controllers/overview/custom-overview","overview-controller":"controllers/overview/overview","parameters-manager":"model/parameters-manager","parameters-decorator":"model/parameters-decorator","base-application-parameters":"model/base-application-parameters","base-model-parameters":"model/base-model-parameters","base-view-parameters":"model/base-view-parameters","custom-application-parameters":"model/custom-application-parameters","custom-model-parameters":"model/custom-model-parameters","custom-view-parameters":"model/custom-view-parameters","deploy-application-parameters":"model/deploy-application-parameters","deploy-model-parameters":"model/deploy-model-parameters","deploy-view-parameters":"model/deploy-view-parameters","runtime-environment-application-parameters":"model/runtime-environment-application-parameters","runtime-environment-model-parameters":"model/runtime-environment-model-parameters","runtime-environment-view-parameters":"model/runtime-environment-view-parameters","edit-dialog-box":"directives/edit-dialog-box/edit-dialog-box","detail-utils":"controllers/common/detail-utils","multicalc-manager":"controllers/common/multicalc/multicalc-manager","multicalc-model":"controllers/multicalc/multicalc-model","multicalc-state":"controllers/multicalc/multicalc-state","multicalc-controller":"controllers/multicalc/multicalc","multicalc-personal-data":"controllers/multicalc/multicalc-personal-data/multicalc-personal-data","multicalc-risk":"controllers/multicalc/multicalc-risk/multicalc-risk","multicalc-saving3a":"controllers/multicalc/multicalc-saving3a/multicalc-saving3a","custom-filters":"filters/custom-filters","localization-filter":"filters/localization-filter",formatter:"services/formatter","tax-calculator":"services/tax-calculator","rpopulaires-calculator":"services/rpopulaires-calculator",localization:"services/localization","route-translator":"services/route-translator","active-controller":"services/active-controller","loading-controller":"services/loading-controller","route-resolver":"services/route-resolver","route-registrator":"services/route-registrator","custom-route-registrator":"services/custom-route-registrator","routes-handler":"services/routes-handler","calculators-manager":"services/calculators-manager","storage-manager":"services/storage-manager","version-manager":"services/version-manager","message-service":"services/message-service","google-analytics-service":"services/google-analytics-service","print-service":"services/print-service","file-service":"services/file-service","authentication-service":"services/authentication-service","storage-service":"services/storage-service","product-list-service":"services/product-list-service","calculator-service":"services/calculator-service","zip-and-location-service":"services/zip-and-location-service","media-service":"services/media-service","statistics-service":"services/statistics-service","location-service":"services/location-service","log-statistics-service":"services/log-statistics-service","basket-service":"services/basket-service","location-breadcrumbs":"services/location-breadcrumbs","user-modules-service":"services/user-modules-service"},shim:{domReady:{exports:"domReady"},jquery:{exports:"jquery"},angular:{exports:"angular",deps:["jquery"]},"angular-route":{exports:"angular_route",deps:["angular"]},"angular-animate":{exports:"angular_animate",deps:["angular"]},"angular-sanitize":{exports:"angular_sanitize",deps:["angular"]},"ui-bootstrap":{exports:"ui_bootstrap",deps:["angular","angular-animate"]},bootstrap:{exports:"bootstrap",deps:["jquery"]},kineticjs:{exports:"kineticjs"},handlebars:{exports:"handlebars"},swag:{exports:"swag",deps:["handlebars"]},"jquery-flot":{exports:"jquery_flot",deps:["jquery"]},"jquery-flot-stack":{exports:"jquery_flot_stack",deps:["jquery-flot"]},"jquery-flot-axislabels":{exports:"jquery_flot_axislabels",deps:["jquery-flot-stack"]},"jquery-flot-pie":{exports:"jquery_flot_pie",deps:["jquery-flot-axislabels"]},"jquery-flot-resize":{exports:"jquery_flot_resize",deps:["jquery-flot-pie"]},"jquery-ui":{exports:"jquery-ui",deps:["jquery"]},"jquery-ui-touch-punch":{exports:"jquery-ui-touch-punch",deps:["jquery-ui"]},filesaver:{exports:"filesaver"},"ng-storage":{exports:"ng-storage",deps:["angular"]},"wolf-calc":{exports:"wolf_calc"},"wolf-tools":{exports:"wolf_tools"},"wolf-rpopulaires":{exports:"wolf_rpopulaires"},"jquery-visible":{exports:"jquery_visible",deps:["jquery"]},"jquery-easing":{exports:"jquery-easing",deps:["jquery","jquery-ui"]},easing:{exports:"easing"},toastr:{exports:"toastr",deps:["jquery"]}},deps:["app-startup"]}),define("main",function(){}),define("common-refresh-handler",["logger","jquery-visible"],function(e){"use strict";var t=e.get("RefreshHandler"),n=function(e,t,n){this.isDirty=!1,this.elementId=e,this.updater=t,n?this.repaintWhenResizing=n:this.repaintWhenResizing=!0,this.drawingEnabled=!0,this.pendingDrawing=!1,this.pendingDrawingForced=!1,this.drawingInterval=null,this.drawingRequests=0,this.enabled=!0};return n.prototype.isOnScreen=function(){try{var e=$("#"+this.elementId);return e.visible(!0)}catch(n){return t.warn("Exception when checking on screen visibility of "+this.elementId),!1}},n.prototype.refresh=function(e){(this.isDirty||this.repaintWhenResizing)&&(t.debug("COMPONENT "+this.elementId+" was dirty and became visible ==> Refresh"),e?this.forceDraw():this.draw())},n.prototype.update=function(){t.debug("Updating "+this.elementId),this.finalDraw(),this.isDirty=!1},n.prototype.draw=function(){return this.enabled?(t.debug("DRAW "+this.elementId),this.isDirty=!1,void this.finalDraw()):void t.debug("RefreshHandler for "+this.elementId+" already disabled, skipping draw")},n.prototype.forceDraw=function(){if(!this.enabled)return void t.debug("RefreshHandler for "+this.elementId+" already disabled, skipping forceDraw");t.debug("FORCE DRAW "+this.elementId),this.pendingDrawing=!1,this.pendingDrawingForced=!1,this.isDirty=!1;var e;try{e=this.updater.update(!0)}catch(n){t.error("Forced drawing failed for "+this.elementId),t.error("Error: "+n),t.error("Stack: "+n.stack),e=!1}e||(t.warn("Drawing was not successful, adding as pending ["+this.elementId+"]"),this.pendingDrawing=!0,this.pendingDrawingForced=!0)},n.prototype.finalDraw=function(){if(!this.drawingEnabled)return t.debug("Adding pending draw for "+this.elementId),this.pendingDrawing=!0,this.pendingDrawingForced=!1,void(this.drawingRequests+=1);t.debug("Actually drawing "+this.elementId),this.drawingEnabled=!1;var e;try{e=this.updater.update(!1)}catch(n){t.error("Drawing failed for "+this.elementId),t.error("Error: "+n),e=!1}e||(t.warn("Drawing was not successful, adding as pending ["+this.elementId+"]"),this.pendingDrawing=!0,this.pendingDrawingForced=!1);var r=this;this.drawingInterval=setInterval(function(){if(r.pendingDrawing){var e=(new Date).getMilliseconds();t.debug("Timeout drawing pending request ["+this.elementId+"]");var n;try{n=r.updater.update(r.pendingDrawingForced)}catch(a){t.error("Drawing failed for "+r.elementId),t.error("Error: "+a),n=!1}var i=(new Date).getMilliseconds();t.debug("Drawing time: "+(i-e)+"ms. Skipped draw events: "+r.drawingRequests),r.pendingDrawing=!1,r.pendingDrawingForced=!1,r.drawingRequests=0,r.drawingEnabled=!0}else clearInterval(r.drawingInterval),r.drawingEnabled=!0},100)},n.prototype.dismiss=function(){if(void 0!==this.updater.dismiss)try{this.updater.dismiss()}catch(e){t.error("Dismissal failed for "+this.elementId),t.error("Error: "+e)}},n.prototype.shutdown=function(){clearInterval(this.drawingInterval),this.enabled=!1},n}),define("common-scope-helper",["logger","common-refresh-handler"],function(e,t){"use strict";function n(e){r.debug("initializeEventListeners");var t=function(){e.scope.$apply(function(){if(r.debug("resizing... "),e.scope.ready)for(var t=0;t<e.refreshHandlers.length;t++){var n=e.refreshHandlers[t];n.refresh(!0)}})};window.addEventListener("resize",t,!1),e.scope.$on("$locationChangeStart",function(n){window.removeEventListener("resize",t,!1);for(var r=0;r<e.refreshHandlers.length;r++){var a=e.refreshHandlers[r];a.dismiss()}}),e.scope.$on("$routeUpdate",function(){window.addEventListener("resize",t,!1)})}var r=e.get("ScopeHelper"),a=function(e){this.scope=e,this.refreshHandlers=[],n(this)};a.prototype.createRefreshHandler=function(e,n,r){var a=new t(e,n,r);return this.refreshHandlers.push(a),a},a.prototype.display=function(e){r.debug("Displaying "+e.length),r.debug(e);for(var t=0;t<this.refreshHandlers.length;t++){var n=this.refreshHandlers[t];e.indexOf(n)>=0?i(n.elementId):o(n.elementId)}},a.prototype.forEachRefreshHandler=function(e){for(var t=0;t<this.refreshHandlers.length;t++){var n=this.refreshHandlers[t];e(n)}};var i=function(e){var t=document.getElementById(e.replace("#",""));null!==t&&(r.debug("MAKE VISIBLE: "+e),t.classList.remove("transparent-element"))},o=function(e){var t=document.getElementById(e.replace("#",""));null!==t&&(r.debug("HIDE: "+e),t.classList.add("transparent-element"))};return a}),define("basic-base-controller",["app","parameters-manager","logger","localization","message-service"],function(e,t,n){"use strict";var r=n.get("BasicBase");e.register.controller("basicBaseController",["$scope","messageService",function(e,n){n.removeMessagesOnNavigation(),e.initializeMessages=function(t,n){e.messageHelperEnumName=t,e.messageHelperGroupName=n},e.getEnumNameFrom=function(t){return t&&t.enumName&&t.enumName.length>0?t.enumName:e.messageHelperEnumName},e.getEnumParamsFrom=function(e){return e&&e.enumParams?e.enumParams:null},e.getTimeoutFrom=function(e){return e&&e.useTimeout?t.baseViewParameters.messageTimeout:void 0},e.getGroupFrom=function(t){return t&&t.group&&t.group.length>0?t.group:e.messageHelperGroupName},e.getDismissOnNavigationFrom=function(e){return e&&void 0!==e.dismissOnNavigation?e.dismissOnNavigation:!0},e.getActionsFrom=function(e){return e&&void 0!==e.actions?e.actions:[]},e.getRemoveOtherGroupMessagesFrom=function(e){return e&&void 0!==e.removeOtherGroupMessages?e.removeOtherGroupMessages:!0},e.createMessage=function(t,n,a){return e.messageHelperEnumName&&e.messageHelperGroupName||void 0===a||a.enumName&&a.group||r.debug("Messages not initialized!"),{type:t,enumName:e.getEnumNameFrom(a),enumKey:n,enumParams:e.getEnumParamsFrom(a),timeout:e.getTimeoutFrom(a),group:e.getGroupFrom(a),dismissOnNavigation:e.getDismissOnNavigationFrom(a),actions:e.getActionsFrom(a),removeOtherGroupMessages:e.getRemoveOtherGroupMessagesFrom(a)}},e.showMessage=function(t,a,i){e.messageHelperEnumName&&e.messageHelperGroupName||void 0===i||i.enumName&&i.group||r.debug("Messages not initialized!"),n.addMessage(e.createMessage(t,a,i))},e.showInfoMessage=function(t,r){e.showMessage(n.MESSAGE_INFO,t,r)},e.showWarningMessage=function(t,r){e.showMessage(n.MESSAGE_WARNING,t,r)},e.showErrorMessage=function(t,r){e.showMessage(n.MESSAGE_DANGER,t,r)},e.showSuccessMessage=function(t,r){r||(r={useTimeout:!0,dismissOnNavigation:!1}),e.showMessage(n.MESSAGE_SUCCESS,t,r)},e.clearGroupMessages=function(){e.messageHelperGroupName||r.debug("Messages not initialized!"),n.removeAllMessagesWithGroup(e.messageHelperGroupName)},e.clearMessagesForGroup=function(e){n.removeAllMessagesWithGroup(e)}}])}),define("base-incomes-calculator-controller",["app","logger","parameters-manager","tax-calculator","wolf-tools","enums-constants"],function(e,t,n){"use strict";t.get("BaseIncomesCalculator");e.register.controller("baseIncomesCalculatorController",["$scope","$q","taxCalculator","localize",function(e,t,r,a){var i=function(){},o=ch.logismata.wolftools.roundValue;i.prototype={wrapThePromise:function(n){var r=t.defer();return e.isReady()||e.allPrePromisesResolved()?e.requestCalculationsPromise([n]).then(function(e){r.resolve(e[0])}):e.addPrePromise(n.then(function(e){r.resolve(e)})),r.promise},getCurrentAge:function(e){return(new Date).getFullYear()-e},getSecondPersonConfession:function(e){return e.secondPerson.confession?e.secondPerson.confession:e.mainPerson.confession},getMainPersonIncomePercentage:function(e){var t,r;return null!==e.mainPerson.grossIncome&&null!==e.secondPerson.grossIncome?(t=e.mainPerson.grossIncome,r=e.secondPerson.grossIncome):null!==e.mainPerson.yearlyNetIncome&&null!==e.secondPerson.yearlyNetIncome?(t=e.mainPerson.yearlyNetIncome,r=e.secondPerson.yearlyNetIncome):null!==e.mainPerson.monthlyNetIncome&&null!==e.secondPerson.monthlyNetIncome?(t=e.mainPerson.monthlyNetIncome,r=e.secondPerson.monthlyNetIncome):null!==e.mainPerson.taxableIncome&&null!==e.secondPerson.taxableIncome&&(t=e.mainPerson.taxableIncome,r=e.secondPerson.taxableIncome),(0===t&&0===r||null===t&&null===r)&&(t=n.baseModelParameters.mainPersonGrossIncome,r=n.baseModelParameters.secondPersonGrossIncome),r?Math.round(t/(t+r)*Math.pow(10,6))/Math.pow(10,6):1},getSecondPersonIncomePercentage:function(e){return 1-this.getMainPersonIncomePercentage(e)},getGrossIncomeFromNetIncomePromise:function(e,t){var n=r.calculateGrossIncomeFromNetIncome(e,this.getCurrentAge(t.mainPerson.birthYear),a.getActiveCountryCode());return this.wrapThePromise(n)},roundPromise:function(e){return e.then(function(e){return o(e)})},getTaxGrossIncomePromise:function(e){var a,i,s=t.defer(),l=this.getCurrentAge(e.mainPerson.birthYear),c=this.getCurrentAge(e.secondPerson.birthYear);if(null!==e.tax.grossIncome)return s.resolve(e.tax.grossIncome),s.promise;var u;if(null!==e.mainPerson.grossIncome)return u=e.mainPerson.grossIncome,null!==e.secondPerson.grossIncome&&e.relationship===Relationship.MARRIED&&(u+=e.secondPerson.grossIncome),s.resolve(o(u)),s.promise;if(null!==e.tax.yearlyNetIncome)return this.roundPromise(this.getGrossIncomeFromNetIncomePromise(e.tax.yearlyNetIncome,e));if(null!==e.mainPerson.yearlyNetIncome)return a=[this.getGrossIncomeFromNetIncomePromise(e.mainPerson.yearlyNetIncome,e)],e.secondPerson.yearlyNetIncome&&e.relationship===Relationship.MARRIED&&a.push(this.getGrossIncomeFromNetIncomePromise(e.secondPerson.yearlyNetIncome,e)),this.roundPromise(t.all(a).then(function(e){var t=e[0];return e.length>1&&(t+=e[1]),o(t)}));if(null!==e.tax.monthlyNetIncome)return i=12*e.tax.monthlyNetIncome,this.roundPromise(this.getGrossIncomeFromNetIncomePromise(i,e));if(null!==e.mainPerson.monthlyNetIncome)return a=[this.getGrossIncomeFromNetIncomePromise(12*e.mainPerson.monthlyNetIncome,e)],null!==e.secondPerson.monthlyNetIncome&&e.relationship===Relationship.MARRIED&&a.push(this.getGrossIncomeFromNetIncomePromise(12*e.secondPerson.monthlyNetIncome,e)),this.roundPromise(t.all(a).then(function(e){var t=e[0];return e.length>1&&(t+=e[1]),o(t)}));if(null!==e.tax.taxableIncome)return this.roundPromise(this.wrapThePromise(r.calculateGrossIncomeStatePromise(e.zipAndLocation.id,l,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,e.tax.taxableIncome,!0)));if(null!==e.mainPerson.taxableIncome)return a=[r.calculateGrossIncomeStatePromise(e.zipAndLocation.id,l,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,e.mainPerson.taxableIncome,!0)],null!==e.secondPerson.taxableIncome&&e.relationship===Relationship.MARRIED&&a.push(r.calculateGrossIncomeStatePromise(e.zipAndLocation.id,c,e.secondPerson.civilStatus,e.secondPerson.confession,e.numberOfChildren,e.secondPerson.taxableIncome,!0)),this.wrapThePromise(t.all(a).then(function(e){var t=e[0];return e.length>1&&(t+=e[1]),o(t)}));if(null!==e.defaultGrossIncome)return s.resolve(e.defaultGrossIncome),s.promise;if(null!==e.defaultNetIncome)return this.roundPromise(this.getGrossIncomeFromNetIncomePromise(e.defaultNetIncome,e));var d=n.baseModelParameters.grossIncome;return void 0!==d||null!==d?(s.resolve(d),s.promise):(s.resolve(null),s.promise)},getPersonGrossIncomePromise:function(e,n,a,i){var s,l=t.defer(),c=this.getCurrentAge(n.birthYear);if(null!==n.grossIncome)return l.resolve(n.grossIncome),l.promise;if(null!==e.tax.grossIncome)return l.resolve(o(e.tax.grossIncome*a)),l.promise;if(null!==n.yearlyNetIncome)return this.roundPromise(this.getGrossIncomeFromNetIncomePromise(n.yearlyNetIncome,e));if(null!==e.tax.yearlyNetIncome)return s=e.tax.yearlyNetIncome*a,this.roundPromise(this.getGrossIncomeFromNetIncomePromise(s,e));if(null!==n.monthlyNetIncome)return s=12*n.monthlyNetIncome,this.roundPromise(this.getGrossIncomeFromNetIncomePromise(s,e));if(null!==e.tax.monthlyNetIncome)return s=12*e.tax.monthlyNetIncome*a,this.roundPromise(this.getGrossIncomeFromNetIncomePromise(s,e));if(null!==n.taxableIncome)return this.wrapThePromise(r.calculateGrossIncomeStatePromise(e.zipAndLocation.id,c,n.civilStatus,n.confession,e.numberOfChildren,n.taxableIncome,!0));if(null!==e.tax.taxableIncome){var u=e.tax.taxableIncome*a;return this.wrapThePromise(r.calculateGrossIncomeStatePromise(e.zipAndLocation.id,c,n.civilStatus,n.confession,e.numberOfChildren,u,!0))}return null!==e.defaultGrossIncome?(1===a?l.resolve(e.defaultGrossIncome):l.resolve(o(e.defaultGrossIncome*a)),
l.promise):null!==e.defaultNetIncome?(s=e.defaultNetIncome*a,this.roundPromise(this.getGrossIncomeFromNetIncomePromise(s,e))):void 0!==i&&null!==i?(l.resolve(i),l.promise):(l.resolve(null),l.promise)},getMainPersonGrossIncomePromise:function(e){return this.getPersonGrossIncomePromise(e,e.mainPerson,this.getMainPersonIncomePercentage(e),n.baseModelParameters.mainPersonGrossIncome)},getSecondPersonGrossIncomePromise:function(e){return this.getPersonGrossIncomePromise(e,e.secondPerson,this.getSecondPersonIncomePercentage(e),n.baseModelParameters.secondPersonGrossIncome)},getTaxTaxableIncomePromise:function(e){var a=t.defer(),i=this;if(null!==e.tax.taxableIncome)return a.resolve(e.tax.taxableIncome),a.promise;var s;if(null!==e.mainPerson.taxableIncome)return s=e.mainPerson.taxableIncome,null!==e.secondPerson.taxableIncome&&e.relationship===Relationship.MARRIED&&(s+=e.secondPerson.taxableIncome),a.resolve(s),a.promise;var l=this.getCurrentAge(e.mainPerson.birthYear),c=this.getCurrentAge(e.secondPerson.birthYear);if(null!==e.tax.grossIncome)return this.roundPromise(this.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,l,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,e.tax.grossIncome,!0)));var u;if(null!==e.mainPerson.grossIncome)return u=[this.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,l,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,e.mainPerson.grossIncome,!0))],null!==e.secondPerson.grossIncome&&u.push(this.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,c,e.secondPerson.civilStatus,this.getSecondPersonConfession(e),e.numberOfChildren,e.secondPerson.grossIncome,!0))),this.roundPromise(t.all(u).then(function(e){var t=e[0];return e.length>1&&(t+=e[1]),o(t)}));if(null!==e.tax.yearlyNetIncome)return this.getGrossIncomeFromNetIncomePromise(e.tax.yearlyNetIncome,e).then(function(t){return i.roundPromise(i.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,l,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,t,!0)))});if(null!==e.mainPerson.yearlyNetIncome)return u=[this.getGrossIncomeFromNetIncomePromise(e.mainPerson.yearlyNetIncome,e)],null!==e.secondPerson.yearlyNetIncome&&e.relationship===Relationship.MARRIED&&u.push(this.getGrossIncomeFromNetIncomePromise(e.secondPerson.yearlyNetIncome,e)),this.wrapThePromise(t.all(u).then(function(n){var a=[i.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,l,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,n[0],!0))];return n.length>1&&a.push(i.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,c,e.secondPerson.civilStatus,e.secondPerson.confession,e.numberOfChildren,n[1],!0))),t.all(a).then(function(e){var t=e[0];return e.length>1&&(t+=e[1]),o(t)})}));if(null!==e.tax.monthlyNetIncome)return this.getGrossIncomeFromNetIncomePromise(12*e.tax.monthlyNetIncome,e).then(function(t){return i.roundPromise(i.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,l,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,t,!0)))});if(null!==e.mainPerson.monthlyNetIncome)return u=[this.getGrossIncomeFromNetIncomePromise(12*e.mainPerson.monthlyNetIncome,e)],null!==e.secondPerson.monthlyNetIncome&&e.relationship===Relationship.MARRIED&&u.push(this.getGrossIncomeFromNetIncomePromise(12*e.secondPerson.monthlyNetIncome,e)),this.roundPromise(t.all(u).then(function(n){var a=[i.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,l,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,n[0],!0))];return n.length>1&&a.push(i.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,c,e.secondPerson.civilStatus,e.secondPerson.confession,e.numberOfChildren,n[1],!0))),t.all(a).then(function(e){var t=e[0];return e.length>1&&(t+=e[1]),o(t)})}));if(null!==e.defaultGrossIncome)return this.roundPromise(this.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,l,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,e.defaultGrossIncome,!0)));if(null!==e.defaultNetIncome)return this.getGrossIncomeFromNetIncomePromise(e.defaultNetIncome,e).then(function(t){return i.roundPromise(i.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,l,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,t,!0)))});var d=n.baseModelParameters.taxableIncome;return void 0!==d&&null!==d?(a.resolve(d),a.promise):(a.resolve(null),a.promise)},getPersonTaxableIncomePromise:function(e,n,a,i){var s,l,c=t.defer(),u=this.getCurrentAge(n.birthYear),d=this;return null!==n.taxableIncome?(c.resolve(n.taxableIncome),c.promise):null!==e.tax.taxableIncome?(c.resolve(o(e.tax.taxableIncome*a)),c.promise):null!==n.grossIncome?this.roundPromise(this.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,u,n.civilStatus,n.confession,e.numberOfChildren,n.grossIncome,!0))):null!==e.tax.grossIncome?(s=e.tax.grossIncome*a,this.roundPromise(this.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,u,n.civilStatus,n.confession,e.numberOfChildren,s,!0)))):null!==n.yearlyNetIncome?(l=n.yearlyNetIncome,this.getGrossIncomeFromNetIncomePromise(l,e).then(function(t){return d.roundPromise(d.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,u,n.civilStatus,n.confession,e.numberOfChildren,t,!0)))})):null!==e.tax.yearlyNetIncome?(l=e.tax.yearlyNetIncome*a,this.getGrossIncomeFromNetIncomePromise(l,e).then(function(t){return d.roundPromise(d.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,u,n.civilStatus,n.confession,e.numberOfChildren,t,!0)))})):null!==n.monthlyNetIncome?this.getGrossIncomeFromNetIncomePromise(12*n.monthlyNetIncome,e).then(function(t){return d.roundPromise(d.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,u,n.civilStatus,n.confession,e.numberOfChildren,t,!0)))}):null!==e.tax.monthlyNetIncome?(l=e.tax.monthlyNetIncome*a*12,this.getGrossIncomeFromNetIncomePromise(l,e).then(function(t){return d.roundPromise(d.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,u,n.civilStatus,n.confession,e.numberOfChildren,t,!0)))})):null!==e.defaultGrossIncome?(s=e.defaultGrossIncome*a,this.roundPromise(this.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,u,n.civilStatus,n.confession,e.numberOfChildren,s,!0)))):null!==e.defaultNetIncome?(l=e.defaultNetIncome*a,this.getGrossIncomeFromNetIncomePromise(l,e).then(function(t){return d.roundPromise(d.wrapThePromise(r.calculateTaxableIncomeStatePromise(e.zipAndLocation.id,u,n.civilStatus,n.confession,e.numberOfChildren,t,!0)))})):void 0!==i&&null!==i?(c.resolve(i),c.promise):(c.resolve(null),c.promise)},getMainPersonTaxableIncomePromise:function(e){return this.getPersonTaxableIncomePromise(e,e.mainPerson,this.getMainPersonIncomePercentage(e),n.baseModelParameters.taxableIncome)},getSecondPersonTaxableIncomePromise:function(e){return this.getPersonTaxableIncomePromise(e,e.secondPerson,this.getSecondPersonIncomePercentage(e),n.baseModelParameters.taxableIncome)},getTaxYearlyNetIncomePromise:function(e){var i,s,l=t.defer(),c=this.getCurrentAge(e.mainPerson.birthYear),u=this.getCurrentAge(e.secondPerson.birthYear),d=a.getActiveCountryCode();if(null!==e.tax.yearlyNetIncome)return l.resolve(e.tax.yearlyNetIncome),l.promise;if(null!==e.mainPerson.yearlyNetIncome)return i=e.mainPerson.yearlyNetIncome,null!==e.secondPerson.yearlyNetIncome&&e.relationship===Relationship.MARRIED&&(i+=e.secondPerson.yearlyNetIncome),l.resolve(i),l.promise;if(null!==e.tax.monthlyNetIncome)return l.resolve(12*e.tax.monthlyNetIncome),l.promise;if(null!==e.mainPerson.monthlyNetIncome)return i=12*e.mainPerson.monthlyNetIncome,null!==e.secondPerson.monthlyNetIncome&&e.relationship===Relationship.MARRIED&&(i+=12*e.secondPerson.monthlyNetIncome),l.resolve(i),l.promise;if(null!==e.tax.grossIncome)return this.roundPromise(this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e.tax.grossIncome,c,d)));if(null!==e.mainPerson.grossIncome)return s=[this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e.mainPerson.grossIncome,c,d))],null!==e.secondPerson.grossIncome&&s.push(this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e.secondPerson.grossIncome,u,d))),this.roundPromise(t.all(s).then(function(e){var t=e[0];return e.length>1&&(t+=e[1]),o(t)}));if(null!==e.tax.taxableIncome)return this.wrapThePromise(r.calcNetIncomeFromTaxableIncome(e.zipAndLocation.id,c,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,e.tax.taxableIncome,!0,d));if(null!==e.mainPerson.taxableIncome)return s=[r.calcNetIncomeFromTaxableIncome(e.zipAndLocation.id,c,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,e.mainPerson.taxableIncome,!0,d)],null!==e.secondPerson.taxableIncome&&e.relationship===Relationship.MARRIED&&s.push(r.calcNetIncomeFromTaxableIncome(e.zipAndLocation.id,u,e.secondPerson.civilStatus,e.secondPerson.confession,e.numberOfChildren,e.secondPerson.taxableIncome,!0,d)),this.wrapThePromise(t.all(s).then(function(e){var t=e[0];return e.length>1&&(t+=e[1]),o(t)}));if(null!==e.defaultNetIncome)return l.resolve(e.defaultNetIncome),l.promise;if(null!==e.defaultGrossIncome)return this.roundPromise(this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e.defaultGrossIncome,c,d)));var m=n.baseModelParameters.budgetNetIncomeYearly;return void 0!==m&&null!==m?(l.resolve(m),l.promise):(l.resolve(null),l.promise)},getPersonYearlyNetIncomePromise:function(e,i,s){var l,c=t.defer(),u=this,d=this.getCurrentAge(i.birthYear),m=a.getActiveCountryCode();if(null!==i.yearlyNetIncome)return c.resolve(i.yearlyNetIncome),c.promise;if(null!==i.monthlyNetIncome)return c.resolve(12*i.monthlyNetIncome),c.promise;if(null!==e.tax.yearlyNetIncome)return 1===s?c.resolve(e.tax.yearlyNetIncome):c.resolve(o(e.tax.yearlyNetIncome*s)),c.promise;if(null!==e.tax.monthlyNetIncome)return 1===s?c.resolve(e.tax.monthlyNetIncome*s*12):c.resolve(o(e.tax.monthlyNetIncome*s*12)),c.promise;if(null!==i.grossIncome)return m=a.getActiveCountryCode(),l=i.grossIncome,this.roundPromise(this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(l,d,m)));if(null!==e.tax.grossIncome)return l=e.tax.grossIncome*s,this.roundPromise(this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(l,d,m)));if(null!==i.taxableIncome)return u.wrapThePromise(r.calculateGrossIncomeStatePromise(e.zipAndLocation.id,d,i.civilStatus,i.confession,e.numberOfChildren,i.taxableIncome,!0)).then(function(e){return u.roundPromise(u.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e,d,m)))});if(null!==e.tax.taxableIncome)return u.wrapThePromise(r.calculateGrossIncomeStatePromise(e.zipAndLocation.id,d,i.civilStatus,i.confession,e.numberOfChildren,e.tax.taxableIncome*s,!0)).then(function(e){return u.roundPromise(u.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e,d,m)))});if(null!==e.defaultNetIncome)return 1===s?c.resolve(e.defaultNetIncome):c.resolve(o(e.defaultNetIncome*s)),c.promise;if(null!==e.tax.grossIncome)return l=e.tax.grossIncome*s,this.roundPromise(this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(l,d,m)));var g=n.baseModelParameters.budgetNetIncomeYearly;return void 0!==g&&null!==g?(c.resolve(o(g*s)),c.promise):(c.resolve(null),c.promise)},getMainPersonYearlyNetIncomePromise:function(e){return this.getPersonYearlyNetIncomePromise(e,e.mainPerson,this.getMainPersonIncomePercentage(e))},getSecondPersonYearlyNetIncomePromise:function(e){return this.getPersonYearlyNetIncomePromise(e,e.secondPerson,this.getSecondPersonIncomePercentage(e))},getTaxMonthlyNetIncomePromise:function(e){var i,s,l=t.defer(),c=this.getCurrentAge(e.mainPerson.birthYear),u=this.getCurrentAge(e.secondPerson.birthYear),d=a.getActiveCountryCode(),m=this;if(null!==e.tax.monthlyNetIncome)return l.resolve(e.tax.monthlyNetIncome),l.promise;if(null!==e.mainPerson.monthlyNetIncome)return i=e.mainPerson.monthlyNetIncome,null!==e.secondPerson.monthlyNetIncome&&e.relationship===Relationship.MARRIED&&(i+=e.secondPerson.monthlyNetIncome),l.resolve(i),l.promise;if(null!==e.tax.yearlyNetIncome)return l.resolve(o(e.tax.yearlyNetIncome/12)),l.promise;if(null!==e.mainPerson.yearlyNetIncome)return i=e.mainPerson.yearlyNetIncome/12,null!==e.secondPerson.yearlyNetIncome&&e.relationship===Relationship.MARRIED&&(i+=e.secondPerson.yearlyNetIncome/12),l.resolve(o(i)),l.promise;var g=e.tax.grossIncome;if(null===g&&(g=e.defaultGrossIncome),null!==g)return this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(g,c,d).then(function(e){return o(e/12)}));if(null!==e.mainPerson.grossIncome)return s=[this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e.mainPerson.grossIncome,c,d))],null!==e.secondPerson.grossIncome&&s.push(this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e.secondPerson.grossIncome,c,d))),this.roundPromise(t.all(s).then(function(e){var t=e[0];return e.length>1&&(t+=e[1]),o(t/12)}));if(null!==e.tax.taxableIncome)return this.wrapThePromise(r.calculateGrossIncomeStatePromise(e.zipAndLocation.id,c,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,e.tax.taxableIncome,!0).then(function(e){return m.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e,c,d)).then(function(e){return o(e/12)})}));if(null!==e.mainPerson.taxableIncome)return s=[r.calcNetIncomeFromTaxableIncome(e.zipAndLocation.id,c,e.mainPerson.civilStatus,e.mainPerson.confession,e.numberOfChildren,e.mainPerson.taxableIncome,!0,d)],null!==e.secondPerson.taxableIncome&&e.relationship===Relationship.MARRIED&&s.push(r.calcNetIncomeFromTaxableIncome(e.zipAndLocation.id,u,e.secondPerson.civilStatus,e.secondPerson.confession,e.numberOfChildren,e.secondPerson.taxableIncome,!0,d)),this.wrapThePromise(t.all(s).then(function(e){var t=e[0];return e.length>1&&(t+=e[1]),o(t/12)}));if(null!==e.defaultNetIncome)return l.resolve(o(e.defaultNetIncome/12)),l.promise;if(null!==e.defaultGrossIncome)return this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e.defaultGrossIncome,c,d).then(function(e){return o(e/12)}));var f=n.baseModelParameters.budgetNetIncomeMonthly;return void 0!==f&&null!==f?(l.resolve(f),l.promise):(l.resolve(null),l.promise)},getPersonMonthlyNetIncomePromise:function(e,n,i,s){var l=t.defer(),c=this.getCurrentAge(n.birthYear),u=this,d=a.getActiveCountryCode();return null!==n.monthlyNetIncome?(l.resolve(n.monthlyNetIncome),l.promise):null!==n.yearlyNetIncome?(l.resolve(o(n.yearlyNetIncome/12)),l.promise):null!==e.tax.monthlyNetIncome?(1===i?l.resolve(e.tax.monthlyNetIncome):l.resolve(e.tax.monthlyNetIncome*i),l.promise):null!==e.tax.yearlyNetIncome?(l.resolve(o(e.tax.yearlyNetIncome*i/12)),l.promise):null!==n.grossIncome?this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(n.grossIncome,c,d).then(function(e){return o(e/12)})):null!==n.grossIncome?this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(n.grossIncome*i,c,d).then(function(e){return o(e/12)})):null!==n.taxableIncome?this.wrapThePromise(r.calculateGrossIncomeStatePromise(e.zipAndLocation.id,c,n.civilStatus,n.confession,e.numberOfChildren,n.taxableIncome,!0)).then(function(e){return u.roundPromise(u.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e,c,d)).then(function(e){return o(e/12)}))}):null!==e.tax.taxableIncome?this.wrapThePromise(r.calculateGrossIncomeStatePromise(e.zipAndLocation.id,c,n.civilStatus,n.confession,e.numberOfChildren,e.tax.taxableIncome*i,!0)).then(function(e){return u.roundPromise(u.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e,c,d)).then(function(e){return o(e/12)}))}):null!==e.defaultNetIncome?(l.resolve(o(e.defaultNetIncome*i/12)),l.promise):null!==e.defaultGrossIncome?this.wrapThePromise(r.calculateNetIncomeFromGrossIncome(e.defaultGrossIncome*i,c,d).then(function(e){return o(e/12)})):void 0!==s&&null!==s?(l.resolve(o(s*i)),l.promise):(l.resolve(null),l.promise)},getMainPersonMonthlyNetIncomePromise:function(e){return this.getPersonMonthlyNetIncomePromise(e,e.mainPerson,this.getMainPersonIncomePercentage(e),n.baseModelParameters.budgetNetIncomeMonthly)},getSecondPersonMonthlyNetIncomePromise:function(e){return this.getPersonMonthlyNetIncomePromise(e,e.secondPerson,this.getSecondPersonIncomePercentage(e),n.baseModelParameters.budgetNetIncomeMonthly)},updateTaxGrossOrTaxableIncome:function(t){var n,a=(new Date).getFullYear()-t.mainPerson.birthYear,i=!0;return n=t.tax.entryType===EntryType.GROSS?r.calculateTaxableIncomeStatePromise(t.zipAndLocation.id,a,t.mainPerson.civilStatus,t.mainPerson.confession,t.numberOfChildren,t.tax.grossIncome,i):r.calculateGrossIncomeStatePromise(t.zipAndLocation.id,a,t.mainPerson.civilStatus,t.mainPerson.confession,t.numberOfChildren,t.tax.taxableIncome,i),e.requestCalculationsPromise([n]).then(function(e){var n=e[0];t.tax.entryType===EntryType.GROSS?t.tax.taxableIncome=n:t.tax.grossIncome=o(n)})},updatePersonsGrossOrTaxableIncome:function(t){var n,a,i=(new Date).getFullYear()-t.mainPerson.birthYear,s=(new Date).getFullYear()-t.secondPerson.birthYear,l=!0;return n=t.mainPerson.entryType===EntryType.GROSS?r.calculateTaxableIncomeStatePromise(t.zipAndLocation.id,i,t.mainPerson.civilStatus,t.mainPerson.confession,t.numberOfChildren,t.mainPerson.grossIncome,l):r.calculateGrossIncomeStatePromise(t.zipAndLocation.id,i,t.mainPerson.civilStatus,t.mainPerson.confession,t.numberOfChildren,t.mainPerson.taxableIncome,l),a=t.secondPerson.entryType===EntryType.GROSS?r.calculateTaxableIncomeStatePromise(t.zipAndLocation.id,s,t.secondPerson.civilStatus,this.getSecondPersonConfession(t),t.numberOfChildren,t.secondPerson.grossIncome,l):r.calculateGrossIncomeStatePromise(t.zipAndLocation.id,s,t.secondPerson.civilStatus,this.getSecondPersonConfession(t),t.numberOfChildren,t.secondPerson.taxableIncome,l),e.requestCalculationsPromise([n,a]).then(function(e){var n=e[0],r=e[1];t.mainPerson.entryType===EntryType.GROSS?t.mainPerson.taxableIncome=n:t.mainPerson.grossIncome=o(n),t.secondPerson.entryType===EntryType.GROSS?t.secondPerson.taxableIncome=r:t.secondPerson.grossIncome=o(r)})}},e.incomesCalculator=new i}])}),define("base-url-parameters-controller",["app","logger","common-object-utilities","calculators-manager"],function(e,t,n){"use strict";var r=t.get("BaseUrlParameters"),a=t.get("AsynchronousModeProfile");e.register.controller("baseUrlParametersController",["$scope","locationService","$route",function(e,t,i){var o=0,s=1,l=2,c=3,u=new n,d=function(e,t,n,r,a,i){this.name=e,this.type=t,this.path=n,this.onProcessed=r,this.removable=a,this.callback=i};d.prototype={_getValue:function(e){switch(this.type){case o:return e;case s:return""===e||isNaN(e)?0:parseFloat(e);case l:return""===e?!1:"true"===e.toLowerCase();case c:return this.callback(e)}return e},apply:function(t){var n=this._getValue(t);r.debug(" applying parameter "+this.name+" value="+n),a.debug("applyParameterValue - parameter: "+JSON.stringify(this.name)),a.debug("applyParameterValue - parameterValue: "+JSON.stringify(n)),a.debug("applyParameterValue - definition: "+JSON.stringify(this)),null!==this.path&&u.setValueThroughString(e,this.path,n),this.onProcessed&&this.onProcessed(n)}};var m=function(){this.list=[]};m.prototype={clear:function(){this.list=[]},get:function(){return this.list},addString:function(e,t,n,r){r="undefined"!=typeof r?r:!0;var a=new d(e,o,t,n,r);return this.list[e.toLowerCase()]=a,a},addNumeric:function(e,t,n,r){r="undefined"!=typeof r?r:!0;var a=new d(e,s,t,n,r);return this.list[e.toLowerCase()]=a,a},addBoolean:function(e,t,n,r){r="undefined"!=typeof r?r:!0;var a=new d(e,l,t,n,r);return this.list[e.toLowerCase()]=a,a},addCallback:function(e,t,n,r,a){a="undefined"!=typeof a?a:!0;var i=new d(e,c,t,r,a,n);return this.list[e.toLowerCase()]=i,i},getParameterFromUrl:function(e){e=e.toLowerCase();for(var t in i.current.params){var n=t.toLowerCase();if(e===n){var r=i.current.params[t];return r}}},process:function(e){var n=[];for(var o in i.current.params){var s=i.current.params[o];r.debug("Parameter: "+o+" value: "+s),a.debug("Parameter: "+o+" value: "+s);var l=this.list[o.toLowerCase()];void 0!==l&&(l.removable||n.push({name:o,value:s}),l.apply(s))}for(var c=t.getPath(),u=0;u<n.length;u++){var d=n[u];d===n[0]&&(c=c.concat("?")),c=c.concat(d.name+"="+d.value),d!==n[n.length-1]&&(c=c.concat("&"))}a.debug("CHANGING URL (UrlParameters.process)"),$(".modal.in").removeClass("in").modal("hide"),$(".modal-backdrop").hide(),t.setUrl(c),e&&e()}},e.urlParameters=new m}])}),define("enter-press",["app"],function(e){"use strict";var t=e.register.directive("enterPress",function(){return{link:function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.enterPress)}),t.preventDefault())})}}});return t}),define("visibility",["app"],function(e){"use strict";var t=e.register.directive("visibility",["$compile",function(e){return{restrict:"A",replace:!1,terminal:!0,priority:1e3,compile:function(t,n){return t.attr("ng-class",n.visibility+" ? '' : 'visibility--off'"),t.removeAttr("visibility"),t.removeAttr("data-visibility"),{pre:function(e,t,n,r){},post:function(t,n,r,a){e(n)(t)}}}}}]);return t}),define("custom-base-controller",["app"],function(e){"use strict";e.register.controller("customBaseController",["$scope",function(e){}])}),define("typeahead-watch-changes",["app"],function(e){"use strict";var t=e.register.directive("typeaheadwatchchanges",function(){return{require:["ngModel"],link:function(e,t,n,r){e.$watch("inputTextModel",function(e){r[0].$setViewValue(""),r[0].$setViewValue(e)})}}});return t}),define("search-field",["app","parameters-manager","logger","ui-bootstrap","typeahead-watch-changes"],function(e,t,n){"use strict";var r=(n.get("AsynchronousModeProfile"),e.register.directive("searchfield",["$timeout","$document",function(e,t){return{restrict:"E",scope:{label:"@",model:"=",attribute:"@",onChange:"&",searchFunction:"=",allowEmpty:"@",isRequired:"@"},templateUrl:"src/directives/fields/search-field/search-field.html",controller:["$scope",function(e){e.inputTextModel=null,e.$watch(function(){return void 0!==e.model?e.model[e.attribute]:null},function(t,n){(t!==n||null===e.inputTextModel)&&(e.inputTextModel=void 0!==e.model?e.model[e.attribute]:null)}),e.resetInputTextModel=function(){e.inputTextModel=void 0!==e.model?e.model[e.attribute]:null,void 0===e.inputTextModel&&e.searchText()},e.cancelOnEscape=function(t){27===t.keyCode&&e.resetInputTextModel()},e.onSelect=function(t){""===t&&e.allowEmpty?e.model[e.attribute]=null:e.model[e.attribute]=t,e.onChange()},e.searchText=function(t){return e.searchFunction(t).then(function(e){return e})},e.keepActiveListItemVisible=function(e,t){if(-1!==t){var n=e.find("ul.dropdown-menu")[0];if(void 0!==n){var r=e.find("ul.dropdown-menu li")[0];if(void 0!==r){var a=r.clientHeight,i=t*a,o=i+a,s=n.offsetHeight;o>n.scrollTop+s&&(n.scrollTop=(t-8+1)*a),i<n.scrollTop&&(n.scrollTop=i)}}}},e.resetInputTextModel()}],compile:function(n,r){return{pre:function(e,t,n,r){e.fieldId=n.model.replace(/\./g,"_")+"_"+n.attribute},post:function(n,r,a,i){var o=r.find("input");n.theInput=o;var s=function(){return"string"==typeof n.inputTextModel?n.inputTextModel:null===n.inputTextModel?"":n.inputTextModel.value},l=function(){return n.allowEmpty&&""===s()?!0:null===n.model[n.attribute]?!1:s()!==n.model[n.attribute].value?!1:!0};o.on("focus",function(t){e(function(){o[0].id===document.activeElement.id&&o.select()})}),o.on("blur",function(t){n.allowEmpty&&""===n.inputTextModel&&n.$apply(function(){n.onSelect("")}),l()||n.searchText(n.inputTextModel).then(function(t){1===t.length?e(function(){n.onSelect(t[0]),n.resetInputTextModel()}):e(function(){l()||n.resetInputTextModel()},250,!0)})}),n.$$childHead.$watch("activeIdx",function(e){n.keepActiveListItemVisible(r,e)});var c=function(){n.$$childHead.matches=[],n.$$childHead.activeIdx=-1,o.attr("aria-expanded",!1)},u=function(e){r[0].contains(e.target)||(c(),n.$digest())};t.bind("mousedown",u),n.$on("$destroy",function(){t.unbind("mousedown",u)})}}}}}]));return r}),define("base-controller",["app","parameters-manager","logger","common-object-utilities","theme-manager","routes-handler","common-scope-helper","common-currency-formatter","basic-base-controller","base-incomes-calculator-controller","base-url-parameters-controller","active-controller","loading-controller","localization","calculators-manager","message-service","google-analytics-service","print-service","file-service","filesaver","storage-manager","storage-service","location-breadcrumbs","enter-press","visibility","calculator-service","custom-base-controller","model-updater","zip-and-location-service","product-list-service","authentication-service","log-statistics-service","location-service","search-field"],function(e,t,n,r,a,i,o,s){"use strict";var l=n.get("Base"),c=n.get("AsynchronousModeProfile"),u=n.get("BaseStatus");e.register.controller("baseController",["$scope","activeController","loadingService","$rootScope","localize","$timeout","$window","$templateCache","$http","$compile","$injector","calculatorsManager","printService","fileService","storageManager","translateRoute","messageService","locationBreadcrumbsService","storageService","$q","calculatorService","googleAnalyticsService","modelUpdater","zipAndLocationService","productListService","authenticationService","logStatisticsService","locationService",function(e,n,d,m,g,f,h,p,v,S,b,P,C,I,w,R,A,y,E,T,D,x,N,M,L,O,F,k){function U(){e.onModalCloseInitialized=!1,e.dialogTemplatePath=void 0;var t=function(e){if(e){var t=e[0].toUpperCase()+e.substring(1);return t.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}return""};e.openDialog=function(n,r){var a=r;if(!a){if(!e.dialogTemplatePath)return void l.error("variable 'dialogTemplatePath' or 'path' parameter must be defined");a=e.dialogTemplatePath}e.dialogName=n,e.templatePath=a+n+".html",m.$broadcast("setup"+t(e.dialogName));var i=m.$on("finish"+t(e.dialogName)+"Setup",function(){e.dialogWindowOpen=!0,$("#editDialogBox"+t(e.dialogName)).modal("show"),i()});e.onModalCloseInitialized||(e.onModalCloseInitialized=!0,$("#editDialogBox"+t(e.dialogName)).on("hidden.bs.modal",function(){e.dialogWindowOpen=!1}))},e.close=function(){$("#editDialogBox"+t(e.dialogName)).modal("hide"),e.calculate()}}function z(){e.calculated=T.defer(),e.pendingCalculation=void 0,e.calculating=!1,e.updateChartsOnCalculate=!0,e.onCalculationFinished=function(){e.refresh(),e.updateChartsOnCalculate=!0,e.calculated=T.defer(),e.calculating=!1,e.pendingCalculation&&(c.debug("*** Processing pending calculation"),e.calculate(e.pendingCalculation.callback))},e.onCalculationAborted=function(){e.calculated=T.defer(),e.calculating=!1,e.pendingCalculation&&(c.debug("*** Processing pending calculation"),e.calculate(e.pendingCalculation.callback))},e.calculate=function(t,n){return c.debug("*** Calculate called"),e.calculating?(c.warn("there is a calculation already running, marking new calculation as pending"),void(e.pendingCalculation={callback:t})):(e.calculating=!0,e.pendingCalculation=void 0,void e.preCalculate.promise.then(function(){return e.hasBeenRejected=!1,c.debug("*** ... about to calculate, checking for scope changes"),void 0===n&&(n=!1),n||e.scenarioHasChanged(e.scenario,e.base)?(c.debug("*** ... calling doCalculate"),e.doCalculate&&e.doCalculate(t),c.debug("*** ... doCalculate finished"),void e.calculated.promise.then(function(){e.onCalculationFinished()},function(t){e.onCalculationAborted()})):(c.debug("*** ... doCalculate skipped, no changes"),"function"==typeof t&&t(),void e.onCalculationFinished())},function(t){e.rejectHandler(t),e.onCalculationAborted()}))},e.finishCalculation=function(){c.debug("### finishCalculation"),e.scenario&&e.base&&e.saveScenario(e.scenario,e.base),e.calculated.resolve("")},e.abortCalculation=function(){c.debug("### abortCalculation"),e.calculated.reject("")},e.whenCalculated=function(t){e.doCalculate?T.when(e.calculated,function(){c.debug("REQUEST CALCULATION FINISHED, running callback"),"function"==typeof t&&t()}):"function"==typeof t&&t()},e.pendingRequestCalculation=void 0,e.requestCalculated=void 0,e.requestCalculations=function(t,n,r){return c.debug("Requesting calculation for "+r),e.clearMessagesForGroup("Calculation"),e.requestCalculated&&0===e.requestCalculated.$$state.status?(c.warn("there is a request calculation already running ("+e.runningCalculationDescription+"), marking new calculation as pending"),void(e.pendingRequestCalculation={calculationRequests:t,callback:n,description:r})):(e.pendingRequestCalculation=void 0,e.runningCalculationDescription=r,c.debug("request calculations"),void D.sendRequests().then(function(){e.requestCalculated=T.all(t).then(function(t){if(c.debug("Calculation requests finished for "+r+", generating results"),!e.hasBeenRejected)if(e.pendingRequestCalculation){c.debug("Processing pending request calculation for "+e.pendingRequestCalculation.description);var a=e.pendingRequestCalculation;c.debug("--> Hanging listener"),e.requestCalculated.then(function(){e.requestCalculations(a.calculationRequests,a.callback,a.description)})}else e.requestCalculated.then(function(){"function"==typeof n&&n(t)})},function(t){e.abortCalculation(),e.rejectHandler(t)})},function(t){e.rejectHandler(t)}))},e.requestCalculationsPromise=function(t){var n=T.defer();return e.requestCalculations(t,function(e){n.resolve(e)}),n.promise},e.onRefresh=function(){},e.refresh=function(){return e.updateChartsOnCalculate?void f(function(){c.debug("Refreshing..."),e.isReady()?e.onRefresh():c.warn("REFRESH AFTER CALCULATION AVOIDED")}):void c.debug("AVOID UPDATE CHARTS ON CALCULATE")},e.onActiveChartRedraw=function(){},e.forceActiveChartDraw=function(){f(function(){f(function(){e.updateChartsOnCalculate=!0,e.getVisibleRefreshHandlers?(e.helper.display(e.getVisibleRefreshHandlers()),e.onActiveChartRedraw()):e.onActiveChartRedraw()})})},$("#alternativeResult").length&&(e.onResize=function(){0!==h.outerWidth&&h.outerWidth<516||0===h.outerWidth&&screen.width<516?"mobile"!==e.style&&(e.style="mobile",$("#alternativeResult").insertAfter($("#alternativeData"))):"desktop"!==e.style&&(e.style="desktop",$("#alternativeData").insertAfter($("#alternativeResult")))},h.onresize=e.onResize,f(function(){e.onResize()})),e.urlParameters.addCallback("language","language",function(e){return e||(e=g.getSessionStoredLanguage()),e&&e!==g.getActiveLanguage()&&g.setLanguage(e),e}),e.urlParameters.addCallback("country","country",function(e){return e||(e=g.getSessionStoredCountry()),e&&e!==g.getActiveCountry()&&g.setCountry(e),e}),e.addCustomBaseUrlParameters&&e.addCustomBaseUrlParameters(),e.showResultPanel=function(){return!0},e.createBridge=function(){var t={};return t.createChartUpdater=function(t,n){return e.createChartUpdater(t,n)},t.createRefreshHandler=function(t,n){return e.helper.createRefreshHandler(t,n)},t.update=function(){throw"'update' must be defined!"},t.forceDraw=function(){throw"'forceDraw' must be defined!"},t.getChart=function(){throw"'getChart' must be defined!"},t.newBridge=function(){return e.createBridge()},t.openDialog=function(t,n){return e.openDialog(t,n)},t.$cleverWatch=function(t,n,r){return e.$cleverWatch(t,n,r)},t.loadTemplateArray=function(t,n,r,a){return e.loadTemplateArray(t,n,r,a)},t.getDefaultCurrencyFormatter=function(){return e.defaultCurrencyFormatter},t},e.getProductList=function(e){return L.getProductList(e).then(function(t){return-1===t.status&&l.warn("Product list "+e+" could not be loaded from the server: using local version"),t.list})}}function B(){e.createChartUpdater=function(t,n){var r={};return r.showing=!0,r.dismiss=function(){t.dismiss()},r.update=function(r){return e.isDisplayable()?(n(t),e.showResultPanel()?(this.showing||(this.showing=!0,r=!0),r?e.resetDrawing(t):t.draw()):void(this.showing=!1)):void 0},r}}m.$emit("viewControllerInitializationStarted"),b.invoke(["$controller",function(t){t("basicBaseController",{$scope:e})}]),b.invoke(["$controller",function(t){t("customBaseController",{
$scope:e})}]),b.invoke(["$controller",function(t){t("baseIncomesCalculatorController",{$scope:e})}]),b.invoke(["$controller",function(t){t("baseUrlParametersController",{$scope:e})}]),l.debug("starting base controller"),e.displayable=!1,e.ready=!1,e.preCalculate=T.defer(),e.prePromises=[],e.initialPromise=T.defer(),e.initialPromises=[],e.prePromisesDefined=T.defer(),e.helper=new o(e),e.defaultCurrencyFormatter=new s(t.baseViewParameters.groupDelimiter,t.baseViewParameters.amountDecimalDelimiter,t.baseViewParameters.useMixedGroupingSeparator);var V=function(){e.onModelSetup(),e.prePromisesDefined.resolve()},G=function(){e.updateChartsOnCalculate=!1,e.onRouteUpdateBeforeAnimating(),e.data&&void 0!==e.data.alternativeOpen&&_(e.data.alternativeOpen),e.onRouteUpdateBeforeCalculating(),e.calculate(function(){e.onRouteUpdateAfterCalculating(),e.forceActiveChartDraw(),e.setInitialFocusWithAnimation()},!0)},_=function(t){"desktop"===e.style?(e.sleepResetDrawingChartDuringAnimation=!0,$(".animated-container").addClass("slide"),$(".animated-div").addClass("fade-in-out"),t?($(".animated-div").removeClass("slide-right"),$(".animated-div").addClass("slide-left")):($(".animated-div").removeClass("slide-left"),$(".animated-div").addClass("slide-right")),$(".resultPanel").addClass("fade-in-out")):($(".animated-container").removeClass("slide"),$(".animated-div").removeClass("slide-left"),$(".animated-div").removeClass("slide-right"),$(".resultPanel").removeClass("fade-in-out"))},H=function(){if(c.debug("!!! starting resolvePrePromises"),e.hasBeenRejected)e.preCalculate.reject();else{var t=e.prePromises.slice();t.length>0?D.sendRequests().then(function(){c.debug("resolveprepromises"),T.all(t).then(function(t){c.debug("!!! FINISHED resolvePrePromises"),e.hasPendingPrePromises()?(c.debug("!!! NEW PRE-PROMISES DETECTED!"),H()):e.preCalculate.resolve(t)},function(t){e.rejectHandler(t)})},function(t){e.rejectHandler(t)}):e.preCalculate.resolve()}},j=function(){c.debug("!!! starting resolveInitialPromises"),e.hasBeenRejected?e.initialPromise.reject():e.initialPromises.length>0?D.sendRequests().then(function(){c.debug("resolveInitialPromises"),T.all(e.initialPromises).then(function(t){c.debug("!!! FINISHED resolveInitialPromises"),e.hasPendingInitialPromises()?(c.debug("!!! NEW INITIAL PROMISES DETECTED!"),j()):e.initialPromise.resolve(t)},function(t){e.rejectHandler(t)})},function(t){e.rejectHandler(t)}):e.initialPromise.resolve()},q=function(){e.clearPrePromises()},Y=function(n){c.debug("finishLoading called, waiting..."),e.prePromisesDefined.promise.then(function(){c.debug("==================== finishLoading ===================="),H(),e.doCalculate?e.calculated.promise.then(function(){c.debug("1. INITIAL CALCULATION DONE"),u.debug("1. INITIAL CALCULATION DONE"),e.initialCalculationDone=!0,"function"==typeof n&&n(),e.setStatus()}):(c.debug("1. INITIAL CALCULATION DONE"),u.debug("1. INITIAL CALCULATION DONE"),e.initialCalculationDone=!0,e.setStatus());var r=t.baseApplicationParameters.googleAnalyticsID;r instanceof Array||(r=[]),h.initializeGoogleAnalytics(r),$(document).ready(function(){f(function(){e.domReady=!0,c.debug("2. DOM READY"),u.debug("2. DOM READY"),e.setStatus()}),f(function(){e.updateDocumentTitle(),e.updateDocumentDescription(),e.broadcastViewTitle(),e.documentTitleReady=!0,c.debug("3. DOCUMENT TITLE"),u.debug("3. DOCUMENT TITLE"),e.setStatus()})}),$("#copyright-disclaimer").show(),d.finishLoading(),e.baseControllerReady=!0,c.debug("4. BASE CONTROLLER READY"),u.debug("4. BASE CONTROLLER READY"),e.setStatus(),y.push(e.getCanGoBackFunction())}),e.data&&void 0!==e.data.alternativeOpen&&(e.urlParameters.addBoolean("showAlternative","data.alternativeOpen",function(t){e.onShowAlternativeUrlParameterParsed&&e.onShowAlternativeUrlParameterParsed(t)},!1),e.openAlternative=function(){e.onOpenAlternative&&e.onOpenAlternative(),k.setSearch("showAlternative=true")},e.closeAlternative=function(){e.onCloseAlternative&&e.onCloseAlternative(),k.setSearch("showAlternative=false")})};e.rejectHandler=function(t){e.hasBeenRejected=!0,l.error(t),e.clearScenario(),f(function(){e.showErrorMessage("CalculationError",{enumName:"Application",group:"Calculation"}),e.ready||(d.finishLoading(),e.ready=!0,m.status="ready",m.activeController=e.controllerName,m.$emit("viewControllerInitializationFinished"))})},e.onModelSetup=function(){},e.defineUrlParameters=function(){},e.dossierIdUrlParameter=function(){e.urlParameters.addString("dossierId",null,function(t){e.addPrePromise(E.getDossier("AnonymousContactDossier",t,null).then(function(t){N.update(t.dossier.onlineCalc).then(function(){w.updateStoredObjectWith(t.dossier.onlineCalc),e.showSuccessMessage("GetDossierSucceeded",{enumName:"StorageService",group:"DossierID",useTimeout:!0,dismissOnNavigation:!1})})["catch"](function(t){e.showErrorMessage("CouldNotUpdateDossier",{enumName:"StorageService",group:"DossierID",useTimeout:!0,dismissOnNavigation:!1})})},function(t){t.status===StorageServiceResultStatus.DOSSIERNOTAVAILABLE&&e.showErrorMessage("DossierNotAvailable",{enumName:"StorageService",group:"DossierID",useTimeout:!0,dismissOnNavigation:!1}),t.status===StorageServiceResultStatus.DOSSIERNOTFOUND?e.showErrorMessage("DossierNotFound",{enumName:"StorageService",group:"DossierID",useTimeout:!0,dismissOnNavigation:!1}):e.showErrorMessage("GetDossierFailed",{enumName:"StorageService",group:"DossierID",useTimeout:!0,dismissOnNavigation:!1})}))})},e.calculatorServiceTokenUrlParameter=function(){var t=e.urlParameters.getParameterFromUrl("calculatorServiceToken");t&&(window.calculatorServiceToken=e.urlParameters.getParameterFromUrl("calculatorServiceToken"))},e.onPrintSetup=function(e){},e.start=function(){Y(),e.hasBeenRejected=!1,e.calculatorServiceTokenUrlParameter(),j(),e.initialPromise.promise.then(function(){e.dossierIdUrlParameter(),e.defineUrlParameters(),e.urlParameters.process(function(){V()})}),e.onPrintSetup(C)},e.getStatistics=function(){var e=new a,t=O.getUserData();return{pcId:window.localStorage.pcId,customer:t?t.customerNumber:null,userId:O.getUserLogged(),calculator:e.getCurrentSubThemeId()}},e.addInitialPromise=function(t){e.initialPromises.push(t)},e.hasPendingInitialPromises=function(){for(var t=0;t<e.initialPromises.length;t++){var n=e.initialPromises[t];if(0===n.$$state.status)return!0}return!1},e.addPrePromise=function(t){e.prePromises.push(t)},e.hasPendingPrePromises=function(){for(var t=0;t<e.prePromises.length;t++){var n=e.prePromises[t];if(0===n.$$state.status)return!0}return!1},e.clearPrePromises=function(){e.preCalculate=T.defer(),e.prePromises=[],e.hasBeenRejected=!1},e.allPrePromisesResolved=function(){return 0!==e.preCalculate.promise.$$state.status},e.onRouteUpdateBeforeAnimating=function(){},e.onRouteUpdateBeforeCalculating=function(){},e.onRouteUpdateAfterCalculating=function(){},e.$on("$routeUpdate",function(){c.debug("ROUTE CHANGED. ready? "+e.ready),e.ready&&(q(),e.data&&void 0!==e.data.alternativeOpen&&(e.data.alternativeOpen=!1),c.debug("routeUpdate before process"),e.urlParameters.process(function(){V(),e.prePromisesDefined.promise.then(function(){H()}),G()}))}),e.onNewConsulting=function(){},e.onBeforeNewConsulting=function(){},e.$on("newConsulting",function(){q(),e.onBeforeNewConsulting(),V(),e.prePromisesDefined.promise.then(function(){H(),e.onNewConsulting(),e.getVisibleRefreshHandlers&&e.helper.display(e.getVisibleRefreshHandlers()),e.calculate()})}),e.shutdown=function(){e.helper.forEachRefreshHandler(function(e){e.shutdown()})},$("body").scrollTop(0),z(),B(),U(),e.initiallyFocusedElement=function(){return l.error("$scope.initiallyFocusedElement should have been overwritten by concrete controllers"),null},e.setScrollForFocusedElement=function(e){var t=$(e).offset().top,n=$(window).scrollTop(),r=window.innerHeight,a=t-n;if(0>a||a>r){var i=$(e).closest(".fancy-box");if(i.length>0){var o=i.offset().top;$("html,body").scrollTop(o-50)}}},e.setFocus=function(t,n,r){if(void 0===n&&(n=!0),null===t)return l.warn("Element to set focus is null"),void("function"==typeof r&&r());var a=!1,i=0,o=window.setInterval(function(){if(i++,i>=10)return window.clearInterval(o),l.warn("Couldn't set focus on "+t),void("function"==typeof r&&r());if(a)return void window.clearInterval(o);if(0!==$(t).length){var s;s=window.matchMedia?window.matchMedia("only screen and (max-width: 760px)"):{matches:!1},n&&e.setScrollForFocusedElement(t),s.matches||$(t).focus(),a=$(t)[0].id===document.activeElement.id,a?(window.clearInterval(o),"function"==typeof r&&r()):l.warn("Setting focus has no effect, will retry")}},100)},e.setInitialFocus=function(t,n){var r=e.initiallyFocusedElement();e.setFocus(r,t,n)},e.updateDocumentTitle=function(){var e=new a,t="",n=e.getCurrentThemeId(),r=e.getCurrentSubThemeId();null!==n&&null!==r&&void 0!==r?t=g.getLocalizedString("PageTitles."+n+"_"+r):null!==n&&(t=g.getLocalizedString("PageTitles."+n)),document.title!==t&&(document.title=t,m.$emit("documentTitleChanged",t))},e.updateDocumentDescription=function(){var e="",t=new a;null!==t.getCurrentThemeId()&&null!==t.getCurrentSubThemeId()&&void 0!==t.getCurrentSubThemeId()?e=g.getLocalizedString("PageDescriptions."+t.getCurrentThemeId()+"_"+t.getCurrentSubThemeId()):null!==t.getCurrentThemeId()&&(e=g.getLocalizedString("PageDescriptions."+t.getCurrentThemeId())),""===e&&(e=g.getLocalizedString("PageDescriptions.Main")),""!==e&&$("meta[name=description]").attr("content",e)},e.broadcastViewTitle=function(){var t=g.getLocalizedString(e.controllerName+".Title");m.$emit("viewTitleChanged",t)},e.onLocalizationChange=function(){};var W=m.$on("localizeResourcesUpdates",function(){e.updateDocumentTitle(),e.updateDocumentDescription(),e.broadcastViewTitle(),e.ready&&(q(),e.data&&void 0!==e.data.alternativeOpen&&(e.data.alternativeOpen=!1),c.debug("routeUpdate before process"),e.urlParameters.process(function(){V(),e.prePromisesDefined.promise.then(function(){H()}),e.onLocalizationChange(),e.forceActiveChartDraw(),e.data&&void 0!==e.data.alternativeOpen&&_(e.data.alternativeOpen),e.setInitialFocusWithAnimation()}))});e.templateArrayInfo={},e.getTemplateArrayInfoForTemplateId=function(t){return e.templateArrayInfo[t]||(e.templateArrayInfo[t]={scopes:[],elements:[]}),e.templateArrayInfo[t]},e.cleanTemplateArrayInfoForTemplateId=function(t){for(var n=e.getTemplateArrayInfoForTemplateId(t),r=0;r<n.scopes.length;r++){var a=n.scopes[r],i=n.elements[r];a.$destroy(),i.remove()}e.templateArrayInfo[t]={scopes:[],elements:[]}},e.loadTemplateArray=function(t,n,r,a){var i=[];return e.cleanTemplateArrayInfoForTemplateId(t),e.basicLoadTemplate(n).then(function(n){for(var o=e.getTemplateArrayInfoForTemplateId(t),s=0;r>s;s++){var l=S(n.data.trim()),c=e.$new();a(c,s);var u=l(c);o.scopes.push(c),o.elements.push(u),i[s]=u}return i}).then(function(){return f(function(){return i})})},e.basicLoadTemplate=function(e){return v.get(e,{cache:p})},e.loadTemplate=function(e,t){return v.get(e,{cache:p}).then(function(e){var n=S(e.data.trim())(t);return f(function(){return n})})},e.$cleverWatch=function(t,n,r){e.$watch(t,function(e,t){e!==t&&(n(e,t),H())},r)},e.objectUtilities=new r,e.previousScenario=null,e.previousBase=null,e.scenarioHasChanged=function(t,n){var r,a;return r=null===e.previousScenario?!0:!e.objectUtilities.equals(e.previousScenario,t),a=null===e.previousBase?!0:!e.objectUtilities.equals(e.previousBase,n),r||a};var X=function(e,t,n){n||(n="");var r;if(Array.isArray(e))for(var a=0;a<e.length;a++)r=e[a],null!==r&&"object"==typeof r&&X(r,t+"["+a+"]",n+"...");else{Object.isExtensible(e)&&(l.error(n+"Model '"+t+"' is not protected!"),l.error(e));for(var i in e)r=e[i],null!==r&&"object"==typeof r&&X(r,i,n+"...")}};e.saveScenario=function(t,n){e.previousBase=JSON.parse(JSON.stringify(n)),e.previousScenario=JSON.parse(JSON.stringify(t)),X(n,"base"),X(t,"scenario")},e.clearScenario=function(){e.previousBase=null,e.previousScenario=null},n.set(e.controllerName),e.$on("$destroy",function(){W(),Q(),te(),e.shutdown(),n.clear()}),e.baseControllerReady=!1,e.documentTitleReady=!1,e.loaded=!1,e.initialCalculationDone=!1,e.domReady=!1,e.initialFocusReady=!1,e.isDisplayable=function(){return e.displayable},e.isReady=function(){return e.ready},e.onReady=function(){},e.setStatus=function(){e.isReady()||(e.isDisplayable()?e.initialFocusReady?(c.debug("SCOPE IS READY "+e.controllerName),f(function(){c.debug("Calling onReady for "+e.controllerName),e.onReady(),e.ready=!0,c.debug("**** CONTROLLER READY ****"),m.status="ready",m.activeController=e.controllerName,x.sendPageView(),F.sendEventOnceByConsulting("used",e.getStatistics()),m.$emit("viewControllerInitializationFinished")})):f(function(){e.setInitialFocus(!1,function(){f(function(){e.initialFocusReady=!0,c.debug("6. INITIAL FOCUS"),u.debug("6. INITIAL FOCUS"),e.setStatus()})})}):e.baseControllerReady&&e.domReady&&e.documentTitleReady&&e.loaded&&e.initialCalculationDone&&(e.displayable=!0,c.debug("SCOPE IS DISPLAYABLE "+e.controllerName),u.debug("SCOPE IS DISPLAYABLE "+e.controllerName),f(function(){e.setStatus()})))},e.sleepResetDrawingChartDuringAnimation=!1,e.resetDrawing=function(n){return e.sleepResetDrawingChartDuringAnimation?(e.sleepResetDrawingChartDuringAnimation=!1,f(function(){n.resetDrawing()},t.baseViewParameters.animationDuration)):n.resetDrawing(),!0},e.setInitialFocusWithAnimation=function(){var n=$("body")[0],r=n.style.minHeight;n.style.minHeight=n.clientHeight+"px",setTimeout(function(){n.style.minHeight=r,e.setInitialFocus()},t.baseViewParameters.animationFocusDuration)},e.$on("$routeChangeSuccess",function(){var e=new a,t=i.getId(),n=P.getThemeNameFromString(t),r=P.getCalculatorNameFromString(t);e.setTheme(n,r)}),e.$on("languageChangeSuccess",function(){e.calculate(function(){},!0)}),e.onCountryChangeSuccess=function(){},e.shouldCalculateOnCountryChange=function(e){return!0},e.$on("countryChangeSuccess",function(){var t=w.getStoredObject("base");t&&(t.country=g.getActiveCountry(),M.searchMoreImportantLocation(M.getActiveCountryLocationDefault()).then(function(e){var n=function(e){return"LI"===e.state?"LI":"CH"};(null===t.zipAndLocation||n(t.zipAndLocation)!==n(e))&&(t.zipAndLocation=e)})),e.onCountryChangeSuccess(),e.shouldCalculateOnCountryChange(g.getActiveCountry())&&e.calculate(function(){},!0)}),e.$on("languageChangeFailed",function(){f(function(){e.showErrorMessage("LanguageChangeFailed",{enumName:"Application",group:"Language"})})}),e.$on("countryChangeFailed",function(){f(function(){e.showErrorMessage("countryChangeFailed",{enumName:"Application",group:"Country"})})});var K=function(e){return void 0!==e&&null!==e&&""!==e},J=function(){var e,t=new a,n=t.getCurrentThemeId(),r=t.getCurrentSubThemeId();return K(n)&&(e=n,K(r)&&(e+="."+r)),e};e.getCurrentContact=function(){var e=J();return P.getContactUrl(e)},e.showCalculatorsButton=function(){return t.baseViewParameters.calculatorSelectionEnabled&&P.availableCalculators().length>0},e.getSocialMediaUrl=function(e){var t=J();return P.getSocialMediaUrl(t,e)},e.onSocialMediaButton=function(t){e.hideNavBarCollapse();var n=e.getSocialMediaUrl(t);window.open(n)},e.getAvailableSocialMedia=function(){var e=J();return P.getAvailableSocialMedia(e)},e.showContact=function(){return t.baseViewParameters.contactIconEnabled?K(t.baseApplicationParameters.contactServiceURL)?!0:K(e.getCurrentContact()):!1},e.contact=function(){return F.sendEvent("contact",e.getStatistics()),e.hideNavBarCollapse(),t.baseApplicationParameters.screenContactUrlByIframe?void m.$emit("openContactUrl",e.getCurrentContact()):K(t.baseApplicationParameters.contactServiceURL)?(y.push(e.getCanGoBackFunction()),k.clearSearch(),void k.setPath(R.getPath("contact"))):void window.open(e.getCurrentContact())},e.basicShowPrint=function(){var e=new a,n=null!==e.getCurrentSubThemeId()&&void 0!==e.getCurrentSubThemeId(),r=void 0!==t.baseApplicationParameters.printServiceURL&&null!==t.baseApplicationParameters.printServiceURL&&""!==t.baseApplicationParameters.printServiceURL;return n&&r},e.showPrint=function(){return e.basicShowPrint()},e.getThemePrintShortTitle=function(){var e=new a;return"PrintShortTitle."+e.getCurrentThemeId()},e.printStartHandlers=[],e.addPrintStartHandler=function(t){e.printStartHandlers.push(t)},e.updateUser=function(n){var r;if(t.baseViewParameters.askConsultantDataForPrinting&&n){e.additionalPrintingData=n;var a=w.getStoredObject("base");if(a&&(a.additionalPrintingData=n),w.storeOnBrowserLocalStorage("consultantInfo",n.consultantInfo),w.storeOnBrowserLocalStorage("additionalData",n.additionalData),t.baseApplicationParameters.consultantMode){w.storeOnBrowserLocalStorage("customerNumber",e.additionalPrintingData.customerNumber),w.storeOnBrowserLocalStorage("customerInfo",e.additionalPrintingData.customerInfo);var i={userId:O.getUserLogged(),password:"",confirmationToken:""},o={userId:O.getUserLogged(),userData:O.getUserData()};o.userData.customerNumber=e.additionalPrintingData.customerNumber,o.userData.customerInfo=e.additionalPrintingData.customerInfo,o.userData.consultantInfo=e.additionalPrintingData.consultantInfo,o.userData.additionalData=e.additionalPrintingData.additionalData;var s=T.defer();r=s.promise,O.updateUser(i,o).then(function(){s.resolve()},function(e){s.reject(e)})}else r=T.when()}else r=T.when();return r},e.basicPrint=function(n,r,a){return e.basicLoadTemplate(n).then(function(n){var i=n.data;return C.print(i,e.printTemplateName,e,r,a).then(function(n){var r=n.content;t.baseApplicationParameters.informParentWindowOnPrintSuccess&&m.$emit("printSuccessful",r);var a=document.createElement("a");if(navigator.userAgent.indexOf("Trident")>0||navigator.userAgent.indexOf("MSIE")>0)a.target="_blank",a.onclick=function(){saveAs(r,"print.pdf")},document.body.appendChild(a),f(function(){a.click()}),e.showSuccessMessage("PrintSucceeded",{enumName:"PrintService",group:"Print",useTimeout:!0});else{var i=URL.createObjectURL(r);a.href=i,a.download="print.pdf",document.body.appendChild(a),f(function(){-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")?e.showSuccessMessage("PrintSucceeded",{enumName:"PrintService",group:"Print",useTimeout:!1,actions:[{localizedLabel:A.prepareLocalizedText("PrintService","OpenPrintedDocument"),id:"openPrintedDocument",fn:function(){a.target="_blank",a.click(),A.removeAllMessagesWithGroup("Print")}}]}):(a.click(),e.showSuccessMessage("PrintSucceeded",{enumName:"PrintService",group:"Print",useTimeout:!0}))})}},function(t){t.status===PrintServiceResultStatus.NOCONTENT&&e.showErrorMessage("PrintFailed",{enumName:"PrintService",group:"Print"}),t.status===PrintServiceResultStatus.SERVERERROR&&e.showErrorMessage("PrintFailed",{enumName:"PrintService",group:"Print"}),t.status===PrintServiceResultStatus.PREPARATIONERROR&&e.showErrorMessage("PrintFailed",{enumName:"PrintService",group:"Print"})})},function(){e.showErrorMessage("PrintFailed",{enumName:"PrintService",group:"Print"})})},e.beforePrint=function(){F.sendEvent("print",e.getStatistics()),e.hideNavBarCollapse(),A.removeAllMessagesWithGroup("Print"),e.showInfoMessage("PrintStarted",{enumName:"PrintService",group:"Print"}),e.printStartHandlers.forEach(function(e){e()})},e.print=function(t){return e.beforePrint(),e.updateUser(t).then(function(){return e.basicPrint(e.printTemplatePath)})},e.getExtraPrintingData=function(e){},e.saveFileCSV=function(t,n,r,a){return I.saveCSV(t,n,r,a).then(function(){},function(t){throw t.status===FileServiceResultStatus.SERVERERROR&&e.showErrorMessage("SaveFailed",{enumName:"FileService",group:"Print"}),t.status===FileServiceResultStatus.PREPARATIONERROR&&e.showErrorMessage("SaveFailed",{enumName:"FileService",group:"Print"}),t})},e.saveFile=function(t,n,r,a){return e.basicLoadTemplate(t).then(function(t){return I.save(t.data,e,n,r,a).then(function(){},function(t){throw t.status===FileServiceResultStatus.SERVERERROR&&e.showErrorMessage("SaveFailed",{enumName:"FileService",group:"Print"}),t.status===FileServiceResultStatus.PREPARATIONERROR&&e.showErrorMessage("SaveFailed",{enumName:"FileService",group:"Print"}),t})})},e.packageFileList=function(t,n,r){return I.packageFileList(t,n,r).then(function(){},function(t){throw t.status===FileServiceResultStatus.SERVERERROR&&e.showErrorMessage("PackageFileList",{enumName:"FileService",group:"Print"}),t})},e.showSave=function(){var e=void 0!==t.baseApplicationParameters.authenticationServiceURL&&null!==t.baseApplicationParameters.authenticationServiceURL&&""!==t.baseApplicationParameters.authenticationServiceURL;return e},e.save=function(){k.clearSearch(),k.setPath(R.getPath("saveAs"))},e.backToPreviousLocation=function(){y.pop()},e.getCanGoBackFunction=function(){return function(){return!0}},e.showSeparator=function(){var n=t.baseViewParameters.languageSelectionEnabled&&t.baseViewParameters.availableLanguages.length>1,r=t.baseViewParameters.countrySelectionEnabled&&t.baseViewParameters.availableCountries.length>1,a=e.getAvailableSocialMedia().length>0;return e.showNew()||e.showCalculatorsButton()||e.showContact()||e.showPrint()||a||n||r},e.showNew=function(){return t.baseViewParameters.newConsultingIconEnabled},e.newConsulting=function(){e.hideNavBarCollapse(),e.showQuestionMessage({enumName:"Application",enumKey:"ResetConsulting"},function(){e.data&&void 0!==e.data.alternativeOpen&&(e.data.alternativeOpen=!1),k.clearSearch(),w.reset(),E.forgetDossier(),w.storeOnBrowserLocalStorage("customerNumber",""),w.storeOnBrowserLocalStorage("customerInfo",""),m.$broadcast("storageReset"),m.$broadcast("newConsulting"),F.sendEventOnceByConsulting("used",e.getStatistics())})},e.expiredOrUnauthorizedMessageWithLogin=function(){var e=A.prepareLocalizedText("StorageService","LogIn");A.removeAllMessages();var t={type:A.MESSAGE_DANGER,localizedText:A.prepareLocalizedText("StorageService","Unauthorized",null),dismissOnNavigation:!0,actions:[{localizedLabel:e,id:"questionForLogingAccept",fn:function(){A.removeAllMessages(),k.clearSearch(),k.setPath(R.getPath("login"))}}]};A.addMessage(t)},e.hideNavBarCollapse=function(){$(document).width()<=750&&setTimeout(function(){$(".navbar-toggle").click()})},e.showQuestionMessage=function(e,t){var n=A.prepareLocalizedText("Application","Yes"),r=A.prepareLocalizedText("Application","No");A.removeAllMessages();var a={type:A.MESSAGE_WARNING,localizedText:A.prepareLocalizedText(e.enumName,e.enumKey,e.params),dismissOnNavigation:!0,actions:[{localizedLabel:n,id:"questionAccept",fn:function(){A.removeAllMessages(),t()}},{localizedLabel:r,id:"questionCancel",fn:function(){A.removeAllMessages()}}]};A.addMessage(a)},e.showDossier=function(){return E.getCurrentDossierName()},e.showEventPlan=function(){return t.baseViewParameters.eventPlanIconEnabled},window===window.parent&&document.getElementsByTagName("html")[0].setAttribute("class","is-parent");var Z=m.$on("refreshStatus",function(){e.loaded=!0,c.debug("5. LOADED"),u.debug("5. LOADED"),e.setStatus(),Z()}),Q=m.$on("executeScript",function(t,n){n(e)}),ee=function(){O.logOut(),m.$broadcast("storageReset"),k.setPath("/login")},te=m.$on("showDemoReminder",function(t,n){"DemoAccountSessionExpired"===n?(e.showErrorMessage(n,{dismissOnNavigation:!1,enumName:"Application",group:"DemoAccount"}),ee()):e.showInfoMessage(n,{enumName:"Application",group:"DemoAccount"})});e.customInitializeScope&&e.customInitializeScope()}])}),define("calculation-header",["app"],function(e){"use strict";var t=e.register.directive("calculationHeader",[function(){return{restrict:"E",replace:!0,scope:{text:"@",description:"@"},templateUrl:"src/directives/calculation-header/calculation-header.html",controller:["$scope",function(e){}]}}]);return t}),define("fancy-box",["app","theme-manager","bootstrap","log-statistics-service"],function(e,t){"use strict";var n=e.register.directive("fancybox",[function(){return{restrict:"E",replace:!0,transclude:!0,scope:{fancyboxTitle:"@",color:"@",numberColor:"@",readyAction:"&",toggleFn:"&",toggleState:"=",infoContent:"@"},templateUrl:"src/directives/fancy-box/fancy-box.html",controller:["$scope","$attrs","logStatisticsService","authenticationService",function(e,n,r,a){e.collapsePanelId=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:7&n|8).toString(16)});return t}(),angular.isDefined(n.toggleFn)?e.hasToogleFn=!0:e.hasToogleFn=!1,e.infoImageClass="show-info-image",e.infoTextClass="show-info-text",e.showInfoImageClass=function(){return e.infoImageClass},e.showInfoTextClass=function(){return e.infoTextClass},e.showInfo=function(){r.sendEventOnceByConsulting("help used",e.getStatistics()),e.$apply(function(){e.infoImageClass="hide-info-image",e.infoTextClass="hide-info-text"})},e.hideInfo=function(){e.$apply(function(){e.infoImageClass="show-info-image",e.infoTextClass="show-info-text"})},e.getStatistics=function(){var e=new t,n=a.getUserData();return{pcId:window.localStorage.pcId,customer:n?n.customerNumber:null,userId:a.getUserLogged(),calculator:e.getCurrentSubThemeId()}}}],link:function(e,t,n){var r=t.find(".panel-collapse");r.on("show.bs.collapse",e.showInfo),r.on("hide.bs.collapse",e.hideInfo)}}}]);return n}),define("link-to-view",["app","theme-manager","fancy-box","log-statistics-service"],function(e,t){"use strict";var n=e.register.directive("linkToView",[function(){return{restrict:"E",replace:!0,scope:{linkTitle:"@",linkInfo:"@",linkHint:"@",openView:"@",onOpenView:"&",iconType:"@",openDialog:"=?",onEdit:"&",isEnabled:"=?",mode:"@"},templateUrl:"src/directives/link-to-view/link-to-view.html",controller:["$scope","logStatisticsService","authenticationService",function(e,n,r){e.isAlternative="alternative"===e.mode,e.isLinkEnabled=function(){var t=e.isEnabled;return(void 0===t||null===t)&&(t=!0),t},void 0===e.openDialog&&(e.openDialog=!1),void 0===e.isAlternative&&(e.isAlternative=!1),e.onAnchorClicked=function(){e.isLinkEnabled()&&(e.isAlternative||n.sendEventOnceByConsulting("alternative used",e.getStatistics()),e.openDialog?e.onEdit():e.onOpenView())},e.getIconClass=function(){return void 0!==e.iconType?e.iconType:e.isAlternative?"standard-icon":"alternative-icon"},e.getLinkClass=function(){return e.isAlternative?e.isLinkEnabled()?"link-to-standard":"link-to-standard disabled-link":e.isLinkEnabled()?"link-to-alternative":"link-to-alternative disabled-link"},e.getHintClass=function(){return e.isAlternative?"standard-hint":"alternative-hint"},e.getOpenClass=function(){return e.isAlternative?"open-standard":"open-alternative"},e.getTextClass=function(){return e.isAlternative?e.isLinkEnabled()?"left-arrow open-standard-text":"open-standard-text disabled-text":e.isLinkEnabled()?"right-arrow open-alternative-text":"open-alternative-text disabled-text"},e.getTextId=function(){return e.isAlternative?"openStandardText":"openAlternativeText"},e.getOpenId=function(){return e.isAlternative?"openStandard":"openAlternative"},e.getStatistics=function(){var e=new t,n=r.getUserData();return{pcId:window.localStorage.pcId,customer:n?n.customerNumber:null,userId:r.getUserLogged(),calculator:e.getCurrentSubThemeId()}}}]}}]);return n}),define("float",["app"],function(e){"use strict";var t=e.register.directive("float",function(){return{require:"ngModel",link:function(e,t,n,r){r.$parsers.unshift(function(e){return e=e.replace(/'/g,""),""===e||isNaN(e)?0:parseFloat(e)})}}});return t}),define("numeric-field",["app","parameters-manager","logger","float","formatter","jquery-ui-touch-punch","jquery-ui"],function(e,t,n){"use strict";var r=n.get("NumericField"),a=t.baseViewParameters.fieldAcceptModelTimeout,i=t.baseViewParameters.fieldAcceptModelTimeout,o=function(e,t,n,o,s,l){return{pre:function(e,t,l,c){void 0!==e.id&&e.id.length>0?e.fieldId=e.id.replace(/\./g,"_"):e.fieldId=l.ngModel.replace(/\./g,"_"),e.calculatorId=e.fieldId+"AddOn",e.showLabel=!0,e.showRange=!0,void 0===e.showCalculator&&(e.showCalculator=!1),void 0===e.isCurrency&&void 0===e.isPercentage&&("amount"===l.type?(e.isCurrency=!0,e.isPercentage=!1):(e.isCurrency=!1,e.isPercentage=!1)),e.shouldBeDisabled=function(){return null!==e.enabled&&void 0!==e.enabled?!e.enabled:e.showCalculator?!e.manualEntryModel:!1},e.disable=function(){n(function(){var t=$("#"+e.fieldId+"_input");t.prop("disabled",!0),e.sliderElement.slider("disable").draggable("disable"),e.sliderHandle=e.sliderElement.slider("disable").children()[0],e.sliderHandle.removeAttribute("href")})},e.enable=function(){n(function(){var t=$("#"+e.fieldId+"_input");t.prop("disabled",!1),e.sliderElement.slider("enable").draggable("enable")})},e.getDivClass=function(){return e.showCalculator||e.isPercentage||e.isCurrency||e.isEditable?"input-group":""},e.onCalculator=function(){e.manualEntryModel=!e.manualEntryModel,e.onEntryModelChanged&&e.onEntryModelChanged({manualEntry:e.manualEntryModel}),e.manualEntryModel&&n(function(){var t=$("#"+e.fieldId+"_input");t.focus()},0,!1)},e.getSliderMax=function(){return void 0!==e.sliderMax?(r.debug("SLIDER-MAX (REAL): "+e.sliderMax),parseFloat(e.sliderMax)):void 0!==e.options&&void 0!==e.options.slider_max?e.options.slider_max:1e3},e.getValidatedSliderMax=function(){return Math.min(e.getMax(),e.getSliderMax())},e.getSliderMin=function(){return void 0!==e.sliderMin?parseFloat(e.sliderMin):void 0!==e.options&&void 0!==e.options.slider_min?e.options.slider_min:0},e.getValidatedSliderMin=function(){return Math.max(e.getMin(),e.getSliderMin())},e.getSliderStep=function(){return void 0!==e.sliderStep?parseFloat(e.sliderStep):void 0!==e.options&&void 0!==e.options.slider_step?e.options.slider_step:100},e.getMax=function(){return void 0!==e.max?parseFloat(e.max):void 0!==e.options&&void 0!==e.options.max?e.options.max:1e3},e.getMin=function(){return void 0!==e.min?parseFloat(e.min):void 0!==e.options&&void 0!==e.options.min?e.options.min:0},l.$observe("showRange",function(t){angular.isDefined(t)&&(e.showRange="false"!==e.showRange)}),l.$observe("showLabel",function(t){angular.isDefined(t)&&(e.showLabel="false"!==e.showLabel)}),e.sliderElement=$(t).find(".slider");var u=function(){n(function(){e.ngModel=e.sliderElement.slider("option","value"),n(function(){e.onChange()})})},d=function(){n(function(){e.visualModel=e.format(e.sliderElement.slider("option","value"))})};e.sliderElement.slider({range:"min",max:e.getValidatedSliderMax(),min:e.getValidatedSliderMin(),animate:!0,step:e.getSliderStep(),value:0,timeoutPromise:void 0,change:function(t,n){r.debug("SLIDE CHANGE! "+e.sliderElement.slider("option","value"))},slide:function(t,i){r.debug("SLIDE! "+e.sliderElement.slider("option","value")),r.debug("timeout set to "+a);var o=new Date;d(),r.debug("end of set visual value: "+(new Date-o)),this.timeoutPromise&&n.cancel(this.timeoutPromise),this.timeoutPromise=n(function(){r.debug("start of timeout promise: "+(new Date-o)),r.debug("TIMEOUT SLIDER BEFORE visual is "+e.visualModel+" model is "+e.ngModel),r.debug("setValue promise "),u(),r.debug("TIMEOUT SLIDER AFTER visual is "+e.visualModel+" model is "+e.ngModel),r.debug("end of timeout promise: "+(new Date-o))},a)},stop:function(t,n){e.onStop()}}).draggable(),null!==e.enabled&&(void 0===e.enabled||e.enabled||e.disable()),e.isNumeric=function(e){return"string"==typeof e&&(e=e.replace(/'/g,"")),!isNaN(e)},e.format=function(t){return s.format(e,o,t)},e.unformat=function(t){return s.unformat(e,o,t)},e.accept=function(t){r.debug("about to unformat "+e.visualModel);var a=!0;if(!t){r.debug("checking expression: "+e.visualModel);var i=o.check(e.visualModel);if(!i)return void r.debug("INVALID EXPRESSION");a=!1}n(function(){var i=e.unformat(e.visualModel);if(!t&&void 0!==e.minDigits&&null!==e.minDigits){var o=i.toString().replace(".","").length;if(o<parseInt(e.minDigits))return}r.debug("raw number "+i+" finished? "+t+" format? "+a),!t&&a&&(r.debug("about to format "+i),e.visualModel=e.format(i)),i=Math.min(i,e.getMax()),i=Math.max(i,e.getMin()),t&&a&&(r.debug("about to format "+i),e.visualModel=e.format(i)),r.debug("model: "+e.ngModel+" raw: "+i),
e.ngModel!==i&&(r.debug("UPDATING MODEL WITH "+i),e.ngModel=i,n(function(){e.onChange()}))})};var m=e.ngModel,g=e.getMax();if(!l.avoidInitialValidation){null!==m&&null!==g&&m>g&&(e.ngModel=g,r.debug("onChange Max"),n(function(){e.onChange()}));var f=e.getMin();null!==m&&null!==f&&f>m&&(e.ngModel=f,r.debug("onChange Min"),n(function(){e.onChange()}))}e.visualModel=e.format(e.ngModel),e.editing=!1,e.alreadyTyped=!1;var h,p=$(t).find("input[type='text']");p.on("focus",function(){e.alreadyTyped=!1,e.editing=!0,r.debug("FOCUS TEXT BEFORE visual is "+e.visualModel+" model is "+e.ngModel),e.$apply(function(){e.visualModel=e.ngModel,n(function(){p[0].id===document.activeElement.id&&p.select()},0,!1)}),r.debug("FOCUS TEXT AFTER visual is "+e.visualModel+" model is "+e.ngModel)}),p.on("blur",function(){e.editing=!1,r.debug("BLUR TEXT BEFORE visual is "+e.visualModel+" model was "+e.ngModel),e.accept(!0),r.debug("BLUR TEXT AFTER: visual is "+e.visualModel+" model is "+e.ngModel)}),p.on("keydown",function(t){if(38===t.which||40===t.which){var n=o.check(e.visualModel);if(n){var r=e.unformat(e.visualModel),a=(r-e.getSliderMin())/e.getSliderStep();a=Math.round(1e8*a)/1e8;var i=Math.floor(a)*e.getSliderStep()+e.getSliderMin();i=Math.round(1e8*i)/1e8;var s=i+e.getSliderStep();s=Math.round(1e8*s)/1e8,38===t.which?r>i&&s>r?r=s:r+=e.getSliderStep():40===t.which&&(r>i&&s>r?r=i:r-=e.getSliderStep()),r=Math.round((r-e.getSliderMin())/e.getSliderStep())*e.getSliderStep()+e.getSliderMin(),r=Math.min(r,e.getMax()),r=Math.max(r,e.getMin()),r=e.unformat(e.format(r)),e.$apply(function(){e.visualModel=r})}}}),p.on("keyup",function(t){37!==t.which&&39!==t.which&&16!==t.which&&17!==t.which&&18!==t.which&&(e.alreadyTyped=!0,r.debug("KEYUP TEXT BEFORE visual is "+e.visualModel+" model is "+e.ngModel),h&&n.cancel(h),h=n(function(){r.debug("TIMEOUT TEXT BEFORE visual is "+e.visualModel+" model is "+e.ngModel),e.accept(!1),r.debug("TIMEOUT TEXT AFTER visual is "+e.visualModel+" model is "+e.ngModel)},i),r.debug("KEYUP TEXT AFTER visual is "+e.visualModel+" model is "+e.ngModel))})},post:function(e,t,n,a){e.$watch(function(){return e.ngModel},function(t,n){if(r.debug("REAL model changed to "+t),e.editing)r.debug("EDITING "+t),e.alreadyTyped||(r.debug("NOT ALREADY TYPED "+t),e.visualModel=t.toString());else{r.debug("NOT EDITING "+t);var a=e.format(t);e.visualModel=a,e.sliderElement.slider("option","animate",!1)}e.sliderElement.slider("value",t),e.sliderElement.slider("option","animate",!0)}),e.showCalculator&&e.$watch(function(){return e.manualEntryModel},function(t,n){void 0!==n&&void 0!==t&&t!==n&&e.onChange()}),e.$watch(function(){return e.enabled},function(t,n){t!==n&&(t?e.enable():e.disable())}),e.$watch(function(){return e.sliderMin},function(){e.sliderElement.slider("option","min",e.getValidatedSliderMin())}),e.$watch(function(){return e.max},function(){var t=e.getValidatedSliderMax();e.sliderElement.slider("option","max",t)}),e.$watch(function(){return e.min},function(){var t=e.getValidatedSliderMin();e.sliderElement.slider("option","min",t)}),e.$watch(function(){return e.sliderMax},function(){e.sliderElement.slider("option","max",e.getValidatedSliderMax())}),e.$watch(function(){return e.sliderStep},function(){e.sliderElement.slider("option","step",e.getSliderStep())}),e.$watch(function(){return e.options},function(){e.sliderElement.slider("option","min",e.getValidatedSliderMin()),e.sliderElement.slider("option","max",e.getValidatedSliderMax()),e.sliderElement.slider("option","step",e.getSliderStep())}),$(document).on("mousedown",".numeric-field-type",function(e){$(this).hide();var t=document.elementFromPoint(e.clientX,e.clientY);return $(this).show(),$(t).mousedown(),!1})}}},s={format:function(e,t,n){if(void 0!==e.decimals&&e.decimals>0){var r=e.decimals;e.maxDecimals&&e.maxDecimals>r&&(r=e.maxDecimals);var a=t.formatCurrencyWithDecimals(n,r,e.isPercentage);if(e.maxDecimals)for(var i=e.maxDecimals-e.decimals;i>0&&"0"===a.slice(-1);)a=a.slice(0,-1),i-=1;return a}return t.formatCurrency(n,e.isPercentage)},unformat:function(e,t,n){var r=t.unformat(n,e.isPercentage),a=e.decimals;if(e.maxDecimals&&e.maxDecimals>a&&(a=e.maxDecimals),void 0!==e.decimals&&a>0){var i=Math.pow(10,a);return Math.round(r*i)/i}return Math.round(r)}},l={format:function(e,t,n){return n},unformat:function(e,t,n){var r=t.unformat(n);return Math.round(r)}},c=e.register.directive("numericfield",["$timeout","formatter","$rootScope",function(e,t,n){return{restrict:"E",require:["?ngModel"],scope:{type:"@",label:"@",ngModel:"=",onChange:"&",onStop:"&",min:"@",max:"@",sliderMin:"@",sliderMax:"@",sliderStep:"@",showRange:"@",showLabel:"@",decimals:"@",maxDecimals:"@",isPercentage:"@",isCurrency:"@",isEditable:"=?",isExpandable:"=?",isExpanded:"&",minDigits:"@",options:"=?",avoidInitialValidation:"=?",showCalculator:"@",manualEntryModel:"=",onEntryModelChanged:"&",id:"@",enabled:"=?",onEdit:"&",onExpand:"&"},templateUrl:"src/directives/fields/numeric-field/numeric-field.html",compile:function(r,a){(null===a.avoidInitialValidation||void 0===a.avoidInitialValidation)&&(a.avoidInitialValidation=!1);var i=s;return"int"===a.type&&(i=l),o(r,a,e,t,i,n)}}}]);return c}),define("slider-field",["app","parameters-manager","logger","float","formatter","jquery-ui-touch-punch","jquery-ui"],function(e,t,n){"use strict";var r=n.get("SliderField"),a=t.baseViewParameters.fieldAcceptModelTimeout,i=(t.baseViewParameters.fieldAcceptModelTimeout,{format:function(e,t,n){if(void 0!==e.decimals&&e.decimals>0){var r=e.decimals;e.maxDecimals&&e.maxDecimals>r&&(r=e.maxDecimals);var a=t.formatCurrencyWithDecimals(n,r,e.isPercentage);if(e.maxDecimals)for(var i=e.maxDecimals-e.decimals;i>0&&"0"===a.slice(-1);)a=a.slice(0,-1),i-=1;return a}return t.formatCurrency(n,e.isPercentage)},unformat:function(e,t,n){var r=t.unformat(n,e.isPercentage),a=e.decimals;if(e.maxDecimals&&e.maxDecimals>a&&(a=e.maxDecimals),void 0!==e.decimals&&a>0){var i=Math.pow(10,a);return Math.round(r*i)/i}return Math.round(r)}}),o={format:function(e,t,n){return n},unformat:function(e,t,n){var r=t.unformat(n);return Math.round(r)}},s=e.register.directive("sliderField",["$timeout","formatter","$rootScope",function(e,t,n){return{restrict:"E",require:["?ngModel"],scope:{label:"@",tooltipText:"@",ngModel:"=",onChange:"&",onStop:"&",sliderMin:"@",sliderMax:"@",sliderStep:"@",showLabel:"@",decimals:"@",maxDecimals:"@",isPercentage:"@",isCurrency:"@",currency:"@",isShowValueHandle:"@",options:"=?",id:"@",enabled:"=?"},templateUrl:"src/directives/fields/slider-field/slider-field.html",compile:function(n,s){var l=i;return"int"===s.type&&(l=o),{pre:function(n,i,o,s){void 0!==n.id&&n.id.length>0?n.fieldId=n.id.replace(/\./g,"_"):n.fieldId=o.ngModel.replace(/\./g,"_").replace(/\$/g,""),n.showLabel=!0,void 0===n.isCurrency&&void 0===n.isPercentage&&("amount"===o.type?(n.isCurrency=!0,n.isPercentage=!1):(n.isCurrency=!1,n.isPercentage=!1)),n.shouldBeDisabled=function(){return null!==n.enabled&&void 0!==n.enabled?!n.enabled:n.showCalculator?!n.manualEntryModel:!1},n.disable=function(){e(function(){var e=$("#"+n.fieldId+"_input");e.prop("disabled",!0),n.sliderElement.slider("disable").draggable("disable"),n.sliderHandle=n.sliderElement.slider("disable").children()[0],n.sliderHandle.removeAttribute("href")})},n.enable=function(){e(function(){var e=$("#"+n.fieldId+"_input");e.prop("disabled",!1),n.sliderElement.slider("enable").draggable("enable")})},n.getSliderMax=function(){return void 0!==n.sliderMax?(r.debug("SLIDER-MAX (REAL): "+n.sliderMax),parseFloat(n.sliderMax)):void 0!==n.options&&void 0!==n.options.slider_max?n.options.slider_max:1e3},n.getSliderMin=function(){return void 0!==n.sliderMin?parseFloat(n.sliderMin):void 0!==n.options&&void 0!==n.options.slider_min?n.options.slider_min:0},n.getSliderStep=function(){return void 0!==n.sliderStep?parseFloat(n.sliderStep):void 0!==n.options&&void 0!==n.options.slider_step?n.options.slider_step:100},n.getMaxFormated=function(){return n.outputFormat(n.getSliderMax())},n.getMinFormated=function(){return n.outputFormat(n.getSliderMin())},o.$observe("showLabel",function(e){angular.isDefined(e)&&(n.showLabel="false"!==n.showLabel)}),n.sliderElement=$(i).find(".slider");var c=function(){e(function(){n.ngModel=n.sliderElement.slider("option","value"),e(function(){n.onChange()})})},u=function(){e(function(){n.visualModel=n.outputFormat(n.sliderElement.slider("option","value"))})};n.sliderElement.slider({range:"min",max:n.getSliderMax(),min:n.getSliderMin(),animate:!0,step:n.getSliderStep(),value:0,timeoutPromise:void 0,change:function(e,t){r.debug("SLIDE CHANGE! "+n.sliderElement.slider("option","value"))},slide:function(t,i){r.debug("SLIDE! "+n.sliderElement.slider("option","value")),r.debug("timeout set to "+a);var o=new Date;u(),r.debug("end of set visual value: "+(new Date-o)),this.timeoutPromise&&e.cancel(this.timeoutPromise),this.timeoutPromise=e(function(){r.debug("start of timeout promise: "+(new Date-o)),r.debug("TIMEOUT SLIDER BEFORE visual is "+n.visualModel+" model is "+n.ngModel),r.debug("setValue promise "),c(),r.debug("TIMEOUT SLIDER AFTER visual is "+n.visualModel+" model is "+n.ngModel),r.debug("end of timeout promise: "+(new Date-o))},a)},stop:function(e,t){n.onStop()}}).draggable(),null!==n.enabled&&(void 0===n.enabled||n.enabled||n.disable()),n.isNumeric=function(e){return"string"==typeof e&&(e=e.replace(/'/g,"")),!isNaN(e)},n.format=function(e){return l.format(n,t,e)},n.outputFormat=function(e){if(0===e)return e;var t=n.format(e);return n.isPercentage?t+"%":n.isCurrency?n.currency+" "+t:t},n.visualModel=n.outputFormat(n.ngModel)},post:function(t,n,a,i){t.$watch(function(){return t.ngModel},function(e,n){if(r.debug("REAL model changed to "+e),t.editing)r.debug("EDITING "+e),t.alreadyTyped||(r.debug("NOT ALREADY TYPED "+e),t.visualModel=e.toString());else{r.debug("NOT EDITING "+e);var a=t.outputFormat(e);t.visualModel=a,t.sliderElement.slider("option","animate",!1)}t.sliderElement.slider("value",e),t.sliderElement.slider("option","animate",!0)}),t.$watch(function(){return t.enabled},function(e,n){e!==n&&(e?t.enable():t.disable())}),t.$watch(function(){return t.sliderMin},function(){t.sliderElement.slider("option","min",t.getSliderMin())}),t.$watch(function(){return t.max},function(){var e=t.getSliderMax();t.sliderElement.slider("option","max",e)}),t.$watch(function(){return t.min},function(){var e=t.getSliderMin();t.sliderElement.slider("option","min",e)}),t.$watch(function(){return t.sliderMax},function(){t.sliderElement.slider("option","max",t.getSliderMax())}),t.$watch(function(){return t.sliderStep},function(){t.sliderElement.slider("option","step",t.getSliderStep())}),t.$watch(function(){return t.options},function(){t.sliderElement.slider("option","min",t.getSliderMin()),t.sliderElement.slider("option","max",t.getSliderMax()),t.sliderElement.slider("option","step",t.getSliderStep())}),e(function(){$("#"+t.fieldId+"_popover").popover({content:t.tooltipText,trigger:"focus",placement:function(e,t){return $(window).innerWidth()<420&&$(t).position().left>150&&$(t).position().left<220?"left":"right"}})})}}}}}]);return s}),define("int",["app"],function(e){"use strict";var t=e.register.directive("int",function(){return{require:"ngModel",link:function(e,t,n,r){r.$parsers.unshift(function(e){return"number"==typeof e?Math.round(e):(e=e.replace(/'/g,""),""===e||isNaN(e)?0:parseInt(e))})}}});return t}),define("selection-field",["app","localization","int"],function(e){"use strict";var t=e.register.directive("selectionfield",["$timeout",function(e){return{restrict:"E",scope:{label:"@",ngModel:"=",onChange:"&",options:"=?","enum":"@",optionLabeler:"&",disabled:"@",id:"@",isRequired:"@",keyName:"@",descriptionName:"@",enabled:"="},templateUrl:"src/directives/fields/selection-field/selection-field.html",controller:["$scope","localize",function(e,t){e.model=e.ngModel,void 0===e.disabled&&(e.disabled=!1),window.isIE9?e.showSelect=!1:e.showSelect=!0,e.getTranslatedDescription=function(n){if(e["enum"]){var r=null;return r=isNaN(n)?n.longDescription:n,r=e["enum"]+"."+r,t.getLocalizedString(r)}return e.optionLabeler({option:n})},e.getOptions=function(){return void 0!==e.keyName?"option as option."+e.descriptionName+" for option in options":e["enum"]?"option as getTranslatedDescription(option) for option in options":"option for option in options"}}],compile:function(t,n){return function(t,n,r){void 0!==t.id&&t.id.length>0?t.fieldId=t.id.replace(/\./g,"_"):t.fieldId=r.ngModel.replace(/\./g,"_"),t.$watch(function(){return t.ngModel},function(e,n){e!==n&&t.editing&&t.onChange()});var a=$(n).find("select");if(a.on("focus",function(){t.editing=!0}),a.on("blur",function(){t.editing=!1}),t.isDisabled=function(){return void 0!==t.enabled?!t.enabled:!1},window.isIE9){var i=$(n).find("select");e(function(){t.showSelect=!0,i[0].style.width="99.9%",e(function(){i[0].style.width="100%"})})}}}}}]);return t}),define("result-summary-box",["app","theme-manager","model-constants","localization","calculators-manager"],function(e,t){"use strict";var n=0,r=e.register.directive("resultSummaryBox",[function(){return{restrict:"E",scope:{text:"@",tips:"=?"},templateUrl:"src/directives/result-summary-box/result-summary-box.html",controller:["$scope","$window","localize","$timeout","logStatisticsService","authenticationService",function(e,r,a,i,o,s){n+=1,e.counter=n,e.switchFinanceCoachInfo=function(){e.financeCoachInfoVisible=!e.financeCoachInfoVisible},e.showFinanceCoachInfo=function(){e.financeCoachInfoVisible=!0},e.hideFinanceCoachInfo=function(){e.financeCoachInfoVisible=!1},e.getTipTypeClass=function(e){return e.type===FinanceCoachInfoType.INFORMATION?"information":e.type===FinanceCoachInfoType.ADVANTAGE?"advantage":e.type===FinanceCoachInfoType.DISADVANTAGE?"disadvantage":e.type===FinanceCoachInfoType.EQUALITY?"equality":"contact"},e.getTipText=function(e){return"string"==typeof e.textKey?a.getLocalizedString(e.textKey):e.localizedText()},e.goToTipLink=function(t){"undefined"!=typeof t.goToTipLink&&(e.selectedTip=t,e.closeTips())},e.tipHasLink=function(t){return e.showTipLink(t)?t.contactLink?t.showTipIfContactLink():"undefined"!=typeof t.goToTipLink?!0:!1:!1},e.getTipLinkText=function(e){return"string"==typeof e.linkTextKey?a.getLocalizedString(e.linkTextKey):""},e.showTipLink=function(e){return"undefined"==typeof e.showTipLink?!0:e.showTipLink()},e.getVisibleTips=function(){var t=[];if(e.tipsWindowOpen)for(var n=0;n<e.tips.length;n++){var r=e.tips[n];r.isVisible()&&r.showTipIfContactLink()&&t.push(r)}return t},e.tipsWindowOpen=!1,e.selectedTip=null,e.onModalCloseInitialized=!1,e.openTips=function(){e.tipsWindowOpen=!0,$("#tips"+e.counter).on("show.bs.modal",function(){window.matchMedia("only screen and (min-width: 516px)").matches&&setTimeout(function(){$("#tips"+e.counter).find(".modal-dialog").off("bsTransitionEnd"),e.$emit("modalOpen")},350)}).modal("show"),o.sendEventOnceByConsulting("finance coach used",e.getStatistics()),e.onModalCloseInitialized||(e.onModalCloseInitialized=!0,$("#tips"+e.counter).on("hidden.bs.modal",function(){if(e.tipsWindowOpen=!1,null!==e.selectedTip){var t=e.selectedTip;e.selectedTip=null,window.isIE9?t.goToTipLink():i(function(){t.goToTipLink()})}}))},e.closeTips=function(){$("#tips"+e.counter).modal("hide")},e.getStatistics=function(){var e=new t,n=s.getUserData();return{pcId:window.localStorage.pcId,customer:n?n.customerNumber:null,userId:s.getUserLogged(),calculator:e.getCurrentSubThemeId()}}}]}}]);return r}),define("table-row",["app"],function(e){"use strict";var t=e.register.directive("tableRow",[function(){return{restrict:"A",scope:{bulletColor:"@",lineBulletColor:"@",col1:"=?",col1Type:"@",col1Decimals:"@",col1Color:"@",col1Class:"@",col1Id:"@",col2:"=?",col2Type:"@",col2Decimals:"@",col2Color:"@",col2Class:"@",col2Id:"@",col3:"=?",col3Type:"@",col3Decimals:"@",col3Color:"@",col3Class:"@",col3Id:"@",col4:"=?",col4Type:"@",col4Decimals:"@",col4Color:"@",col4Class:"@",col4Id:"@",col5:"=?",col5Type:"@",col5Decimals:"@",col5Color:"@",col5Class:"@",col5Id:"@",titleColspan:"=?"},templateUrl:"src/directives/table-row/table-row.html",controller:["$scope","$attrs","localize",function(e,t,n){e.hasBullet=function(){return e.hasSquareBullet()||e.hasLineBullet()},e.hasSquareBullet=function(){return void 0!==e.bulletColor&&""!==e.bulletColor&&null!==e.bulletColor},e.hasLineBullet=function(){return void 0!==e.lineBulletColor&&""!==e.lineBulletColor&&null!==e.lineBulletColor},e.getBulletColor=function(){return e.hasSquareBullet()?e.bulletColor:e.lineBulletColor},e.getColId=function(e,t){var n=e;return(null===n||void 0===n)&&(n=t),void 0!==t?n.replace(/\$ctrl./g,"").replace(/\./g,"_").replace(/\(/g,"").replace(/\)/g,"").replace(/-/g,""):void 0},e.getCol1Id=function(){return e.getColId(e.col1Id,t.col1)},e.getCol2Id=function(){return e.getColId(e.col2Id,t.col2)},e.getCol3Id=function(){return e.getColId(e.col3Id,t.col3)},e.getCol4Id=function(){return e.getColId(e.col4Id,t.col4)},e.getCol5Id=function(){return e.getColId(e.col5Id,t.col5)},e.getColClass=function(e){return"percentage"===e?"percentage-col":""},e.getColBindHtml=function(e,t,r,a){if(void 0===t&&(t=a),"none"===t)return e;var i="percentage"===t?"Percentage":"Amount";return n.getLocalizedString("GenericFormats."+i,{VALUE:e,DECIMALS:r})}}]}}]);return t}),define("table-row-list",["app"],function(e){"use strict";var t=e.register.directive("tableRowList",[function(){return{restrict:"A",transclude:!0,replace:!0,scope:{rowClass:"@"},templateUrl:"src/directives/table-row-list/table-row-list.html",controller:["$scope","$attrs",function(e,t){}]}}]);return t}),define("checkbox-field",["app"],function(e){"use strict";var t=e.register.directive("checkboxfield",[function(){return{restrict:"E",require:"?ngModel",scope:{label:"@",inline:"@",ngModel:"=",id:"@",onChange:"&",enabled:"=?"},templateUrl:"src/directives/fields/checkbox-field/checkbox-field.html",compile:function(e,t){return{pre:function(e,t,n,r){n.id?e.fieldId=n.id:e.fieldId=n.ngModel.replace(/\./g,"_"),n.inline||(e.inline=!1),void 0===e.enabled&&(e.enabled=!0),e.isDisabled=function(){return!e.enabled}}}}}}]);return t}),define("two-tab-field",["app"],function(e){"use strict";var t=e.register.directive("twotabfield",[function(){return{restrict:"E",scope:{firstTabTarget:"@",firstTabText:"@",firstTabValue:"=?",secondTabTarget:"@",secondTabText:"@",secondTabValue:"=?",model:"=",attribute:"@",onChange:"&"},templateUrl:"src/directives/fields/two-tab-field/two-tab-field.html",link:function(e,t,n){e.firstTabId=n.model.replace(/\./g,"_")+"_"+n.attribute+"_"+n.firstTabTarget,e.secondTabId=n.model.replace(/\./g,"_")+"_"+n.attribute+"_"+n.secondTabTarget;var r=t.find(".firstAnchor"),a=t.find(".secondAnchor");e.$watch(function(){return e.model[e.attribute]},function(t,n){t!==n&&(e.model[e.attribute]===e.firstTabValue?r.tab("show"):a.tab("show"))}),r.on("shown.bs.tab",function(){e.model[e.attribute]!==e.firstTabValue&&e.$apply(function(){e.model[e.attribute]=e.firstTabValue,e.onChange()})}),a.on("shown.bs.tab",function(){e.model[e.attribute]!==e.secondTabValue&&e.$apply(function(){e.model[e.attribute]=e.secondTabValue,e.onChange()})}),e.isFirstActive=function(){return e.model[e.attribute]===e.firstTabValue}}}}]);return t}),define("edit-dialog-box",["app","parameters-manager","model-constants","localization","calculators-manager"],function(e,t){"use strict";var n=t.baseViewParameters.fieldAcceptModelTimeout+50,r=e.register.directive("editDialogBox",[function(){return{restrict:"E",scope:{dialogName:"@"},templateUrl:"src/directives/edit-dialog-box/edit-dialog-box.html",controller:["$scope","$rootScope","localize","$injector","$timeout",function(e,t,r,a,i){e.getCamelCaseName=function(){return e.dialogName?e.dialogName.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()}):""},e.getDialogName=function(){if(e.dialogName){var t=e.dialogName[0].toUpperCase()+e.dialogName.substring(1);return t.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}return""};var o=t.$on("setup"+e.getDialogName(),function(){e.parent=e.$parent,""!==e.getCamelCaseName()&&a.invoke(["$controller",function(n){n(e.getCamelCaseName(),{$scope:e}),e.injectGenericFunctionality(),i(function(){t.$broadcast("finish"+e.getDialogName()+"Setup")})}])});e.$on("$destroy",function(){o()}),e.injectGenericFunctionality=function(){e.parent.template=e.parent.templatePath,$("#editDialogBox"+e.getDialogName()).on("show.bs.modal",function(){window.matchMedia("only screen and (min-width: 516px)").matches&&setTimeout(function(){$("#editDialogBox"+e.getDialogName()).find(".modal-dialog").off("bsTransitionEnd"),e.$emit("modalOpen"),e.parent.setFocus(e.getInitialFocusElement())},350)}),$("#editDialogBox"+e.getDialogName()).on("hidden.bs.modal",function(){e.parent.template=""}),e.hasManualButton=function(){return e.getHasManualButton?e.getHasManualButton():!1},e.hasAcceptButton=function(){return e.getHasAcceptButton?e.getHasAcceptButton():!1},e.manualSet=function(){e.manualSetCallback&&e.manualSetCallback(),e.parent.close()},e.getAcceptButtonLabel=function(){return e.acceptButtonLabel?r.getLocalizedString(e.acceptButtonLabel):r.getLocalizedString("editDialogBox.Accept")},e.getCancelButtonLabel=function(){return e.cancelButtonLabel?r.getLocalizedString(e.cancelButtonLabel):r.getLocalizedString("editDialogBox.ManualSet")},e.acceptDialog=function(){e.parent.setFocus("#editDialogAcceptButton"),i(function(){e.acceptCallback&&e.acceptCallback(),e.avoidCalculateOnAccept||e.parent.calculate(function(){e.parent.close()})},n)},e.cancelDialog=function(){e.cancelCallback&&e.cancelCallback(),e.parent.close()},e.getTitle=function(){return e.getDialogTitle?e.getDialogTitle():e.getCamelCaseName()}}}]}}]);return r}),define("multicalc-personal-data",["app","parameters-manager","model-constants","localization"],function(e,t){"use strict";var n=e.register.directive("multicalcPersonalData",[function(){return{restrict:"E",scope:{calculate:"&",onIncomeChanged:"&",onProfessionalStatusChanged:"&",base:"=",data:"=",scenario:"="},templateUrl:"src/controllers/multicalc/multicalc-personal-data/multicalc-personal-data.html",controller:["$scope",function(e){e.SexOptions=SexOptions,e.CivilStatusOptions=CivilStatusOptions,e.NumberOfChildrenOptions=t.baseModelParameters.numberOfChildrenOptions,e.ProfessionalStatusOptions=ProfessionalStatusOptions,e.baseModelParameters=t.baseModelParameters,e.baseViewParameters=t.baseViewParameters}]}}]);return n}),define("radio-field",["app"],function(e){"use strict";var t=e.register.directive("radiofield",[function(){return{restrict:"E",require:"?ngModel",scope:{label:"@",showLabel:"@",ngModel:"=",ngValue:"=",id:"@",name:"@",inline:"@",onChange:"&",enabled:"=?"},templateUrl:"src/directives/fields/radio-field/radio-field.html",compile:function(e,t){return{pre:function(e,t,n,r){e.radioModel=e.ngModel,e.radioValue=e.ngValue,n.fieldId?e.fieldId=n.fieldId:e.fieldId=n.ngValue.replace(/\./g,"_"),n.inline||(e.inline=!1),void 0===e.enabled&&(e.enabled=!0),e.isDisabled=function(){return!e.enabled},e.fieldName=e.name,e.$watch("radioModel",function(t,n){e.$eval("ngModel = radioModel")}),e.$watch("ngModel",function(t,n){e.radioModel=t}),e.$watch("radioValue",function(t,n){e.$eval("ngValue = radioValue")}),e.$watch("ngValue",function(t,n){e.radioValue=t})}}}}}]);return t}),define("zip-and-location-field",["app","parameters-manager","logger","ui-bootstrap","typeahead-watch-changes"],function(e,t,n){"use strict";var r=n.get("AsynchronousModeProfile"),a=e.register.directive("zipandlocationfield",["$timeout","$document",function(e,n){return{restrict:"E",scope:{label:"@",model:"=",attribute:"@",onChange:"&",allowEmpty:"@",searchByCountry:"="},templateUrl:"src/directives/fields/zip-and-location-field/zip-and-location-field.html",controller:["$scope","zipAndLocationService",function(n,a){n.baseViewParameters=t.baseViewParameters,n.zipAndLocationService=a,n.testMode=0,n.inputTextModel=null,n.useGeolocatedList=!1,n.geolocatedCities=[],n.geolocationSearchInProgress=!1,n.displayFailedGeolocationMessage=!1,n.$watch(function(){return n.model[n.attribute]},function(e,t){(e!==t||null===n.inputTextModel)&&(n.useGeolocatedList?n.inputTextModel=n.model[n.attribute].zipAndLocation:n.inputTextModel=n.model[n.attribute])}),n.resetInputTextModel=function(){n.inputTextModel=n.model[n.attribute],void 0===n.inputTextModel&&n.searchLocations(),n.useGeolocatedList=!1},n.cancelOnEscape=function(e){27===e.keyCode&&n.resetInputTextModel()},n.onSelect=function(e){""===e&&n.allowEmpty?n.model[n.attribute]=null:n.model[n.attribute]=e,n.onChange(),n.useGeolocatedList=!1},n.searchLocations=function(e){return"testGeoLocation1"===e&&(n.testMode=1),"testGeoLocation2"===e&&(n.testMode=2),"testGeoLocation3"===e&&(n.testMode=3),"testGeoLocation4"===e&&(n.testMode=4),n.useGeolocatedList?(n.useGeolocatedList=!1,n.geolocatedCities):(n.displayFailedGeolocationMessage=!1,a.searchLocations(e,n.searchByCountry).then(function(e){return r.debug("result = "+JSON.stringify(e)),e}))},n.hasLocalizationSupport=function(){return navigator.geolocation&&n.baseViewParameters.useGeoLocation},n.getCity=function(t){if(n.geolocationSearchInProgress){var r=t.coords.latitude,i=t.coords.longitude;return 1===n.testMode&&(r=47.7,i=8.633333),2===n.testMode&&(r=47.366667,i=8.55),3===n.testMode&&(r=57,i=160),4===n.testMode&&(r=47.14,i=9.514),a.searchLocationsAround(r,i,8,n.searchByCountry).then(function(t){n.geolocationSearchInProgress=!1,0===t.length?n.displayFailedGeolocationMessage=!0:e(1===t.length?function(){n.onSelect(t[0]),n.resetInputTextModel()}:function(){n.theInput.focus(),n.model[n.attribute]=t[0],n.onChange(),n.useGeolocatedList=!0,n.geolocatedCities=t;var e=t[0].zipAndLocation;n.inputTextModel=e})})}},n.errorOnLocation=function(){return n.geolocationSearchInProgress=!1,n.displayFailedGeolocationMessage=!0,null},n.geolocationSearchTimedOut=function(){n.geolocationSearchInProgress&&(n.geolocationSearchInProgress=!1,n.displayFailedGeolocationMessage=!0)},n.getLocation=function(){n.geolocationSearchInProgress=!0,e(n.geolocationSearchTimedOut,1e4),navigator.geolocation.getCurrentPosition(n.getCity,n.errorOnLocation)},n.isDisabled=function(){return n.geolocationSearchInProgress},n.showMessage=function(){return n.displayFailedGeolocationMessage},n.getButtonBackground=function(){return n.geolocationSearchInProgress?"localization-inprogress-background":"icon-map-marker"},n.keepActiveListItemVisible=function(e,t){if(-1!==t){var n=e.find("ul.dropdown-menu")[0];if(void 0!==n){var r=e.find("ul.dropdown-menu li")[0];if(void 0!==r){var a=r.clientHeight,i=t*a,o=i+a,s=n.offsetHeight;o>n.scrollTop+s&&(n.scrollTop=(t-8+1)*a),i<n.scrollTop&&(n.scrollTop=i)}}}},n.resetInputTextModel()}],compile:function(t,r){return{pre:function(e,t,n,r){e.fieldId=n.model.replace(/\./g,"_")+"_"+n.attribute},post:function(t,r,a,i){var o=r.find("input");t.theInput=o;var s=function(){return"string"==typeof t.inputTextModel?t.inputTextModel:null===t.inputTextModel?"":t.inputTextModel.zipAndLocation},l=function(){return t.allowEmpty&&""===s()?!0:null===t.model[t.attribute]?!1:s()!==t.model[t.attribute].zipAndLocation?!1:!0};o.on("focus",function(t){e(function(){o[0].id===document.activeElement.id&&o.select()})}),o.on("blur",function(n){t.useGeolocatedList=!1,t.allowEmpty&&""===s()&&t.$apply(function(){t.onSelect("")}),l()||t.searchLocations(s()).then(function(n){1===n.length?e(function(){t.onSelect(n[0]),t.resetInputTextModel()}):e(function(){l()||t.resetInputTextModel()},250,!0)})}),t.$$childHead.$watch("activeIdx",function(e){t.keepActiveListItemVisible(r,e)});var c=function(){t.$$childHead.matches=[],t.$$childHead.activeIdx=-1,o.attr("aria-expanded",!1)},u=function(e){r[0].contains(e.target)||(c(),t.$digest())};n.bind("mousedown",u),t.$on("$destroy",function(){n.unbind("mousedown",u)})}}}}}]);return a}),define("multicalc-controller",["app","theme-manager","parameters-manager","multicalc-model","logger","multicalc-state","localization","base-state","base-controller","multicalc-risk","model-constants","enums-constants","calculation-header","link-to-view","fancy-box","tab-selector-link","numeric-field","slider-field","selection-field","result-summary-box","base-data-summary","table-row","table-row-list","rpopulaires-calculator","storage-manager","checkbox-field","log-statistics-service","topic-chooser","topic-link","topic-panel","two-tab-field","edit-dialog-box","calculators-manager","multicalc-personal-data","radio-field","zip-and-location-field"],function(e,t,n,r,a){"use strict";var i=a.get("Multicalc"),o=a.get("AsynchronousModeProfile");e.register.controller("multicalcController",["$scope","$injector","localize","multicalcState","baseState","rpopulairesCalculator","zipAndLocationService",function(e,a,s,l,c,u,d){function m(){e.controllerName="multicalc",a.invoke(["$controller",function(t){t("baseController",{$scope:e})}]);var n=new t;n.setTheme("multicalc")}function g(){e.isSingle=function(){return e.base.mainPerson.civilStatus===CivilStatus.SINGLE},e.isMarried=function(){return e.base.mainPerson.civilStatus===CivilStatus.MARRIED},e.isConcubinage=function(){return e.base.mainPerson.civilStatus===CivilStatus.SINGLE_IN_CONCUBINAGE}}function f(){e.data={maxMonthlySavingCapacity:null,maxNeed:1/0}}function h(){e.onReady=function(){o.debug("DRAWING..."),e.forceActiveChartDraw()},e.data||f(),e.onBeforeNewConsulting=function(){f()},e.baseModelParameters=n.baseModelParameters,e.baseViewParameters=n.baseViewParameters,e.baseApplicationParameters=n.baseApplicationParameters,e.onModelSetup=function(){null===e.scenario.age&&(e.scenario.age=n.baseModelParameters.mainPersonAge),null===e.base.mainPerson.civilStatus&&(e.base.mainPerson.civilStatus=n.baseModelParameters.civilStatus),null===e.base.mainPerson.sex&&(e.base.mainPerson.sex=e.baseModelParameters.mainPersonSex),null===e.base.mainPerson.grossIncome&&(e.base.mainPerson.grossIncome=n.baseModelParameters.grossIncome),e.data.maxNeed=e.base.mainPerson.grossIncome,null===e.scenario.disabilityNeed&&(e.scenario.disabilityNeed=e.base.mainPerson.grossIncome*n.baseModelParameters.disabilityNeedPercentage/100),null===e.scenario.deathNeed&&(e.scenario.deathNeed=e.base.mainPerson.grossIncome*n.baseModelParameters.deathNeedPercentage/100),null===e.scenario.interestRate&&(e.scenario.interestRate=n.baseModelParameters.interestRate),null===e.base.hasDetailedNumberOfChildren&&(e.base.hasDetailedNumberOfChildren=!1),null===e.base.numberOfChildren&&(e.base.numberOfChildren=n.baseModelParameters.numberOfChildren),null===e.base.currentFortune&&(e.base.currentFortune=0),null===e.base.pensionInterest&&(e.base.pensionInterest=0),null===e.base.yearlySavings&&(e.base.yearlySavings=0),null===e.base.zipAndLocation&&e.addPrePromise(d.searchMoreImportantLocationPromise(d.getActiveCountryLocationDefault()).then(function(t){null===e.base.zipAndLocation&&(e.base.zipAndLocation=t)})),null===e.scenario.professionalStatus&&(e.scenario.professionalStatus=n.baseModelParameters.professionalStatus),e.scenario.professionalStatus!==ProfessionalStatus.SELF_EMPLOYEE_NO_SECOND_PILLAR_INSURED?e.data.maxMonthlySavingCapacity=e.max3aPremiumWithBVG/12:e.data.maxMonthlySavingCapacity=e.max3aPremiumWithoutBVG/12,null===e.scenario.monthlySavingCapacity&&(e.scenario.monthlySavingCapacity=e.data.maxMonthlySavingCapacity)},e.addInitialPromise(u.getMax3aPremiumWithBVG().then(function(t){e.max3aPremiumWithBVG=t})),e.addInitialPromise(u.getMax3aPremiumWithoutBVG().then(function(t){e.max3aPremiumWithoutBVG=t})),e.scenario=l.get(),e.base=c,e.result=new r.MulticalcResult}function p(){e.standardDisability=e.createBridge(),e.standardSaving3a=e.createBridge(),e.standardDeath=e.createBridge(),e.checkSavingLimit=function(){e.scenario.professionalStatus!==ProfessionalStatus.SELF_EMPLOYEE_NO_SECOND_PILLAR_INSURED?e.data.maxMonthlySavingCapacity=e.max3aPremiumWithBVG/12:(e.data.maxMonthlySavingCapacity=e.max3aPremiumWithoutBVG/12,e.data.maxMonthlySavingCapacity>.2*e.base.mainPerson.grossIncome/12&&(e.data.maxMonthlySavingCapacity=.2*e.base.mainPerson.grossIncome/12)),
e.scenario.monthlySavingCapacity>e.data.maxMonthlySavingCapacity&&(e.scenario.monthlySavingCapacity=e.data.maxMonthlySavingCapacity)},e.onIncomeChanged=function(){e.data.maxNeed=e.base.mainPerson.grossIncome,e.scenario.disabilityNeed>e.data.maxNeed&&(e.scenario.disabilityNeed=e.data.maxNeed),e.scenario.deathNeed>e.data.maxNeed&&(e.scenario.deathNeed=e.data.maxNeed),e.checkSavingLimit(),e.calculate()},e.onProfessionalStatusChanged=function(){e.checkSavingLimit(),e.calculate()}}function v(){e.onRefresh=function(){e.data.saving3aActive&&e.getBridges().Saving3a.update(),e.data.disabilityActive&&e.getBridges().Disability.update(),e.data.deathActive&&e.getBridges().Death.update()},e.getVisibleRefreshHandlers=function(){var t=[];return e.data.saving3aActive=!0,e.data.disabilityActive=!0,e.data.deathActive=!0,e.data.saving3aActive&&Array.prototype.push.apply(t,e.standardSaving3a.getVisibleRefreshHandlers()),e.data.disabilityActive&&Array.prototype.push.apply(t,e.standardDisability.getVisibleRefreshHandlers()),e.data.deathActive&&Array.prototype.push.apply(t,e.standardDeath.getVisibleRefreshHandlers()),t},e.onActiveChartRedraw=function(){e.data.saving3aActive&&e.getBridges().Saving3a.forceDraw(),e.data.disabilityActive&&e.getBridges().Disability.forceDraw(),e.data.deathActive&&e.getBridges().Death.forceDraw()}}function S(){i.debug("initializeRefreshHandlers"),e.getBridges=function(){var t={Saving3a:e.standardSaving3a,Disability:e.standardDisability,Death:e.standardDeath};return t}}function b(){e.doCalculate=function(t){var n={year:(new Date).getFullYear(),union:e.base.mainPerson.civilStatus,gender:e.base.mainPerson.sex,age:e.scenario.age,children:e.base.numberOfChildren,income:e.base.mainPerson.grossIncome,is_empl:e.scenario.professionalStatus===ProfessionalStatus.EMPLOYEE,has_bvg:e.scenario.professionalStatus!==ProfessionalStatus.SELF_EMPLOYEE_NO_SECOND_PILLAR_INSURED,locality:e.base.zipAndLocation.id,premium:12*e.scenario.monthlySavingCapacity,interest:e.scenario.interestRate,consumption:e.baseModelParameters.consumptionDuration},r={year:(new Date).getFullYear(),union:e.base.mainPerson.civilStatus,gender:e.base.mainPerson.sex,age:e.scenario.age,children:e.base.numberOfChildren,income:e.base.mainPerson.grossIncome,is_empl:e.scenario.professionalStatus===ProfessionalStatus.EMPLOYEE,has_bvg:e.scenario.professionalStatus!==ProfessionalStatus.SELF_EMPLOYEE_NO_SECOND_PILLAR_INSURED,need_disab:e.scenario.disabilityNeed,need_death:e.scenario.deathNeed};e.requestCalculations([u.calcSparenJSON(n),u.calcRisikoJSON(r)],function(t){var n=t[0],r=t[1],a=JSON.parse(n),i=JSON.parse(r);e.result.saving3a.taxSavings=a.tax_gain_sum,e.result.saving3a.interest=a.yield_sum,e.result.saving3a.savings=a.deposit_sum,e.result.saving3a.capitalizationTax=a.capital_tax,e.result.saving3a.grossCapital=a.capital_gross,e.result.saving3a.netCapital=a.capital_net,e.result.saving3a.netYield=a.yield_net,e.result.saving3a.duration=a.duration,e.result.saving3a.taxSavingsSet=e.getSet(e.result.saving3a.taxSavings,e.result.saving3a.duration),e.result.saving3a.savingsSet=e.getSet(e.result.saving3a.savings,e.result.saving3a.duration),e.result.saving3a.interestSet=e.getSet(e.result.saving3a.interest,e.result.saving3a.duration),e.result.disability.firstPillarRent=i.disab_iv,e.result.disability.secondPillarRent=i.disab_bvg,e.result.disability.benefits=i.disab_sum,e.result.disability.gap=i.disab_miss,e.result.death.firstPillarRent=i.death_ahv,e.result.death.secondPillarRent=i.death_bvg,e.result.death.benefits=i.death_sum,e.result.death.gap=i.death_miss,e.finishCalculation()}),o.debug("END OF CALCULATE")},e.getSet=function(e,t){for(var n=e/t,r=[],a=0;t>=a;a++)r[a]=n*a;return r}}function P(){e.initiallyFocusedElement=function(){return"#sex_female"}}m(),g(),h(),p(),b(),v(),S(),e.calculate(),P(),e.start()}])});