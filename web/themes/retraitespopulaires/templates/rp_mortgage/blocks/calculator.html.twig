
{% set settings = variables.settings %}

<form id="mortgage-calculator" class="js-mortgage-calculator" action="#">
  <table class="table-wide table-hypotheque tablesaw tablesaw-stack" data-tablesaw-mode="stack">
    <thead>
    <tr>
      <th colspan="2"><strong>{% trans %}1. Prix d'achat{% endtrans %}</strong></th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>{% trans %}Introduisez ici le montant d'achat du bien immobilier{% endtrans %}</td>
      <td>
        <div class="form-group">
          <input type="text" value="" required class="form-control form-control-hypotheque js-amount-input form-chf-numeric " id="amount" placeholder="Le montant en CHF">
        </div>
      </td>
    </tr>
    <tr>
      {% set notaryRateFormatted = (settings.notaryRateFee*100)|format_pourcent %}
      <td>{% trans %}Prix d'achat y compris droits de mutations et frais de notaire (+{{ notaryRateFormatted }}){% endtrans %}</td>
      <td>
        <div class="form-group readonly">
          <input type="text" readonly="" name="amountWithFee" class="form-control js-amount-with-fee-input form-chf-numeric" value="" />
        </div>
      </td>
    </tr>
    <tr>
      <td>{% trans %}Revenu annuel net (min.){% endtrans %}</td>
      <td>
        <div class="form-group readonly">
          <input type="text" readonly="" name="minimalIncomeForAmount" class="form-control js-minimal-income-for-amount form-chf-numeric" value="" />
        </div>
      </td>
    </tr>
    <tr>
      <td>{% trans %}Fonds propres (min.){% endtrans %}</td>
      <td>
        <div class="form-group readonly">
          <input type="text" readonly="" name="minimalEquityCapitalForAmount" class="form-control js-minimal-equity-capital-for-amount form-chf-numeric" value="" />
        </div>
      </td>
    </tr>
    </tbody>
  </table>

  <div class="spacer spacer-md"></div>
  <table class="table-wide table-hypotheque tablesaw tablesaw-stack" data-tablesaw-mode="stack">
    <thead>
    <tr>
      <th colspan="2"><strong>{% trans %}2. Fonds propres{% endtrans %}</strong></th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>{% trans %}Les fonds propres doivent au moins représenter 20% du prix d'achat{% endtrans %}</td>
      <td>
        <div class="form-group">
          <input type="text" value="" required class="form-control form-control-hypotheque js-equity-capital-input form-chf-numeric" name="equityCapital" value="" placeholder="Le montant en CHF">
        </div>
      </td>
    </tr>
    <tr>
      <td>{% trans %}Prix d'achat (max.) sans droits de mutations et frais de notaire{% endtrans %}</td>
      <td>
        <div class="form-group readonly">
          <input type="text" readonly name="maxAmountForEquityCapital" class="form-control js-max-amount-for-equity-capital form-chf-numeric" value="" />
        </div>
      </td>
    </tr>
    <tr>
      <td>{% trans %}Revenu annuel net (min.){% endtrans %}</td>
      <td>
        <div class="form-group readonly">
          <input type="text" readonly name="minimalIncomeForEquityCapital" class="form-control js-minimal-income-for-equity-capital form-chf-numeric" value="" />
        </div>
      </td>
    </tr>
    </tbody>
  </table>
  <div class="spacer spacer-md"></div>
  <table class="table-wide table-hypotheque tablesaw tablesaw-stack" data-tablesaw-mode="stack">
    <thead>
    <tr>
      <th colspan="2"><strong>{% trans %}3. Revenu annuel net{% endtrans %}</strong></th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>{% trans %}Revenu annuel net du ménage{% endtrans %}</td>
      <td>
        <div class="form-group">
          <input type="text" value="" required class="form-control form-control-hypotheque js-income-input form-chf-numeric" name="income" placeholder="Le montant en CHF">
        </div>
      </td>
    </tr>
    <tr>
      <td>Prix d'achat (max.) sans droits de mutations et frais de notaire</td>
      <td>
        <div class="form-group readonly">
          <input type="text" readonly name="maxAmountForIncome" class="form-control js-max-amount-for-income form-chf-numeric" value="" />
      </td>
    </div>
    </tr>
    <tr>
      <td>{% trans %}Fonds propres (min.){% endtrans %}</td>
      <td>
        <div class="form-group readonly">
          <input type="text" readonly name="minEquityCapitalForIncome" class="form-control js-min-equity-capital-for-income form-chf-numeric" value="" />
        </div>
      </td>
    </tr>
    </tbody>
  </table>
  <div class="spacer spacer-md"></div>
  <table class="table-wide table-hypotheque tablesaw tablesaw-stack" data-tablesaw-mode="stack">
    <thead>
    <tr>
      <th colspan="2"><strong>{% trans %}4. Taux souhaité en 1er rang{% endtrans %}</strong></th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>{% trans %}Sélectionnez le taux qui vous intéresse en premier rang{% endtrans %}</td>
      <td>
        <div class="form-group">
          <select name="rate" class="form-control form-control-hypotheque js-rate-name full-width">
            {% for rate in variables.rates %}
              <option value="{{ rate.firstRate }}" data-first-rate="{{ rate.firstRate }}" data-second-rate="{{ rate.secondRate }}">{{ rate.getName() }}</option>
            {% endfor %}
          </select>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        {% trans %}Taux en pourcent{% endtrans %}
        {% spaceless %}
        {% if variables.rate_date %}
          ({{ variables.rate_date|date_format('F Y') }})
        {% endif %}
        {% endspaceless %}
      </td>
      <td>
        <div class="form-group readonly">
          <input type="text" class="form-control form-control-hypotheque form-percent-numeric js-rate" readonly value="" aria-label="Taux en pourcent">
        </div>
      </td>
    </tr>
    </tbody>
  </table>

  <div class="spacer spacer-md"></div>
  <div>
  {% if variables.rate_date %}
    <div class="alert alert-info">
      {% set formatted_date = variables.rate_date|date_format('F Y') %}
      {% trans %}Les taux utilisés sont ceux de {{ formatted_date }}{% endtrans %}
    </div>
  {% else %}
    <div class="alert alert-warning">
      {% trans %}La date des taux n'est pas connue, contactez Retraites Populaires pour en savoir plus.{% endtrans %}
    </div>
  {% endif %}
  </div>

  <button type="submit" class="btn btn-default btn-hypotheque pull-right">Calculer</button>
</form>


<div id="mortgage-results" class="js-mortgage-results hidden">

  <div class="spacer spacer-xl"></div>


  <table class="table-wide table-hypotheque tablesaw tablesaw-stack" data-tablesaw-mode="stack">
    <thead>
    <tr>
      <th colspan="2"><strong>{% trans %}Montant du prêt hypothécaire{% endtrans %}</strong></th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>{% trans %}Montant du prêt en 1<sup>er</sup> rang{% endtrans %}</td>
      <td>
        <span class="js-first-loan"> - </span>
      </td>
    </tr>
    <tr>
      <td>{% trans %}Montant du prêt en 2<sup>ème</sup> rang{% endtrans %}</td>
      <td>
        <span class="js-second-loan"> - </span>
      </td>
    </tr>
    <tr class="success">
      <td>{% trans %}Montant total du prêt hypothécaire{% endtrans %}</td>
      <td>
        <span class="js-total-loan"> - </span>
      </td>
    </tr>
    </tbody>
  </table>

  <div>
    <div class="spacer spacer-md"></div>
    <h3>{% trans %}Visualisation{% endtrans %}</h3>
    {% set advanceRateMax = (settings.advanceRateMax*100)|format_pourcent %}
    <div class="js-visualisation-loan">
      <h4>{% trans %}Financement hypothécaire nécessaire (max {{ advanceRateMax }}){% endtrans %}</h4>
      <div class="spacer spacer-xs"></div>
      <div class="progress media-heading">
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">

        </div>
        <div class="progress-pipe" role="progresspipe" aria-valuenow="{{ (settings.advanceRateMax*100) }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ (settings.advanceRateMax*100) }}%;"></div>
      </div>
      <p class="text-warning js-text-warning hidden">Fonds propres insuffisants.</p>
      <p class="text-success js-text-success hidden">Part que représente le financement hypothécaire sur le prix d'achat.</p>
    </div>

    <div class="spacer spacer-md"></div>
    <div class="js-visualisation-cost">
      {% set maxCost = (settings.maxCost*100)|format_pourcent %}
      <h4>Charge hypothécaire annuelle (max {{ maxCost }})</h4>
      <div class="spacer spacer-xs"></div>
      <div class="progress media-heading">
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">

        </div>
        <div class="progress-pipe" role="progresspipe" aria-valuenow="{{ (settings.maxCost*100) }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ (settings.maxCost*100) }}%;"></div>
      </div>

      <p class="text-warning js-text-warning hidden">Prix d'achat trop élevé. N'hésitez pas à nous contacter.</p>
      <p class="text-success js-text-success hidden">
        Les charges hypothécaires sont calculées à raison de 5% sur le 1er rang et 7% sur le 2ème rang. Le calcul tient également compte d'un forfait de frais d'entretien estimé à CHF 4800.- par année.
      </p>
    </div>
  </div>

  <div>
    <div class="spacer spacer-md"></div>
    <table class="table-wide table-hypotheque tablesaw tablesaw-stack" data-tablesaw-mode="stack">
      <thead>
      <tr>
        <th colspan="2"><strong>{% trans %}Charges hypothécaires annuelles théoriques{% endtrans %}</strong></th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>{% trans %}Intérêts en 1er rang{% endtrans %} <small class="js-first-rate pull-right"></small></td>
        <td>
          <span class="js-interest-first-loan"></span>
        </td>
      </tr>
      <tr>
        <td>{% trans %}Intérêts en 2ème rang{% endtrans %} <small class="js-second-rate pull-right"></small></td>
        <td>
          <span class="js-interest-second-loan"></span>
        </td>
      </tr>
      <tr>
        <td>{% trans %}Amortissement en 1er rang{% endtrans %}</td>
        <td>
          <span class="js-first-amortisation"></span>
        </td>
      </tr>
      <tr>
        <td>{% trans %}Amortissement en 2ème rang{% endtrans %}</td>
        <td>
          <span class="js-second-amortisation"></span>
        </td>
      </tr>
      <tr>
        <td>{% trans %}Frais annexes{% endtrans %}</td>
        <td>
          <span class="js-maintenance-fee"></span>
        </td>
      </tr>
      <tr class="success">
        <td>{% trans %}Charge mensuelle réelle{% endtrans %}</td>
        <td>
          <span class="js-monthly-living-cost"></span>
        </td>
      </tr>
      <tr class="success">
        <td>{% trans %}Charge annuelle réelle{% endtrans %}</td>
        <td>
          <span class="js-yearly-living-cost"></span>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

</div>



{# @TODO: Expose this with the Drupal Javascript API... #}
<script>
  window.MORTGAGE_RATES = {{ variables.rates|json_encode|raw }};
  window.MORTGAGE_SETTINGS = {{ variables.settings|json_encode|raw }};
</script>
